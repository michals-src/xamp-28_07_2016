!function(view){if(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10")){var constructors=["SVGSVGElement","SVGGElement"],dummy=document.createElement("dummy");if(!constructors[0]in view)return!1;if(Object.defineProperty){var innerHTMLPropDesc={get:function(){return dummy.innerHTML="",Array.prototype.slice.call(this.childNodes).forEach(function(node,index){dummy.appendChild(node.cloneNode(!0))}),dummy.innerHTML},set:function(content){var self=this,allNodes=Array.prototype.slice.call(self.childNodes),fn=function(to,node){if(1!==node.nodeType)return!1;var newNode=document.createElementNS("http://www.w3.org/2000/svg",node.nodeName);Array.prototype.slice.call(node.attributes).forEach(function(attribute){newNode.setAttribute(attribute.name,attribute.value)}),"TEXT"===node.nodeName&&(newNode.textContent=node.innerHTML),to.appendChild(newNode),node.childNodes.length&&Array.prototype.slice.call(node.childNodes).forEach(function(node,index){fn(newNode,node)})};content=content.replace(/<(\w+)([^<]+?)\/>/,"<$1$2></$1>"),allNodes.forEach(function(node,index){node.parentNode.removeChild(node)}),dummy.innerHTML=content,Array.prototype.slice.call(dummy.childNodes).forEach(function(node){fn(self,node)})},enumerable:!0,configurable:!0};try{constructors.forEach(function(constructor,index){Object.defineProperty(window[constructor].prototype,"innerHTML",innerHTMLPropDesc)})}catch(ex){}}else Object.prototype.__defineGetter__&&constructors.forEach(function(constructor,index){window[constructor].prototype.__defineSetter__("innerHTML",innerHTMLPropDesc.set),window[constructor].prototype.__defineGetter__("innerHTML",innerHTMLPropDesc.get)})}}(window),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var funcNameRegex=/function\s([^(]{1,})\(/,results=funcNameRegex.exec(this.toString());return results&&results.length>1?results[1].trim():""},set:function(){}}),function(){function CustomEvent(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}(window.MSInputMethodContext&&document.documentMode||-1!==navigator.appVersion.indexOf("MSIE 10"))&&(CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent)}(),ContentEdit.INDENT="",ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH=2e3,ContentTools.HIGHLIGHT_HOLD_DURATION=999999;var PBS={};window.addEventListener("DOMContentLoaded",function(){var editor;if(document.querySelector('[data-name="main-content"]')){if(localStorage&&localStorage.getItem("pbs-open-"+pbsParams.post_id)){localStorage.removeItem("pbs-open-"+pbsParams.post_id);var starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(document.querySelector(".ct-ignition__button--edit").dispatchEvent(new CustomEvent("click")),clearInterval(starterInterval))},200)}editor=ContentTools.EditorApp.get(),window._contentToolsShim(editor),editor.init("*[data-editable]","data-name"),editor.bind("start",function(){clearInterval(editor._toolbox._updateToolsTimeout),editor._toolbox._updateToolsTimeout=setInterval(editor._toolbox._updateTools,300)}),document.addEventListener("click",function(ev){"pbs-help-docs"===ev.target.getAttribute("id")&&"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open?HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"):"pbs-help-docs"===ev.target.getAttribute("id")?window.open("http://docs.pagebuildersandwich.com/","_blank"):"pbs-help-replay-tour"===ev.target.getAttribute("id")&&window.pbsPlayTour()}),document.querySelector("#wp-admin-bar-pbs_help_docs").addEventListener("click",function(ev){return"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open&&HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"),ev.preventDefault(),!1}),editor.bind("start",function(){editor._toolboxScrollCheckInterval=setInterval(function(){var elements=document.querySelectorAll(".media-modal-backdrop"),hasModal=!1;elements&&Array.prototype.forEach.call(elements,function(el){(0!==el.offsetWidth||0!==el.offsetHeight)&&(hasModal=!0)});var toolbox=document.querySelector(".ct-toolbox");toolbox&&toolbox.style["overflow-y"]!==(hasModal?"hidden":"")&&(toolbox.style["overflow-y"]=hasModal?"hidden":"")},300)}),editor.bind("stop",function(){clearInterval(editor._toolboxScrollCheckInterval)}),editor.bind("start",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="none",setTimeout(function(){adminBar.style["pointer-events"]=""},100))}),editor.bind("stop",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="")}),editor.bind("save",function(regions){var name,payload,xhr,xhrTracking;this.busy(!0),payload=new FormData;for(name in regions)if(regions.hasOwnProperty(name)){var html=regions[name];html=wp.hooks.applyFilters("pbs.save",html),payload.append(name,html)}payload.append("action","gambit_builder_save_content"),payload.append("save_nonce",pbsParams.save_nonce),payload.append("post_id",pbsParams.post_id),pbsParams.new_post_status&&(payload.append("post_status",pbsParams.new_post_status),pbsParams.new_post_status=void 0);var styles="";document.querySelector("style#pbs-style")&&(styles=document.querySelector("style#pbs-style").innerHTML),payload.append("style",styles),wp.hooks.doAction("pbs.save.payload",payload),xhr=new XMLHttpRequest,xhr.onload=function(){if(editor.busy(!1),xhr.status>=200&&xhr.status<400){if(xhr.responseText.match(/(http|https):\/\//)){var currentHref=window.location.href.replace(/#\.*$/,"");xhr.responseText!==currentHref&&(window.location.href=xhr.responseText)}new ContentTools.FlashUI("ok")}else new ContentTools.FlashUI("no")},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload),(pbsParams.show_opt_in_stats_track||pbsParams.stats_tracking_opted_in)&&(xhrTracking=new XMLHttpRequest,xhrTracking.open("POST",pbsParams.ajax_url),payload.append("action","pbs_save_content_tracking"),xhrTracking.send(payload))});var _isShiftDown=!1,_showColumnOutlines=_.debounce(function(){_isShiftDown&&document.querySelector("html").classList.add("pbs-show-outlines")},800),showColumnOutlines=function(e){e.shiftKey&&(_isShiftDown=!0,_showColumnOutlines())},hideColumnOutlines=function(e){16===e.which&&(_isShiftDown=!1,document.querySelector("html").classList.remove("pbs-show-outlines"))};editor.bind("start",function(){document.querySelector("html").classList.add("pbs-editing"),document.querySelector("html").classList.add("theme-"+pbsParams.theme_name);try{this.regions()["main-content"].children[0].focus()}catch(e){}this.domRegions()[0].classList.add("pbs-editing"),document.removeEventListener("keydown",this._handleHighlightOn),document.removeEventListener("keyup",this._handleHighlightOff),window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new CustomEvent("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16),document.addEventListener("keydown",showColumnOutlines),document.addEventListener("keyup",hideColumnOutlines)}),editor.bind("stop",function(){this.domRegions()[0].classList.remove("pbs-editing"),document.querySelector("html").classList.remove("pbs-editing"),document.querySelector("html").classList.remove("theme-"+pbsParams.theme_name),window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new CustomEvent("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16),document.removeEventListener("keydown",showColumnOutlines),document.removeEventListener("keyup",hideColumnOutlines)}),document.body.addEventListener("mousedown",function(e){(e.target.classList.contains("ct-ignition__button--confirm")||e.target.parentNode&&e.target.parentNode.classList.contains("ct-ignition__button--confirm"))&&window.PBSEditor.updateModifiedContent()}),document.body.addEventListener("mousedown",function(e){for(var editorArea=document.querySelector('[data-name="main-content"]'),isInEditorArea=editorArea.contains(e.target),isEditorArea=editorArea===e.target,editorSemiRoot=editorArea;"body"!==editorSemiRoot.parentNode.tagName.toLowerCase();)editorSemiRoot=editorSemiRoot.parentNode;var isInEditorSemiRoot=editorSemiRoot.contains(e.target);if(editorArea.classList.contains("pbs-editing")&&isInEditorSemiRoot&&!isEditorArea&&!isInEditorArea){var elem,rect=editorArea.getBoundingClientRect(),mainRegion=ContentTools.EditorApp.get().regions()["main-content"],isTop=!0;if(e.pageY>window.scrollY+rect.top+rect.height/2?(isTop=!1,elem=mainRegion.children[mainRegion.children.length-1]):elem=mainRegion.children[0],"Text"!==elem.constructor.name){var p=new ContentEdit.Text("p",{},"");isTop?elem.parent().attach(p,0):elem.parent().attach(p,elem.parent().children.indexOf(elem)+1),elem=p}var index=0;isTop||elem.content&&(index=elem.content.length()),e.preventDefault(),elem.focus();var selection=new ContentSelect.Range(index,index);return void selection.select(elem._domElement)}}),wp.hooks.doAction("pbs.init")}}),ContentEdit.DRAG_HOLD_DURATION=400,ContentEdit.Root.get().bind("drag",function(){document.querySelector('[data-name="main-content"]').classList.add("dragging")}),ContentEdit.Root.get().bind("drop",function(){document.querySelector('[data-name="main-content"]').classList.remove("dragging"),window.pbsFixRowWidths&&window.pbsFixRowWidths()}),window.pbsSelectorMatches=function(el,selector){var p=Element.prototype,f=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.msMatchesSelector||function(s){return-1!==[].indexOf.call(document.querySelectorAll(s),this)};return 1!==el.nodeType&&el.parentNode&&(el=el.parentNode),1!==el.nodeType?!1:f.call(el,selector)},window.cssToStyleObject=function(cssString){for(var match,regex=/([\w-]*)\s*:\s*([^;]*)/g,properties={};match=regex.exec(cssString);)properties[match[1]]=match[2];return properties},window.cssToStyleString=function(cssObject){var s="";for(var i in cssObject)cssObject.hasOwnProperty(i)&&(s+=i+":"+cssObject[i]+";");return s},ContentEdit.Element.prototype._onMouseMove=function(){};var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.PBSEditor={},window.PBSEditor.getToolUI=function(name){return ContentTools.EditorApp.get()._toolbox._toolUIs[name]},ContentEdit.Root.get().bind("mount",function(element){element.domElement()._ceElement=element}),window.PBSEditor.updateModifiedContent=function(){var regions=ContentTools.EditorApp.get().regions();for(var i in regions)regions.hasOwnProperty(i)&&window.PBSEditor.updateModifiedContentRecursive(regions[i])},window.PBSEditor.updateModifiedContentRecursive=function(element){var children=element.children;if(children)for(var k=0;k<children.length;k++){var ctElement=children[k];"undefined"!=typeof ctElement.content&&ctElement.content.html()!==ctElement._domElement.innerHTML&&window.PBSEditor.updateElementContent(ctElement,ctElement._domElement.innerHTML),window.PBSEditor.updateModifiedContentRecursive(ctElement)}},window.PBSEditor.updateElementContent=function(element,newContent){"Shortcode"!==element.constructor.name&&(element.content=new HTMLString.String(newContent,element.content.preserveWhitespace()).trim(),element.updateInnerHTML(),element.taint())},window.PBSEditor.isEditing=function(){var editorArea=document.querySelector('[data-name="main-content"]');return editorArea?editorArea.classList.contains("pbs-editing"):!1},window.PBSEditor.getUniqueClassName=function(domElement){if(domElement.getAttribute("class")){var classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/);if(matches)return matches[0]}return null},window.PBSEditor.removeUniqueClassName=function(domElement){if(domElement.getAttribute("class")){var classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/);if(matches)return domElement.classList.remove(matches[0]),!0}return!1},window.PBSEditor.generateUniqueClassName=function(){var name;do name="pbsguid-"+window.PBSEditor.generateHash();while(document.querySelector("."+name));return name},window.PBSEditor.generateHash=function(){return Math.floor(4294967296*(1+Math.random())).toString(36).substring(1)},window.PBSEditor.addPseudoElementStylesRaw=function(styles){var styleTag=document.querySelector("style#pbs-style");styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","pbs-style"),document.body.appendChild(styleTag));var currentStyles=styleTag.innerHTML+styles,mainRegion=ContentTools.EditorApp.get().regions()["main-content"];return"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styles},window.PBSEditor.addPseudoElementStyles=function(selector,styles){var selectorStillExists=window.PBSEditor.removePseudoElementStyles(selector,Object.keys(styles)),styleTag=document.querySelector("style#pbs-style");styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","pbs-style"),document.body.appendChild(styleTag));var currentStyles=styleTag.innerHTML,styleString="";for(var styleName in styles)if(styles.hasOwnProperty(styleName)){var value=styles[styleName];value.trim&&(value=value.trim()),value&&(styleString+=styleName+": "+value+";")}var escapedSelector=selector.replace(/\./g,"\\.");if(selectorStillExists){var re=new RegExp("("+escapedSelector+"\\s*\\{)","gm");currentStyles=currentStyles.replace(re,"$1"+styleString)}else currentStyles+=selector+" {"+styleString+"}";var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];return"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styleString},window.PBSEditor.getPseudoElementStyles=function(selector,style){var styleTag=document.querySelector("style#pbs-style");if(!styleTag)return null;var currentStyles=styleTag.innerHTML,selectorPattern=selector.replace(/\./g,"\\."),re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m"),matches=currentStyles.match(re);if(!matches)return null;for(var stylesMatch=matches[1].replace(/;$/,"").split(";"),k=0;k<stylesMatch.length;k++){var styleMatch=stylesMatch[k].match(new RegExp("^"+style+"\\s*:([\\s\\S]*$)"));if(styleMatch){var value=styleMatch[1].trim();return value&&(value=value.replace(/\s*!important/,"")),value}}return null},window.PBSEditor.removePseudoElementStyles=function(selector,styles){"string"==typeof styles&&(styles=[styles]);var styleTag=document.querySelector("style#pbs-style");if(!styleTag)return!1;for(var re,stylesMatch,selectorPattern=selector.replace(/\./g,"\\."),currentStyles=styleTag.innerHTML,i=0;i<styles.length;i++){var styleName=styles[i];re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m");var matches=currentStyles.match(re);if(matches){stylesMatch=matches[1].replace(/;$/,"").split(";");for(var k=0;k<stylesMatch.length;k++)if(stylesMatch[k].match(new RegExp("^"+styleName+"\\s*:"))){stylesMatch.splice(k,1);break}stylesMatch=stylesMatch.join(";"),currentStyles=currentStyles.replace(matches[0],""),currentStyles+=selector+" {"+stylesMatch+"}"}}return(currentStyles=currentStyles.replace(/(^|[^\}])+\{[\s]*\}/gm,"").trim())?(styleTag.innerHTML=currentStyles,re=new RegExp(selectorPattern+"\\s*\\{","gm"),!!styleTag.innerHTML.match(re)):(styleTag.parentNode.removeChild(styleTag),!1)},window.PBSEditor.convertSVGToBackgroundImage=function(svgElement){svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg");var svgString=svgElement.outerHTML;return svgString=svgString.replace(/"/g,"'"),svgString=svgString.replace(/</g,"%3C"),svgString=svgString.replace(/>/g,"%3E"),svgString=svgString.replace(/&/g,"%26"),svgString=svgString.replace(/#/g,"%23"),svgString=svgString.replace(/\n/g,""),svgString='url("data:image/svg+xml,'+svgString+'")'},window.PBSEditor.isCtrlDown=!1,window.PBSEditor.isShiftDown=!1,window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){(ev.ctrlKey||ev.metaKey)&&(window.PBSEditor.isCtrlDown=!0),ev.shiftKey&&(window.PBSEditor.isShiftDown=!0)}),document.addEventListener("keyup",function(ev){ev.ctrlKey||ev.metaKey||(window.PBSEditor.isCtrlDown=!1),ev.shiftKey||(window.PBSEditor.isShiftDown=!1)})}),function(){var _Root=ContentEdit.Root.get(),proxied=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){if(!this._dropTarget)return null;var placements=this._dropTarget.constructor.placements;if(-1===placements.indexOf("center")&&-1!==placements.indexOf("left")&&-1!==placements.indexOf("right")){var _ref,vert,horz,rect=this._dropTarget.domElement().getBoundingClientRect();return _ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],horz="center",horz=x<rect.width/2?"left":"right",vert="above",y>rect.height/2&&(vert="below"),[vert,horz]}return proxied.call(this,x,y)}}(),ContentEdit.Element.prototype.style=function(name,value){var style;return"undefined"==typeof value?this._domElement?(style=this._domElement.style[name],style?style:(style=window.getComputedStyle(this._domElement),style[name])):null:this._domElement?this._domElement.style[name]===value?value:(this._domElement.style[name]=value,style=this._domElement.getAttribute("style"),null===style?(this._attributes.style="",this.isMounted()&&this._domElement.removeAttribute("style"),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),this.debouncedTaint()):this.attr("style",style)):value},ContentEdit.Element.prototype.defaultStyle=function(name){var origStyleAttribute=this._domElement.getAttribute("style");this._domElement.style[name]="";var defaultStyle=window.getComputedStyle(this._domElement);return defaultStyle="undefined"!=typeof defaultStyle[name]?defaultStyle[name]:0,origStyleAttribute?this._domElement.setAttribute("style",origStyleAttribute):this._domElement.removeAttribute("style"),defaultStyle},ContentEdit.Element.prototype.attr=function(name,value){return name=name.toLowerCase(),void 0===value?this._attributes[name]:this._attributes[name]!==value?(this._attributes[name]=value,this.isMounted()&&"class"!==name.toLowerCase()&&this._domElement.setAttribute(name,value),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),ContentEdit.Root.get().trigger("debounced_taint",this),this.debouncedTaint()):void 0},ContentEdit.Element.prototype.removeAllCSSClasses=function(){if(this._domElement&&this._domElement.classList)for(var i=this._domElement.classList.length-1;i>=0;i--)this.removeCSSClass(this._domElement.classList.item(i))},window._contentToolsShim=function(editor){editor.start=function(){ContentTools.EditorApp.getCls().prototype.start.call(this),editor.trigger("start")},editor.stop=function(){ContentTools.EditorApp.getCls().prototype.stop.call(this),editor.trigger("stop")}},function(){var proxied=ContentEdit.Element.prototype._addCSSClass;ContentEdit.Element.prototype._addCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("over",this),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Element.prototype._removeCSSClass;ContentEdit.Element.prototype._removeCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("out",this),proxied.call(this,className)}}(),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]'))var starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(wp.hooks.doAction("pbs.ct.ready"),clearInterval(starterInterval))},200)}),ContentTools.IgnitionUI.prototype.mount=function(){this._domElement=document.querySelector("#wpadminbar"),this._domEdit=document.querySelector("#wp-admin-bar-gambit_builder_edit"),this._domEdit.classList.add("ct-ignition__button--edit"),this._domConfirm=document.querySelector("#wp-admin-bar-gambit_builder_save"),this._domConfirm.classList.add("ct-ignition__button--confirm"),this._domCancel=document.querySelector("#wp-admin-bar-gambit_builder_cancel"),this._domCancel.classList.add("ct-ignition__button--cancel"),this._domBusy=document.querySelector("#wp-admin-bar-gambit_builder_busy"),this._domBusy.classList.add("ct-ignition__button--busy");var ret=this._addDOMEventListeners();return this._domEdit.addEventListener("mousedown",function(){this.prevScrollY=window.scrollY}),this._domEdit.addEventListener("click",function(){window.scrollTo(0,this.prevScrollY)}),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-publish").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="publish",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","publish"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=pbsParams.labels.save_and_update}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-draft").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="draft",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","draft"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=pbsParams.labels.save_as_draft}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-pending").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="pending",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","pending"),this._domConfirm.querySelector(".ab-item").childNodes[1].nodeValue=pbsParams.labels.save_as_pending}.bind(this)),wp.hooks.doAction("pbs.ct.mounted"),ret},function(){var proxied=ContentTools.History.prototype.undo;ContentTools.History.prototype.undo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.undo"),ret}}(),function(){var proxied=ContentTools.History.prototype.redo;ContentTools.History.prototype.redo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.redo"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var height,width,rect;return!newSize&&this._domElement?(rect=this._domElement.getBoundingClientRect(),width=parseInt(rect.width||1,10),height=parseInt(rect.height||1,10),[width,height]):proxied.call(this,newSize)}}(),function(){var proxied=ContentEdit.ResizableElement.prototype._onMouseDown;ContentEdit.ResizableElement.prototype._onMouseDown=function(ev){var corner=this._getResizeCorner(ev.clientX,ev.clientY);corner&&window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown&&(this.style("width","auto"),this.style("height","auto"),this.attr("height",""),this.attr("width","")),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype.drop;ContentEdit.Element.prototype.drop=function(element,placement){var root=ContentEdit.Root.get();return element&&"undefined"!=typeof element.type&&!this.constructor.droppers[element.type()]&&!element.constructor.droppers[this.type()]&&element.constructor.droppers["*"]?(element._removeCSSClass("ce-element--drop"),element._removeCSSClass("ce-element--drop-"+placement[0]),element._removeCSSClass("ce-element--drop-"+placement[1]),element.constructor.droppers["*"](this,element,placement),void root.trigger("drop",this,element,placement)):proxied.call(this,element,placement)}}(),function(){var proxied=ContentEdit.Element.prototype._onOver;ContentEdit.Element.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(!ret){var root=ContentEdit.Root.get(),dragging=root.dragging();if(!dragging)return;if(dragging===this)return;if(root._dropTarget)return;if(this.constructor.droppers["*"])return this._addCSSClass("ce-element--drop"),root._dropTarget=this}return ret}}(),PBSEditor.Frame=wp.media.view.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},initialize:function(){wp.media.view.Frame.prototype.initialize.apply(this,arguments),_.defaults(this.options,{title:"My Modal",button:"My Button",modal:!0}),this.options.modal&&(this.modal=new wp.media.view.Modal({controller:this}),this.modal.content(this),this.modal.on("open",_.bind(function(){this._onOpen()},this)),this.modal.on("close",_.bind(function(){this._onClose()},this)))},open:function(args){args||(args={}),args.content&&this.modal.content(args.content(this)),this.successCallback=args.successCallback?args.successCallback:null,this.openCallback=args.openCallback?args.openCallback:null,this.closeCallback=args.closeCallback?args.closeCallback:null,this.modal.open(),this.modal.el.children[0].classList.add("pbs-modal-frame"),this.className&&this.modal.el.children[0].classList.add(this.className),this.modal.el.querySelector(".media-frame-title h1").textContent=args.title?args.title:this.options.title,this.modal.el.querySelector(".media-toolbar-primary button").textContent=args.button?args.button:this.options.button,this.modal.el.children[0].classList.add("pbs-frame-hide"),setTimeout(function(){this.modal.el.children[0].classList.remove("pbs-frame-hide")}.bind(this),50)},close:function(){this.modal.close()},_primaryClicked:function(){this.modal.close(),this.successCallback&&this.successCallback(this)},_onOpen:function(){this.openCallback&&this.openCallback(this)},_onClose:function(){this.closeCallback&&this.closeCallback(this)}}),PBSEditor.SearchFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled"),this.modal.el.querySelector(".pbs-no-results").style.display=""},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){this.selected=null,this.model.el.querySelector(".pbs-no-results").style.display="",this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim().toLowerCase(),shortcodes=this.modal.el.querySelectorAll(".pbs-search-list > *"),hasResult=!1;Array.prototype.forEach.call(shortcodes,function(el){""===keyword||-1!==el.textContent.trim().toLowerCase().indexOf(keyword)?(el.style.display="",hasResult=!0):el.style.display="none"}),this.modal.el.querySelector(".pbs-no-results").style.display=hasResult?"":"flex"},select:function(ev){for(var target=ev.target;!target.parentNode.classList.contains("pbs-search-list");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-selected")&&this.modal.el.querySelector(".pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),PBSEditor._IconFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click .pbs-icon-display [data-name]":"selectIcon"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');""===searchInput.value&&(searchInput.value="dashicons",this.searchKeyup({target:searchInput})),searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){for(this._searchResults=[],this.modal.el.querySelector(".pbs-no-results").style.display="";this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)");){var item=this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)");item.parentNode.removeChild(item)}this._prevKeyword="",this.selected=null,this._currentGroup=null,this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim();if(keyword&&this._prevKeyword!==keyword){this.reset(),this._prevKeyword=keyword,"undefined"==typeof pbsParams.icon_searches&&(pbsParams.icon_searches=[]),"undefined"!=typeof ev.keyCode&&pbsParams.icon_searches.push(keyword);var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=function(){if(request.status>=200&&request.status<400){if(request.responseText){var response=JSON.parse(request.responseText);return"undefined"!=typeof response.length||0===response.length?void this.displayNoResults():(this._searchResults=response,void this.displayResults())}this.displayNoResults()}}.bind(this),request.send("action=pbs_icon_search&nonce="+pbsParams.icon_nonce+"&s="+keyword)}},displayNoResults:function(){this.modal.el.querySelector(".pbs-no-results").style.display="flex"},displayResults:function(){var groupLabel,keys=Object.keys(this._searchResults);if(keys.length){var key=keys[0],result=this._searchResults[Object.keys(this._searchResults)[0]];if(delete this._searchResults[key],"undefined"==typeof this.groups){this.groups={};for(groupLabel in pbsParams.icon_groups)pbsParams.icon_groups.hasOwnProperty(groupLabel)&&(this.groups[groupLabel]=new RegExp(pbsParams.icon_groups[groupLabel],"i"))}var currGroup="";for(groupLabel in this.groups)if(this.groups.hasOwnProperty(groupLabel)){var groupRegex=this.groups[groupLabel];if(key.match(groupRegex)){currGroup=groupLabel;break}}if(this._currentGroup!==currGroup){var item=document.createElement("h4");item.innerHTML=groupLabel,item.classList.add("pbs-icon-group-title"),this.modal.el.querySelector(".pbs-icon-display").appendChild(item),this._currentGroup=currGroup}var icon=document.createElement("div");icon.innerHTML=result,icon.setAttribute("data-name",key),this.modal.el.querySelector(".pbs-icon-display").appendChild(icon),keys.length>1&&setTimeout(function(){this.displayResults()}.bind(this),5),this.modal.el.querySelector(".pbs-no-results").style.display=""}},selectIcon:function(ev){
for(var target=ev.target;!target.getAttribute("data-name");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-icon-display .pbs-selected")&&this.modal.el.querySelector(".pbs-icon-display .pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.iconFrame=new PBSEditor._IconFrame}),wp.hooks.addAction("pbs.save.payload",function(payload){"undefined"!=typeof pbsParams.icon_searches&&payload.append("icon_searches",pbsParams.icon_searches)}),PBSEditor._WidgetFrame=PBSEditor.SearchFrame.extend({className:"pbs-widget-modal",template:wp.template("pbs-widget-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-widget-slug]":"select"}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.widgetFrame=new PBSEditor._WidgetFrame}),PBSEditor._ShortcodeFrame=PBSEditor.SearchFrame.extend({className:"pbs-shortcode-modal",template:wp.template("pbs-shortcode-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-shortcode-tag]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initShortcodeList()},initShortcodeList:function(){var shortcodeArea=this.modal.el.querySelector(".pbs-search-list");if(!shortcodeArea.querySelector("*:not(.pbs-no-results)")){for(var sc,allShortcodes=[],i=0;i<pbsParams.shortcodes.length;i++){if(sc={tag:pbsParams.shortcodes[i],name:pbsParams.shortcodes[i],desc:""},PBSShortcodes[pbsParams.shortcodes[i]]){var map=PBSShortcodes[pbsParams.shortcodes[i]];map.label&&(sc.name=map.label),map.name&&(sc.name=map.name),map.desc&&(sc.desc=map.desc)}allShortcodes.push(sc)}allShortcodes.sort(function(a,b){var x=a.name.toLowerCase(),y=b.name.toLowerCase();return y>x?-1:x>y?1:0});for(var tag in allShortcodes)if(allShortcodes.hasOwnProperty(tag)){sc=allShortcodes[tag];var div=document.createElement("DIV");div.setAttribute("data-shortcode-tag",sc.tag);var title=document.createElement("H4");if(title.innerHTML=sc.name,div.appendChild(title),sc.desc){var desc=document.createElement("P");desc.innerHTML=sc.desc,div.appendChild(desc)}shortcodeArea.appendChild(div)}}}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.shortcodeFrame=new PBSEditor._ShortcodeFrame}),PBSEditor._PredesignedFrame=PBSEditor.SearchFrame.extend({className:"pbs-predesigned-modal",template:wp.template("pbs-predesigned-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){if(!this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")){var container=this.modal.el.querySelector(".pbs-search-list"),designElements=document.querySelectorAll("[data-design-element-template]");Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")),image&&(elem=document.createElement("img"),elem.setAttribute("src",image),elem.setAttribute("alt",name?name:templateID),button.appendChild(elem)),name&&(elem=document.createElement("h4"),elem.innerHTML=name,button.appendChild(elem)),description&&(elem=document.createElement("p"),elem.classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)})}}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.predesignedFrame=new PBSEditor._PredesignedFrame}),PBSEditor._HtmlFrame=PBSEditor.Frame.extend({className:"pbs-html-modal",template:wp.template("pbs-html-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked","keydown textarea":"tabHandler"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var input=this.modal.el.querySelector("textarea");input.focus(),""===input.value&&(input.value="<div>\n	<p>Sample HTML</p>\n</div>",input.select())}.bind(this),1)},_onClose:function(){this.modal.el.querySelector("textarea").focus()},tabHandler:function(e){if(9===e.keyCode){var val=e.target.value,start=e.target.selectionStart,end=e.target.selectionEnd;return e.target.value=val.substring(0,start)+"	"+val.substring(end),e.target.selectionStart=e.target.selectionEnd=start+1,e.preventDefault(),!1}},getHtml:function(){var html=this.modal.el.querySelector("textarea").value.trim(),dummy=document.createElement("div");return dummy.innerHTML=html,dummy.innerHTML.replace(/\s{2,}/g," ")},setHtml:function(html){html=html.trim(),html=this.formatXml(html).trim(),this.modal.el.querySelector("textarea").value=html},formatXml:function(xml){var formatted="",reg=/(>)(<)(\/*)/g;xml=xml.toString().replace(reg,"$1\r\n$2$3");var pad=0,nodes=xml.split("\r\n");for(var n in nodes){var node=nodes[n],indent=0;node.match(/.+<\/\w[^>]*>$/)?indent=0:node.match(/^<\/\w/)?0!==pad&&(pad-=1):indent=node.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var padding="",i=0;pad>i;i++)padding+="  ";formatted+=padding+node+"\r\n",pad+=indent}return formatted}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.htmlFrame=new PBSEditor._HtmlFrame}),PBSEditor.Overlays=[],PBSEditor.Overlay=function(){function Overlay(){this._domElement=null,this._active=!1,this._shown=!1,this._isMounted=!1,this._classname="",PBSEditor.Overlays.push(this),ContentEdit.Root.get().bind("over",function(element){ContentEdit.Root.get().dragging()||(clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){this._shown||this._hide(),this._shown=!1}.bind(this),10),this.canApply(element)&&(this.element=this.applyTo(element),this._shown=!0,this._show(this.element)))}.bind(this)),ContentEdit.Root.get().bind("drag",function(){this._hide()}.bind(this)),ContentEdit.Root.get().bind("drop",function(){this._hide()}.bind(this)),document.addEventListener("mouseover",function(ev){if(this._isMounted&&!Overlay.active){if(window.pbsSelectorMatches(ev.target,'[data-name="main-content"], [data-name="main-content"] *, .pbs-quick-action-overlay, .pbs-quick-action-overlay *, .pbs-toolbar, .pbs-toolbar *'))return;this._hide()}}.bind(this)),ContentEdit.Root.get().bind("taint",function(element){this.element===element&&this._show(element)}.bind(this)),ContentEdit.Root.get().bind("debounced_taint",function(element){this.element===element&&this._show(element)}.bind(this));var editor=ContentTools.EditorApp.get();editor.bind("start",function(){this._domElement=this.createElement(),this.mount()}.bind(this)),editor.bind("stop",function(){this.unmount()}.bind(this))}return Overlay.prototype.mount=function(){this._domElement.classList.add("pbs-quick-action-overlay"),this._domElement.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this._classname&&this._domElement.classList.add(this._classname),document.body.appendChild(this._domElement),this.addEventHandlers(),this._isMounted=!0},Overlay.prototype.unmount=function(){this.removeEventHandlers(),document.body.removeChild(this._domElement),this._isMounted=!1},Overlay.prototype.addEventHandlers=function(){this._mousedownBound=this._mousedown.bind(this),this._mousemoveBound=this._mousemove.bind(this),this._mouseupBound=this._mouseup.bind(this),this._mouseenterBound=this._mouseenter.bind(this),this._mouseleaveBound=this._mouseleave.bind(this),this._domElement.addEventListener("mousedown",this._mousedownBound),this._domElement.addEventListener("mouseenter",this._mouseenterBound),this._domElement.addEventListener("mouseleave",this._mouseleaveBound),document.addEventListener("mousemove",this._mousemoveBound),document.addEventListener("mouseup",this._mouseupBound)},Overlay.prototype.removeEventHandlers=function(){this._domElement.removeEventListener("mousedown",this._mousedownBound),this._domElement.removeEventListener("mouseenter",this._mouseenterBound),this._domElement.removeEventListener("mouseleave",this._mouseleaveBound),document.removeEventListener("mousemove",this._mousemoveBound),document.removeEventListener("mouseup",this._mouseupBound)},Overlay.prototype._mousedown=function(ev){return this.canApply()?(this._active=!0,this.startX=parseInt(ev.screenX,10),this.startY=parseInt(ev.screenY,10),this.deltaX=0,this.deltaY=0,Overlay.active=!0,this._domElement.classList.add("pbs-active"),document.body.classList.add("pbs-overlay-is-active"),document.body.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this.onClick(),void this.onMoveStart()):void(this._active=!1)},Overlay.prototype._mousemove=function(ev){this._active&&(this.deltaX=parseInt(ev.screenX,10)-this.startX,this.deltaY=parseInt(ev.screenY,10)-this.startY,ev.preventDefault(),ev.stopPropagation(),this.onMove(),Overlay.hideOtherOverlays(this))},Overlay.hideOtherOverlays=function(callingOverlay){Array.prototype.forEach.call(PBSEditor.Overlays,function(overlay){overlay!==callingOverlay&&overlay._hide()})},Overlay.prototype._mouseup=function(){this._active=!1,Overlay.active=!1,this._domElement.classList.remove("pbs-active"),document.body.classList.remove("pbs-overlay-is-active"),document.body.classList.remove("pbs-overlay-active-"+this.constructor.name.toLowerCase())},Overlay.prototype._mouseenter=function(){this._domElement.classList.add("pbs-over"),document.body.classList.add("pbs-overlay-hovered"),document.body.classList.add("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onEnter()},Overlay.prototype._mouseleave=function(){this._domElement.classList.remove("pbs-over"),document.body.classList.remove("pbs-overlay-hovered"),document.body.classList.remove("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onLeave()},Overlay.prototype._show=function(element){var root=ContentEdit.Root.get();element._domElement&&!root.dragging()&&(this._domElement.style.display="flex",this.show(element))},Overlay.prototype._hide=function(){this._domElement.style.display="none",this.hide()},Overlay.active=!1,Overlay.prevOverElement=null,Overlay.prototype.canApply=function(element){return!Overlay.active},Overlay.prototype.createElement=function(){},Overlay.prototype.onMoveStart=function(){},Overlay.prototype.onMove=function(){},Overlay.prototype.onClick=function(){},Overlay.prototype.show=function(element){},Overlay.prototype.hide=function(){},Overlay.prototype.onEnter=function(){},Overlay.prototype.onLeave=function(){},Overlay.prototype.applyTo=function(element){return element},Overlay}(),function(){var proxied=ContentEdit.Element.prototype._onMouseDown;ContentEdit.Element.prototype._onMouseDown=function(ev){return PBSEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseMove;ContentEdit.Element.prototype._onMouseMove=function(ev){return PBSEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){return PBSEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){return PBSEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseUp;ContentEdit.Element.prototype._onMouseUp=function(ev){return PBSEditor.Overlay.active?void 0:proxied.call(this,ev)}}(),PBSEditor.MarginBottom=function(_super){function MarginBottom(){MarginBottom.__super__.constructor.call(this),this.supportedElements=["Text","PreText","Image","Html","Icon","Map"]}return __extends(MarginBottom,_super),MarginBottom.prototype.createElement=function(){var element=document.createElement("DIV"),label=document.createElement("DIV");return element.appendChild(label),element},MarginBottom.prototype.canApply=function(element){return MarginBottom.__super__.canApply.call(this,element)?(element||(element=this.element),wp.hooks.applyFilters("pbs.overlay.margin_bottom.can_apply",!0,element)?-1!==this.supportedElements.indexOf(element.constructor.name):!1):!1},MarginBottom.prototype.show=function(element){var styles=getComputedStyle(element._domElement),rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.bottom+window.scrollY+"px",this._domElement.style.height=styles.marginBottom,this._domElement.style.left=rect.left+30+"px",this._domElement.style.width=rect.right-rect.left+"px",this._domElement.firstChild.innerHTML=styles.marginBottom},MarginBottom.prototype.onMoveStart=function(){var styles=getComputedStyle(this.element._domElement);this.initialValue=parseInt(styles.marginBottom,10)},MarginBottom.prototype.onMove=function(){var margin=this.deltaY+this.initialValue;if(0>margin&&(margin=0),window.PBSEditor.isShiftDown){var remainder=margin%10;margin-=remainder}this.element.style("margin-bottom",margin+"px"),this._domElement.style.height=margin+"px",this._domElement.firstChild.innerHTML=this._domElement.style.height},MarginBottom.prototype.onClick=function(){return window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?(this.element.style("margin-bottom",""),this.onMoveStart(),this._domElement.style.height=this.initialValue,void(this._domElement.firstChild.innerHTML=this._domElement.style.height)):void 0},MarginBottom}(PBSEditor.Overlay),PBSEditor.MarginTop=function(_super){function MarginTop(){MarginTop.__super__.constructor.call(this),this.supportedElements=["Text","PreText","Image","Html","Icon","Map"]}return __extends(MarginTop,_super),MarginTop.prototype.createElement=function(){var element=document.createElement("DIV"),label=document.createElement("DIV");return element.appendChild(label),element},MarginTop.prototype.canApply=function(element){return MarginTop.__super__.canApply.call(this,element)?(element||(element=this.element),wp.hooks.applyFilters("pbs.overlay.margin_top.can_apply",!0,element)?-1!==this.supportedElements.indexOf(element.constructor.name):!1):!1},MarginTop.prototype.show=function(element){var styles=getComputedStyle(element._domElement),rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.top+window.scrollY-parseInt(styles.marginTop,10)+"px",this._domElement.style.height=styles.marginTop,this._domElement.style.left=rect.left+30+"px",this._domElement.style.width=rect.right-rect.left+"px",this._domElement.firstChild.innerHTML=styles.marginTop},MarginTop.prototype.onMoveStart=function(){var styles=getComputedStyle(this.element._domElement);this.initialValue=parseInt(styles.marginTop,10)},MarginTop.prototype.onMove=function(){var margin=this.deltaY+this.initialValue;if(0>margin&&(margin=0),window.PBSEditor.isShiftDown){var remainder=margin%10;margin-=remainder}this.element.style("margin-top",margin+"px"),this._domElement.style.height=margin+"px",this._domElement.firstChild.innerHTML=this._domElement.style.height},MarginTop.prototype.onClick=function(){return window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?(this.element.style("margin-top",""),this.onMoveStart(),this._domElement.style.height=this.initialValue,void(this._domElement.firstChild.innerHTML=this._domElement.style.height)):void 0},MarginTop}(PBSEditor.Overlay),PBSEditor.MarginBottomContainer=function(_super){function MarginBottomContainer(){MarginBottomContainer.__super__.constructor.call(this),this._classname="pbs-overlay-marginbottom",this.supportedElements=["Tabs","DivRow","Carousel"]}return __extends(MarginBottomContainer,_super),MarginBottomContainer.prototype.getSupportedElement=function(element){for(var iterElem=element,lastMatchedElement=element;"Region"!==iterElem.constructor.name;)-1!==this.supportedElements.indexOf(iterElem.constructor.name)&&(lastMatchedElement=iterElem),iterElem=iterElem.parent();return lastMatchedElement},MarginBottomContainer.prototype.applyTo=function(element){return this.getSupportedElement(element)},MarginBottomContainer.prototype.canApply=function(element){return element||(element=this.element),element=this.getSupportedElement(element),wp.hooks.applyFilters("pbs.overlay.margin_bottom_container.can_apply",!0,element)&&-1!==this.supportedElements.indexOf(element.constructor.name)?!0:!1},MarginBottomContainer}(PBSEditor.MarginBottom),PBSEditor.MarginTopContainer=function(_super){function MarginTopContainer(){MarginTopContainer.__super__.constructor.call(this),this._classname="pbs-overlay-margintop",this.supportedElements=["Tabs","DivRow","Carousel"]}return __extends(MarginTopContainer,_super),MarginTopContainer.prototype.getSupportedElement=function(element){for(var iterElem=element,lastMatchedElement=element;"Region"!==iterElem.constructor.name;)-1!==this.supportedElements.indexOf(iterElem.constructor.name)&&(lastMatchedElement=iterElem),iterElem=iterElem.parent();return lastMatchedElement},MarginTopContainer.prototype.applyTo=function(element){return this.getSupportedElement(element)},MarginTopContainer.prototype.canApply=function(element){return element||(element=this.element),element=this.getSupportedElement(element),wp.hooks.applyFilters("pbs.overlay.margin_top_container.can_apply",!0,element)&&-1!==this.supportedElements.indexOf(element.constructor.name)?!0:!1},MarginTopContainer}(PBSEditor.MarginTop),PBSEditor.OverlayColumnWidth=function(_super){function OverlayColumnWidth(){OverlayColumnWidth.__super__.constructor.call(this)}return __extends(OverlayColumnWidth,_super),OverlayColumnWidth.prototype.createElement=function(){return document.createElement("DIV")},OverlayColumnWidth.prototype.canApply=function(element){return OverlayColumnWidth.__super__.canApply.call(this,element)?(element||(element=this.element),"DivCol"===element.constructor.name&&element.parent().children.indexOf(element)>0?!0:!1):!1},OverlayColumnWidth.prototype.onEnter=function(){this.element.parent().showOutline()},OverlayColumnWidth.prototype.onLeave=function(){this.element.parent().hideOutline()},OverlayColumnWidth.prototype.show=function(element){var rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.top+window.scrollY+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left-10+"px",this._domElement.style.width="20px"},OverlayColumnWidth.prototype.onMoveStart=function(){var cols=this.element.parent().children,colIndex=cols.indexOf(this.element);this.leftInitialValue=this.normalizeFlexGrow(cols[colIndex-1]),this.initialValue=this.normalizeFlexGrow(this.element),this.element.parent().showOutline()},OverlayColumnWidth.prototype.normalizeFlexGrow=function(col){for(var flex=parseFloat(col.style("flex-grow")),rowWidth=0,totalFlex=0,i=0;i<col.parent().children.length;i++){var otherCol=col.parent().children[i];totalFlex+=parseFloat(otherCol.style("flex-grow")),rowWidth+=parseInt(otherCol._domElement.offsetWidth,10)}return Math.floor(flex/totalFlex*rowWidth)},OverlayColumnWidth.prototype.onMove=function(){var row=this.element.parent(),cols=row.children,colIndex=cols.indexOf(this.element),widths=[];if(this.element.parent().showOutline(),!(-this.deltaX+this.initialValue<0||this.deltaX+this.leftInitialValue<0)){for(var i=0;i<cols.length;i++)widths.push(this.normalizeFlexGrow(cols[i]));for(i=0;i<cols.length;i++)cols[i].style("flex-grow",widths[i]);var amount=this.deltaX;if(window.PBSEditor.isShiftDown){var remainder=(this.deltaX+this.initialValue)%10;amount-=remainder}widths[colIndex]=-amount+this.initialValue,widths[colIndex-1]=amount+this.leftInitialValue,cols[colIndex-1].style("flex-grow",widths[colIndex-1]),cols[colIndex].style("flex-grow",widths[colIndex])}},OverlayColumnWidth}(PBSEditor.Overlay),PBSEditor.OverlayColumnWidthRight=function(_super){function OverlayColumnWidthRight(){OverlayColumnWidthRight.__super__.constructor.call(this)}return __extends(OverlayColumnWidthRight,_super),OverlayColumnWidthRight.prototype.canApply=function(element){return PBSEditor.OverlayColumnWidth.__super__.canApply.call(this,element)?(element||(element=this.element),"DivCol"===element.constructor.name&&element.parent().children.indexOf(element)<element.parent().children.length-1?!0:!1):!1},OverlayColumnWidthRight.prototype.onEnter=function(){this.element.parent().showOutline()},OverlayColumnWidthRight.prototype.onLeave=function(){this.element.parent().hideOutline()},OverlayColumnWidthRight.prototype.show=function(element){var rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.top+window.scrollY+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+rect.width-10+"px",this._domElement.style.width="20px"},OverlayColumnWidthRight.prototype.onMoveStart=function(){var cols=this.element.parent().children,colIndex=cols.indexOf(this.element);this.rightInitialValue=this.normalizeFlexGrow(cols[colIndex+1]),this.initialValue=this.normalizeFlexGrow(this.element),this.element.parent().showOutline()},OverlayColumnWidthRight.prototype.onMove=function(){var row=this.element.parent(),cols=row.children,colIndex=cols.indexOf(this.element),widths=[];if(this.element.parent().showOutline(),!(this.deltaX+this.initialValue<0||-this.deltaX+this.rightInitialValue<0)){for(var i=0;i<cols.length;i++)widths.push(this.normalizeFlexGrow(cols[i]));for(i=0;i<cols.length;i++)cols[i].style("flex-grow",widths[i]);var amount=this.deltaX;if(window.PBSEditor.isShiftDown){var remainder=(this.deltaX+this.initialValue)%10;amount-=remainder}widths[colIndex+1]=-amount+this.rightInitialValue,widths[colIndex]=amount+this.initialValue,cols[colIndex+1].style("flex-grow",widths[colIndex+1]),cols[colIndex].style("flex-grow",widths[colIndex])}},OverlayColumnWidthRight}(PBSEditor.OverlayColumnWidth),PBSEditor.OverlayColumnWidthLabels=function(_super){function OverlayColumnWidthLabels(){OverlayColumnWidthLabels.__super__.constructor.call(this)}return __extends(OverlayColumnWidthLabels,_super),OverlayColumnWidthLabels.prototype.createElement=function(){return document.createElement("DIV")},OverlayColumnWidthLabels.prototype.canApply=function(element){if(!OverlayColumnWidthLabels.__super__.canApply.call(this,element))return!1;element||(element=this.element);var ret=!1,row=element;if("DivCol"===element.constructor.name?(row=element.parent(),element.parent().children.length>1&&(ret=!0)):"DivRow"===element.constructor.name&&element.children.length>1&&(ret=!0),ret){for(;this._domElement.children.length>row.children.length;)this._domElement.removeChild(this._domElement.firstChild);for(;this._domElement.children.length<row.children.length;){var label=document.createElement("DIV");this._domElement.appendChild(label)}}return ret},OverlayColumnWidthLabels.prototype.show=function(element){"DivCol"===element.constructor.name&&(element=element.parent());var rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.top+window.scrollY-20+"px",this._domElement.style.height="20px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px";for(var labelContainerLeft=rect.left,percentageCount=0,i=0;i<element.children.length;i++){var label=this._domElement.children[i],percentage=Math.round(element.children[i]._domElement.offsetWidth/element._domElement.offsetWidth*100);element.children.length-1===i&&(percentage=100-percentageCount),percentageCount+=percentage,label.innerHTML=percentage+"%",rect=element.children[i]._domElement.getBoundingClientRect(),label.style.left=rect.left-labelContainerLeft+rect.width/2+"px"}},OverlayColumnWidthLabels}(PBSEditor.Overlay),PBSEditor.OverlayMapHeight=function(_super){function OverlayMapHeight(){OverlayMapHeight.__super__.constructor.call(this)}return __extends(OverlayMapHeight,_super),OverlayMapHeight.prototype.createElement=function(){var element=document.createElement("DIV"),label=document.createElement("DIV");return element.appendChild(label),element},OverlayMapHeight.prototype.canApply=function(element){return OverlayMapHeight.__super__.canApply.call(this,element)?(element||(element=this.element),"Map"===element.constructor.name):!1},OverlayMapHeight.prototype.show=function(element){var styles=getComputedStyle(element._domElement),rect=element._domElement.getBoundingClientRect();this._domElement.style.top=rect.bottom+window.scrollY-7.5+"px",this._domElement.style.left=rect.left+rect.width/2-7.5-30+"px";var label=styles.height;"250px"===styles.height&&(label="Auto"),this._domElement.firstChild.innerHTML=label},OverlayMapHeight.prototype.onMoveStart=function(){var styles=getComputedStyle(this.element._domElement);this.initialValue=parseInt(styles.height,10)},OverlayMapHeight.prototype.onMove=function(){var height=this.deltaY+this.initialValue;if(0>height&&(height=0),window.PBSEditor.isShiftDown){var remainder=height%10;height-=remainder}this.element.style("height",height+"px"),this.element.style("max-height",height+"px");var styles=getComputedStyle(this.element._domElement),label=styles.height;"250px"===styles.height&&(label=pbsParams.labels.auto,this.element.style("max-height","")),this._domElement.firstChild.innerHTML=label},OverlayMapHeight.prototype.onClick=function(){return window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?(this.element.style("height",""),this.element.style("max-height",""),this.onMoveStart(),this._domElement.style.height=this.initialValue,void(this._domElement.firstChild.innerHTML=pbsParams.labels.auto)):void 0},OverlayMapHeight}(PBSEditor.Overlay),window.addEventListener("DOMContentLoaded",function(){new PBSEditor.OverlayMapHeight}),PBSEditor.allDroppers={Carousel:ContentEdit.Element._dropVert,DivRow:ContentEdit.Element._dropVert,Div:ContentEdit.Element._dropVert,Embed:ContentEdit.Element._dropVert,Hr:ContentEdit.Element._dropVert,IFrame:ContentEdit.Element._dropVert,Shortcode:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Image:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert},PBSEditor.isNewStaticLikeElement=function(element){return"Static"===element.constructor.name?!1:"undefined"==typeof element._content?!1:!0},ContentEdit.Text.prototype._elementOverrideKeyLeft=ContentEdit.Text.prototype._keyLeft,ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]){var elem=this.previousContent();if(elem&&PBSEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyLeft(ev)},ContentEdit.Text.prototype._elementOverrideKeyRight=ContentEdit.Text.prototype._keyRight,ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)){var elem=this.nextContent();if(elem&&PBSEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyRight(ev)},window.addEventListener("DOMContentLoaded",function(){var editor=ContentEdit.Root.get();document.addEventListener("keydown",function(ev){if(editor.focused()&&PBSEditor.isNewStaticLikeElement(editor.focused())&&-1!==["body","html"].indexOf(ev.target.tagName.toLowerCase())&&-1===[16,17,18,91,92].indexOf(ev.which)){var p,elem,parent,selection,sc=editor.focused(),index=sc.parent().children.indexOf(sc);if(-1!==[13,8,46].indexOf(ev.which)&&ev.preventDefault(),8===ev.which?(sc.blur(),sc.parent().children[index-1]?(elem=sc.parent().children[index-1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):sc.parent().children[index+1]?(elem=sc.parent().children[index+1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},1))):46===ev.which&&(sc.blur(),sc.parent().children[index+1]?sc.parent().children[index+1].focus():sc.parent().children[index-1]?sc.parent().children[index-1].focus():(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},1))),8===ev.which||46===ev.which)return void sc.parent().detach(sc);if((40===ev.which||39===ev.which)&&sc.nextContent()&&sc.parent().children.indexOf(sc)!==sc.parent().children.length-1)return ev.preventDefault(),void sc.nextContent().focus();if((38===ev.which||37===ev.which)&&sc.previousContent()&&0!==sc.parent().children.indexOf(sc))return ev.preventDefault(),void sc.previousContent().focus();38!==ev.which&&37!==ev.which&&index++,p=new ContentEdit.Text("p"),sc.parent().attach(p,index),sc.blur(),p.focus()}})}),ContentEdit.Node.prototype._overridePreviousContent=ContentEdit.Node.prototype.previousContent,ContentEdit.Node.prototype.previousContent=function(){var node=this.previousWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)});return node},ContentEdit.Node.prototype._overrideNextContent=ContentEdit.Node.prototype.nextContent,ContentEdit.Node.prototype.nextContent=function(){return this.nextWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)})},function(){var proxied=ContentEdit.Static.prototype._onMouseUp;ContentEdit.Static.prototype._onMouseUp=function(ev){proxied.call(this,ev),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseOut;ContentEdit.Static.prototype._onMouseOut=function(ev){proxied.call(this,ev),this._doubleClickCount=0,clearTimeout(this._dragTimeout)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseMove;ContentEdit.Static.prototype._onMouseMove=function(ev){proxied.call(this,ev),this._doubleClickCount=0}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseDown;ContentEdit.Static.prototype._onMouseDown=function(ev){ev.preventDefault(),ev.stopPropagation(),proxied.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target&&(this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION/2),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++,3===this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,"function"==typeof this._onDoubleClick&&this._onDoubleClick(ev)))}}(),ContentEdit.Static.prototype.convertToText=function(text,keepSize){"undefined"==typeof keepSize&&(keepSize=!1);var elem=document.createElement("P");elem.innerHTML=text,elem=ContentEdit.Text.fromDOMElement(elem),this.blur();var index=this.parent().children.indexOf(this),rect=this._domElement.getBoundingClientRect(),marginBottom=0;if(this._domElement.nextElementSibling){var nextRect=this._domElement.nextElementSibling.getBoundingClientRect();marginBottom=nextRect.top-rect.bottom}return this.parent().attach(elem,index),this.parent().detach(this),keepSize&&(elem._domElement.style.minHeight=rect.height+"px",elem._domElement.style.marginBottom=marginBottom+"px"),elem.focus(),function(elem){setTimeout(function(){var selection=new ContentSelect.Range(elem.content.length(),elem.content.length());elem._domElement&&selection.select(elem._domElement);
},1)}(elem),elem},ContentEdit.StaticEditable=function(_super){function StaticEditable(tagName,attributes,content){this._doubleClickCount=0,StaticEditable.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(StaticEditable,_super),StaticEditable.droppers=PBSEditor.allDroppers,StaticEditable.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},StaticEditable.prototype._onMouseOver=function(ev){return StaticEditable.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},StaticEditable.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},StaticEditable.prototype.cssTypeName=function(){return"staticeditable"},StaticEditable.prototype.typeName=function(){return"StaticEditable"},StaticEditable}(ContentEdit.Static),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(ev.preventDefault(),this.content.isWhitespace())return proxied.call(this,ev);if(ev.shiftKey||ev.metaKey||ev.ctrlKey){ContentSelect.Range.query(this._domElement);var selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),cursor=selection.get()[0]+1,br=new HTMLString.String("<br><br>",!0);return 0!==tail.length()&&(br=new HTMLString.String("<br>",!0)),this.content=tip.concat(br,tail),this.updateInnerHTML(),selection.set(cursor,cursor),this.selection(selection),this.taint()}return proxied.call(this,ev)}}(),function(){ContentEdit.Text.prototype._onMouseDown=function(ev){return this.isFocused()&&this.content.isWhitespace()?void ev.preventDefault():(ContentEdit.Text.__super__._onMouseDown.call(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION))}}(),function(){var bringBackState=!1,mouseDownHandler=function(ev){if(!ev.target._ceElement&&window.pbsSelectorMatches(ev.target,"[data-editable]")){var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.storeState(),bringBackState=!0}},mouseUpHandler=function(){if(bringBackState){bringBackState=!1;var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.restoreState()}},proxiedFocus=ContentEdit.Text.prototype.focus;ContentEdit.Text.prototype.focus=function(supressDOMFocus){var ret=proxiedFocus.call(this,supressDOMFocus);return document.addEventListener("mousedown",mouseDownHandler),document.addEventListener("mouseup",mouseUpHandler),ret};var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){var ret=proxiedBlur.call(this);return document.removeEventListener("mousedown",mouseDownHandler),document.removeEventListener("mouseup",mouseUpHandler),ret}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyDown;ContentEdit.Text.prototype._onKeyDown=function(ev){if(-1===[40,37,39,38,9,8,46,13,32].indexOf(ev.keyCode)){var n,range,sel,docRange=window.getSelection().getRangeAt(0);docRange.startContainer.parentNode&&(docRange.startContainer.nextSibling&&"A"!==docRange.startContainer.parentNode.tagName&&"A"===docRange.startContainer.nextSibling.tagName?docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.nextSibling.innerHTML.match(/^&nbsp;/)||(n=document.createTextNode(" "),docRange.startContainer.nextSibling.insertBefore(n,docRange.startContainer.nextSibling.firstChild),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer.nextSibling,1),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))):"A"===docRange.startContainer.parentNode.tagName&&docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.parentNode.innerHTML.match(/&nbsp;$/)||(n=document.createTextNode(" "),docRange.startContainer.parentNode.appendChild(n)),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer,docRange.startContainer.length),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range)))}proxied.call(this,ev)}}(),function(){var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){if(this._domElement){var innerHTML=this._domElement.innerHTML;innerHTML=innerHTML.replace(/(\s|&nbsp;)+(<\/a>)/,"$2"),innerHTML=innerHTML.replace(/(<a\s[^>]+>)(&nbsp;|\s)+/,"$1"),this._domElement.innerHTML!==innerHTML&&(this._domElement.innerHTML=innerHTML,this._syncContent())}return proxiedBlur.call(this)}}(),function(){var proxied=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(ev){return this._domElement&&"undefined"!=typeof this._domElement.innerHTML?proxied.call(this,ev):this._flagIfEmpty()}}(),ContentEdit.Shortcode=function(_super){function Shortcode(tagName,attributes,content){this.sc_hash=attributes["data-shortcode"],this.sc_base=attributes["data-base"],this.sc_raw=atob(this.sc_hash),this.sc_prev_raw=this.sc_raw,this.model=new Backbone.Model({}),this.parseShortcode(),this.model.element=this,this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,Shortcode.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Shortcode,_super),Shortcode.sc_raw="",Shortcode.sc_hash="",Shortcode.sc_base="",Shortcode.sc_prev_raw="",Shortcode.btoa=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},Shortcode.prototype.mount=function(){var ret=Shortcode.__super__.mount.call(this),scStyles=getComputedStyle(this._domElement);return"0px"===scStyles.height?this._domElement.classList.add("pbs--blank"):this._domElement.classList.remove("pbs--blank"),ret},Shortcode.createShortcode=function(shortcode){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","shortcode"),o.setAttribute("data-base",shortcode.shortcode.tag),o.setAttribute("data-shortcode",Shortcode.btoa(shortcode.shortcode.string())),ContentEdit.Shortcode.fromDOMElement(o)},Shortcode.prototype.convertToText=function(){var innerHTML=this._domElement.innerHTML,elem=Shortcode.__super__.convertToText.call(this,this.sc_raw);return elem.origShortcode=this.sc_raw,elem.origInnerHTML=innerHTML,elem.isShortcodeEditing=!0,elem},Shortcode.prototype.parseShortcode=function(){var sc=wp.shortcode.next(this.sc_base,this.sc_raw,0);for(var attributeName in sc.shortcode.attrs.named)sc.shortcode.attrs.named.hasOwnProperty(attributeName)&&this.model.set(attributeName,sc.shortcode.attrs.named[attributeName],{silent:!0});for(var i=0;i<sc.shortcode.attrs.numeric.length;i++)this.model.set(i,sc.shortcode.attrs.numeric[i],{silent:!0});this.model.set("content",sc.shortcode.content,{silent:!0})},Shortcode.prototype._onDoubleClick=function(){wp.hooks.applyFilters("pbs.shortcode.allow_raw_edit",!0,this.sc_base,this)&&this.convertToText()},Shortcode.prototype.cssTypeName=function(){return"shortcode"},Shortcode.prototype.typeName=function(){return"Shortcode"},Shortcode.prototype.clone=function(){var root=ContentEdit.Root.get();root.focused()===this&&root.focused().blur();var clone=document.createElement("div");clone.innerHTML=this.html();var newElement=Shortcode.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);this.parent().attach(newElement,index+1),newElement.focus()},Shortcode.prototype.modelChanged=function(){this.updateSCRaw(),this.updateSCHash(),clearTimeout(this._scRefreshTrigger);var _this=this;this._scRefreshTrigger=setTimeout(function(){_this.ajaxUpdate()},500)},Shortcode.prototype.setSCAttr=function(name,value){this.model.set(name,value)},Shortcode.prototype.setSCContent=function(value){this.model.set("content",value)},Shortcode.prototype.updateSCRaw=function(){var sc="";sc+="["+this.sc_base;for(var keys=this.model.keys(),i=0;i<keys.length;i++){var attrName=keys[i];if("content"!==attrName){var value=this.model.get(attrName)||"";value=value.replace(/\n/g,"<br>"),sc+=" "+attrName+'="'+value+'"'}}sc+="]",this.model.get("content")&&(sc+=this.model.get("content")),sc+="[/"+this.sc_base+"]",this.sc_raw=sc},Shortcode.prototype.updateSCHash=function(){this.sc_hash=Shortcode.btoa(this.sc_raw),this.attr("data-shortcode",this.sc_hash)},Shortcode.prototype.ajaxUpdate=function(forceUpdate){if(this.sc_prev_raw!==this.sc_raw||forceUpdate){var payload=new FormData;payload.append("action","pbs_shortcode_render"),payload.append("shortcode",this.sc_hash),payload.append("nonce",pbsParams.shortcode_nonce),this._domElement.classList.add("pbs--rendering");var _this=this,request=new XMLHttpRequest;request.open("POST",window.location.href),request.onload=function(){if(request.status>=200&&request.status<400){var response=JSON.parse(request.responseText),enqueued=response.scripts+response.styles,dummyContainer=document.createElement("div");dummyContainer.innerHTML=enqueued.trim();var currentHead=document.querySelector("html").innerHTML;if(enqueued.trim().length)for(var i=dummyContainer.childNodes.length-1;i>=0;i--)if(dummyContainer.childNodes[i].getAttribute){var node=dummyContainer.childNodes[i];-1===currentHead.indexOf(node.outerHTML)&&document.body.appendChild(node)}var rendered=response.output.trim();if(_this._domElement.innerHTML=rendered,_this._content=rendered,_this.style("float",""),1===_this._domElement.children.length)try{var style=getComputedStyle(_this._domElement.firstChild);("left"===style["float"]||"right"===style["float"])&&_this.style("float",style["float"])}catch(err){}document.dispatchEvent(new CustomEvent("pbs:shortcode-render",{detail:document.querySelector(".pbs--rendering")}))}_this._domElement.classList.remove("pbs--rendering"),_this._domElement.classList.remove("pbs--blank"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw;var scStyles=getComputedStyle(_this._domElement);"0px"===scStyles.height?_this._domElement.classList.add("pbs--blank"):_this._domElement.classList.remove("pbs--blank")},request.onerror=function(){_this._domElement.classList.remove("pbs--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw},request.send(payload)}},Shortcode}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Shortcode,"shortcode"),ContentEdit.Text.prototype.convertShortcodes=function(){var html=this.content.html(),textParts=[],shortcodes=[];if(""!==html.trim()){var shortcodeRegex=/\[([^\/][\w-_]+)[^\]]*\]/g,shortcodeMatch=shortcodeRegex.exec(html);if(shortcodeMatch){for(var prevIndex=0;shortcodeMatch;)if(-1!==pbsParams.shortcodes.indexOf(shortcodeMatch[1]))if(shortcodeMatch.index<prevIndex)shortcodeMatch=shortcodeRegex.exec(html);else{var base=shortcodeMatch[1],sc=wp.shortcode.next(base,html,shortcodeMatch.index);textParts.push(html.substr(prevIndex,shortcodeMatch.index-prevIndex)),shortcodes.push(sc),prevIndex=shortcodeMatch.index+sc.content.length,shortcodeMatch=shortcodeRegex.exec(html)}else shortcodeMatch=shortcodeRegex.exec(html);if(0!==shortcodes.length){textParts.push(html.substr(prevIndex));var elem,minHeight,bottomMargin,insertAt=this.parent().children.indexOf(this),parent=this.parent(),dom=this._domElement;dom&&dom.style.minHeight&&(minHeight=dom.style.minHeight,bottomMargin=dom.style.bottomMargin);for(var i=0;i<textParts.length+shortcodes.length;i++){var isShortcode=i%2===1;if(elem=null,0!==i){if(isShortcode?elem=ContentEdit.Shortcode.createShortcode(shortcodes[Math.floor(i/2)]):textParts[i/2].trim()&&(elem=document.createElement("P"),elem.innerHTML=textParts[i/2],elem=ContentEdit.Text.fromDOMElement(elem)),elem&&(insertAt++,parent.attach(elem,insertAt),1===i&&dom&&minHeight&&(elem._domElement.style.minHeight=minHeight,elem._domElement.style.bottomMargin=bottomMargin),"Shortcode"===elem.constructor.name)){var doAjax=!0;if(1===i&&elem.sc_raw===this.origShortcode){elem._domElement.innerHTML=this.origInnerHTML,elem._content=this.origInnerHTML;var scStyles=getComputedStyle(elem._domElement);"0px"===scStyles.height?elem._domElement.classList.add("pbs--blank"):elem._domElement.classList.remove("pbs--blank"),doAjax=!1}doAjax&&elem.ajaxUpdate(!0)}}else this.content=new HTMLString.String(textParts[i],!0),this.updateInnerHTML(),this.taint()}this.parent()&&this.content.isWhitespace()&&this.parent().detach(this)}}}},function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(this.isShortcodeEditing)return this.blur(),this.convertShortcodes();var ret=proxied.call(this,ev);return this.convertShortcodes(),ret}}(),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertShortcodes()}),document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.html().match(/\[\w+[^\]]+\]/)&&focused.blur()})}),window.addEventListener("DOMContentLoaded",function(){var shortcodes=document.querySelectorAll('[data-name="main-content"] [data-shortcode]');Array.prototype.forEach.call(shortcodes,function(el){if(1===el.children.length)try{var style=getComputedStyle(el.firstChild);("left"===style["float"]||"right"===style["float"])&&(el.style["float"]=style["float"])}catch(err){}})}),ContentEdit.Hr=function(_super){function Hr(tagName,attributes){this.model=new Backbone.Model({}),Hr.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Hr,_super),Hr.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Hr.droppers=PBSEditor.allDroppers,Hr.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Hr.prototype.cssTypeName=function(){return"hr"},Hr.prototype.typeName=function(){return"Horizontal Rule"},Hr}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Hr,"hr"),ContentEdit.Embed=function(_super){function Embed(tagName,attributes,content){this.url=attributes["data-url"],this.model=new Backbone.Model({}),this._doubleClickCount=0,Embed.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Embed,_super),Embed.create=function(url){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","embed"),o.setAttribute("data-url",url),ContentEdit.Embed.fromDOMElement(o)},Embed.prototype.mount=function(){var ret=Embed.__super__.mount.call(this);return this._domElement.innerHTML="",jQuery(this._domElement).html(this._content),wp.hooks.doAction("pbs.embed.mount",this),ret},Embed.prototype._onDoubleClick=function(){this.convertToText(this.url,!1)},Embed.prototype.cssTypeName=function(){return"embed"},Embed.prototype.typeName=function(){return"Embed"},Embed.updateEmbedContent=function(url,textElement){var payload=new FormData;payload.append("post_ID",pbsParams.post_id),payload.append("type","embed"),payload.append("action","parse-embed"),payload.append("shortcode","[embed]"+url+"[/embed]");var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url),request.onload=function(){if(request.status>=200&&request.status<400){var response=JSON.parse(request.responseText);if(!response.success)return;if(!textElement.parent())return;var elem=ContentEdit.Embed.create(url),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement),jQuery(elem._domElement).html("<p>"+response.data.body+"</p>"),elem._content="<p>"+response.data.body+"</p>",elem._domElement.classList.remove("pbs--rendering"),wp.hooks.doAction("pbs.embed.update_embed_content",elem)}},request.onerror=function(){},request.send(payload)},Embed}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Embed,"embed"),ContentEdit.Text.prototype.convertOEmbedURLs=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(this.content.html().match(/<a[^>]+/g)||(text=text.trim(),text&&text.match(/^https?:\/\/[^\s/$.?#].[^\s]*$/)&&ContentEdit.Embed.updateEmbedContent(text,this)))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertOEmbedURLs()})}),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"]');Array.prototype.forEach.call(shortcodes,function(el){var html=el.innerHTML;el.innerHTML="",jQuery(el).html(html)})})}),function(){ContentEdit.PreText.prototype.unhighlight=function(){this.updateInnerHTML()},ContentEdit.PreText.prototype.rehighlight=function(){"undefined"!=typeof hljs&&(this.storeState(),this.removeAllCSSClasses(),hljs.highlightBlock(this._domElement),this.restoreState())}}(),function(){var proxied=ContentEdit.PreText.prototype.html;ContentEdit.PreText.prototype.html=function(indent){return proxied.call(this,indent),this._cached=this._cached.replace(/<\/?\w+[^>]*>/g,""),""+indent+"<"+this._tagName+this._attributesToString()+">"+(""+this._cached+"</"+this._tagName+">")}}(),function(){var proxied=ContentEdit.PreText.prototype.focus;ContentEdit.PreText.prototype.focus=function(){var ret=proxied.call(this);return this.unhighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.mount;ContentEdit.PreText.prototype.mount=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.blur;ContentEdit.PreText.prototype.blur=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.fromDOMElement;ContentEdit.PreText.fromDOMElement=function(domElement){return domElement.innerHTML=domElement.innerHTML.replace(/<\/?\w+[^>]*>/g,""),proxied.call(this,domElement)}}(),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){window.pbsInitAllPretext&&window.pbsInitAllPretext()})}),function(){var proxied=ContentEdit.PreText.prototype._onKeyDown;ContentEdit.PreText.prototype._onKeyDown=function(ev){if(9===ev.keyCode){ev.preventDefault(),ContentSelect.Range.query(this._domElement);var insertAt,selection=ContentSelect.Range.query(this._domElement),preserveWhitespace=this.content.preserveWhitespace();insertAt=selection.get()[1],this.content=this.content.insert(insertAt,new HTMLString.String("	",preserveWhitespace),preserveWhitespace),this.updateInnerHTML(),insertAt+=1,selection=new ContentSelect.Range(insertAt,insertAt),selection.select(this.domElement())}return proxied.call(this,ev)}}(),function(){var fitVideos=function(element){if("undefined"!=typeof jQuery&&"undefined"!=typeof jQuery.fn.fitVids){var domElement=element._domElement||element;jQuery(domElement).fitVids()}};wp.hooks.addAction("pbs.embed.mount",fitVideos),wp.hooks.addAction("pbs.embed.update_embed_content",fitVideos),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"] iframe');Array.prototype.forEach.call(shortcodes,function(el){fitVideos(el.parentNode)})})})}();var pbsTwitterMount=function(element){var domElement=element._domElement||element;if(domElement.querySelector("[data-tweet-id]")){var tweetID=domElement.querySelector("[data-tweet-id]").getAttribute("data-tweet-id");domElement.innerHTML="",twttr.widgets.createTweet(tweetID,domElement)}};wp.hooks.addAction("pbs.embed.mount",pbsTwitterMount),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll("[data-tweet-id]");Array.prototype.forEach.call(shortcodes,function(el){pbsTwitterMount(el.parentNode)})})}),ContentEdit.IFrame=function(_super){function IFrame(tagName,attributes,content){this.model=new Backbone.Model({}),IFrame.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(IFrame,_super),IFrame.prototype.html=function(){return"<p>"+this._content+"</p>"},IFrame.prototype._onDoubleClick=function(){var html=this._domElement.innerHTML.replace(/</g,"&lt;").replace(/<p>|<\/p>/g,"").replace(/data-ce-tag=['"]iframe['"]/,""),textElement=this.convertToText(html,!1);textElement.isIframeEditing=!0},IFrame.prototype.cssTypeName=function(){return"iframe"},IFrame.prototype.typeName=function(){return"IFrame"},IFrame.convertTextToIFrame=function(html,textElement){var elem=new ContentEdit.IFrame("P",[],html),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement)},IFrame}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.IFrame,"iframe"),function(){var proxied=ContentEdit.Text.fromDOMElement;ContentEdit.Text.fromDOMElement=function(domElement){return domElement&&domElement.children&&1===domElement.children.length&&"IFRAME"===domElement.firstChild.tagName?new ContentEdit.IFrame(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML):proxied.call(this,domElement)}}(),ContentEdit.Text.prototype.convertIFrameTags=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(text=text.trim(),text&&text.match(/^\s*<iframe.*/)&&ContentEdit.IFrame.convertTextToIFrame(text,this))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertIFrameTags()})}),window.addEventListener("DOMContentLoaded",function(){document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.text().match(/^\s*<iframe.*/)&&focused.blur()})}),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){return this.isIframeEditing?void this.blur():proxied.call(this,ev)}}(),ContentEdit.Div=function(_super){function Div(tagName,attributes){Div.__super__.constructor.call(this,tagName,attributes)}return __extends(Div,_super),Div.prototype.cssTypeName=function(){return"div"},Div.prototype.type=function(){return"Div"},Div.prototype.typeName=function(){return"Div"},Div.prototype._onMouseUp=function(ev){ev.target===this._domElement&&(Div.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout))},Div.prototype._onMouseOut=function(ev){Div.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},Div.prototype._onMouseDown=function(ev){return ev.target===this._domElement&&(Div.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)?(ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},Div.prototype._onMouseOver=function(ev){ev.target===this._domElement&&Div.__super__._onMouseOver.call(this,ev)},Div.prototype._onMouseMove=function(ev){Div.__super__._onMouseMove.call(this,ev)},Div.prototype.attach=function(component,index){2===this.children.length&&"undefined"!=typeof this.children[0].content&&this.children[0].content.isWhitespace()&&this.detach(this.children[0]),2===this.children.length&&"undefined"!=typeof this.children[1].content&&this.children[1].content.isWhitespace()&&this.detach(this.children[1]),Div.__super__.attach.call(this,component,index)},Div.prototype.detach=function(element){ContentEdit.NodeCollection.prototype.detach.call(this,element),setTimeout(function(){0===this.children.length&&this.attach(new ContentEdit.Text("p"),0)}.bind(this),1)},Div.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;return root.focused()&&root.focused().blur(),void(this.children[i].focus&&this.children[i].focus())}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},Div.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this.isFocused()?(this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Div._dropInside=function(element,target,placement){var insertIndex=0;return"below"===placement[0]&&(insertIndex=target.children.length),target.attach(element,insertIndex)},Div.droppers=PBSEditor.allDroppers,Div._fromDOMElement=function(domElement){var cls,tagNames=ContentEdit.TagNames.get();if(domElement.getAttribute("data-ce-tag"))cls=tagNames.match(domElement.getAttribute("data-ce-tag"));else if(domElement.classList.contains("pbs-row"))cls=tagNames.match("row");else if(domElement.classList.contains("pbs-col"))cls=tagNames.match("column");else if(domElement.getAttribute("data-shortcode"))cls=tagNames.match("shortcode");else{if("DIV"===domElement.tagName)return null;cls=tagNames.match(domElement.tagName)}return cls.fromDOMElement(domElement)},Div.fromDOMElement=function(domElement){var element=this._fromDOMElement(domElement);if(element)return element;var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName),element=cls.fromDOMElement(childNode),element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},Div}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Div,"div"),ContentEdit.DivRow=function(_super){function DivRow(tagName,attributes){DivRow.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(DivRow,_super),DivRow.prototype.cssTypeName=function(){return"row"},DivRow.prototype.type=function(){return"DivRow"},DivRow.prototype.typeName=function(){return"Row"},DivRow.prototype.showOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._addCSSClass("pbs-new-column"),currElem=currElem.parent()},DivRow.prototype.hideOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._removeCSSClass("pbs-new-column"),currElem=currElem.parent()},DivRow.prototype._onMouseOver=function(ev){this._removeCSSClass("pbs-new-column");var root=ContentEdit.Root.get(),dragging=root.dragging();return null!==root._dropTarget&&dragging&&pbsSelectorMatches(root._dropTarget.domElement(),".ce-element--dragging *")?(root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)):(DivRow.__super__._onMouseOver.call(this,ev),void(ev.target.classList.contains("pbs-row")||this._removeCSSClass("ce-element--over")))},DivRow.prototype._onMouseUp=function(ev){DivRow.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick&&this.testClickBetweenRows(ev),clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseOut=function(ev){DivRow.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseMove=function(ev){this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout);var root=ContentEdit.Root.get();if(null!==root._dropTarget){if("DivCol"===root._dropTarget.constructor.name&&"DivRow"===root.dragging().constructor.name){var row=root._dropTarget.parent();return root._dropTarget._onMouseOut(ev),void row._onOver(ev)}if(ev.target===root.dragging()._domElement)return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null);if(pbsSelectorMatches(root._dropTarget._domElement,".ce-element--dragging *"))return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)}DivRow.__super__._onMouseMove.call(this,ev),clearTimeout(this._dragTimeout)},DivRow.prototype._onMouseDown=function(ev){return DivRow.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!0,clearTimeout(this._betweenRowSelectorTimeout),this._betweenRowSelectorTimeout=setTimeout(function(){this._checkForBetweenRowClick=!1}.bind(this),300),this.domElement()===ev.target?(ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},DivRow.droppers=PBSEditor.allDroppers,DivRow.prototype.mount=function(){DivRow.__super__.mount.call(this),this.addCSSClass("pbs-row");var currentClass=this._domElement.getAttribute("class");currentClass.match(/pbs_row_uid_/)||this.addCSSClass("pbs_row_uid_"+Math.floor(268435456*(1+Math.random())).toString(36)),window._pbsFixRowWidth&&window._pbsFixRowWidth(this._domElement)},DivRow.fromDOMElement=function(domElement){var childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=domElement.children;var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType&&("div"===childNode.tagName.toLowerCase()||childNode.classList.contains("pbs-col"))){var element=tagNames.match("column").fromDOMElement(childNode);element&&list.attach(element)}return list},DivRow.prototype.focus=function(){var overElem=document.querySelector(".ce-element--over");if(null===overElem){if(this.children[0].isFocused())return;this.children[0].focus()}if(document.querySelector(".ce-element--over")===this._domElement){if(this.children[this.children.length-1].isFocused())return;this.children[this.children.length-1].focus()}},DivRow.prototype.addNewColumn=function(index){
"undefined"==typeof index&&(index=this.children.length);var existingGap=this.hasColumnGap(),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");return col.attach(p),this.attach(col,index),col.style("flex-grow","1"),existingGap&&index!==this.children.length-1?col.style("margin-right",existingGap):existingGap&&this.children[index-1].style("margin-right",existingGap),col},DivRow.prototype.adjustColumnNumber=function(numColumns){if(this.children.length<numColumns)for(;this.children.length<numColumns;)this.addNewColumn();else if(this.children.length>numColumns)for(;this.children.length>numColumns;)this.children[numColumns].blurIfFocused(),this.children[numColumns-1].merge(this.children[numColumns])},DivRow.prototype.adjustColumns=function(columnEquation){var arrWidths=columnEquation.replace(/(\s*\+\s*|\s+)/g," ").split(" ");this.adjustColumnNumber(arrWidths.length);for(var highestDenom=1,i=0;i<arrWidths.length;i++)if(-1!==arrWidths[i].indexOf("/")){var denom=parseInt(arrWidths[i].split("/")[1],10);denom>highestDenom&&(highestDenom=denom)}for(i=0;i<arrWidths.length;i++){var grow=1;if(-1!==arrWidths[i].indexOf("/")){var nums=arrWidths[i].split("/");grow=nums[0]/nums[1]*highestDenom}else grow=parseInt(arrWidths[i],10);this.children[i].style("flex-grow",grow)}},DivRow.prototype.clone=function(){this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newRow=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newRow,index+1),newRow.focus(),newRow},DivRow.prototype.getColumnEquation=function(){var col,colStyle,i,totalGrow=0;for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),totalGrow+=parseFloat(colStyle["flex-grow"]);var equation="";for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),equation+=equation?" + ":"",equation+=parseFloat(colStyle["flex-grow"])+"/"+totalGrow;return equation},DivRow.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivRow.prototype.hasColumnGap=function(){for(var existingMargin="",currMargin="",i=0;i<this.children.length;i++)i<this.children.length-1?""===currMargin?(currMargin=this.children[i]._domElement.style["margin-right"],existingMargin=currMargin):currMargin!==this.children[i]._domElement.style["margin-right"]&&(existingMargin=""):""!==this.children[i]._domElement.style["margin-right"]&&(existingMargin="");return existingMargin},DivRow.prototype.testClickBetweenRows=function(ev){if(ev.target._ceElement&&!("DivCol"!==ev.target._ceElement.constructor.name&&"DivRow"!==ev.target._ceElement.constructor.name||"DivCol"===ev.target._ceElement.constructor.name&&ev.target._ceElement.parent()!==this||"DivRow"===ev.target._ceElement.constructor.name&&ev.target._ceElement!==this||"Region"!==this.parent().constructor.name&&"DivCol"!==this.parent().constructor.name)){var clickedOnTop=!1,clickedOnBottom=!1;if(ev.offsetY<10)clickedOnTop=!0;else{if(!(ev.offsetY>ev.target.offsetHeight-10))return;clickedOnBottom=!0}var otherElement,p,index=this.parent().children.indexOf(this),doAddEmpty=!0;clickedOnTop?(index&&(otherElement=this.parent().children[index-1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index),p.focus())):clickedOnBottom&&(index<this.parent().children.length-1&&(otherElement=this.parent().children[index+1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index+1),p.focus()))}},DivRow}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.DivRow,"row"),ContentEdit.DivCol=function(_super){function DivCol(tagName,attributes){DivCol.__super__.constructor.call(this,tagName,attributes)}function selectAfterFocus(domElement,index){var selection=new ContentSelect.Range(index,index);selection.select(domElement)}return __extends(DivCol,_super),DivCol.prototype.cssTypeName=function(){return"col"},DivCol.prototype.type=function(){return"DivRow"},DivCol.prototype.typeName=function(){return"Column"},DivCol.prototype._onMouseUp=function(ev){DivCol.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseOut=function(ev){DivCol.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseDown=function(ev){return DivCol.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target?(ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},DivCol.prototype._onMouseMove=function(ev){DivCol.__super__._onMouseOver.call(this,ev),clearTimeout(this._dragTimeout);var root=ContentEdit.Root.get(),dragging=root.dragging();dragging&&ev.target===this._domElement?(this._onMouseOut(ev),this.parent()._onOver(ev),this.parent()._removeCSSClass("ce-element--over")):ev.target!==this._domElement&&this._removeCSSClass("ce-element--over")},DivCol.prototype._onKeyDown=function(ev){DivCol.__super__._onMouseDown.call(this,ev);var index;if(190===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey)return index=this.parent().children.indexOf(this),this.blurIfFocused(),this.parent().addNewColumn(index+1).focus(),void ev.preventDefault();if(188===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey){index=this.parent().children.indexOf(this),this.blurIfFocused();var parent=this.parent();return parent.detach(this),index>0&&parent&&parent.children.length&&index--,parent&&parent.children.length&&parent.children[index].focus(),void ev.preventDefault()}if(ev.target._ceElement){if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("list"))return;if(-1!==ev.target._ceElement.constructor.name.toLowerCase().indexOf("table"))return}9===ev.keyCode&&(!ev.shiftKey&&this.nextSibling()?(this.nextSibling().focus(),ev.stopPropagation()):ev.shiftKey&&this.previousSibling()&&(this.previousSibling().focus(),ev.stopPropagation()))},DivCol.droppers={},DivCol.prototype.mount=function(){DivCol.__super__.mount.call(this),this.addCSSClass("pbs-col");var currentClass=this._domElement.getAttribute("class");currentClass.match(/pbs_col_uid_/)||this.addCSSClass("pbs_col_uid_"+Math.floor(268435456*(1+Math.random())).toString(36));for(var numEmpties=0,numNonEmpties=0,i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()?numEmpties++:numNonEmpties++;if(numEmpties>1)for(i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()&&(numEmpties>1&&0===numNonEmpties?(this.detach(this.children[i]),numEmpties--):this.detach(this.children[i]))},DivCol.prototype.merge=function(element){for(var len=element.children.length,i=0;len>i;i++)this.attach(element.children[0]);for(element.parent().detach(element),len=this.children.length,i=len-1;i>=0;i--)this.children[i].content&&this.children[i].content.isWhitespace()&&this.detach(this.children[i]);return this.taint()},DivCol.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},DivCol.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=0;i<this.children.length;i++)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;root.focused()&&root.focused().blur(),this.children[i].focus&&this.children[i].focus();var index=0;this.children[i].content&&(index=this.children[i].content.length());var domElement=this.children[i]._domElement;return void setTimeout(selectAfterFocus,1,domElement,index)}if(this.children.length){var allCompounds=!0;for(i=0;i<this.children.length;i++)"undefined"!=typeof this.children[i].isCompundElement&&this.children[i].isCompundElement||(allCompounds=!1);if(allCompounds)return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.domElement().focus(),root.trigger("focus",this)}for(i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"===this.children[i].constructor.name){if(this.children[i].children[0].isFocused())return;return root.focused()&&root.focused().blur(),void this.children[i].children[0].focus()}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},DivCol.prototype.clone=function(){var existingGap=this.parent().hasColumnGap();this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newCol=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newCol,index+1),newCol.focus(),existingGap&&this.style("margin-right")!==existingGap&&this.style("margin-right",existingGap),newCol},DivCol.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivCol}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.DivCol,"column"),ContentEdit.Root.get().bind("drop",function(element,droppedElement){if(null!==droppedElement&&null!==droppedElement.parent()){var col,i;if("DivCol"===droppedElement.parent().constructor.name||"Div"===droppedElement.parent().constructor.name)for(col=droppedElement.parent(),i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i]);else if("DivRow"===droppedElement.parent().constructor.name)for(col=droppedElement,i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i])}}),ContentEdit.Root.get().bind("drop",function(element,droppedElement){null!==droppedElement&&null!==droppedElement.parent()&&"DivRow"===element.constructor.name&&("Div"===element.parent().constructor.name||"DivCol"===element.parent().constructor.name)&&element.attr("data-width")&&(element.style("margin-right",""),element.style("margin-left",""),"full-width-retain-content"===element.attr("data-width")&&(element.style("padding-right",""),element.style("padding-left","")),element.removeAttr("data-width"))}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index>0&&row.parent().children[index-1].content)return void row.parent().children[index-1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index<row.parent().children.length-1&&row.parent().children[index+1].content)return void row.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){if(this.content.isWhitespace()&&this.parent()&&("Div"===this.parent().constructor.name||"DivCol"===this.parent().constructor.name)){for(var otherWhitespaces=0,otherNonWhitespaces=0,i=0;i<this.parent().children.length;i++){var sibling=this.parent().children[i];sibling.content&&sibling.content.isWhitespace()?otherWhitespaces++:otherNonWhitespaces++}if(1===otherWhitespaces&&0===otherNonWhitespaces){var error;if(this.isMounted()&&this._syncContent(),this.isMounted()){try{this._domElement.blur()}catch(_error){error=_error}this._domElement.removeAttribute("contenteditable")}return ContentEdit.Text.__super__.blur.call(this)}}return proxied.call(this,ev)}}(),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(max-width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style\=[^>]*[^-])(width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(left:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<div[^>]+>)\s+/gm,"$1"),html=html.replace(/\s+(<\/div>)/gm,"$1"),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width-retain-content["'][^>]+>/g,function(match){return match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/(padding:\s?)([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/\s?padding-left:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/\s?padding-right:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")}),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width["'][^>]+>/g,function(match){return match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")})}),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.paste;_EditorApp.prototype.paste=function(element,clipboardData){var content,encodeHTML,i,insertAt,insertIn,insertNode,item,lastItem,line,lineLength,lines,type,_i,_len;if(content=clipboardData.getData("text/plain"),lines=content.split("\n"),lines=lines.filter(function(line){return""!==line.trim()}),!lines)return proxied.call(this,element,clipboardData);if(encodeHTML=HTMLString.String.encode,type=element.type(),"PreText"===type||"ListItemText"===type||"DivRow"!==element.parent().type())return proxied.call(this,element,clipboardData);if(lines.length>1||!element.content){for(insertNode=element,insertIn=insertNode.parent(),insertAt=insertIn.children.indexOf(insertNode)+1,i=_i=0,_len=lines.length;_len>_i;i=++_i)line=lines[i],line=encodeHTML(line),item=new ContentEdit.Text("p",{},line),lastItem=item,insertIn.attach(item,insertAt+i);return lineLength=lastItem.content.length(),lastItem.focus(),lastItem.selection(new ContentSelect.Range(lineLength,lineLength))}return proxied.call(this,element,clipboardData)}}(),ContentEdit.Icon=function(_super){function Icon(tagName,attributes,content){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="icon"),attributes.role||(attributes.role="presentation"),Icon.__super__.constructor.call(this,tagName,attributes),this._content=content,this._domSizeInfoElement=null,this._aspectRatio=1}return __extends(Icon,_super),Icon.prototype.cssTypeName=function(){return"icon"},Icon.prototype.typeName=function(){return"Icon"},Icon.fromDOMElement=function(domElement){return new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML)},Icon.droppers=PBSEditor.allDroppers,Icon.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Icon.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Icon.prototype.mount=function(){var ret=Icon.__super__.mount.call(this),svg=this._domElement.children[0];return svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),svg.innerHTML=svg.innerHTML.trim()+" ",this._content=this._domElement.innerHTML,this._domElement.setAttribute("data-ce-size",this._getSizeInfo()),ret},Icon.prototype.change=function(svg){this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint()},Icon.prototype.clone=function(){this.isFocused()&&this.blur();var clone=document.createElement("div");clone.innerHTML=this.html();var newElem=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newElem,index+1),newElem.focus(),newElem},Icon.prototype._onMouseOver=function(ev){return Icon.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Icon.droppers=PBSEditor.allDroppers,Icon.prototype.aspectRatio=function(){return this._aspectRatio},Icon.prototype.maxSize=function(){var maxWidth;return maxWidth=parseInt(this.attr("data-ce-max-width")||0,10),maxWidth||(maxWidth=ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH),maxWidth=Math.max(maxWidth,this.size()[0]),[maxWidth,maxWidth*this.aspectRatio()]},Icon.prototype.minSize=function(){var minWidth;return minWidth=parseInt(this.attr("data-ce-min-width")||0,10),minWidth||(minWidth=20),minWidth=Math.min(minWidth,this.size()[0]),[minWidth,minWidth*this.aspectRatio()]},Icon.prototype.resize=function(corner,x,y){return this.isMounted()?ContentEdit.Root.get().startResizing(this,corner,x,y,!0):void 0},Icon.prototype._onDoubleClick=function(){PBSEditor.iconFrame.open({title:pbsParams.labels.icon_frame_change_title,button:pbsParams.labels.icon_frame_change_button,successCallback:function(frameView){this.change(frameView.selected.firstChild)}.bind(this)})},Icon.prototype.size=function(newSize){var height,maxSize,minSize,width;return newSize?(newSize[0]=parseInt(newSize[0],10),newSize[1]=parseInt(newSize[1],10),minSize=this.minSize(),newSize[0]=Math.max(newSize[0],minSize[0]),newSize[1]=Math.max(newSize[1],minSize[1]),maxSize=this.maxSize(),newSize[0]=Math.min(newSize[0],maxSize[0]),newSize[1]=Math.min(newSize[1],maxSize[1]),this.style("width",parseInt(newSize[0],10)+"px"),this.style("height",parseInt(newSize[1],10)+"px"),this.isMounted()?(this._domElement.style.width=newSize[0]+"px",this._domElement.style.height=newSize[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())):void 0):(width=parseInt(this.style("width")||1,10),height=parseInt(this.style("height")||1,10),[width,height])},Icon.prototype._onMouseDown=function(ev){var corner;return Icon.__super__._onMouseDown.call(this,ev),corner=this._getResizeCorner(ev.clientX,ev.clientY),corner?(window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown&&(this.style("width","100px"),this.style("height","100px")),clearTimeout(this._dragTimeout),this.resize(corner,ev.clientX,ev.clientY)):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),150))},Icon.prototype._onMouseMove=function(ev){var corner;return Icon.__super__._onMouseMove.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),corner=this._getResizeCorner(ev.clientX,ev.clientY),corner?this._addCSSClass("ce-element--resize-"+corner[0]+"-"+corner[1]):void 0},Icon.prototype._onMouseOut=function(ev){return Icon.__super__._onMouseOut.call(this,ev),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},Icon.prototype._onMouseUp=function(ev){return Icon.__super__._onMouseUp.call(this,ev),this._dragTimeout?clearTimeout(this._dragTimeout):void 0},Icon.prototype._getResizeCorner=function(x,y){var corner,cornerSize,rect,size,_ref;return rect=this._domElement.getBoundingClientRect(),_ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],size=this.size(),cornerSize=ContentEdit.RESIZE_CORNER_SIZE,cornerSize=Math.min(cornerSize,Math.max(parseInt(size[0]/4,10),1)),cornerSize=Math.min(cornerSize,Math.max(parseInt(size[1]/4,10),1)),corner=null,cornerSize>x?cornerSize>y?corner=["top","left"]:y>rect.height-cornerSize&&(corner=["bottom","left"]):x>rect.width-cornerSize&&(cornerSize>y?corner=["top","right"]:y>rect.height-cornerSize&&(corner=["bottom","right"])),corner},Icon.prototype._getSizeInfo=function(){var size;return size=this.size(),"w "+size[0]+" × h "+size[1]},Icon}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Icon,"icon"),ContentEdit.Html=function(_super){function Html(tagName,attributes,content){this.model=new Backbone.Model({}),Html.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Html,_super),Html.prototype.openEditor=function(){PBSEditor.htmlFrame.open({title:pbsParams.labels.html,button:pbsParams.labels.html_frame_button,successCallback:function(frameView){var html=frameView.getHtml();this._domElement.innerHTML=html,this._content=html,html||(this.nextContent()?this.nextContent().focus():this.previousContent()&&this.previousContent().focus(),this.parent().detach(this))}.bind(this),openCallback:function(frameView){frameView.setHtml(this._content)}.bind(this)})},Html.prototype._onDoubleClick=function(){this.openEditor()},Html.prototype.cssTypeName=function(){return"html"},Html.prototype.typeName=function(){return"Html"},Html.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Html.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Html.prototype._onMouseOver=function(ev){return Html.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Html}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Html,"html"),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_sidebar"===scBase?pbsParams.labels.sidebar:scBase}),ContentEdit.Map=function(_super){function Map(tagName,attributes){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="map"),this.model=new Backbone.Model({}),Map.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Map,_super),Map.prototype.blur=function(){var root=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)):void 0},Map.prototype._onMouseOver=function(ev){return Map.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Map.prototype._onMouseUp=function(ev){Map.__super__._onMouseUp.call(this,ev),this.updateMapData(),this._removeCSSClass("pbs-map-editing"),this._dragging=!1,this._clicked=!1,clearInterval(this._forceCentered)},Map.prototype.updateMapData=function(){if(!this._dragging){var latlng=this._domElement.map.getCenter(),center=latlng.lat().toFixed(6)+", "+latlng.lng().toFixed(6);this.attr("data-center")!==center&&(this.attr("data-center",center),this.attr("data-lat",latlng.lat().toFixed(6)),this.attr("data-lng",latlng.lng().toFixed(6)),this.model.set("data-center",center),this._domElement.map.marker&&this._domElement.map.marker.setPosition(this._domElement.map.getCenter()))}var zoom=this._domElement.map.getZoom();parseInt(this.attr("data-zoom"),10)!==zoom&&(this.attr("data-zoom",zoom),this.model.trigger("change",this.model))},Map.prototype._onMouseDown=function(ev){return this._clicked=!0,this.focus(),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this._dragging=!0,_this.drag(ev.pageX,ev.pageY)}}(this),2*ContentEdit.DRAG_HOLD_DURATION)},Map.prototype._onMouseMove=function(ev){this._dragging||clearTimeout(this._dragTimeout),!this._dragging&&this._clicked&&this._addCSSClass("pbs-map-editing"),Map.__super__._onMouseMove.call(this,ev)},Map.droppers=PBSEditor.allDroppers,Map.prototype.focus=function(supressDOMFocus){var root;return root=ContentEdit.Root.get(),this.isFocused()?void 0:(root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this))},Map.prototype.cssTypeName=function(){return"map"},Map.prototype.typeName=function(){return"Map"},Map.prototype.mount=function(){var ret=Map.__super__.mount.call(this);return window.initPBSMaps(this._domElement,function(){google.maps.event.addListener(this._domElement.map,"zoom_changed",_.throttle(function(){this.updateMapData()}.bind(this),2)),google.maps.event.addListener(this._domElement.map,"drag",_.throttle(function(){this.updateMapData()}.bind(this),2))}.bind(this)),ret},Map.prototype.unmount=function(){return google.maps.event.clearInstanceListeners(this._domElement.map),Map.__super__.unmount.call(this)},Map.create=function(){var o=document.createElement("DIV");return o.setAttribute("data-ce-tag","map"),o.setAttribute("data-ce-moveable",""),ContentEdit.Map.fromDOMElement(o)},Map}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Map,"map"),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();window.initPBSMaps&&editor.bind("stop",window.initPBSMaps);var mapRefreshInterval;window.pbsMapsReCenter&&(editor.bind("start",function(){mapRefreshInterval=setInterval(function(){document.querySelector(".ce-element--dragging")||document.querySelector(".pbs-map-editing")||window.pbsMapsReCenter()},1e3)}),editor.bind("stop",function(){clearInterval(mapRefreshInterval)}))}),ContentEdit.Tabs=function(_super){function Tabs(tagName,attributes){Tabs.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(Tabs,_super),Tabs.prototype.cssTypeName=function(){return"tabs"},Tabs.prototype.type=function(){return"Tabs"},Tabs.prototype.typeName=function(){return"Tabs"},Tabs.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},Tabs.prototype.detachTabAndContent=function(tab){var inputID=tab._domElement.getAttribute("for"),inputElem=this._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab"),tabRow=this._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement;return inputElem.parent().detach(inputElem),tab.parent().detach(tab),tabRow.parent().detach(tabRow),this.reIndexTabs(),tabRow},Tabs.prototype.attachTabAndContent=function(tab,index,row){for(var tabsID=this._domElement.getAttribute("class").match(/pbs-tabs-(\w+)/)[0],tabIndex=this.numTabs()+1,hash=window.PBSEditor.generateHash();document.querySelector('[id="pbs-tab-'+hash+'"]');)hash=window.PBSEditor.generateHash();var radio=document.createElement("input");radio.classList.add("pbs-tab-state"),radio.setAttribute("type","radio"),radio.setAttribute("name",tabsID),radio.setAttribute("id","pbs-tab-"+hash),radio.setAttribute("data-tab",tabIndex),radio.setAttribute("data-ce-tag","static"),this.attach(ContentEdit.Static.fromDOMElement(radio),0),tab.attr("for","pbs-tab-"+hash),row.attr("data-panel",tabIndex),this._domElement.querySelector(".pbs-tab-tabs")._ceElement.attach(tab,index),this._domElement.querySelector(".pbs-tab-panels")._ceElement.attach(row)},Tabs.prototype.reIndexTabs=function(){for(var numTabs=this._domElement.querySelectorAll(".pbs-tab-state").length,i=1;numTabs>=i;i++){var radio=this._domElement.querySelector('[data-tab="'+i+'"]');radio||(radio=this._domElement.querySelector('[data-tab="'+(i+1)+'"]'),radio&&(radio._ceElement.attr("data-tab",i),this._domElement.querySelector('[data-panel="'+(i+1)+'"]')._ceElement.attr("data-panel",i)))}},Tabs.prototype.getOpenTab=function(){var radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement,panel=this._domElement.querySelector('[data-panel="'+radio.attr("data-tab")+'"]');return panel||(panel=this._domElement.querySelector("[data-panel]")),panel._ceElement},Tabs.prototype.numTabs=function(){return this._domElement.querySelectorAll(".pbs-tab-state").length},Tabs.prototype.addTab=function(){var firstTab=this._domElement.querySelector(".pbs-tab-state")._ceElement,radioID="pbs-tab-"+window.PBSEditor.generateHash(),tabNum=this.numTabs()+1,radio=new ContentEdit.TabRadio("input",{"data-ce-tag":"tabradio","class":"pbs-tab-state","data-tab":tabNum,id:radioID,name:firstTab.attr("name"),type:"radio"});this.attach(radio,0);var tab=new ContentEdit.Tab("label",{"data-ce-tag":"tab","for":radioID},"<span>New Tab</span>"),tabContainer=this._domElement.querySelector(".pbs-tab-tabs")._ceElement;tabContainer.attach(tab,tabContainer.children.length);
var panelContainer=this._domElement.querySelector(".pbs-tab-panels")._ceElement,row=new ContentEdit.DivRow("div",{"data-panel":tabNum});panelContainer.attach(row);var col=new ContentEdit.DivCol("div");row.attach(col);var p=new ContentEdit.Text("p",{},"");col.attach(p),tab.openTab(),p.focus()},Tabs.prototype.removeTab=function(tab){if("undefined"==typeof tab){var radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement;tab=this._domElement.querySelector('label[for="'+radio.attr("id")+'"]')._ceElement}var otherTab=tab.nextSibling();if(otherTab||(otherTab=tab.previousSibling()),this.detachTabAndContent(tab),otherTab)otherTab.openTab();else{this.blur();var focusTo=this.nextSibling();focusTo||(focusTo=this.previousSibling()),focusTo&&focusTo.focus(),this.parent().detach(this)}},Tabs.droppers=PBSEditor.allDroppers,Tabs}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.Tabs,"tabs"),ContentEdit.Tab=function(_super){function Tab(tagName,attributes,content){Tab.__super__.constructor.call(this,tagName,attributes,content)}return __extends(Tab,_super),Tab.prototype.cssTypeName=function(){return"tab"},Tab.prototype.type=function(){return"Tab"},Tab.prototype.typeName=function(){return"Tab"},Tab.prototype.parentTab=function(){return this.parent().parent()},Tab.prototype.setActiveTab=function(){var activeTab=this.parentTab()._domElement.querySelector(".pbs-tab-tabs .pbs-tab-active");activeTab&&activeTab._ceElement.removeCSSClass("pbs-tab-active"),this.addCSSClass("pbs-tab-active")},Tab.prototype._onMouseDown=function(ev){return setTimeout(function(){this.setActiveTab()}.bind(this),1),Tab.__super__._onMouseDown.call(this,ev)},Tab.prototype.openTab=function(){this.parentTab()._domElement.querySelector('[id="'+this.attr("for")+'"]').checked=!0,this.setActiveTab()},Tab._dropTab=function(element,target,placement){var insertIndex=target.parent().children.indexOf(target);if("left"!==placement[1]&&(insertIndex+=1),element.parent()!==target.parent()){var originalTabElement=element.parentTab(),otherTab=element.previousSibling();otherTab||(otherTab=element.nextSibling());var tabRow=element.parentTab().detachTabAndContent(element);return target.parentTab().attachTabAndContent(element,insertIndex,tabRow),element.openTab(),void(otherTab?otherTab.openTab():originalTabElement.parent().detach(originalTabElement))}return element.parent().detach(element),target.parent().attach(element,insertIndex)},Tab.prototype._onMouseOver=function(ev){var root=ContentEdit.Root.get();return root.dragging()&&this.openTab(),Tab.__super__._onMouseOver.call(this,ev)},Tab.droppers={Tab:Tab._dropTab},Tab.placements=["left","right"],Tab.prototype.focus=function(){return this.openTab(),Tab.__super__.focus.call(this)},Tab.prototype._keyReturn=function(ev){ev.preventDefault();var next=this.nextSibling();next&&next.focus()},Tab.prototype.isLastTab=function(){return this.parent().children.indexOf(this)===this.parent().children.length-1},Tab.prototype.getMatchingPanel=function(){var inputID=this.attr("for"),inputElem=this.parentTab()._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab");return this.parentTab()._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement},Tab.prototype.html=function(){var ret=Tab.__super__.html.call(this);if(0===this.parent().children.indexOf(this)){if(!ret.match(/pbs-tab-active/)){var r=new RegExp("(<"+this._tagName+"[^>]+class=['\"])");ret.match(r)?ret=ret.replace(r,"$1pbs-tab-active "):(r=new RegExp("(<"+this._tagName+")"),ret=ret.replace(r,'$1 class="pbs-tab-active"'))}}else ret=ret.replace(/\s*pbs-tab-active\s*/g,""),ret=ret.replace(/\s*class=[\'\"][\'\"]/g,"");return ret},Tab.prototype._keyLeft=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);0===selection.get()[0]&&selection.isCollapsed()&&this._keyUp(ev)}return Tab.__super__._keyLeft.call(this,ev)},Tab.prototype._keyUp=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]&&selection.isCollapsed()){var tabs=this.parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index>0&&tabs.parent().children[index-1].content){var elem=tabs.parent().children[index-1];return elem.focus(),selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem.domElement())}var p=new ContentEdit.Text("p",{},"");tabs.parent().attach(p,index),p.focus()}}return Tab.__super__._keyUp.call(this,ev)},Tab.prototype._keyDown=function(ev){if(this.parent().children.indexOf(this)===this.parent().children.length-1){var selection=ContentSelect.Range.query(this._domElement);if(!this._atEnd(selection)||!selection.isCollapsed())return;if(this._atEnd(selection)){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}}return Tab.__super__._keyDown.call(this,ev)},Tab.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)&&selection.isCollapsed()){if(this.isLastTab()){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}return Tab.__super__._keyRight.call(this,ev)}},Tab}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.Tab,"tab"),ContentEdit.TabContainer=function(_super){function TabContainer(tagName,attributes){TabContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabContainer,_super),TabContainer.prototype.cssTypeName=function(){return"tabcontainer"},TabContainer.prototype.type=function(){return"TabContainer"},TabContainer.prototype.typeName=function(){return"TabContainer"},TabContainer._dropOutside=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().parent().children.indexOf(target.parent()),"below"===placement[0]&&(insertIndex+=1),target.parent().parent().attach(element,insertIndex)},TabContainer.prototype._onOver=function(ev){var ret=TabContainer.__super__._onOver.call(this,ev);if(ret){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent()}return ret},TabContainer.droppers={"*":TabContainer._dropOutside},TabContainer.prototype._onMouseUp=function(ev){TabContainer.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseOut=function(ev){TabContainer.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseDown=function(ev){return TabContainer.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target?(ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},TabContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabContainer,"tabcontainer"),ContentEdit.TabPanelContainer=function(_super){function TabPanelContainer(tagName,attributes){TabPanelContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabPanelContainer,_super),TabPanelContainer.prototype.cssTypeName=function(){return"tabpanelcontainer"},TabPanelContainer.prototype.type=function(){return"TabPanelContainer"},TabPanelContainer.prototype.typeName=function(){return"TabPanelContainer"},TabPanelContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_len>_i;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabPanelContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabPanelContainer,"tabpanelcontainer"),ContentEdit.TabRadio=function(_super){function TabRadio(tagName,attributes){TabRadio.__super__.constructor.call(this,tagName,attributes)}return __extends(TabRadio,_super),TabRadio.prototype.cssTypeName=function(){return"tabradio"},TabRadio.prototype.type=function(){return"TabRadio"},TabRadio.prototype.typeName=function(){return"TabRadio"},TabRadio.prototype.mount=function(){var ret=TabRadio.__super__.mount.call(this);return this._domElement.setAttribute("disabled","disabled"),ret},TabRadio.prototype.unmount=function(){return this._domElement.removeAttribute("disabled"),TabRadio.__super__.unmount.call(this)},TabRadio}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.TabRadio,"tabradio"),wp.hooks.addFilter("pbs.overlay.margin_top.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("pbs-tab-tabs"))return!1}return apply}),wp.hooks.addFilter("pbs.overlay.margin_bottom.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("pbs-tab-tabs"))return!1}return apply}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".pbs-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyLeft;ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===this.parent().parent().children.indexOf(this.parent())&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".pbs-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),tabs.parent().children[index+1].focus(),selection=new ContentSelect.Range(0,0),selection.select(tabs.parent().children[index+1]._domElement);var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyRight;ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this.parent().parent().children.indexOf(this.parent())===this.parent().parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),void tabs.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Node.prototype.previous;ContentEdit.Node.prototype.previous=function(){var node=proxied.call(this);if(node&&node._domElement&&window.pbsSelectorMatches(node._domElement,".pbs-tab-panels *")&&0===node._domElement.offsetWidth&&0===node._domElement.offsetHeight){for(var tabs=node.parent().parent();tabs&&"Tabs"!==tabs.constructor.name;)tabs=tabs.parent();if(tabs){node=tabs.getOpenTab();for(var allVisibles=node._domElement.querySelectorAll("*"),i=allVisibles.length-1;i>=0;i--)if(allVisibles[i]._ceElement)return allVisibles[i]._ceElement}}return node}}(),function(){var proxied=ContentEdit.DivCol.prototype._onMouseDown;ContentEdit.DivCol.prototype._onMouseDown=function(ev){return this.parent().parent()._domElement.classList.contains("pbs-tab-panels")&&(this.draggableParent=this.parent().parent().parent()),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.DivRow.prototype._onOver;ContentEdit.DivRow.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(ret&&"TabPanelContainer"===this.parent().constructor.name){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent().parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent().parent()}return ret}}();var root=ContentEdit.Root.get();root._overrideImageOnStopResizing=root._onStopResizing,root._onStopResizing=function(ev){if("Image"===this._resizing.constructor.name){var match=this._resizing._attributes["class"].match(/size-\w+/);match&&this._resizing.removeCSSClass(match[0]),this._resizing.style("height","auto")}return this._overrideImageOnStopResizing(ev)}.bind(root),ContentEdit.Image.prototype._onDblclick=function(){this.openMediaManager()},ContentEdit.Image.prototype.openMediaManager=function(){var frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(this._domElement)});frame.state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()})},ContentEdit.Image.prototype._removeDOMEventListeners=function(){this._domElement.removeEventListener("dblclick",this._onDblClickBound),window.removeEventListener("keydown",this._onKeyDownBound)},ContentEdit.Image.prototype.mount=function(){var i;if(this._attributes){var responsiveAttributes=["srcset","sizes","data-lazy-loaded","data-lazy-src","data-pin-nopin","src-orig","scale"];for(i=0;i<responsiveAttributes.length;i++)this._attributes[responsiveAttributes[i]]&&delete this._attributes[responsiveAttributes[i]]}if(this._attributes&&this._attributes["class"]){var classes=this._attributes["class"].split(" ");-1!==classes.indexOf("alignnone")&&(classes[classes.indexOf("alignnone")]="aligncenter",this._attributes["class"]=classes.join(" "))}this._domElement=document.createElement("img");for(i in this._attributes)this._attributes.hasOwnProperty(i)&&this._attributes[i]&&this._domElement.setAttribute(i,this._attributes[i]);return this._onDblClickBound=this._onDblclick.bind(this),this._domElement.addEventListener("dblclick",this._onDblClickBound),this._onKeyDownBound=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDownBound),ContentEdit.Image.__super__.mount.call(this)},ContentEdit.Image.prototype._onKeyDown=function(ev){16!==ev.keyCode&&91!==ev.keyCode&&93!==ev.keyCode&&(ev.ctrlKey||ev.metaKey||-1===["input","select","textarea","button"].indexOf(ev.target.tagName.toLowerCase())&&this.isFocused()&&(ev.preventDefault(),ContentTools.Tools.Paragraph.apply(this,null,function(){})))},ContentEdit.Image._dropBoth=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().children.indexOf(target),"below"===placement[0]&&"center"===placement[1]&&(insertIndex+=1),element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),-1!==["left","right","center"].indexOf(placement[1])&&element.addCSSClass("align"+placement[1]),target.parent().attach(element,insertIndex)},ContentEdit.Image.droppers={Image:ContentEdit.Image._dropBoth,PreText:ContentEdit.Image._dropBoth,Static:ContentEdit.Image._dropBoth,Text:ContentEdit.Image._dropBoth},wp.hooks.addFilter("pbs.shortcode.allow_raw_edit",function(allow,scBase,element){if("caption"===scBase){var target=element._domElement.querySelector("img"),frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(target)});return frame.state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImage(target,imageData)}),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()}),!1}return allow});var _pbsToolbarImageHasTextContent=function(node){return node&&!(!node.textContent&&!node.innerText)},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImage=function(imageNode,imageData){var classes,node,captionNode,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null};for(var key in attrs)attrs.hasOwnProperty(key)&&imageNode.setAttribute(key,attrs[key]);if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode))if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&imageNode.parentNode.setAttribute(key,linkAttrs[key]);else{var oldA=imageNode.parentNode;oldA.parentNode.insertBefore(imageNode,oldA),oldA.parentNode.removeChild(oldA)}else if(imageData.linkUrl){var linkNode=_pbsToolbarImageGetParent(imageNode,"a");linkNode&&imageNode.parentNode.insertBefore(linkNode,imageNode.nextSibling),linkNode=document.createElement("a");for(var i in linkAttrs)linkAttrs.hasOwnProperty(i)&&null!==linkAttrs[i]&&linkNode.setAttribute(i,linkAttrs[i]);imageNode.parentNode.insertBefore(linkNode,imageNode),linkNode.appendChild(imageNode)}captionNode=_pbsToolbarImageGetParent(imageNode,".mceTemp"),node=imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode)?imageNode.parentNode:imageNode;for(var textElement=null,currElement=node;currElement;){if(currElement._ceElement){textElement=currElement._ceElement;break}currElement=currElement.parentNode}var parent,index,newElem;if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:node.outerHTML+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData).string();parent=textElement.parent(),index=parent.children.indexOf(textElement),shortcode=wp.shortcode.next("caption",shortcode,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),parent.attach(newElem,index),parent.detach(textElement),newElem.ajaxUpdate(!0),newElem.focus(),textElement=newElem}else parent=textElement.parent(),index=parent.children.indexOf(textElement),newElem=ContentEdit.Image.fromDOMElement(node),parent.attach(newElem,index),parent.detach(textElement),newElem.focus()},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&-1!==(" "+node.className+" ").indexOf(" "+className+" "))return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImageCTElement=function(imageNode,imageData){var classes,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null},imageNode._aspectRatio=height/width,imageNode.size([width,height]),imageNode.removeCSSClass("alignleft"),imageNode.removeCSSClass("alignright"),imageNode.removeCSSClass("aligncenter"),imageNode.removeCSSClass("alignnone");for(var i=0;i<classes.length;i++)classes[i]&&imageNode.addCSSClass(classes[i]);for(var key in attrs)attrs.hasOwnProperty(key)&&"class"!==key&&(null!==attrs[key]?imageNode.attr(key,attrs[key]):imageNode.removeAttr(key));if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.a)if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&(null!==linkAttrs[key]?imageNode.a[key]=linkAttrs[key]:delete imageNode.a[key]);else imageNode.a=null;else if(imageData.linkUrl){imageNode.a={};for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&(imageNode.a[key]=linkAttrs[key])}if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:imageNode.html()+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData),newElem=ContentEdit.Shortcode.createShortcode(wp.shortcode.next("caption",shortcode.string(),0)),index=imageNode.parent().children.indexOf(imageNode);return imageNode.parent().attach(newElem,index),imageNode.parent().detach(imageNode),void newElem.ajaxUpdate(!0)}},_pbsImageGetMetaData=function(img){var i,attachmentID=img.getAttribute("class").match(/wp-image-(\d+)/),align=img.getAttribute("class").match(/align(\w+)/),size=img.getAttribute("class").match(/size-(\w+)/),tmpClasses=img.getAttribute("class").split(" "),extraClasses=[],classRegex=/wp-image-\d+|align\w+|size-\w+|ce-element[-\w]*/;if(img._ceElement&&img._ceElement.a&&img._ceElement.a["class"]){var aClasses=img._ceElement.a["class"].split(" ");for(i=0;i<aClasses.length;i++)aClasses[i].match(classRegex)||extraClasses.push(aClasses[i])}for(i=0;i<tmpClasses.length;i++)tmpClasses[i].match(classRegex)||extraClasses.push(tmpClasses[i]);var metadata={attachment_id:attachmentID?attachmentID[1]:!1,size:size?size[1]:"custom",caption:"",align:align?align[1]:"none",extraClasses:extraClasses.join(" "),link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""};metadata.url=img.getAttribute("src"),metadata.alt=img.getAttribute("alt"),metadata.title=img.getAttribute("title");var width=img.getAttribute("width"),height=img.getAttribute("height");metadata.customWidth=metadata.width=width,metadata.customHeight=metadata.height=height;for(var captionClassName=[],captionBlock=img.parentNode;null!==captionBlock&&"undefined"!=typeof captionBlock.classList&&!captionBlock.classList.contains("wp-caption");)captionBlock=captionBlock.parentNode;if(captionBlock&&captionBlock.classList){var classes=captionBlock.classList;for(i=0;i<classes.length;i++){var c=classes.item(i);/^align/.test(c)?metadata.align=c.replace("align",""):c&&"wp-caption"!==c&&captionClassName.push(c)}metadata.captionClassName=captionClassName.join(" ");var caption=captionBlock.querySelector(".wp-caption-text");caption&&(metadata.caption=caption.innerHTML.replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}if(img.parentNode&&"A"===img.parentNode.nodeName){var link=img.parentNode;metadata.linkUrl=link.getAttribute("href"),metadata.linkTargetBlank="_blank"===link.getAttribute("target")?!0:!1,metadata.linkRel=link.getAttribute("rel"),metadata.linkClassName=link.className}return img._ceElement&&img._ceElement.a&&(metadata.linkUrl=img._ceElement.a.href,metadata.linkTargetBlank="_blank"===img._ceElement.a.target?!0:!1,metadata.linkRel=img._ceElement.a.rel,metadata.linkClassName=img._ceElement.a["class"]),metadata};window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){for(var editableArea=document.querySelector('[data-name="main-content"]'),selector="a:not([data-ce-tag]) > img.alignright, a:not([data-ce-tag]) > img.alignleft, a:not([data-ce-tag]) > img.aligncenter, a:not([data-ce-tag]) > img.alignnone, p > img.alignright, p > img.alignleft, p > img.aligncenter, p > img.alignnone";editableArea.querySelector(selector);){var el=editableArea.querySelector(selector),mainImageNode=el;if("A"===el.parentNode.tagName&&(mainImageNode=el.parentNode,mainImageNode.setAttribute("data-ce-tag","img")),"P"===mainImageNode.parentNode.tagName){var clonedPNode,p=mainImageNode.parentNode,startingIndex=p.innerHTML.indexOf(mainImageNode.outerHTML),endingIndex=startingIndex+mainImageNode.outerHTML.length,tip=p.innerHTML.substr(0,startingIndex).trim(),tail=p.innerHTML.substr(endingIndex).trim(),newContent="";""!==tip&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tip,newContent+=clonedPNode.outerHTML),newContent+=mainImageNode.outerHTML,""!==tail&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tail,newContent+=clonedPNode.outerHTML),p.outerHTML=newContent}}for(;editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br');)editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br').remove()}}),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/\sdata-ce-tag=["']img["']/g,""),html=html.replace(/(<a[^>]*)\sclass((\s|>)[^>]*>)/g,"$1$2"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<p[^\w>]*>)/g,"$4$1"),html=html.replace(/(<[^pa][^>]*>\s*)(<img[^>]*>)/g,"$1<p>$2</p>"),html=html.replace(/(<[^p][^>]*>\s*)(<a[^>]+>\s*<img[^>]*>\s*<\/a>)/g,"$1<p>$2</p>"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<br[^>]*>)*/g,"$1")}),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_widget"===scBase?pbsParams.labels.widget:scBase}),wp.hooks.addFilter("pbs.inspector.do_add_section_options",function(doContinue,optionName,model,divGroup,element,toolboxUI){return"widgetSettings"===optionName&&model&&model.attributes&&model.attributes.widget&&(doContinue=!!document.querySelector("#tmpl-pbs-widget-"+model.attributes.widget),doContinue||toolboxUI.addGenericShortcodeOptions(divGroup,element)),doContinue}),HTMLString.String.prototype.removeStyles=function(){var c,from,i,newString,to,_i,newStyles,tagName;for(from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from),newString=this.copy(),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i)if(c=newString.characters[i],c._tags.length)for(var z=c._tags.length-1;z>=0;z--)"a"!==c.tags()[z].name()&&newString.characters[i].removeTags(c.tags()[z]);return newString.optimize(),newString},HTMLString.String.prototype.hasStyle=function(){var c,from,i,to,_i,styleName=null;for(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i)if(c=this.characters[i],c&&c._tags.length)if(styleName){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));if("undefined"!=typeof currentStyles[styleName])return currentStyles[styleName]}else{if(-1!==["b","strong","i","em"].indexOf(c.tags()[0].name()))return!0;if(c.tags()[0].attr("style"))return!0}return!1},HTMLString.String.prototype.style=function(){var c,from,i,newString,tags,to,_i,newStyles,tagName;from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],tags=new HTMLString.Tag("span"),0>to&&(to=this.length()+to+1),0>from&&(from=this.length()+from);var dummy=document.createElement(tagName);for(dummy.style.display="none",document.body.appendChild(dummy),newString=this.copy(),i=_i=from;to>=from?to>_i:_i>to;i=to>=from?++_i:--_i){c=newString.characters[i],c._tags.length||c.addTags(tags);for(var isBr=!1,z=0;z<c._tags.length;z++)if("br"===c._tags[z].name()){isBr=!0;break}if(!isBr){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));for(var styleName in newStyles){if(newStyles.hasOwnProperty(styleName)&&newStyles[styleName]){"string"==typeof newStyles[styleName]?newStyles[styleName]=["",newStyles[styleName]]:""!==newStyles[styleName][0]&&newStyles[styleName].unshift("");for(var applyStyle,expectedStyleValue=newStyles[styleName][newStyles[styleName].length-1],k=0;k<newStyles[styleName].length;k++){applyStyle=newStyles[styleName][k];var dummyStyleAttribute="";applyStyle&&(dummyStyleAttribute='style="'+styleName+": "+applyStyle+'"'),dummy.innerHTML="<span "+dummyStyleAttribute+">"+c.c()+"</span>";var appliedStyles=window.getComputedStyle(dummy.firstChild);if(appliedStyles[styleName]===expectedStyleValue)break}currentStyles[styleName]=applyStyle}else delete currentStyles[styleName];""===currentStyles[styleName]&&delete currentStyles[styleName]}newString.characters[i]._tags[0].attr("style",window.cssToStyleString(currentStyles)),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags()}}return document.body.removeChild(dummy),newString.optimize(),newString},HTMLString.String.prototype.getStyle=function(styleName,element){var dashedStyleName=styleName;styleName=styleName.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()});var nodeToCheck=element._domElement,nodeHTML=this.html(),foundNode=!1;if(0===nodeHTML.indexOf("<"))for(var i=0;i<element._domElement.children.length;i++)if(element._domElement.children[i].outerHTML===nodeHTML){nodeToCheck=element._domElement.children[i],foundNode=!0;break}if(!foundNode&&0===nodeHTML.indexOf("<")){var styleRegex=new RegExp("(<\\w+[^>]+style=[^>]*[^-]"+dashedStyleName+":\\s*)([\\w.]+)"),match=nodeHTML.match(styleRegex);
if(match)return match[2]}return getComputedStyle(nodeToCheck)[styleName]},HTMLString.Character.prototype.addTags=function(){var tag,tags,_i,_len,_results;for(tags=1<=arguments.length?__slice.call(arguments,0):[],_results=[],_i=0,_len=tags.length;_len>_i;_i++)tag=tags[_i],Array.isArray(tag)||(tag.selfClosing()?this.isTag()||this._tags.unshift(tag.copy()):_results.push(this._tags.push(tag.copy())));return _results},window.addEventListener("DOMContentLoaded",function(){wp.media.frames.pbsSelectImage=wp.media({title:pbsParams.labels.select_image,multiple:!1,library:{type:"image"},button:{text:pbsParams.labels.use_selected_image}}),PBSEditor.openMediaManager=function(callback,selectedImageID){wp.media.frames.pbsSelectImage.callback=function(){wp.media.frames.pbsSelectImage.off("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.off("select",wp.media.frames.pbsSelectImage.callback);var selection=wp.media.frames.pbsSelectImage.state().get("selection");if(selection){var ret=null;selection.each(function(attachment){ret=attachment}),ret&&callback(ret)}},wp.media.frames.pbsSelectImage.on("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.on("select",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage._onOpen=function(){wp.media.frames.pbsSelectImage.off("open",wp.media.frames.pbsSelectImage._onOpen);var selection=wp.media.frames.pbsSelectImage.state().get("selection");if(selection){for(;selection.length;)selection.remove(selection.first());if(selectedImageID){var attachment=wp.media.attachment(selectedImageID);attachment&&selection.add(attachment)}}},wp.media.frames.pbsSelectImage.on("open",wp.media.frames.pbsSelectImage._onOpen),wp.media.frames.pbsSelectImage.open()}}),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var appendWidgetTemplates=function(ajaxResponse){localStorage.setItem("pbs_get_widget_templates_hash",pbsParams.widget_list_hash),localStorage.setItem("pbs_get_widget_templates",ajaxResponse);var dummy=document.createElement("DIV");for(dummy.innerHTML=ajaxResponse;dummy.firstChild;)document.body.appendChild(dummy.firstChild)},storedWidgetHash=localStorage.getItem("pbs_get_widget_templates_hash"),storedWidgets=localStorage.getItem("pbs_get_widget_templates");if(storedWidgetHash===pbsParams.widget_list_hash&&storedWidgets)return void appendWidgetTemplates(storedWidgets);var payload=new FormData;payload.append("action","pbs_get_widget_templates"),payload.append("nonce",pbsParams.widget_nonce);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<400&&appendWidgetTemplates(xhr.responseText)},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}}),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){document.querySelector("html").classList.remove("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")}),null===window.localStorage.getItem("ct-toolbox-position")&&window.localStorage.setItem("ct-toolbox-position","0,32");var toolbox=ContentTools.EditorApp.get()._toolbox;toolbox.__contain=toolbox._contain,toolbox._contain=function(){var adminBarTop=32;document.querySelector("#wpadminbar")&&(adminBarTop=parseInt(document.querySelector("#wpadminbar").clientHeight,10)),this._domElement.style.top=adminBarTop+"px",isNaN(parseInt(this._domElement.style.left,10))&&(this._domElement.style.left="0px");var ret=toolbox.__contain();return window.innerWidth-this._domElement.offsetWidth<=parseInt(this._domElement.style.left,10)+5?(this._domElement.style.left=window.innerWidth-this._domElement.offsetWidth+"px",document.querySelector("html").classList.add("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")):5>=parseInt(this._domElement.style.left,10)?(this._domElement.style.left="0px",document.querySelector("html").classList.add("pbs-inspector-docked-left"),document.querySelector("html").classList.remove("pbs-inspector-docked-right")):(document.querySelector("html").classList.remove("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")),ret};var stopBodyScroll=function(ev){var $=jQuery,$this=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height(),delta="DOMMouseScroll"===ev.type?-40*ev.originalEvent.detail:ev.originalEvent.wheelDelta,up=delta>0,prevent=function(){return ev.stopPropagation(),ev.preventDefault(),ev.returnValue=!1,!1};return!up&&-delta>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?($this.scrollTop(0),prevent()):void 0};editor.bind("start",function(){jQuery(".ct-toolbox").on("DOMMouseScroll mousewheel",stopBodyScroll)}),editor.bind("stop",function(){jQuery(".ct-toolbox").off("DOMMouseScroll mousewheel",stopBodyScroll)})}}),window.updateInspector=function(clickedElement){clearTimeout(window._updateInspectorTimeout),window._updateInspectorTimeout=setTimeout(function(){var domElement=document.getSelection().anchorNode,editor=ContentTools.EditorApp.get();clickedElement&&(domElement=clickedElement),window._inspectorOrigScrollTop=document.querySelector(".ct-toolbox").scrollTop,editor._toolbox.addSection(domElement),document.querySelector(".ct-toolbox").scrollTop=window._inspectorOrigScrollTop},10)},window.addEventListener("DOMContentLoaded",function(){document.addEventListener("mouseup",function(ev){window.PBSEditor.isEditing()&&window.pbsSelectorMatches(ev.target,'[data-name="main-content"] *')&&window.updateInspector(ev.target)}),document.addEventListener("keyup",function(ev){window.PBSEditor.isEditing()&&window.pbsSelectorMatches(ev.target,'[data-name="main-content"] *')&&-1!==[40,37,39,38,9,8,46,13].indexOf(ev.keyCode)&&window.updateInspector()}),ContentEdit.Root.get().bind("focus",function(element){element.isFocused()||element.focus&&element.focus();var root=ContentEdit.Root.get();if(root.focused()){var domElement=null;root.focused()._domElement&&(domElement=root.focused()._domElement),window.updateInspector(domElement)}}),ContentEdit.Root.get().bind("drop",function(element){element.isFocused()||element.focus&&element.focus();var root=ContentEdit.Root.get();if(root.focused()){var domElement=null;root.focused()._domElement&&(domElement=root.focused()._domElement),window.updateInspector(domElement)}}),ContentEdit.Root.get().bind("blur",function(){setTimeout(function(){window._inspectorOrigScrollTop=document.querySelector(".ct-toolbox").scrollTop},1)})}),ContentTools.ToolboxUI.prototype._pbsAddDesignMount=ContentTools.ToolboxUI.prototype.mount,ContentTools.ToolboxUI.prototype.mount=function(){for(var ret=this._pbsAddDesignMount(),i=0;i<window.PBSEditor.toolHeadings.length;i++){var toolHeader=window.PBSEditor.toolHeadings[i],label=toolHeader.label,cls="pbs-"+toolHeader["class"];if(document.querySelectorAll(".ct-toolbox .ct-tool-group")[i]){var group=document.querySelectorAll(".ct-toolbox .ct-tool-group")[i];group.classList.add(cls+"-group");var heading=document.createElement("div");heading.innerHTML=label,heading.classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add(cls+"-title"),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),toolHeader.tip&&heading.appendChild(window.PBSEditor.createGroupTip(toolHeader.tip))}}return ret},window.PBSEditor.createGroupTip=function(text){var tip=document.createElement("span");tip.classList.add("pbs-group-tip"),tip.innerHTML="?";var tipText=document.createElement("span");return tipText.classList.add("pbs-group-tip-details"),tipText.innerHTML=text,tip.appendChild(tipText),tip};var _pbsCreatedViews=[];ContentTools.ToolboxUI.prototype.addSectionOptions=function(divGroup,option,element,model){"undefined"==typeof model&&(model=element.model);for(var optionName in PBSOption)if(PBSOption.hasOwnProperty(optionName)&&option.type.toLowerCase()===optionName.toLowerCase()){var id=optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();element.constructor.name&&(id=element.constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-"+option.id);var optionWrapper=document.createElement("DIV");if(optionWrapper.classList.add("ct-tool"),"button"!==option.type.toLowerCase()&&optionWrapper.classList.add("pbs-tool-option"),option["class"]&&optionWrapper.setAttribute("class",optionWrapper.getAttribute("class")+" "+option["class"]),optionName&&optionWrapper.classList.add("pbs-"+optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),option.id&&optionWrapper.setAttribute("id",id),option.group){var subGroupName=option.group.toLowerCase().trim().replace(/\"/g,""),subGroup=divGroup.querySelector('[data-subgroup="'+subGroupName+'"]');subGroup||(subGroup=document.createElement("DIV"),subGroup.setAttribute("data-subgroup",subGroupName),divGroup.appendChild(subGroup),"default"!==option.group&&(subGroup.innerHTML='<div class="pbs-option-subtitle pbs-tool-option">'+option.group+"</div>","Shortcode"===element.constructor.name&&(subGroup.firstChild.classList.add("pbs-collapsable-title"),subGroup.setAttribute("data-collapse-group",element.constructor.name.toLowerCase()),divGroup.querySelectorAll("[data-subgroup]").length>1&&window.pbsCollapseSection(subGroup)))),subGroup.appendChild(optionWrapper),option["group-tip"]&&(subGroup.querySelector(".pbs-group-tip-details")?subGroup.querySelector(".pbs-group-tip-details").innerHTML=option["group-tip"]:subGroup.querySelector(".pbs-option-subtitle").appendChild(window.PBSEditor.createGroupTip(option["group-tip"])))}else{var firstSubGroup=divGroup.querySelector("[data-subgroup]");firstSubGroup?divGroup.insertBefore(optionWrapper,firstSubGroup):divGroup.appendChild(optionWrapper)}if(!wp.hooks.applyFilters("pbs.inspector.do_add_section_options",!0,optionName,model,divGroup,element,this))return;var o=new PBSOption[optionName]({optionSettings:option,model:model,el:optionWrapper});return _pbsCreatedViews.push(o.render()),divGroup.view=o,void this.applyOptionDependencies(o)}},ContentTools.ToolboxUI.prototype.applyOptionDependencies=function(view){if(view.optionSettings.depends){var depends=view.optionSettings.depends;"number"!=typeof depends.length&&(depends=[depends]),view.listenTo(view.model,"change",function(){for(var allConditions=[],i=0;i<depends.length;i++)if(depends[i].id&&depends[i].value){var id=depends[i].id,value=depends[i].value,currentValue=this.model.get(id),makeVisible=!1;if("string"==typeof value&&("__not_empty"===value.toLowerCase().trim()||"__empty"===value.toLowerCase().trim()||value.match(/^(>=?|<=?|==|!=)(.*)/)||(value=[value])),value===!1||"string"==typeof value&&"false"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:"string"==typeof currentValue&&"false"===currentValue.toLowerCase().trim()?makeVisible=!0:"string"==typeof currentValue&&""===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"!=typeof currentValue||currentValue?currentValue||(makeVisible=!0):makeVisible=!0;else if(value===!0||"string"==typeof value&&"true"===value.toLowerCase().trim())"string"==typeof currentValue&&"true"===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue?makeVisible=!0:currentValue&&(makeVisible=!0);else if("object"==typeof value&&"number"==typeof value.length){var k,brokenByUnmatch=!1,onceMatched=!1,allNegatives=!0;for(k=0;k<value.length;k++)if(!value[k].match(/^!(.*)/)){allNegatives=!1;break}for(k=0;k<value.length;k++)if(value[k].match(/^!(.*)/)){var text=value[k].match(/^!(.*)/);if(text=text[1],text===currentValue){brokenByUnmatch=!0;break}}else if(value[k]===currentValue){onceMatched=!0;break}allNegatives&&!brokenByUnmatch?makeVisible=!0:!brokenByUnmatch&&onceMatched&&(makeVisible=!0)}else if("__not_empty"===value.toLowerCase().trim())"string"==typeof currentValue&&""!==currentValue.trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue&&(makeVisible=!0);else if("__empty"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:""===currentValue.trim()&&(makeVisible=!0);else if(value.match(/^(>=?|<=?|==|!=)(.*)/)){var matches=value.match(/^(>=?|<=?|==|!=)(.*)/),operator=matches[1],num=matches[2];num=num.match(/\./)?parseFloat(num):parseInt(num,10),currentValue="undefined"==typeof currentValue?0:currentValue.match(/\./)?parseFloat(currentValue):parseInt(currentValue,10),makeVisible="<"===operator?num>currentValue:"<="===operator?num>=currentValue:">"===operator?currentValue>num:">="===operator?currentValue>=num:"!="===operator?currentValue!==num:currentValue===num}allConditions.push(makeVisible)}var allTrue=!0;for(i=0;i<allConditions.length;i++)allConditions[i]||(allTrue=!1);allTrue?this.$el.fadeIn():this.$el.fadeOut()}),view.model.trigger("change",view.model)}},ContentTools.ToolboxUI.prototype.addGenericShortcodeOptions=function(divGroup,element){var view,keys,i,attributeName,hasOptions=!1;for(keys=element.model.keys(),i=0;i<keys.length;i++)attributeName=keys[i],"content"!==attributeName&&(view=new PBSOption.GenericOption({attribute:attributeName,model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0);if(element.model.get("content")&&(view=new PBSOption.GenericOption({attribute:"content",model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0),!hasOptions){var note=document.createElement("SPAN");note.innerHTML=pbsParams.labels.shortcodes_not_attributes_detected,note.classList.add("pbs-shortcode-no-options"),divGroup.appendChild(note)}},ContentTools.ToolboxUI.prototype.addSection=function(domElement){var currElem,i,k,group,heading,label,doneTypes=[];if(this._previouslySelectedElement!==domElement){if(this._newGroups=[],this._currentGroupIndex=0,"undefined"==typeof this._oldGroups){this._oldGroups=[];var editor=ContentTools.EditorApp.get();editor.bind("start",function(){this._oldGroups=[]}.bind(this))}if(this._previouslySelectedElement=domElement,"undefined"==typeof this._domInspectorGroups&&(this._domInspectorGroups=[]),domElement){for(var currDomElement=null;domElement;){if(domElement.tagName&&"DIV"!==domElement.tagName&&window.pbsSelectorMatches(domElement,'[data-name="main-content"] *')){currDomElement=domElement;break}domElement=domElement.parentNode}var matchedPattern="";if(label="",currDomElement)for(var pattern in PBSShortcodes)if(PBSShortcodes.hasOwnProperty(pattern))try{window.pbsSelectorMatches(domElement,pattern)&&(matchedPattern=pattern)}catch(err){}if(matchedPattern)for(PBSShortcodes[matchedPattern].label&&(label=PBSShortcodes[matchedPattern].label),label||(label=matchedPattern),group=this.constructor.createDiv(["ct-tool-group","pbs-inspector-group","pbs-dom-group"]),group.groupType=matchedPattern,heading=document.createElement("DIV"),heading.classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-dom-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),currElemModel=new Backbone.Model({element:currDomElement}),i=0;i<PBSShortcodes[matchedPattern].options.length;i++)this.addSectionOptions(group,PBSShortcodes[matchedPattern].options[i],currDomElement,currElemModel)}var root=ContentEdit.Root.get(),element=root.focused();if(element){currElem=element;for(var hierarchy=[],finishedClasses=[];currElem&&"Region"!==currElem.constructor.name;)-1===finishedClasses.indexOf(currElem.constructor.name)&&(hierarchy.push(currElem),finishedClasses.push(currElem.constructor.name)),currElem=currElem.parent();var elem;for(i=0;i<hierarchy.length;i++)if("DivRow"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}for(i=0;i<hierarchy.length;i++)if("DivCol"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}var currElemModel,finishedElemTypes=[];for(i=0;i<hierarchy.length;i++){currElem=hierarchy[i];var groupClasses,elemType=currElem.constructor.name;if(elemType=wp.hooks.applyFilters("pbs.inspector.elemtype",elemType,currElem),-1===finishedElemTypes.indexOf(elemType)){if(finishedElemTypes.push(elemType),"Shortcode"===elemType)label=currElem._domElement.getAttribute("data-base"),"undefined"!=typeof PBSShortcodes[currElem.sc_base]&&"undefined"!=typeof PBSShortcodes[currElem.sc_base].label&&(label=PBSShortcodes[currElem.sc_base].label);else{if("undefined"==typeof PBSShortcodes[elemType]||-1!==doneTypes.indexOf(elemType))continue;label=currElem.typeName(),PBSShortcodes[elemType].label&&(label=PBSShortcodes[elemType].label)}if(groupClasses=["ct-tool-group","pbs-inspector-group","pbs-"+currElem.cssTypeName()+"-group"],"Shortcode"===elemType&&groupClasses.push("pbs-shortcode-"+currElem.sc_base+"-group"),group=this.constructor.createDiv(groupClasses),group.groupType=elemType,heading=document.createElement("DIV"),heading.classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-"+currElem.cssTypeName()+"-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),"Shortcode"===elemType){var shortcodeBase=currElem.sc_base,shortcodeProperties=PBSShortcodes[shortcodeBase];if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.hidden&&shortcodeProperties.hidden)continue;if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.options)for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(group,shortcodeProperties.options[k],currElem);else this.addGenericShortcodeOptions(group,currElem),heading.innerHTML+="<span>"+pbsParams.labels.note_options_are_detected+"</span>";var shortcodeNote=document.createElement("DIV");shortcodeNote.classList.add("pbs-inspector-shortcode-note"),shortcodeNote.innerHTML=pbsParams.labels.note_shortcode_not_appearing,group.appendChild(shortcodeNote)}else{if("undefined"==typeof PBSShortcodes[elemType]||-1!==doneTypes.indexOf(elemType))continue;for(currElem.model?(currElemModel=currElem.model,currElemModel.set("element",currElem)):currElemModel=new Backbone.Model({element:currElem}),k=0;k<PBSShortcodes[elemType].options.length;k++)this.addSectionOptions(group,PBSShortcodes[elemType].options[k],currElem,currElemModel);wp.hooks.doAction("pbs.inspector.add_section",group,label)}}}for(i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];"undefined"!=typeof oldGroup.view,oldGroup.style.height=window.getComputedStyle(oldGroup).height,oldGroup.style.webkitTransition="height .3s ease-in-out",oldGroup.style.mozTransition="height .3s ease-in-out",oldGroup.style.msTransition="height .3s ease-in-out",oldGroup.style.transition="height .3s ease-in-out",oldGroup.style.overflow="hidden",oldGroup.offsetHeight,oldGroup.style.height=0,oldGroup.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.removeEventListener("transitionend",transitionEnd,!1),"undefined"!=typeof this.view&&this.view.remove(),this.parentNode.removeChild(this))}.bind(oldGroup),!1),setTimeout(function(){"undefined"!=typeof this.view&&this.view.remove(),this.parentNode&&this.parentNode.removeChild(this)}.bind(oldGroup),350)}for(this._oldGroups=[];this._newGroups.length;)this._oldGroups.push(this._newGroups.pop())}}},ContentTools.ToolboxUI.prototype.clearSections=function(){for(;_pbsCreatedViews.length>0;){var o=_pbsCreatedViews.pop();o.remove()}if(this._domInspectorGroups)for(;this._domInspectorGroups.length;){var elemToRemove=this._domInspectorGroups.shift();elemToRemove.parentNode.removeChild(elemToRemove)}this._previouslySelectedElement=null},ContentTools.ToolboxUI.prototype.placeGroup=function(group){this._newGroups.push(group);for(var i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];if(oldGroup.groupType===group.groupType){var startHeight=getComputedStyle(oldGroup).height;return group.style.overflow="hidden",group.style.height=startHeight,"undefined"!=typeof oldGroup.view&&oldGroup.view.remove(),this._domElement.replaceChild(group,oldGroup),this._currentGroupIndex=i+1,this._oldGroups.splice(i,1),void setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=startHeight,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight;var didTransition=!1;this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),didTransition=!0,this.removeEventListener("transitionend",transitionEnd,!1))},!1),setTimeout(function(){!didTransition&&this&&(this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"))}.bind(this),350)}.bind(group),1)}}group.style.height=0,group.style.overflow="hidden",this._domElement.insertBefore(group,this._domElement.querySelectorAll(".ct-tool-group")[this._currentGroupIndex+1]),this._currentGroupIndex++,setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=0,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight,this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),this.removeEventListener("transitionend",transitionEnd,!1))},!1)}.bind(group),1)},window.pbsAddInspector=function(elemName,args){if("object"==typeof args){var i;if("object"!=typeof elemName){if("undefined"==typeof PBSShortcodes[elemName])return void(PBSShortcodes[elemName]=args);for(var argName in args)if(args.hasOwnProperty(argName))if("options"!==argName)PBSShortcodes[elemName][argName]=args[argName];else{var options=args[argName];for(i=0;i<options.length;i++)PBSShortcodes[elemName].options.push(options[i])}}else for(i=0;i<elemName.length;i++)window.pbsAddInspector(elemName[i],args)}};var PBSShortcodes={};if(pbsParams.additional_shortcodes)for(var elemName in pbsParams.additional_shortcodes)pbsParams.additional_shortcodes.hasOwnProperty(elemName)&&(PBSShortcodes[elemName]=pbsParams.additional_shortcodes[elemName]);var storedCollapsed=[];window.pbsCollapseSection=function(section){var classes;if(section.classList.contains("pbs-collapse")){if(section.getAttribute("data-collapse-group")){var openSections=document.querySelectorAll('[data-collapse-group="'+section.getAttribute("data-collapse-group")+'"]:not(.pbs-collapse)');Array.prototype.forEach.call(openSections,function(el){window.pbsCollapseSection(el)})}var prevHeight=section.style.height;section.style.height="auto";var endHeight=getComputedStyle(section).height;section.style.height=prevHeight,section.offsetHeight,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.style.height=endHeight,section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(section.style.webkitTransition="",section.style.mozTransition="",section.style.msTransition="",section.style.transition="",section.style.height="auto",section.style.overflow="visible",section.removeEventListener("transitionend",transitionEnd,!1))},!1),section.classList.remove("pbs-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,""),-1!==storedCollapsed.indexOf(classes)&&(storedCollapsed.splice(storedCollapsed.indexOf(classes),1),localStorage.setItem("pbs_collapsed_sections",JSON.stringify(storedCollapsed)))}else section.style.height=window.getComputedStyle(section).height,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.offsetHeight,section.style.height=window.getComputedStyle(section.firstChild).height,section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&section.removeEventListener("transitionend",transitionEnd,!1)},!1),section.classList.add("pbs-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,""),-1===storedCollapsed.indexOf(classes)&&(storedCollapsed.push(classes),localStorage.setItem("pbs_collapsed_sections",JSON.stringify(storedCollapsed)))},window.pbsOpenAllSections=function(){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el)})},window.pbsOnlyOpenSection=function(sectionClass){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){sectionClass&&el.classList.contains(sectionClass)?el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el):el.classList.contains("pbs-collapse")||window.pbsCollapseSection(el)})},window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var editor=ContentTools.EditorApp.get();editor.bind("start",function(){if("undefined"!=typeof localStorage.getItem("pbs_collapsed_sections")&&localStorage.getItem("pbs_collapsed_sections")){storedCollapsed=JSON.parse(localStorage.getItem("pbs_collapsed_sections"));for(var i=0;i<storedCollapsed.length;i++){var groupClass=storedCollapsed[i].replace(/\s/g,".");if(groupClass){var section=document.querySelector(".ct-tool-group."+groupClass);section&&(section.classList.add("pbs-collapse"),section.style.height=window.getComputedStyle(section.firstChild).height)}}}}),document.addEventListener("click",function(ev){var section=ev.target;if(ev.target.classList.contains("pbs-collapsable-title"))section=ev.target.parentNode;else{if(!ev.target.parentNode)return;if(!ev.target.parentNode.classList)return;if(!ev.target.parentNode.classList.contains("pbs-collapsable-title"))return;section=ev.target.parentNode.parentNode}window.pbsCollapseSection(section)})}}),wp.hooks.addAction("inspector.group_title.create",function(section){var classes=section.getAttribute("class");classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,""),-1!==storedCollapsed.indexOf(classes)&&(section.classList.add("pbs-collapse"),setTimeout(function(){section.style.height=window.getComputedStyle(section.firstChild).height},1))});var PBSOption={};PBSOption.widgetSettings=Backbone.View.extend({className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged",'click input[type="radio"]':"attributeChanged",'click input[type="checkbox"]':"attributeChanged","change select":"attributeChanged","keyup select":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"undefined"==typeof this.model.attributes.widget&&(this.model.attributes.widget="WP_Widget_Text"),this.template=wp.template("pbs-widget-"+this.model.attributes.widget)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data));var widgetInfo=pbsParams.widget_list[this.model.attributes.widget],inspectorContainer=this.el.parentNode.querySelector(".pbs-group-title");inspectorContainer.innerHTML=pbsParams.labels.widget_properties_title.replace("%s",widgetInfo.name)+"<span>"+widgetInfo.description+"</span>";for(var attributeName in this.model.attributes)if(this.model.attributes.hasOwnProperty(attributeName)){var option=this.el.querySelector("#widget-"+widgetInfo.id_base+"--"+attributeName);option&&("TEXTAREA"===option.tagName?option.value=this.model.attributes[attributeName].replace(/<br>/g,"\n"):"INPUT"===option.tagName&&"checkbox"===option.getAttribute("type")?this.model.attributes[attributeName]&&(option.checked=!0):option.value=this.model.attributes[attributeName])}var fields=this.el.querySelectorAll("[id^=widget-"+widgetInfo.id_base+"--");return Array.prototype.forEach.call(fields,function(el){this.attributeChanged({target:el})}.bind(this)),this},attributeChanged:function(e){var widgetInfo=pbsParams.widget_list[this.model.attributes.widget],attribute=e.target.getAttribute("id").replace("widget-"+widgetInfo.id_base+"--","");"INPUT"===e.target.tagName&&"checkbox"===e.target.getAttribute("type")?this.model.set(attribute,e.target.checked?e.target.value:""):this.model.set(attribute,e.target.value)}}),PBSOption.Button=Backbone.View.extend({events:{click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",mousedown:"mousedown",mouseup:"mouseup"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this._canApplyUpdater()},render:function(){return this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name),this.optionSettings.render&&this.optionSettings.render(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this},click:function(){this.el.classList.contains("ct-tool--disabled")||(this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this._selectedElement&&this._selectedElement.restoreState&&this._selectedElement.restoreState())},updateTooltip:function(value){if(value||(value=""),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){if(this.optionSettings["tooltip-reset"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-reset"].replace("{0}",value))}else if(window.PBSEditor.isCtrlDown){if(this.optionSettings["tooltip-down"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-down"].replace("{0}",value))}else if(this.optionSettings.tooltip)return void this.el.setAttribute("data-tooltip",this.optionSettings.tooltip.replace("{0}",value));this.optionSettings.tooltip?this.el.setAttribute("data-tooltip",this.optionSettings.tooltip):this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name)},_tooltipUpdater:function(){this.optionSettings.tooltipValue&&this.model.get("element")?this.updateTooltip(this.optionSettings.tooltipValue(this.model.get("element"),this)):this.updateTooltip()},updateIsApplied:function(value){this.el.classList.remove("ct-tool--applied"),
value&&this.el.classList.add("ct-tool--applied")},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&this.model.get("element")&&this.model.get("element")._domElement&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},_isAppliedUpdater:function(){this.optionSettings.isApplied&&this.model.get("element")&&this.model.get("element")._domElement&&this.updateIsApplied(this.optionSettings.isApplied(this.model.get("element"),this))},mouseenter:function(){this.optionSettings.mouseenter&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseenter(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.add("ce-element--over"),this._tooltipUpdaterInterval=setInterval(this._tooltipUpdater.bind(this),100)},mouseleave:function(){this.optionSettings.mouseleave&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseleave(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.remove("ce-element--over"),clearInterval(this._tooltipUpdaterInterval)},mousedown:function(){var root=ContentEdit.Root.get(),selectedElement=root.focused();selectedElement&&selectedElement.storeState&&selectedElement.storeState(),selectedElement&&(this._selectedElement=selectedElement),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.optionSettings.hold(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater()}.bind(this),30)}.bind(this),500))},mouseup:function(){this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval))}}),PBSOption.GenericOption=Backbone.View.extend({template:wp.template("pbs-shortcode-generic-option"),className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"content"===this.attribute&&(this.template=wp.template("pbs-shortcode-generic-content"))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.model.get(this.attribute),data.attr=this.attribute,this.$el.html(this.template(data)),this},attributeChanged:function(e){this.model.set(this.attribute,e.target.value)}}),PBSOption.Border=Backbone.View.extend({template:wp.template("pbs-option-border"),events:{"change select":"styleChanged","change .width":"widthChanged","keyup .width":"widthChanged","change .radius":"radiusChanged","keyup .radius":"radiusChanged","click .pbs-color-preview":"togglePicker","change .pbs-color-popup input":"colorChanged","keyup .pbs-color-popup input":"colorChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID;for(var styles=window.getComputedStyle(this.model.get("element")._domElement),stylesToAdd=["border-color","border-style","border-width","border-radius"],i=0;i<stylesToAdd.length;i++)this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});this.$el.html(this.template(data));var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){_this.colorChanged()},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.apply(this,arguments)},colorChanged:function(){var inputColor=this.el.querySelector(".pbs-color-popup input").value,color=jQuery(this.el.querySelector("#"+this.randomID)).iris("color");("transparent"===inputColor||""===inputColor)&&(color=inputColor),this.model.get("element").style("border-color",color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview").style.background=color},styleChanged:function(e){this.model.get("element").style("border-style",e.target.value);var newBorder="0px";"none"!==e.target.value&&(newBorder="1px");var allBordersZero=!0;parseInt(this.model.get("border-top-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-right-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-bottom-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-left-width"),10)&&(allBordersZero=!1),(allBordersZero&&"none"!==e.target.value||"none"===e.target.value)&&(this.model.set("border-top-width",newBorder),this.model.set("border-right-width",newBorder),this.model.set("border-bottom-width",newBorder),this.model.set("border-left-width",newBorder),this.model.get("element").style("border-width",newBorder),this.model.trigger("change",this.model))},widthChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-width",value)},radiusChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-radius",value)},togglePicker:function(){"block"===this.el.querySelector(".pbs-color-popup").style.display?this.el.querySelector(".pbs-color-popup").style.display="":this.el.querySelector(".pbs-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""}}),PBSOption.Color=Backbone.View.extend({template:wp.template("pbs-option-color"),events:{mouseenter:"mouseenter",mouseleave:"mouseleave","change input":"selectChanged","keyup input":"selectChanged","click .pbs-color-preview":"togglePicker","mousedown .iris-square-handle":"mousedownPicker","mouseup .iris-square-handle":"mouseupPicker"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this._canApplyUpdater()},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},updateColor:function(color){this.el.querySelector(".pbs-color-preview").style.background!==color&&(this.el.querySelector(".pbs-color-preview").style.background=color,this.el.querySelector("input").value=color,jQuery("#"+this.randomID).iris("color",color))},updateTooltip:function(value){if(value||(this.optionSettings.value?value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(value=this.model.get(this.optionSettings.id))),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){if(this.optionSettings["tooltip-reset"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-reset"].replace("{0}",value))}else if(window.PBSEditor.isCtrlDown){if(this.optionSettings["tooltip-down"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-down"].replace("{0}",value))}else if(this.optionSettings.tooltip)return void this.el.setAttribute("data-tooltip",this.optionSettings.tooltip.replace("{0}",value));this.optionSettings.tooltip?this.el.setAttribute("data-tooltip",this.optionSettings.tooltip):this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID,this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html(this.template(data)),this.el.classList.add("pbs-button"),this.updateTooltip(data.value);var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){return _this._justInit?void _this.selectChanged():void(_this._justInit=!0)},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this._canApplyUpdater(),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.apply(this,arguments)},selectChanged:function(forceColor){var input=this.el.querySelector("input"),color=jQuery(input).iris("color");forceColor&&(color=input.value),(""===input.value||"transparent"===input.value)&&(color=input.value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),color,this),this.optionSettings.id&&this.model.set(this.optionSettings.id,color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview").style.background=color},togglePicker:function(){if(window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){var input=this.el.querySelector("input");return input.value="",this.selectChanged(),void jQuery("#"+this.randomID).iris("color","transparent")}var popup=this.el.querySelector(".pbs-color-popup"),otherPopups=document.querySelectorAll(".pbs-color-popup");Array.prototype.forEach.call(otherPopups,function(el){el!==popup&&(el.style.display="")}),"block"===popup.style.display?popup.style.display="":(wp.hooks.doAction("pbs.tool.popup.open"),popup.style.display="block"),wp.hooks.addAction("pbs.tool.popup.open",function(){popup.style.display=""}.bind(this))},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""},mouseenter:function(){this.optionSettings.mouseenter&&this.optionSettings.mouseenter(this.model.get("element"),this),this._tooltipUpdaterInterval=setInterval(this.updateTooltip.bind(this),100)},mouseleave:function(){this.optionSettings.mouseleave&&this.optionSettings.mouseleave(this.model.get("element"),this),clearInterval(this._tooltipUpdaterInterval)},mousedownPicker:function(){ContentTools.EditorApp.get().history.stopWatching()},mouseupPicker:function(){ContentTools.EditorApp.get().history.watch()}}),PBSOption.ColorButton=PBSOption.Color.extend({}),PBSOption.Select=Backbone.View.extend({template:wp.template("pbs-option-select"),events:{"change select":"selectChanged"},initialize:function(options){if(this.optionSettings=_.clone(options.optionSettings),this.listenTo(this.model,"change",this.render),this.optionSettings.value)this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")));else{var value=this.model.element.model.attributes[this.optionSettings.id]||"";this.model.set(this.optionSettings.id,value)}this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element"),this):data.value=this.model.element.model.attributes[this.optionSettings.id]||"",this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.Checkbox=Backbone.View.extend({template:wp.template("pbs-option-checkbox"),events:{"change input":"selectChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html(this.template(data)),this},selectChanged:function(e){var value=!1;this.optionSettings.unchecked&&(value=this.optionSettings.unchecked),e.target.checked&&(value=!0,this.optionSettings.checked&&(value=this.optionSettings.checked)),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value),this.model.set(this.optionSettings.id,value)},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Text=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged","click input":"click"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value)},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Textarea=PBSOption.Text.extend({template:wp.template("pbs-option-textarea"),events:{"change textarea":"selectChanged","keyup textarea":"selectChanged","click textarea":"click"}}),PBSOption.Number=PBSOption.Text.extend({}),PBSOption.MarginsAndPaddings=Backbone.View.extend({template:wp.template("pbs-option-margins-and-paddings"),events:{"keyup input":"inputChanged","change input":"inputChanged","blur input":"fixBlankValue","keydown input":"incrementDecrementValue"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.listenTo(this.model,"change",this.render)},render:function(){for(var element=this.model.get("element")._domElement,styles=window.getComputedStyle(element),stylesToAdd=["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left"],i=0;i<stylesToAdd.length;i++)element.style[stylesToAdd[i]]?this.model.set(stylesToAdd[i],element.style[stylesToAdd[i]],{silent:!0}):this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});"full-width-retain-content"===element.getAttribute("data-width")||"full-width"===element.getAttribute("data-width")?("full-width-retain-content"===this.model.get("width")?this.model.set("disableHorizontalPaddings",!0):this.model.unset("disableHorizontalPaddings"),"full-width-retain-content"===this.model.get("width")||"full-width"===this.model.get("width")?this.model.set("disableHorizontalMargins",!0):this.model.unset("disableHorizontalMargins")):(this.model.unset("disableHorizontalPaddings"),this.model.unset("disableHorizontalMargins"));var data=_.extend({},this.model.attributes,this.optionSettings);return this.$el.html(this.template(data)),this},inputChanged:function(e){var value=e.target.value,styleName=e.target.getAttribute("data-style");isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style(styleName,value),this.model.set(styleName,value,{silent:!0})},incrementDecrementValue:function(e){var regex=/^(\-?\d+)([^\d]*)$/,match=regex.exec(e.target.value);!match||38!==e.which&&40!==e.which||(38===e.which?(match[1]++,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]++,match[1]++,match[1]++,match[1]++)):(match[1]--,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]--,match[1]--,match[1]--,match[1]--)),e.target.value=match[1]+match[2],e.target.dispatchEvent(new CustomEvent("change")))},fixBlankValue:function(e){var style=e.target.getAttribute("data-style"),styleCamel=style.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()}),cssValue=this.model.get("element")._domElement.style[styleCamel];if(!cssValue){var values=window.getComputedStyle(this.model.get("element")._domElement);cssValue=values[style]}e.target.value=cssValue,this.model.set(style,cssValue,{silent:!0})}}),PBSOption.CustomClass=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getClasses:function(){var element=this.model.get("element");if("undefined"==typeof element.attr("class"))return"";var classes=element.attr("class");if(this.optionSettings.ignoredClasses){var currentClasses=classes.trim().split(" ");classes="",this.staticClasses=[];for(var staticClassRegex=new RegExp(this.optionSettings.ignoredClasses,"i"),i=0;i<currentClasses.length;i++)staticClassRegex.test(currentClasses[i])?this.staticClasses.push(currentClasses[i]):(classes+=0===classes.length?"":" ",classes+=currentClasses[i])}return classes},change:function(element,value){var i;if(value=value.toLowerCase(),"undefined"!=typeof element.attr("class")){var currentClasses=element.attr("class").split(" ");for(i=0;i<currentClasses.length;i++)element.removeCSSClass(currentClasses[i])}if(""!==value.trim()){var newClasses=value.trim().split(" ");for(i=0;i<newClasses.length;i++)element.addCSSClass(newClasses[i])}if(this.staticClasses.length)for(i=0;i<this.staticClasses.length;i++)element.addCSSClass(this.staticClasses[i]);element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getClasses(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getClasses(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.CustomID=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getID:function(){var element=this.model.get("element");return"undefined"==typeof element.attr("id")?"":element.attr("id")},change:function(element,value){element.attr("id",value),element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getID(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getID(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),window.pbsAddInspector("Icon",{label:"Icon",options:[{name:pbsParams.labels.choose_icon,tooltip:pbsParams.labels.choose_icon,type:"button","class":"ct-tool--icon",click:function(element){PBSEditor.iconFrame.open({title:pbsParams.labels.choose_icon,button:pbsParams.labels.choose_icon,successCallback:function(frameView){element.change(frameView.selected.firstChild)}})}},{tooltip:pbsParams.labels.change_icon_color,"tooltip-reset":pbsParams.labels.reset_icon_color,type:"colorButton",initialize:function(element,view){view.listenTo(view.model,"change:fill",view.optionSettings.modelChanged)},modelChanged:function(){this.updateColor(this.model.get("element")._domElement.style.fill)},value:function(element){return element._domElement.style.fill},change:function(element,value,view){element.style("fill",value),view.model.set("fill",value)}},{name:pbsParams.labels.increase_size,tooltip:pbsParams.labels.increase_size+" {0}","tooltip-down":pbsParams.labels.decrease_size+" {0}","tooltip-reset":pbsParams.labels.reset_size,type:"button","class":"ct-tool--font-up",initialize:function(element,view){view.listenTo(view.model,"change:width",view.render)},tooltipValue:function(element){return element._domElement.style.width},isApplied:function(element){return element._domElement.style.width},click:function(element,view){var margin=element._domElement.style.width,defaultMargin=parseInt(element.defaultStyle("width"),10);margin=""===margin?defaultMargin:parseInt(margin,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?margin=defaultMargin:window.PBSEditor.isCtrlDown?margin--:margin++,margin===defaultMargin?margin="":margin+="px",element.style("width",margin),element.style("height",margin),view.model.set("width",margin),view.model.set("height",margin)},hold:function(element,view){view.optionSettings.click(element,view)}}]}),window.pbsAddInspector("pbs_widget",{label:pbsParams.labels.widget,desc:pbsParams.labels.widget_inspector_desc,options:[{type:"widgetSettings"}]}),window.pbsAddInspector("divider_advanced",{label:"Champion - Advanced Divider Line",desc:"A more customizable divider.",options:[{name:"Color",type:"color",id:"color",desc:"The divider&apos;s color","default":""},{name:"Top Padding",type:"text",id:"paddingtop",desc:"in px","default":"20"},{name:"Bottom Padding",type:"text",id:"paddingbottom",desc:"in px","default":"false"},{name:"Thickness",type:"text",id:"thickness",desc:"in px","default":"false"},{name:"Width",type:"text",id:"width",desc:"add units, e.g. px or %","default":"false"},{name:"Go to top link",type:"checkbox",id:"top",checked:"true",unchecked:"false","default":"false"}]}),window.pbsAddInspector("divider_arrow",{label:"Champion - Divider Arrow",desc:"A customizable divider with arrows.",options:[{name:"Color",type:"color",id:"color",desc:"The divider&apos;s color",group:"Colors","default":""},{name:"Background Color",type:"color",id:"bgcolor",desc:"The divider&apos;s background color",group:"Colors","default":""},{name:"Arrow Width Left",type:"text",id:"widthleft",desc:"in px",group:"Arrow","default":""},{name:"Arrow Width Right",type:"text",id:"widthright",desc:"in px",group:"Arrow","default":""},{name:"Arrow Height",type:"text",id:"height",desc:"in px",group:"Arrow","default":"30"},{name:"Arrow Horizontal Position",type:"text",id:"horizontal",desc:"add units, e.g. px or %",group:"Arrow","default":""},{name:"Arrow Offset",type:"text",id:"offset",desc:"in px",group:"Arrow","default":""},{name:"Arrow Type",type:"select",id:"arrow",options:{down:"Down Arrow",up:"Up Arrow"},desc:"The direction of the arrow",group:"Arrow","default":"down"},{name:"Divider Line Thickness",type:"text",id:"thickness",desc:"in px",group:"Line","default":""},{name:"Divider Line Color",type:"color",id:"linecolor",desc:"",group:"Line","default":"",depends:[{id:"thickness",value:"__not_empty"}]},{name:"Optional Class",type:"text",id:"class",desc:"",group:"Advanced","default":""},{name:"Visible Screen Size",type:"select",id:"visible",options:{all:"All",320:"0-320",480:"0-480",568:"0-568",768:"0-768",980:"0-980","-480":"480-all","-568":"568-all","-768":"768-all","-980":"980-all"},desc:"",group:"Advanced","default":"all"}]}),window.pbsAddInspector("pbs_sidebar",{label:pbsParams.labels.sidebar,desc:pbsParams.labels.sidebar_inspector_desc,options:[{type:"select",name:pbsParams.labels.select_a_sidebar,id:"id",options:pbsParams.sidebar_list,desc:pbsParams.sidebar_label_id}]}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:[{name:pbsParams.labels.change_row_width,tooltip:pbsParams.labels.change_row_width+": {0}","tooltip-down":pbsParams.labels.change_row_width+": {0}","tooltip-reset":pbsParams.labels.reset_row_width,id:"width",type:"button","class":"pbs-button-row-width",initialize:function(element,view){view.listenTo(view.model,"change",view.render)},getRootRow:function(element){for(var rootRow=element,currElem=element._domElement;currElem&&currElem._ceElement;)currElem.classList.contains("pbs-row")&&(rootRow=currElem._ceElement),currElem=currElem.parentNode;return rootRow},canApply:function(element){return wp.hooks.applyFilters("inspector.row.change_width.can_apply",!0,element)},tooltipValue:function(element,view){var width=view.optionSettings.getRootRow(element)._domElement.getAttribute("data-width");return"full-width"===width?pbsParams.labels.full_width:"full-width-retain-content"===width?pbsParams.labels.full_width_retained_content_width:pbsParams.labels.normal},isApplied:function(element,view){return!!view.optionSettings.getRootRow(element)._domElement.getAttribute("data-width")},render:function(element,view){var rootRow=view.optionSettings.getRootRow(element),val=rootRow._domElement.getAttribute("data-width");val||(val=""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===val?view.el.classList.add("full"):"full-width-retain-content"===val&&view.el.classList.add("full-retain"),view.model.set(view.optionSettings.id,val)},click:function(element,view){var rootRow=view.optionSettings.getRootRow(element),val=rootRow._domElement.getAttribute("data-width");val||(val=""),rootRow.style("margin-left",""),rootRow.style("margin-right",""),rootRow.style("padding-left",""),rootRow.style("padding-right",""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?val="":window.PBSEditor.isCtrlDown?"full-width"===val?(val="full-width-retain-content",view.el.classList.add("full-retain")):"full-width-retain-content"===val?val="":(val="full-width",view.el.classList.add("full")):"full-width"===val?val="":"full-width-retain-content"===val?(val="full-width",view.el.classList.add("full")):(val="full-width-retain-content",view.el.classList.add("full-retain")),rootRow.attr("data-width",val),window._pbsFixRowWidth(rootRow._domElement),rootRow.taint(),view.model.set(view.optionSettings.id,val)}},{tooltip:pbsParams.labels.background_color,"tooltip-reset":pbsParams.labels.reset_background_color,type:"colorButton",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.optionSettings.modelChanged)},modelChanged:function(){this.updateColor(this.model.get("element")._domElement.style.backgroundColor)},value:function(element){return element._domElement.style.backgroundColor},change:function(element,value,view){element.style("background-color",value),view.model.set("background-color",value),pbsParams.is_lite&&element.style("background-image",""),wp.hooks.doAction("pbs.inspector.row.color.change",element)}},{name:pbsParams.labels.background_image,tooltip:pbsParams.labels.background_image,"tooltip-reset":pbsParams.labels.remove_background_image,type:"button","class":"pbs-button-background-image",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change",view.render)},tooltipValue:function(element,view){var value=element._domElement.style["background-image"];value?view.el.setAttribute("style","background-image: "+value+" !important;"):view.el.setAttribute("style","")},isApplied:function(element){return!!element._domElement.style["background-image"]},click:function(element,view){var imageID=element._domElement.getAttribute("data-bg-image-id");return window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?(element.style("background-image",""),element.attr("data-bg-image-id",""),void view.model.set("background-image","")):(setTimeout(function(){view._selectedElement&&view._selectedElement.storeState&&view._selectedElement.storeState()},1),void PBSEditor.openMediaManager(function(attachment){var currBgImage=element._domElement.style["background-image"],currBgColor=element._domElement.style["background-color"];-1!==currBgImage.indexOf("gradient")&&currBgColor?element.style("background-image","linear-gradient("+currBgColor+", "+currBgColor+"), url("+attachment.attributes.url+")"):element.style("background-image","url("+attachment.attributes.url+")"),element.attr("data-bg-image-id",attachment.id),view.model.set("background-image","url("+attachment.attributes.url+")"),view._selectedElement&&view._selectedElement.restoreState&&view._selectedElement.restoreState()},imageID))}}]}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:[{tooltip:pbsParams.labels.background_color,"tooltip-reset":pbsParams.labels.reset_background_color,type:"colorButton",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.optionSettings.modelChanged)},modelChanged:function(){this.updateColor(this.model.get("element")._domElement.style.backgroundColor)},value:function(element){return element._domElement.style.backgroundColor},change:function(element,value,view){element.style("background-color",value),view.model.set("background-color",value),pbsParams.is_lite&&element.style("background-image","")}},{name:pbsParams.labels.background_image,tooltip:pbsParams.labels.background_image,"tooltip-reset":pbsParams.labels.remove_background_image,type:"button","class":"pbs-button-background-image",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change",view.render)},tooltipValue:function(element,view){var value=element._domElement.style["background-image"];value?view.el.setAttribute("style","background-image: "+value+" !important;"):view.el.setAttribute("style","")},isApplied:function(element){return!!element._domElement.style["background-image"]},click:function(element,view){var imageID=element._domElement.getAttribute("data-bg-image-id");return window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?(element.style("background-image",""),element.attr("data-bg-image-id",""),void view.model.set("background-image","")):(setTimeout(function(){view._selectedElement&&view._selectedElement.storeState&&view._selectedElement.storeState()},1),void PBSEditor.openMediaManager(function(attachment){var currBgImage=element._domElement.style["background-image"],currBgColor=element._domElement.style["background-color"];-1!==currBgImage.indexOf("gradient")&&currBgColor?element.style("background-image","linear-gradient("+currBgColor+", "+currBgColor+"), url("+attachment.attributes.url+")"):element.style("background-image","url("+attachment.attributes.url+")"),element.attr("data-bg-image-id",attachment.id),view.model.set("background-image","url("+attachment.attributes.url+")"),view._selectedElement&&view._selectedElement.restoreState&&view._selectedElement.restoreState()},imageID))}}]}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:[{name:pbsParams.labels.increase_top_spacing,tooltip:pbsParams.labels.increase_top_spacing+" {0}",
"tooltip-down":pbsParams.labels.decrease_top_spacing+" {0}","tooltip-reset":pbsParams.labels.reset_top_spacing,type:"button","class":"pbs-button-row-margin-top-increase",group:pbsParams.labels.spacing,initialize:function(element,view){view.listenTo(view.model,"change:margin-top",view.render)},tooltipValue:function(element){return element._domElement.style["margin-top"]},canApply:function(element){return wp.hooks.applyFilters("inspector.row.add_top_spacing.can_apply",!0,element)},isApplied:function(element){return element._domElement.style["margin-top"]},click:function(element,view){var margin=element._domElement.style["margin-top"];view.el.classList.remove("ct-tool--applied");var defaultMargin=parseInt(element.defaultStyle("margin-top"),10);margin=""===margin?defaultMargin:parseInt(margin,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?margin=defaultMargin:window.PBSEditor.isCtrlDown?margin--:margin++,margin===defaultMargin?margin="":margin+="px",element.style("margin-top",margin),view.model.set("margin-top",margin)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_bottom_spacing,tooltip:pbsParams.labels.increase_bottom_spacing+" {0}","tooltip-down":pbsParams.labels.decrease_bottom_spacing+" {0}","tooltip-reset":pbsParams.labels.reset_bottom_spacing,type:"button","class":"pbs-button-row-margin-bottom-increase",group:pbsParams.labels.spacing,initialize:function(element,view){view.listenTo(view.model,"change:margin-bottom",view.render)},tooltipValue:function(element){return element._domElement.style["margin-bottom"]},canApply:function(element){return wp.hooks.applyFilters("inspector.row.add_bottom_spacing.can_apply",!0,element)},isApplied:function(element){return element._domElement.style["margin-bottom"]},click:function(element,view){var margin=element._domElement.style["margin-bottom"];view.el.classList.remove("ct-tool--applied");var defaultMargin=parseInt(element.defaultStyle("margin-bottom"),10);margin=""===margin?defaultMargin:parseInt(margin,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?margin=defaultMargin:window.PBSEditor.isCtrlDown?margin--:margin++,margin===defaultMargin?margin="":margin+="px",element.style("margin-bottom",margin),view.model.set("margin-bottom",margin)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_top_thickness,tooltip:pbsParams.labels.increase_top_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_top_thickness+" {0}","tooltip-reset":pbsParams.labels.reset_top_thickness,type:"button","class":"pbs-button-row-padding-top",group:pbsParams.labels.row_thickness,initialize:function(element,view){view.listenTo(view.model,"change:margin-top",view.render)},tooltipValue:function(element){return element._domElement.style["padding-top"]},isApplied:function(element){return element._domElement.style["padding-top"]},click:function(element,view){var padding=element._domElement.style["padding-top"];view.el.classList.remove("ct-tool--applied");var defaultPadding=parseInt(element.defaultStyle("padding-top"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=5:padding+=5,padding===defaultPadding?padding="":padding+="px",element.style("padding-top",padding),view.model.set("padding-top",padding)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_bottom_thickness,tooltip:pbsParams.labels.increase_bottom_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_bottom_thickness+" {0}","tooltip-reset":pbsParams.labels.reset_bottom_thickness,type:"button","class":"pbs-button-row-padding-bottom",group:pbsParams.labels.row_thickness,initialize:function(element,view){view.listenTo(view.model,"change:margin-bottom",view.render)},tooltipValue:function(element){return element._domElement.style["padding-bottom"]},isApplied:function(element){return element._domElement.style["padding-bottom"]},click:function(element,view){var padding=element._domElement.style["padding-bottom"];view.el.classList.remove("ct-tool--applied");var defaultPadding=parseInt(element.defaultStyle("padding-bottom"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=5:padding+=5,padding===defaultPadding?padding="":padding+="px",element.style("padding-bottom",padding),view.model.set("padding-bottom",padding)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_left_thickness,tooltip:pbsParams.labels.increase_left_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_left_thickness+" {0}","tooltip-reset":pbsParams.labels.reset_left_thickness,type:"button","class":"pbs-button-row-padding-left",group:pbsParams.labels.row_thickness,initialize:function(element,view){view.listenTo(view.model,"change",view.render)},tooltipValue:function(element){return element._domElement.style["padding-left"]},isApplied:function(element){return element._domElement.style["padding-left"]},canApply:function(element){return element._domElement.getAttribute("data-width")&&"full-width-retain-content"===element._domElement.getAttribute("data-width")?!1:!0},click:function(element,view){var padding=element._domElement.style["padding-left"];view.el.classList.remove("ct-tool--applied");var defaultPadding=parseInt(element.defaultStyle("padding-left"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=5:padding+=5,padding===defaultPadding?padding="":padding+="px",element.style("padding-left",padding),view.model.set("padding-left",padding)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_right_thickness,tooltip:pbsParams.labels.increase_right_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_right_thickness+" {0}","tooltip-reset":pbsParams.labels.reset_right_thickness,type:"button","class":"pbs-button-row-padding-right",group:pbsParams.labels.row_thickness,initialize:function(element,view){view.listenTo(view.model,"change",view.render)},tooltipValue:function(element){return element._domElement.style["padding-right"]},isApplied:function(element){return element._domElement.style["padding-right"]},canApply:function(element){return element._domElement.getAttribute("data-width")&&"full-width-retain-content"===element._domElement.getAttribute("data-width")?!1:!0},click:function(element,view){var padding=element._domElement.style["padding-right"];view.el.classList.remove("ct-tool--applied");var defaultPadding=parseInt(element.defaultStyle("padding-right"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=5:padding+=5,padding===defaultPadding?padding="":padding+="px",element.style("padding-right",padding),view.model.set("padding-right",padding)},hold:function(element,view){view.optionSettings.click(element,view)}}]}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:[{name:pbsParams.labels.increase_horizontal_content_padding,tooltip:pbsParams.labels.increase_horizontal_content_padding+" {0}","tooltip-down":pbsParams.labels.decrease_horizontal_content_padding+" {0}","tooltip-reset":pbsParams.labels.reset_horizontal_content_padding,type:"button","class":"pbs-button-col-padding-horizontal",group:pbsParams.labels.spacing_and_widths,initialize:function(element,view){view.listenTo(view.model,"change:padding-left change:padding-right",view.render)},tooltipValue:function(element){return element._domElement.style["padding-left"]},isApplied:function(element){return!!element._domElement.style["padding-left"]},click:function(element,view){var padding=element._domElement.style["padding-left"],defaultPadding=parseInt(element.defaultStyle("padding-left"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=1:padding+=1,padding===defaultPadding?padding="":padding+="px",element.style("padding-left",padding),element.style("padding-right",padding),view.model.set("padding-left",padding),view.model.set("padding-right",padding)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_vertical_content_padding,tooltip:pbsParams.labels.increase_vertical_content_padding+" {0}","tooltip-down":pbsParams.labels.decrease_vertical_content_padding+" {0}","tooltip-reset":pbsParams.labels.reset_vertical_content_padding,type:"button","class":"pbs-button-col-padding-vertical",group:pbsParams.labels.spacing_and_widths,initialize:function(element,view){view.listenTo(view.model,"change:padding-top change:padding-bottom",view.render)},tooltipValue:function(element){return element._domElement.style["padding-top"]},isApplied:function(element){return!!element._domElement.style["padding-top"]},click:function(element,view){var padding=element._domElement.style["padding-top"],defaultPadding=parseInt(element.defaultStyle("padding-top"),10);padding=""===padding?defaultPadding:parseInt(padding,10),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?padding=defaultPadding:window.PBSEditor.isCtrlDown?padding-=1:padding+=1,padding===defaultPadding?padding="":padding+="px",element.style("padding-top",padding),element.style("padding-bottom",padding),view.model.set("padding-top",padding),view.model.set("padding-bottom",padding)},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_column_gap,tooltip:pbsParams.labels.increase_column_gap+" {0}","tooltip-down":pbsParams.labels.decrease_column_gap+" {0}","tooltip-reset":pbsParams.labels.reset_column_gap,type:"button","class":"pbs-button-column-gap",group:pbsParams.labels.spacing_and_widths,tooltipValue:function(element){var row=element.parent();return row.hasColumnGap()},isApplied:function(element){var row=element.parent();return!!row.hasColumnGap()},click:function(element,view){var row=element.parent(),margin=row.hasColumnGap();if(1!==row.children.length){margin=parseInt(margin,10),margin||(margin=0),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?margin=0:window.PBSEditor.isCtrlDown?margin-=1:margin+=1,margin?0>margin?margin="":margin+="px":margin="";for(var i=0;i<row.children.length;i++)i<row.children.length-1?row.children[i].style("margin-right",margin):row.children[i].style("margin-right","");view.model.set("margin-right",margin)}},hold:function(element,view){view.optionSettings.click(element,view)}}]}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:[{name:pbsParams.labels.add_column,type:"button","class":"pbs-button-add-column",click:function(element){var overElement=element._domElement.querySelector(".ce-element--over");overElement&&overElement.classList.remove("ce-element--over");var col,root=ContentEdit.Root.get(),index=element.children.length;if(root.focused())for(col=root.focused();"Region"!==col.constructor.name&&"DivRow"!==col.constructor.name;){if("DivCol"===col.constructor.name){index=element.children.indexOf(col)+1;break}col=col.parent()}col=element.addNewColumn(index),col.focus(),col._domElement.classList.add("ce-element--over")},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}},{name:pbsParams.labels.clear_all_row_styles,type:"button","class":"pbs-clear-formatting",click:function(element,view){var i,styles=element.attr("style").replace(/(^\s*;|;\s*$)/g,"").split(";"),stylesToTrigger=[];for(i=0;i<styles.length;i++)-1!==styles[i].indexOf(":")&&stylesToTrigger.push(styles[i].match(/\s*([^:]+)/)[0]);for(element.attr("style",""),element.attr("data-width",""),i=0;i<stylesToTrigger.length;i++)view.model.set(stylesToTrigger[i].trim(),"")},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}},{name:pbsParams.labels.clone_row,type:"button","class":"pbs-button-clone",click:function(element){var newRow=element.clone();window._pbsFixRowWidth(newRow._domElement)},canApply:function(element){return wp.hooks.applyFilters("inspector.row.clone.can_apply",!0,element)},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}},{name:pbsParams.labels.delete_row,type:"button","class":"ct-tool--remove",click:function(element){element.blurIfFocused();var otherElement=element.nextSibling();otherElement||(otherElement=element.previousSibling()),element.parent().detach(element),otherElement&&otherElement.focus()},canApply:function(element){return wp.hooks.applyFilters("inspector.row.delete.can_apply",!0,element)}}]}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:[{name:pbsParams.labels.clear_all_column_styles,type:"button","class":"pbs-clear-formatting",click:function(element,view){var i,existingMarginRight=element._domElement.style["margin-right"],existingMarginLeft=element._domElement.style["margin-left"],styles=element.attr("style").replace(/(^\s*;|;\s*$)/g,"").split(";"),stylesToTrigger=[];for(i=0;i<styles.length;i++)if(-1!==styles[i].indexOf(":")){var styleName=styles[i].match(/\s*([^:]+)/)[0];"margin-right"!==styleName&&"margin-left"!==styleName&&stylesToTrigger.push(styleName)}for(element.attr("style",""),existingMarginRight&&element.style("margin-right",existingMarginRight),existingMarginLeft&&element.style("margin-left",existingMarginLeft),i=0;i<stylesToTrigger.length;i++)view.model.set(stylesToTrigger[i].trim(),"")},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}},{name:pbsParams.labels.clone_column,type:"button","class":"pbs-button-clone",click:function(element){element._domElement.classList.remove("ce-element--over");var col=element.clone();col.focus(),col._domElement.classList.add("ce-element--over")},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}},{name:pbsParams.labels.delete_column,type:"button","class":"ct-tool--remove",click:function(element){var parent=element.parent(),parentSibling=parent.nextSibling(),index=parent.children.indexOf(element);if(index===parent.children.length-1){index--;var existingGap=parent.hasColumnGap();existingGap&&parent.children[index].style("margin-right","")}element.blurIfFocused(),parent.detach(element),parent&&(parent.children.length?parent.children[index].focus():parentSibling&&parentSibling.focus()),wp.hooks.doAction("pbs.inspector.column.delete.click",element)},canApply:function(element){return wp.hooks.applyFilters("inspector.column.delete.can_apply",!0,element)},mouseenter:function(element){element._domElement.classList.add("ce-element--over")},mouseleave:function(element){element._domElement.classList.remove("ce-element--over")}}]}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:[{tooltip:pbsParams.labels.border_color,"tooltip-reset":pbsParams.labels.remove_border,type:"colorButton",group:pbsParams.labels.borders,id:"border-color",initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.optionSettings.modelChanged)},modelChanged:function(){this.updateColor(this.model.get("element")._domElement.style.borderColor)},value:function(element){return element._domElement.style.borderColor},change:function(element,value,view){element.style("border-color",value),"transparent"===value&&(value=""),value?(value=element._domElement.style["border-style"],value&&"none"!==value||(value="solid",element.style("border-style",value),view.model.set("border-style",value)),value=element._domElement.style["border-width"],value||(value="1px",element.style("border-width",value),view.model.set("border-width",value))):(element.style("border-style",""),view.model.set("border-style",""),element.style("border-width",""),view.model.set("border-width",""))}},{name:pbsParams.labels.border_style,tooltip:pbsParams.labels.border_style+" {0}","tooltip-down":pbsParams.labels.border_style+" {0}","tooltip-reset":pbsParams.labels.remove_border,type:"button","class":"pbs-button-col-border-style",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-style",view.render)},tooltipValue:function(element){return element._domElement.style["border-style"]},isApplied:function(element){return!!element._domElement.style["border-style"]},click:function(element,view){var value=element._domElement.style["border-style"];value=window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?"":window.PBSEditor.isCtrlDown?"dashed"===value?"solid":"solid"===value?"":"solid":""===value?"solid":"solid"===value?"dashed":"",element.style("border-style",value),view.model.set("border-style",value),value&&(value=element._domElement.style["border-width"],value||(value="1px",element.style("border-width",value),view.model.set("border-width",value)),value=element._domElement.style["border-color"],value||(value="#000000",element.style("border-color",value),view.model.set("border-color",value)))},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_border_thickness,tooltip:pbsParams.labels.increase_border_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_border_thickness+" {0}","tooltip-reset":pbsParams.labels.remove_border,type:"button","class":"pbs-button-col-border-width",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},tooltipValue:function(element){return element._domElement.style["border-width"]},isApplied:function(element){return element._domElement.style["border-width"]},click:function(element,view){var value=element._domElement.style["border-width"];return value=value?parseInt(value,10):0,window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?value="":window.PBSEditor.isCtrlDown?value-=1:value+=1,value?value+="px":value="",element.style("border-width",value),view.model.set("border-width",value),value?(value=element._domElement.style["border-style"],value&&"none"!==value||(value="solid",element.style("border-style",value),view.model.set("border-style",value)),value=element._domElement.style["border-color"],void(value||(value="#000000",element.style("border-color",value),view.model.set("border-color",value)))):(element.style("border-style",""),view.model.set("border-style",""),element.style("border-color",""),void view.model.set("border-color",""))},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_border_radius,tooltip:pbsParams.labels.increase_border_radius+" {0}","tooltip-down":pbsParams.labels.decrease_border_radius+" {0}","tooltip-reset":pbsParams.labels.remove_border_radius,type:"button","class":"pbs-button-col-border-radius",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-radius",view.render)},tooltipValue:function(element){return element._domElement.style["border-radius"]},isApplied:function(element){return element._domElement.style["border-radius"]},click:function(element,view){var value=element._domElement.style["border-radius"];value=value?parseInt(value,10):0,window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?value=0:window.PBSEditor.isCtrlDown?value--:value++,value?value+="px":value="",element.style("border-radius",value),view.model.set("border-radius",value)},hold:function(element,view){view.optionSettings.click(element,view)}}]}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:[{tooltip:pbsParams.labels.border_color,"tooltip-reset":pbsParams.labels.remove_border,type:"colorButton",group:pbsParams.labels.borders,id:"border-color",initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.optionSettings.modelChanged)},modelChanged:function(){this.updateColor(this.model.get("element")._domElement.style.borderColor)},value:function(element){return element._domElement.style.borderColor},change:function(element,value,view){element.style("border-color",value),"transparent"===value&&(value=""),value?(value=element._domElement.style["border-style"],value&&"none"!==value||(value="solid",element.style("border-style",value),view.model.set("border-style",value)),value=element._domElement.style["border-width"],value||(value="1px",element.style("border-width",value),view.model.set("border-width",value))):(element.style("border-style",""),view.model.set("border-style",""),element.style("border-width",""),view.model.set("border-width",""))}},{name:pbsParams.labels.border_style,tooltip:pbsParams.labels.border_style+" {0}","tooltip-down":pbsParams.labels.border_style+" {0}","tooltip-reset":pbsParams.labels.remove_border,type:"button","class":"pbs-button-col-border-style",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-style",view.render)},tooltipValue:function(element){return element._domElement.style["border-style"]},isApplied:function(element){return!!element._domElement.style["border-style"]},click:function(element,view){var value=element._domElement.style["border-style"];return value=window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?"":window.PBSEditor.isCtrlDown?"dashed"===value?"solid":"solid"===value?"":"solid":""===value?"solid":"solid"===value?"dashed":"",element.style("border-style",value),view.model.set("border-style",value),value?(value=element._domElement.style["border-width"],value||(value="1px",element.style("border-width",value),view.model.set("border-width",value)),value=element._domElement.style["border-color"],void(value||(value="#000000",element.style("border-color",value),view.model.set("border-color",value)))):(element.style("border-style",""),view.model.set("border-style",""),element.style("border-color",""),void view.model.set("border-color",""))},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_border_thickness,tooltip:pbsParams.labels.increase_border_thickness+" {0}","tooltip-down":pbsParams.labels.decrease_border_thickness+" {0}","tooltip-reset":pbsParams.labels.remove_border,type:"button","class":"pbs-button-col-border-width",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},tooltipValue:function(element){return element._domElement.style["border-width"]},isApplied:function(element){return element._domElement.style["border-width"]},click:function(element,view){var value=element._domElement.style["border-width"];value=value?parseInt(value,10):0,window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?value="":window.PBSEditor.isCtrlDown?value-=1:value+=1,value?value+="px":value="",element.style("border-width",value),view.model.set("border-width",value),value&&(value=element._domElement.style["border-style"],value&&"none"!==value||(value="solid",element.style("border-style",value),view.model.set("border-style",value)),value=element._domElement.style["border-color"],value||(value="#000000",element.style("border-color",value),view.model.set("border-color",value)))},hold:function(element,view){view.optionSettings.click(element,view)}},{name:pbsParams.labels.increase_border_radius,tooltip:pbsParams.labels.increase_border_radius+" {0}","tooltip-down":pbsParams.labels.decrease_border_radius+" {0}","tooltip-reset":pbsParams.labels.remove_border_radius,type:"button","class":"pbs-button-col-border-radius",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-radius",view.render)},tooltipValue:function(element){return element._domElement.style["border-radius"]},isApplied:function(element){return element._domElement.style["border-radius"]},click:function(element,view){var value=element._domElement.style["border-radius"];value=value?parseInt(value,10):0,window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown?value=0:window.PBSEditor.isCtrlDown?value--:value++,value?value+="px":value="",element.style("border-radius",value),view.model.set("border-radius",value)},hold:function(element,view){view.optionSettings.click(element,view)}}]}),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){for(var row=null,col=null;element&&"Region"!==element.constructor.name;)"DivRow"===element.constructor.name&&(row=element),"DivCol"===element.constructor.name&&(col=element),element=element.parent();row&&"none"===row.style("border-style")&&("0px"!==row.style("border-width")&&row.style("border-width",""),""!==row.style("border-color")&&row.style("border-color","")),col&&"none"===col.style("border-style")&&("0px"!==col.style("border-width")&&col.style("border-width",""),""!==col.style("border-color")&&col.style("border-color",""))})}),window.pbsAddInspector("Map",{label:pbsParams.labels.map,options:[{name:pbsParams.labels.hide_map_controls,tooltip:pbsParams.labels.hide_map_controls,"tooltip-reset":pbsParams.labels.reset_map_controls,type:"button","class":"pbs-button-map-ui",isApplied:function(element){return element._domElement.getAttribute("data-disable-ui")},click:function(element){var value=element._domElement.getAttribute("data-disable-ui")||!1,enableControls=value||window.PBSEditor.isShiftDown&&window.PBSEditor.isCtrlDown;enableControls?element.attr("data-disable-ui",""):element.attr("data-disable-ui","1"),element._domElement.map.setOptions({disableDefaultUI:!enableControls})}},{name:pbsParams.labels.latitude_longitude_and_address,type:"text",desc:pbsParams.labels.latitude_longitude_desc,initialize:function(element,view){view.listenTo(view.model,"change:data-center",view.render)},value:function(element){return element.attr("data-center")},change:_.debounce(function(element,value,view){if(element.attr("data-center")!==value){element.attr("data-center",value),view.$el.find("input").removeClass("pbs-option-error");var center=value.trim()||"37.09024, -95.712891";element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker);var latLonMatch=center.match(/^([-+]?\d{1,2}([.]\d+)?)\s*,?\s*([-+]?\d{1,3}([.]\d+)?)$/);if(latLonMatch)element.attr("data-lat",latLonMatch[1]),element.attr("data-lng",latLonMatch[3]),center={lat:parseFloat(latLonMatch[1]),lng:parseFloat(latLonMatch[3])},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}));else{var geocoder=new google.maps.Geocoder;geocoder.geocode({address:center},function(results,status){status===google.maps.GeocoderStatus.OK?(element.attr("data-lat",results[0].geometry.location.lat()),element.attr("data-lng",results[0].geometry.location.lng()),center={lat:results[0].geometry.location.lat(),lng:results[0].geometry.location.lng()},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}))):view.$el.find("input").addClass("pbs-option-error")})}}},300)}]}),window.pbsAddInspector("Tabs",{label:pbsParams.labels.tabs,options:[{name:pbsParams.labels.add_tab,type:"button","class":"pbs-button-carousel-add-slide",click:function(element){element.addTab()}},{name:pbsParams.labels.remove_tab,type:"button","class":"pbs-button-carousel-remove-slide",click:function(element){element.removeTab()}},{name:pbsParams.labels.delete_tabs,type:"button","class":"ct-tool--remove",click:function(element){element.blur(),element.parent().detach(element)}}]}),ContentTools.Tools.ElementButton=function(_super){function ElementButton(){return ElementButton.__super__.constructor.apply(this,arguments)}return __extends(ElementButton,_super),ElementButton.canApply=function(element){return"Tab"===element.constructor.name?!1:!0},ElementButton}(ContentTools.Tool),ContentTools.Tools.AlignCenter.className="",ContentTools.Tools.AlignCenter.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),element.style("textAlign","center"),callback(!0)},ContentTools.Tools.AlignLeft.className="",ContentTools.Tools.AlignLeft.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),element.style("textAlign","left"),callback(!0)},ContentTools.Tools.AlignRight.className="",ContentTools.Tools.AlignRight.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),element.style("textAlign","right"),callback(!0)},ContentTools.Tools.AlignLeft.isApplied=function(element,selection){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"left"===element.style("textAlign")||"start"===element.style("textAlign")):!1},ContentTools.Tools.AlignCenter.isApplied=function(element,selection){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"center"===element.style("textAlign")):!1},ContentTools.Tools.AlignRight.isApplied=function(element,selection){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"right"===element.style("textAlign")||"end"===element.style("textAlign")):!1},ContentTools.Tools.Heading._canApply=ContentTools.Tools.Heading.canApply,ContentTools.Tools.Heading.canApply=function(element,selection){var origReturn=ContentTools.Tools.Heading._canApply(element,selection);return"ListItemText"===element.constructor.name?!1:void 0!==element.content&&element.parent().tagName?origReturn||"div"===element.parent().tagName():origReturn},ContentTools.Tools.Paragraph.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.UnorderedList.canApply=function(element,selection){var ret=ContentTools.Tools.Heading1.canApply(element,selection);return element.parent()&&element.parent().tagName&&"li"===element.parent().tagName()?!0:ret},ContentTools.Tools.OrderedList.canApply=ContentTools.Tools.UnorderedList.canApply,ContentTools.Tools.UnorderedList.isApplied=function(element){return element.parent()&&element.parent().parent()&&element.parent().parent().tagName&&element.parent().parent().tagName()===this.listTag?!0:!1},ContentTools.Tools.OrderedList.isApplied=ContentTools.Tools.UnorderedList.isApplied,function(){var proxied=ContentTools.Tools.UnorderedList.apply;ContentTools.Tools.UnorderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);
return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),function(){var proxied=ContentTools.Tools.OrderedList.apply;ContentTools.Tools.OrderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),ContentTools.Tools.Preformatted.canApply=function(element,selection){return ContentTools.Tools.Heading1.canApply(element,selection)},function(){var proxied=ContentTools.Tools.Preformatted.apply;ContentTools.Tools.Preformatted.apply=function(element,selection,callback){if(this.isApplied(element))return void window.PBSEditor.getToolUI("paragraph").apply(element,selection);if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return proxied.call(this,element,selection,callback)}}(),ContentTools.Tools.Preformatted.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.Bold.canApply=function(element,selection){return element.content?selection:!1},ContentTools.Tools.Bold.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontWeight=styledString.getStyle("font-weight",element);if(styledString.hasTags("strong",!0)||styledString.hasTags("b",!0))return!0;var fontWeightNum=parseInt(fontWeight,10);return isNaN(fontWeightNum)?"bold"===fontWeight:fontWeightNum>400},ContentTools.Tools.Bold.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("strong",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("strong"));else if(styledString.hasTags("b",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("b"));else{var fontWeight=styledString.getStyle("font-weight",element);if(fontWeight=fontWeight&&"normal"!==fontWeight?isNaN(parseInt(fontWeight,10))?"normal":parseInt(fontWeight,10)<=400?"bold":"normal":"bold","normal"===fontWeight){var defaultFontWeight=element.defaultStyle("font-weight");isNaN(parseInt(defaultFontWeight,10))||parseInt(defaultFontWeight,10)<400&&(fontWeight=defaultFontWeight)}var newStyle={"font-weight":fontWeight};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Italic.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},ContentTools.Tools.Italic.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontStyle=styledString.getStyle("font-style",element);return styledString.hasTags("em",!0)||styledString.hasTags("i",!0)?!0:"italic"===fontStyle},ContentTools.Tools.Italic.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("em",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("em"));else if(styledString.hasTags("i",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("i"));else{var fontStyle=styledString.getStyle("font-style",element);fontStyle=fontStyle&&"normal"!==fontStyle?"normal":"italic";var newStyle={"font-style":fontStyle};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Link.isApplied=function(element,selection){if("Image"===element.constructor.name)return element.a;if(selection){var from,to,_ref;return void 0!==element.content&&element.content.length()?(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)):!1}},function(){var proxied=ContentTools.Tools.Paragraph.apply;ContentTools.Tools.Paragraph.apply=function(element,selection,callback){var app,forceAdd,paragraph,region;if(app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Heading.canApply(element)&&!forceAdd);else if("DivCol"===element.parent().constructor.name||"Div"===element.parent().constructor.name)return region=element.parent(),paragraph=new ContentEdit.Text("p"),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0);return proxied.call(this,element,selection,callback)}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseDown;ContentTools.ToolUI.prototype._onMouseDown=function(ev){var ret=proxied.call(this,ev);if(!this.tool.doHold)return ret;clearTimeout(this._holdTimeout),clearInterval(this._holdInterval);var interval=30;this.tool.holdInterval&&(interval=this.tool.holdInterval);var element,selection;if(this._mouseDown){if(element=ContentEdit.Root.get().focused(),!element||!element.isMounted())return;selection=null,element.selection&&(selection=element.selection()),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.tool.doHold(element,selection)}.bind(this),interval)}.bind(this),500)}return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),proxied.call(this,ev)}}(),ContentTools.Tool.refreshTooltip=function(value){var buttonElement=window.PBSEditor.getToolUI(this.icon)._domElement;value||(value="");var tooltip;tooltip=window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?this.labelReset.replace("{0}",value):window.PBSEditor.isCtrlDown?this.labelDown.replace("{0}",value):this.label.replace("{0}",value),buttonElement.getAttribute("data-tooltip")!==tooltip&&buttonElement.setAttribute("data-tooltip",tooltip)},function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);if(this.tool.buttonName){this._domElement.classList.add("pbs-tool-large");var label=document.createElement("div");if(label.classList.add("pbs-tool-title"),label.textContent=this.tool.buttonName,this._domElement.appendChild(label),this.tool.premium&&pbsParams.is_lite){this._domElement.classList.add("pbs-tool-is-premium");var star=document.createElement("div");star.classList.add("pbs-tool-premium"),this._domElement.appendChild(star),this._domElement.addEventListener("mouseover",function(ev){ev.target.setAttribute("data-tooltip","Available only in Premium.")}.bind(this)),this._domElement.addEventListener("click",function(ev){var preview=document.createElement("DIV");preview.innerHTML=wp.template("pbs-preview-premium-element")({title:this.tool.title||this.tool.icon,description:this.tool.description,image:pbsParams.plugin_url+"page_builder_sandwich/images/preview-"+this.tool.icon+".gif"}),preview.addEventListener("click",function(ev){-1!==["IMG","DIV"].indexOf(ev.target.tagName)&&preview.parentNode.removeChild(preview)}),document.body.appendChild(preview)}.bind(this))}}return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return("Undo"===this.tool.name||"Redo"===this.tool.name)&&document.querySelector("#wp-admin-bar-root-default").appendChild(this._domElement),ret}}(),function(){var proxied=ContentTools.ToolUI.createDiv;ContentTools.ToolUI.createDiv=function(classNames,attributes,content){var elem;if(-1!==classNames.indexOf("ct-tool--undo")&&(elem=document.querySelector("#wp-admin-bar-pbs_adminbar_undo")),-1!==classNames.indexOf("ct-tool--redo")&&(elem=document.querySelector("#wp-admin-bar-pbs_adminbar_redo")),elem){if(elem.addEventListener("click",function(ev){ev.preventDefault()}),classNames&&classNames.length>0&&(elem.getAttribute("class")&&classNames.push(elem.getAttribute("class")),elem.setAttribute("class",classNames.join(" "))),attributes)for(var name in attributes)if(attributes.hasOwnProperty(name)){var value=attributes[name];elem.setAttribute(name,value)}return elem}return proxied.call(this,classNames,attributes,content)}}(),function(){ContentTools.Tools.Table.apply;ContentTools.Tools.Table.apply=function(element,selection,callback){},ContentTools.Tools.Table.premium=!0,ContentTools.Tools.Table.buttonName=pbsParams.labels.table,ContentTools.Tools.Table.label=pbsParams.labels.table}(),function(){ContentTools.Tools.Table.canApply=ContentTools.Tools.ElementButton.canApply}(),ContentTools.Tools.AlignRight.shortcut="ctrl+r",ContentTools.Tools.AlignCenter.shortcut="ctrl+e",ContentTools.Tools.AlignLeft.shortcut="ctrl+l",ContentTools.Tools.Italic.shortcut="ctrl+i",ContentTools.Tools.Bold.shortcut="ctrl+b",ContentTools.Tools.Link.shortcut="ctrl+k",ContentTools.Tools.Paragraph.shortcut="ctrl+1",ContentTools.Tools.UnorderedList.shortcut="ctrl+.",ContentTools.Tools.OrderedList.shortcut="ctrl+/",ContentTools.Tools.OrderedList.shortcut="ctrl+/",ContentTools.Tools.Preformatted.shortcut="ctrl+8",ContentTools.Tools.Undo.label=pbsParams.labels.undo+" (ctrl+Z)",ContentTools.Tools.Redo.label=-1!==navigator.appVersion.indexOf("Mac")?pbsParams.labels.redo+" (ctrl+shift+Z)":pbsParams.labels.redo+" (ctrl+y)",function(){var shortcuts={},gatherShortcutKeys=function(toolboxUI){if(!Object.keys(shortcuts).length)for(var toolUI in toolboxUI._toolUIs)if(toolboxUI._toolUIs.hasOwnProperty(toolUI)){var tool=toolboxUI._toolUIs[toolUI].tool;if(tool.shortcut){var key="",sc=tool.shortcut.replace(/\s/,"").toLowerCase();-1!==sc.indexOf("ctrl")&&(key+="ctrl"),-1!==sc.indexOf("shift")&&(key+=key?"+":"",key+="shift"),sc=sc.replace(/(ctrl|shift|\+)/g,""),sc||(key=""),key&&("space"===sc?sc=32:"up"===sc?sc=38:"right"===sc?sc=39:"down"===sc?sc=40:"left"===sc?sc=37:"tab"===sc?sc=9:"enter"===sc?sc=13:"."===sc?sc=190:"/"===sc?sc=191:"="===sc?sc=187:"-"===sc?sc=189:"delete"===sc&&(sc=8),"number"==typeof sc?key+="+"+sc:(sc=sc.match(/[a-z]/)?sc.toUpperCase():sc,key+="+"+sc.charCodeAt(0)),shortcuts[key]=tool)}}},getShortcutKey=function(ev){var key="";return(ev.metaKey||ev.ctrlKey)&&(key+="ctrl"),ev.shiftKey&&(key+=key?"+":"",key+="shift"),key?key+="+"+ev.keyCode:void 0},shortcutListener=function(ev){var key=getShortcutKey(ev),element=ContentEdit.Root.get().focused();if(wp.hooks.applyFilters("pbs.shortcuts",!1,key,element))return void ev.preventDefault();if(element&&shortcuts[key]){var tool=shortcuts[key];if(!element||!element.isMounted())return;var selection=null;if(element.selection&&(selection=element.selection()),tool.canApply(element,selection)){var temp1=window.PBSEditor.isCtrlDown,temp2=window.PBSEditor.isShiftDown;window.PBSEditor.isCtrlDown=!1,window.PBSEditor.isShiftDown=!1,tool.apply(element,selection,function(){},!0),window.PBSEditor.isCtrlDown=temp1,window.PBSEditor.isShiftDown=temp2}return ev.preventDefault(),ev.stopPropagation(),!1}},elementKeyDownProxy=ContentEdit.Text.prototype._onKeyDown;ContentEdit.Text.prototype._onKeyDown=function(ev){if(gatherShortcutKeys(this),shortcuts){var key=getShortcutKey(ev);if(shortcuts[key])return void shortcutListener(ev)}elementKeyDownProxy.call(this,ev)};var addDomEventListenersProxy=ContentTools.ToolboxUI.prototype._addDOMEventListeners;ContentTools.ToolboxUI.prototype._addDOMEventListeners=function(){return gatherShortcutKeys(this),document.addEventListener("keydown",shortcutListener),addDomEventListenersProxy.call(this)};var removeDomEventListenersProxy=ContentTools.ToolboxUI.prototype._removeDOMEventListeners;ContentTools.ToolboxUI.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",shortcutListener),removeDomEventListenersProxy.call(this)};var toolUIMountProxy=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){if("undefined"!=typeof this.tool.shortcut&&""!==this.tool.shortcut){var sc=this.tool.shortcut;sc=sc.replace(/\+(.)$/,function(match){return match.toUpperCase()}),this.tool.label&&(this.tool._origLabel||(this.tool._origLabel=this.tool.label),this.tool.label=this.tool._origLabel+" ("+sc+")"),this.tool.labelDown&&(this.tool._origLabelDown||(this.tool._origLabelDown=this.tool.labelDown),this.tool.labelDown=this.tool._origLabelDown+" ("+sc+")"),this.tool.labelReset&&(this.tool._origLabelReset||(this.tool._origLabelReset=this.tool.labelReset),this.tool.labelReset=this.tool._origLabelReset+" ("+sc+")")}var ret=toolUIMountProxy.call(this,domParent,before);return this._domElement.setAttribute("data-tooltip",ContentEdit._(this.tool.label.replace("{0}",""))),ret}}(),window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){if(window.PBSEditor.isEditing())if(!ev.metaKey&&!ev.ctrlKey||83!==ev.keyCode&&27!==ev.keyCode)(ev.metaKey||ev.ctrlKey)&&ev.shiftKey&&82===ev.keyCode&&(ev.preventDefault(),location.reload());else{ev.preventDefault();var element=ContentEdit.Root.get().focused();element&&element.blur(),83===ev.keyCode?document.querySelector("#wp-admin-bar-gambit_builder_save").dispatchEvent(new CustomEvent("click")):document.querySelector("#wp-admin-bar-gambit_builder_cancel").dispatchEvent(new CustomEvent("click"))}else(ev.metaKey||ev.ctrlKey)&&69===ev.keyCode&&(document.querySelector("#wp-admin-bar-gambit_builder_edit").dispatchEvent(new CustomEvent("click")),ev.preventDefault())})}),ContentTools.Tools.AddElementButton=function(_super){function AddElementButton(){return AddElementButton.__super__.constructor.apply(this,arguments)}return __extends(AddElementButton,_super),AddElementButton.isAddElementButton=!0,AddElementButton.listTool="",AddElementButton.icon="add-element-button",AddElementButton.canApply=function(){return!0},AddElementButton.isApplied=function(){if(this.listTool){var tool=window.PBSEditor.getToolUI(this.listTool);if(tool)return"block"===tool._domElement.style.display}return!1},AddElementButton.apply=function(element,selection,callback){return callback(!0)},AddElementButton}(ContentTools.Tool),ContentTools.Tools.AddElementList=function(_super){function AddElementList(){return AddElementList.__super__.constructor.apply(this,arguments)}return __extends(AddElementList,_super),AddElementList.type="design-elements-list",AddElementList.icon="design-elements-list",AddElementList.label="",AddElementList.populateList=function(domToolContainer){},AddElementList.addClickedItem=function(domItemClicked,elemFocused){},AddElementList.canApply=function(){return!0},AddElementList.isApplied=function(){return!1},AddElementList.toggleList=function(){this._ceElement._domElement.style.display?this.hideList():this.showList()},AddElementList.init=function(){var toolDomElement=this._ceElement._domElement;if(!toolDomElement.children.length){toolDomElement.classList.add("pbs-add-element-list"),this.populateList(toolDomElement);for(var i=0;i<toolDomElement.children.length;i++){var el=toolDomElement.children[i];el.classList.add("pbs-add-element-list-item"),el.setAttribute("data-search-terms",el.textContent.trim().toLowerCase()),el.addEventListener("click",this._onClick.bind(this))}var elem=document.createElement("INPUT");elem.setAttribute("type","search"),elem.setAttribute("placeholder","Type to search..."),toolDomElement.insertBefore(elem,toolDomElement.firstChild),elem.addEventListener("keyup",this._doSearch.bind(this)),elem=document.createElement("SPAN"),elem.classList.add("pbs-add-element-list-none-found"),elem.innerHTML="Nothing found",toolDomElement.insertBefore(elem,toolDomElement.firstChild)}},AddElementList._onClick=function(e){var root=ContentEdit.Root.get();if(root.focused()){for(var currTarget=e.target;!currTarget.classList.contains("pbs-add-element-list-item")&&currTarget.parentNode;)currTarget=currTarget.parentNode;this.addClickedItem(currTarget,root.focused())}},AddElementList.showList=function(){this._ceElement._domElement.style.display="block";var search=this._ceElement._domElement.querySelector('[type="search"]');search.focus(),search.select()},AddElementList.hideList=function(){this._ceElement._domElement.style.display=""},AddElementList._doSearch=function(ev){var elements,searchString=ev.target.value.trim().toLowerCase(),noneFoundLabel=this._ceElement._domElement.querySelector(".pbs-add-element-list-none-found");return noneFoundLabel.style.display="none",""===searchString?(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),void Array.prototype.forEach.call(elements,function(el){el.style.display=""})):(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),Array.prototype.forEach.call(elements,function(el){el.style.display="none"}),elements=ev.target.parentNode.querySelectorAll('[data-search-terms*="'+searchString+'"]'),Array.prototype.forEach.call(elements,function(el){el.style.display=""}),void(elements.length||(noneFoundLabel.style.display="block")))},AddElementList}(ContentTools.Tool),function(){var proxied=ContentTools.ToolboxUI.prototype.mount;ContentTools.ToolboxUI.prototype.mount=function(){var ret=proxied.call(this);for(var i in this._toolUIs)this._toolUIs.hasOwnProperty(i)&&this._toolUIs[i].tool.init&&this._toolUIs[i].tool.init();return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if(this.tool.__super__&&"AddElementButton"===this.tool.__super__.constructor.name)this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){var tool=window.PBSEditor.getToolUI(this.tool.listTool);"undefined"!=typeof tool&&tool.tool.toggleList()}}.bind(this));else{if(!this.tool.__super__||"AddElementList"!==this.tool.__super__.constructor.name)return proxied.call(this);this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()})}}}(),ContentTools.Tools.Shortcode=function(_super){function Shortcode(){return Shortcode.__super__.constructor.apply(this,arguments)}return __extends(Shortcode,_super),ContentTools.ToolShelf.stow(Shortcode,"shortcode"),Shortcode.label=pbsParams.labels.shortcode,Shortcode.icon="shortcode",Shortcode.tagName="shortcode",Shortcode.buttonName=pbsParams.labels.shortcode,Shortcode.apply=function(element,selection,callback){return PBSEditor.shortcodeFrame.open({title:pbsParams.labels.insert_shortcode,button:pbsParams.labels.insert_shortcode,successCallback:function(view){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var base=view.selected.getAttribute("data-shortcode-tag"),shortcodeRaw=this.createInsertedShortcode(base),shortcode=wp.shortcode.next(base,shortcodeRaw,0),elem=new ContentEdit.Text("p",{},shortcode.shortcode.string()),index=elemFocused.parent().children.indexOf(elemFocused);elemFocused.parent().attach(elem,index+1),elem.focus(),elem.origShortcode="",elem.origInnerHTML="",elem.isShortcodeEditing=!0}.bind(this)}),callback(!0)},Shortcode.createInsertedShortcode=function(base){var scData={tag:base,type:"closed",content:"",attrs:{}};if(PBSShortcodes[base]&&PBSShortcodes[base].options)for(var i=0;i<PBSShortcodes[base].options.length;i++){var option=PBSShortcodes[base].options[i];option.id&&option["default"]&&(scData.attrs[option.id]=option["default"])}return new wp.shortcode(scData).string()},Shortcode}(ContentTools.Tools.ElementButton),window.addEventListener("DOMContentLoaded",function(){var _toolbar=new PBS.Toolbar;_toolbar.init(),ContentTools.EditorApp.get().bind("start",function(){_toolbar.start()}),ContentTools.EditorApp.get().bind("stop",function(){_toolbar.stop()})}),PBS.Toolbar=function(){function Toolbar(){this._domElement=null,this.tools=[]}return Toolbar.prototype.init=function(){this._domElement=document.createElement("DIV"),this._domElement.classList.add("pbs-toolbar"),this._offsetAdminBar=document.querySelector("#wpadminbar").offsetHeight,document.body.appendChild(this._domElement),this._addEventListeners(),this._onMouseOverBound=this._onMouseOver.bind(this),this._onMouseMoveBound=this._onMouseMove.bind(this),this._onMouseOutBound=this._onMouseOut.bind(this),this._updatePositionBound=this._updatePosition.bind(this)},Toolbar.prototype._addEventListeners=function(){this._domElement.addEventListener("mouseout",function(e){this._parent!==e.relatedTarget&&this._onMouseOut(e)}.bind(this)),this._domElement.addEventListener("mouseout",function(e){e.relatedTarget&&e.relatedTarget.dispatchEvent(new CustomEvent("mouseover"))}),ContentEdit.Root.get().bind("drag",function(){this.hide()}.bind(this)),ContentEdit.Root.get().bind("blur",function(){this.hide()}.bind(this))},Toolbar.prototype._onMouseOver=function(e){var editorArea=document.querySelector("[data-editable]");if(editorArea.contains(e.target)&&!(e.relatedTarget&&e.relatedTarget.classList&&(e.relatedTarget.classList.contains("pbs-toolbar")||e.relatedTarget.classList.contains("pbs-tool"))||e.target.classList&&e.target.classList.contains("pbs-no-toolbar")||ContentEdit.Root.get().dragging())){var selectors=wp.hooks.applyFilters("pbs.has_toolbar_selectors",[]);this._clearTools();for(var i=0;i<selectors.length;i++){if(pbsSelectorMatches(e.target,selectors[i]))return this._parent=e.target,void(this._addTools(e.target)&&(this._domElement.classList.add("pbs-show"),this._domElement.style.opacity=1,this._updatePosition()));var childSelector=selectors[i].split(",").join(" *,").concat(" *");if(pbsSelectorMatches(e.target,childSelector))for(var parentElement=e.target.parentNode;parentElement&&"BODY"!==parentElement.tagName;){if(pbsSelectorMatches(parentElement,selectors[i]))return this._parent=parentElement,void(this._addTools(parentElement)&&(this._domElement.classList.add("pbs-show"),this._domElement.style.opacity=1,this._updatePosition()));parentElement=parentElement.parentNode}}}},Toolbar.prototype._onMouseMove=function(e){this._parent&&(this._domElement.classList.contains("pbs-show")||this._onMouseOver(e),this._updatePosition())},Toolbar.prototype._onMouseOut=function(e){e.relatedTarget&&e.relatedTarget.classList&&(e.relatedTarget.classList.contains("pbs-toolbar")||e.relatedTarget.classList.contains("pbs-tool"))||this.hide()},Toolbar.prototype._addTools=function(targetElement){var tools=wp.hooks.applyFilters("pbs.toolbar_tools",[],this._domElement,targetElement);if(tools.length){for(;this._domElement.firstChild;)this._domElement.removeChild(this._domElement.firstChild);for(var i=0;i<tools.length;i++)this._domElement.appendChild(tools[i]),this.tools.push(tools[i]),this.tools[this.tools.length-1].addEventListener("click",this._updatePositionBound);return tools.length}},Toolbar.prototype._updatePosition=function(){var rect=this._parent.getBoundingClientRect(),style=getComputedStyle(document.querySelector("html"));this._domElement.style.left=parseInt(rect.right-rect.width/2-this._domElement.offsetWidth/2-parseInt(style["margin-left"],10),10)+"px",this._domElement.style.top=parseInt(rect.top+window.pageYOffset-this._offsetAdminBar-this._domElement.offsetHeight+1,10)+"px"},Toolbar.prototype.start=function(){document.addEventListener("mouseover",this._onMouseOverBound),document.addEventListener("mousemove",this._onMouseMoveBound),document.addEventListener("mouseout",this._onMouseOutBound)},Toolbar.prototype.stop=function(){document.removeEventListener("mouseover",this._onMouseOverBound),document.removeEventListener("mousemove",this._onMouseMoveBound),document.removeEventListener("mouseout",this._onMouseOutBound)},Toolbar.prototype._clearTools=function(){for(var i=0;i<this.tools;i++)this.tools[i].removeEventListener("click",this._updatePositionBound);for(;this._domElement.firstChild;)this._domElement.removeChild(this._domElement.firstChild);this.tools=[]},Toolbar.prototype.hide=function(){this._domElement.classList.remove("pbs-show"),this._clearTools()},Toolbar}(),ContentTools.Tools.Heading1=function(_super){function Heading1(){return Heading1.__super__.constructor.apply(this,arguments)}return __extends(Heading1,_super),ContentTools.ToolShelf.stow(Heading1,"h1"),Heading1.label=pbsParams.labels.heading_label.replace("%d","1"),Heading1.icon="h1",Heading1.tagName="h1",Heading1.shortcut="ctrl+1",Heading1.canApply=function(element,selection){return"ListItemText"===element.constructor.name?!1:"TableCellText"===element.constructor.name?!1:ContentTools.Tools.Paragraph.canApply(element,selection)},Heading1.apply=function(element,selection,callback){if(this.isApplied(element))return void window.PBSEditor.getToolUI("paragraph").apply(element,selection);if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return Heading1.__super__.constructor.apply.call(this,element,selection,callback)},Heading1.isApplied=function(element){return element.tagName()===this.tagName},Heading1}(ContentTools.Tools.Heading),ContentTools.Tools.Heading2=function(_super){function Heading2(){return Heading2.__super__.constructor.apply(this,arguments)}return __extends(Heading2,_super),ContentTools.ToolShelf.stow(Heading2,"h2"),Heading2.label=pbsParams.labels.heading_label.replace("%d","2"),Heading2.icon="h2",Heading2.tagName="h2",Heading2.shortcut="ctrl+2",Heading2}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading3=function(_super){function Heading3(){return Heading3.__super__.constructor.apply(this,arguments)}return __extends(Heading3,_super),ContentTools.ToolShelf.stow(Heading3,"h3"),Heading3.label=pbsParams.labels.heading_label.replace("%d","3"),Heading3.icon="h3",Heading3.tagName="h3",Heading3.shortcut="ctrl+3",Heading3}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading4=function(_super){function Heading4(){return Heading4.__super__.constructor.apply(this,arguments)}return __extends(Heading4,_super),ContentTools.ToolShelf.stow(Heading4,"h4"),Heading4.label=pbsParams.labels.heading_label.replace("%d","4"),Heading4.icon="h4",Heading4.tagName="h4",Heading4.shortcut="ctrl+4",Heading4}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading5=function(_super){function Heading5(){return Heading5.__super__.constructor.apply(this,arguments)}return __extends(Heading5,_super),ContentTools.ToolShelf.stow(Heading5,"h5"),Heading5.label=pbsParams.labels.heading_label.replace("%d","5"),Heading5.icon="h5",Heading5.tagName="h5",Heading5.shortcut="ctrl+5",Heading5}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading6=function(_super){function Heading6(){return Heading6.__super__.constructor.apply(this,arguments)}return __extends(Heading6,_super),ContentTools.ToolShelf.stow(Heading6,"h6"),Heading6.label=pbsParams.labels.heading_label.replace("%d","6"),Heading6.icon="h6",Heading6.tagName="h6",Heading6.shortcut="ctrl+6",Heading6}(ContentTools.Tools.Heading1),ContentTools.Tools.Blockquote=function(_super){function Blockquote(){return Blockquote.__super__.constructor.apply(this,arguments)}return __extends(Blockquote,_super),ContentTools.ToolShelf.stow(Blockquote,"blockquote"),Blockquote.label=pbsParams.labels.blockquote,Blockquote.icon="blockquote",Blockquote.tagName="blockquote",Blockquote.shortcut="ctrl+7",Blockquote}(ContentTools.Tools.Heading1),ContentTools.Tools.ClearFormatting=function(_super){function ClearFormatting(){return ClearFormatting.__super__.constructor.apply(this,arguments)}return __extends(ClearFormatting,_super),ContentTools.ToolShelf.stow(ClearFormatting,"clear-formatting"),ClearFormatting.label=pbsParams.labels.clear_formatting,ClearFormatting.icon="clear-formatting",ClearFormatting.tagName="span",ClearFormatting.canApply=function(element,selection){if(!ContentTools.Tools.Bold.canApply(element,selection))return!1;var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content.hasStyle(from,to)):!1},ClearFormatting.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length()),element.content=element.content.removeStyles(from,to),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ClearFormatting}(ContentTools.Tool),ContentTools.Tools.Code=function(_super){function Code(){return Code.__super__.constructor.apply(this,arguments)}return __extends(Code,_super),ContentTools.ToolShelf.stow(Code,"code"),Code.label=pbsParams.labels.code,Code.icon="code",Code.tagName="code",Code.shortcut="",Code.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],this.isApplied(element,selection)?element.content=element.content.unformat(from,to,new HTMLString.Tag(this.tagName)):element.content=element.content.format(from,to,new HTMLString.Tag(this.tagName)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Code.isApplied=function(element,selection){if(selection){var from,to,_ref;return void 0!==element.content&&element.content.length()?(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)):!1}return!1},Code}(ContentTools.Tools.Bold),ContentTools.Tools.Color=function(_super){function Color(){return Color.__super__.constructor.apply(this,arguments)}return __extends(Color,_super),ContentTools.ToolShelf.stow(Color,"color"),Color.label=pbsParams.labels.color,Color.icon="color",Color.tagName="span",Color.canApply=function(element,selection){if(!element.content)return!1;var from,to,apply=selection&&!selection.isCollapsed(),color="";if(apply){var _ref=selection.get();from=_ref[0],to=_ref[1],from===to&&(to+=1)}else from=0,to=element.content.length();var selectedContent=element.content.slice(from,to).html(),matches=selectedContent.match(/^<span[^>]style[^>]+['"\s;]color:\s?([#().,\w]+)/);if(matches&&(color=matches[1]),!color){if("undefined"==typeof this._defaultBodyTextColor){var s=getComputedStyle(document.body);this._defaultBodyTextColor=s.color}color=this._defaultBodyTextColor}return this._ceElement._domElement.style.backgroundColor!==color&&(this._ceElement._domElement.style.backgroundColor=color),color?window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+color):window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label),
!0},Color.isApplied=function(){return!1},Color.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),this.rememberedSelection&&(selection=this.rememberedSelection),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var currColor=jQuery(this._ceElement._domElement.querySelector("input")).iris("color");return""===this._ceElement._domElement.querySelector("input").value&&(currColor=""),element.content=element.content.style(from,to,element._tagName,{color:currColor}),element.updateInnerHTML(),element.taint(),element.restoreState(),wp.hooks.doAction("pbs.tool.color.applied",element),callback(!0)},Color._colorPickerMount=function(){var _this=this,d=document.createElement("DIV"),o=document.createElement("INPUT");o.addEventListener("mousedown",function(){var element=ContentEdit.Root.get().focused(),selection=null;element.selection&&(selection=element.selection());var _ref=selection.get(),from=_ref[0],to=_ref[1];(0!==from||0!==to)&&(_this.rememberedSelection=selection)}),o.addEventListener("keyup",function(e){""===e.target.value&&(_this.selectedColor=e.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(),jQuery(_this._ceElement._domElement.querySelector("input")).iris("color",_this.selectedColor))}),o.addEventListener("blur",function(){_this._ceElement._domElement.querySelector("input").focus()}),o.classList.add("color-picker"),o.setAttribute("data-alpha","true"),d.appendChild(o),this._ceElement._domElement.appendChild(d),jQuery(o).iris({defaultColor:this._ceElement._domElement.style.backgroundColor,change:function(event){_this._ceElement._justShowedPicker||(_this.selectedColor=event.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(event)),_this._ceElement._justShowedPicker=void 0},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#D2527F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){_this.hidePicker()}),wp.hooks.addAction("pbs.tool.popup.open",function(){this.hidePicker()}.bind(this))},Color.hidePicker=function(){this._ceElement._domElement.firstChild.style.display="",this.rememberedSelection=null},Color}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=ContentTools.EditorApp.get()._toolbox._toolUIs.color;"undefined"!=typeof tool&&tool.tool.hidePicker()}),ContentTools.ToolUI.prototype._colorPickerMountOverride=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=this._colorPickerMountOverride(domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._colorPickerMount&&this.tool._colorPickerMount(),ret},ContentTools.ToolUI.prototype._toolColorAddDOMEventListeners=ContentTools.ToolUI.prototype._addDOMEventListeners,ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("Color"!==this.tool.name)return this._toolColorAddDOMEventListeners();var _this=this;this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){_this._domElement.querySelector("input").value=_this._domElement.style.backgroundColor,_this._justShowedPicker=!0,jQuery(_this._domElement.querySelector("input")).iris("color",_this._domElement.style.backgroundColor),""===_this._domElement.firstChild.style.display&&wp.hooks.doAction("pbs.tool.popup.open"),_this._domElement.firstChild.style.display=_this._domElement.firstChild.style.display?"":"block";var elements=_this._domElement.querySelectorAll(".iris-palette");Array.prototype.forEach.call(elements,function(el){"undefined"==typeof el._pbsInitDone&&(el._pbsInitDone=!0,el.addEventListener("mousedown",function(e){e.preventDefault()}))})}})},ContentTools.Tools.TwoColumn=function(_super){function OneColumn(){return OneColumn.__super__.constructor.apply(this,arguments)}return __extends(OneColumn,_super),ContentTools.ToolShelf.stow(OneColumn,"onecolumn"),OneColumn.label=pbsParams.labels.one_column,OneColumn.icon="onecolumn",OneColumn.tagName="onecolumn",OneColumn.buttonName=pbsParams.labels.one_column,OneColumn.apply=function(element,selection,callback){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),index=element.parent().children.indexOf(element);return element.parent().attach(row,index+1),row.attach(col),col.attach(p),element.blur(),p.focus(),row.showOutline(),wp.hooks.doAction("pbs.tool.row.applied",row),callback(!0)},OneColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.TwoColumn=function(_super){function TwoColumn(){return TwoColumn.__super__.constructor.apply(this,arguments)}return __extends(TwoColumn,_super),ContentTools.ToolShelf.stow(TwoColumn,"twocolumn"),TwoColumn.label=pbsParams.labels.two_column,TwoColumn.icon="twocolumn",TwoColumn.tagName="twocolumn",TwoColumn.buttonName=pbsParams.labels.two_column,TwoColumn.apply=function(element,selection,callback){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),index=element.parent().children.indexOf(element);return element.parent().attach(row,index+1),row.attach(col),col.attach(p),element.blur(),p.focus(),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),row.showOutline(),callback(!0)},TwoColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.ThreeColumn=function(_super){function ThreeColumn(){return ThreeColumn.__super__.constructor.apply(this,arguments)}return __extends(ThreeColumn,_super),ContentTools.ToolShelf.stow(ThreeColumn,"threecolumn"),ThreeColumn.label=pbsParams.labels.three_column,ThreeColumn.icon="threecolumn",ThreeColumn.tagName="threecolumn",ThreeColumn.buttonName=pbsParams.labels.three_column,ThreeColumn.apply=function(element,selection,callback){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),index=element.parent().children.indexOf(element);return element.parent().attach(row,index+1),row.attach(col),col.attach(p),element.blur(),p.focus(),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),row.showOutline(),callback(!0)},ThreeColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.FourColumn=function(_super){function FourColumn(){return FourColumn.__super__.constructor.apply(this,arguments)}return __extends(FourColumn,_super),ContentTools.ToolShelf.stow(FourColumn,"fourcolumn"),FourColumn.label=pbsParams.labels.four_column,FourColumn.icon="fourcolumn",FourColumn.tagName="fourcolumn",FourColumn.buttonName=pbsParams.labels.four_column,FourColumn.apply=function(element,selection,callback){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),index=element.parent().children.indexOf(element);return element.parent().attach(row,index+1),row.attach(col),col.attach(p),element.blur(),p.focus(),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),row.showOutline(),callback(!0)},FourColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.AlignJustify=function(_super){function AlignJustify(){return AlignJustify.__super__.constructor.apply(this,arguments)}return __extends(AlignJustify,_super),ContentTools.ToolShelf.stow(AlignJustify,"align-justify"),AlignJustify.label=pbsParams.labels.justify,AlignJustify.icon="align-justify",AlignJustify.className="",AlignJustify.apply=function(element,selection,callback){var _ref;return("ListItemText"===(_ref=element.constructor.name)||"TableCellText"===_ref)&&(element=element.parent()),element.style("textAlign","justify"),callback(!0)},AlignJustify.isApplied=function(element,selection){var _ref;return this.canApply(element)?(("ListItemText"===(_ref=element.type())||"TableCellText"===_ref)&&(element=element.parent()),"justify"===element.style("textAlign")):!1},AlignJustify}(ContentTools.Tools.AlignLeft),ContentTools.Tools.Sidebar=function(_super){function Sidebar(){return Sidebar.__super__.constructor.apply(this,arguments)}return __extends(Sidebar,_super),ContentTools.ToolShelf.stow(Sidebar,"sidebar"),Sidebar.label=pbsParams.labels.sidebar_or_widget_area,Sidebar.icon="sidebar",Sidebar.tagName="sidebar",Sidebar.buttonName=pbsParams.labels.sidebar,Sidebar.apply=function(element,selection,callback){var defaultSidebar="";for(var sidebarID in pbsParams.sidebar_list)if(sidebarID&&pbsParams.sidebar_list.hasOwnProperty(sidebarID)){defaultSidebar=sidebarID;break}var shortcode=wp.shortcode.next("pbs_sidebar",'[pbs_sidebar id="'+defaultSidebar+'"][/pbs_sidebar]',0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),index=element.parent().children.indexOf(element);return element.parent().attach(newElem,index+1),newElem.ajaxUpdate(!0),newElem.focus(),callback(!0)},Sidebar}(ContentTools.Tools.ElementButton),ContentTools.Tools.Hr=function(_super){function Hr(){return Hr.__super__.constructor.apply(this,arguments)}return __extends(Hr,_super),ContentTools.ToolShelf.stow(Hr,"hr"),Hr.label=pbsParams.labels.horizontal_rule,Hr.icon="hr",Hr.tagName="hr",Hr.shortcut="ctrl+h",Hr.canApply=function(){return!0},Hr.apply=function(element,selection,callback){var hr=new ContentEdit.Hr("hr"),index=element.parent().children.indexOf(element);return element.parent().attach(hr,index+1),hr.focus(),callback(!0)},Hr}(ContentTools.Tool),ContentTools.Tools.Icon=function(_super){function Icon(){return Icon.__super__.constructor.apply(this,arguments)}return __extends(Icon,_super),ContentTools.ToolShelf.stow(Icon,"icon"),Icon.label=pbsParams.labels.icon,Icon.icon="icon",Icon.tagName="icon",Icon.buttonName=pbsParams.labels.icon,Icon.apply=function(element,selection,callback){return PBSEditor.iconFrame.open({title:pbsParams.labels.insert_icon,button:pbsParams.labels.use_icon,successCallback:function(view){var newElem=new ContentEdit.Icon("div",{},view.selected.innerHTML),index=element.parent().children.indexOf(element);element.parent().attach(newElem,index+1),newElem.focus()}}),callback(!0)},Icon}(ContentTools.Tools.ElementButton),ContentTools.Tools.Link._pbsToolLinkOverrideCanApply=ContentTools.Tools.Link.canApply,ContentTools.Tools.Link.canApply=function(element,selection){var ret=this._pbsToolLinkOverrideCanApply(element,selection);if(!ret&&element.content&&selection){var _ref=selection.get(),from=_ref[0],to=_ref[1];if(from===to)return!0}return ret},ContentTools.Tools.Link.getSelectedLink=function(element,from,to){if(from<element.content.characters.length&&from>=0&&element.content.characters[from].hasTags("a"))for(;from>0;)if(from--,!element.content.characters[from].hasTags("a")){from++;break}if(to<element.content.characters.length&&to>=0&&element.content.characters[to].hasTags("a"))for(;to<element.content.characters.length&&element.content.characters[to].hasTags("a");)to++;return{from:from,to:to}},ContentTools.Tools.Link.apply=function(element,selection,callback){if("Image"===element.constructor.name)return void element.openMediaManager();var _ref=selection.get(),from=_ref[0],to=_ref[1],selected=this.getSelectedLink(element,from,to);from=selected.from,to=selected.to,selection=new ContentSelect.Range(from,to);var tag=this.getTag(element,selection),url="",target="",text="",existingClass="",existingStyles="";return tag&&(tag.attr("href")&&(url=tag.attr("href")),tag.attr("target")&&(target=tag.attr("target")),tag.attr("class")&&(existingClass=tag.attr("class")),tag.attr("style")&&(existingStyles=tag.attr("style"))),text=element.content.unformat(from,to,"a"),text=text.slice(from,to),element.storeState&&element.storeState(),wpLink.open("dummy-wplink-textarea"),text.html().trim()===text.text().trim()?(document.querySelector("#wp-link-wrap").classList.add("has-text-field"),text=text.text()):(document.querySelector("#wp-link-wrap").classList.remove("has-text-field"),text=""),document.querySelector("#wp-link-url").value=url,document.querySelector("#wp-link-text").value=text,document.querySelector("#wp-link-target").checked=""!==target,window._pbsCurrentLink={element:element,selection:selection,existingClass:existingClass,existingStyles:existingStyles,type:this.name},callback(!0)},window.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(ev){if("wp-link-submit"===ev.target.getAttribute("id")){var element=window._pbsCurrentLink.element,selection=window._pbsCurrentLink.selection,existingClass=window._pbsCurrentLink.existingClass,existingStyles=window._pbsCurrentLink.existingStyles,linkType=window._pbsCurrentLink.type,_ref=selection.get(),from=_ref[0],to=_ref[1];element.content=element.content.unformat(from,to,"a");var url=document.querySelector("#wp-link-url").value,text=document.querySelector("#wp-link-text").value,target=document.querySelector("#wp-link-target").checked;if(url){var args={href:url};if(target&&(args.target="_blank"),existingClass&&(args["class"]=existingClass),existingStyles&&(args.style=existingStyles),args=wp.hooks.applyFilters("pbs.tool."+linkType.toLowerCase()+".args",args),document.querySelector("#wp-link-wrap").classList.contains("has-text-field")&&""===text.trim()&&(text=url),text){var content=new HTMLString.String(text,"PreText"===element.constructor.name);content=content.format(0,content.characters.length,new HTMLString.Tag("a",args));var tip=element.content.substring(0,selection.get()[0]),tail=element.content.substring(selection.get()[1]);element.content=tip.concat(content),element.content=element.content.concat(tail,!1),from===to&&(to+=content.length())}else element.content=element.content.format(from,to,new HTMLString.Tag("a",args))}else element.content=element.content.unformat(from,to,"a");delete window._pbsCurrentLink,wp.hooks.doAction("pbs.tool."+linkType.toLowerCase()+".applied",element,from,to),element.updateInnerHTML(),element.taint(),element.restoreState&&element.restoreState(),window.updateInspector(),wpLink.close()}})}),ContentTools.Tools.Link.getTag=function(element,selection){var c,from,selectedContent,tag,to,_i,_j,_len,_len1,_ref,_ref1,_ref2;if("Image"===element.constructor.name){if(element.a)return element.a}else for(_ref=selection.get(),from=_ref[0],to=_ref[1],selectedContent=element.content.slice(from,to),_ref1=selectedContent.characters,_i=0,_len=_ref1.length;_len>_i;_i++)if(c=_ref1[_i],c.hasTags("a"))for(_ref2=c.tags(),_j=0,_len1=_ref2.length;_len1>_j;_j++)if(tag=_ref2[_j],"a"===tag.name())return tag;return null},ContentTools.Tools.Widget=function(_super){function Widget(){return Widget.__super__.constructor.apply(this,arguments)}return __extends(Widget,_super),ContentTools.ToolShelf.stow(Widget,"widget"),Widget.label=pbsParams.labels.widget,Widget.icon="widget",Widget.tagName="widget",Widget.buttonName=pbsParams.labels.widget,Widget.apply=function(element,selection,callback){return PBSEditor.widgetFrame.open({title:pbsParams.labels.insert_widget,button:pbsParams.labels.insert_widget,successCallback:function(view){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var base="pbs_widget",widgetSlug=view.selected.getAttribute("data-widget-slug"),shortcodeRaw='[pbs_widget widget="'+widgetSlug+'" ]',shortcode=wp.shortcode.next(base,shortcodeRaw,0),elem=ContentEdit.Shortcode.createShortcode(shortcode),index=elemFocused.parent().children.indexOf(elemFocused);elemFocused.parent().attach(elem,index+1),elem.focus(),setTimeout(function(){elem.ajaxUpdate(!0)},20)}}),callback(!0)},Widget}(ContentTools.Tools.ElementButton),ContentTools.Tools.Html=function(_super){function Html(){return Html.__super__.constructor.apply(this,arguments)}return __extends(Html,_super),ContentTools.ToolShelf.stow(Html,"html"),Html.label=pbsParams.labels.html,Html.icon="html",Html.tagName="html",Html.buttonName=pbsParams.labels.html,Html.apply=function(element,selection,callback){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html");var elem=ContentEdit.Html.fromDOMElement(dummy),index=elemFocused.parent().children.indexOf(elemFocused);return elemFocused.parent().attach(elem,index+1),elem.focus(),elem.openEditor(),callback(!0)},Html}(ContentTools.Tools.ElementButton),ContentTools.Tools.Map=function(_super){function Map(){return Map.__super__.constructor.apply(this,arguments)}return __extends(Map,_super),ContentTools.ToolShelf.stow(Map,"map"),Map.label=pbsParams.labels.map,Map.icon="map",Map.tagName="div",Map.shortcut="",Map.buttonName=pbsParams.labels.map,Map.apply=function(element,selection,callback){var newElem=ContentEdit.Map.create(),index=element.parent().children.indexOf(element);return element.parent().attach(newElem,index+1),newElem.focus(),callback(!0)},Map}(ContentTools.Tools.ElementButton),ContentTools.Tools.Tabs=function(_super){function Tabs(){return Tabs.__super__.constructor.apply(this,arguments)}return __extends(Tabs,_super),ContentTools.ToolShelf.stow(Tabs,"tabs"),Tabs.label=pbsParams.labels.tabs,Tabs.icon="tabs",Tabs.tagName="tabs",Tabs.buttonName=pbsParams.labels.tabs,Tabs.premium=!0,Tabs.apply=function(element,selection,callback){for(var hashes=[];hashes.length<4;){var hash=window.PBSEditor.generateHash();document.querySelector(".pbs-tabs-"+hash)||document.querySelector('[id="pbs-tabs-'+hash+'"]')||-1===hashes.indexOf(hash)&&hashes.push(hash)}var elem=document.createElement("div");elem.classList.add("pbs-tabs-"+hashes[0]),elem.setAttribute("data-ce-tag","tabs"),elem.innerHTML='<input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[1]+'" data-tab="1" data-ce-tag="tabradio" checked /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[2]+'" data-tab="2" data-ce-tag="tabradio" /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[3]+'" data-tab="3" data-ce-tag="tabradio" /><div class="pbs-tab-tabs" data-ce-tag="tabcontainer"><label for="pbs-tab-'+hashes[1]+'" data-ce-tag="tab" class="pbs-tab-active"><span style="font-weight: bold;">Tab 1</span></label><label for="pbs-tab-'+hashes[2]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 2</span></label><label for="pbs-tab-'+hashes[3]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 3</span></label></div><div class="pbs-tab-panels" data-ce-tag="tabpanelcontainer"><div class="pbs-row" data-panel="1"><div class="pbs-col"><p>Tab 1 content</p></div></div><div class="pbs-row" data-panel="2"><div class="pbs-col"><p>Tab 2 content</p></div></div><div class="pbs-row" data-panel="3"><div class="pbs-col"><p>Tab 3 content</p></div></div></div>';var newElem=ContentEdit.Tabs.fromDOMElement(elem);if(window.pbsSelectorMatches(element._domElement,'[data-ce-tag="tabs"] *'))for(;element&&"Tabs"!==element.constructor.name;)element=element.parent();var index=element.parent().children.indexOf(element);return element.parent().attach(newElem,index+1),newElem.focus(),callback(!0)},Tabs}(ContentTools.Tools.ElementButton),wp.media.view.settings.post&&(wp.media.view.settings.post.id=pbsParams.post_id),ContentTools.Tools.pbsMedia=function(_super){function pbsMedia(){return pbsMedia.__super__.constructor.apply(this,arguments)}return __extends(pbsMedia,_super),ContentTools.ToolShelf.stow(pbsMedia,"pbs-media"),pbsMedia.label=pbsParams.labels.media,pbsMedia.icon="image",pbsMedia.shortcut="ctrl+m",pbsMedia.buttonName=pbsParams.labels.media,pbsMedia.apply=function(element,selection){if(!this._isOpen()){var root=ContentEdit.Root.get(),elem=root.focused();ContentSelect.Range.query(elem._domElement),selection=ContentSelect.Range.query(elem._domElement),window._tempSelection=selection,window._pbsAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.pbsAddMediaOverrideInsert,wp.media.editor.open()}},pbsMedia._isOpen=function(){if(!wp.media.editor.get())return!1;var el=wp.media.editor.get().el;return!(0===el.offsetWidth&&0===el.offsetHeight)},pbsMedia.pbsAddMediaOverrideInsert=function(html){var index,newElem,root=ContentEdit.Root.get();if(root.focused()){var elem=root.focused(),addedImage=!1;if(html.match(/^\[/)){var base=html.match(/^\[(\w+)/);base=base[1];var shortcode=wp.shortcode.next(base,html,0);newElem=ContentEdit.Shortcode.createShortcode(shortcode),index=elem.parent().children.indexOf(elem),elem.parent().attach(newElem,index+1),newElem.ajaxUpdate(!0),newElem.focus()}else{var dummy=document.createElement("p");dummy.innerHTML=html,newElem=ContentEdit.Image.fromDOMElement(dummy.firstChild),newElem&&(index=elem.parent().children.indexOf(elem),elem.parent().attach(newElem,index+1),addedImage=!0,newElem.focus())}}wp.media.editor.insert=window._pbsAddMediaOrigInsert,delete window._pbsAddMediaOrigInsert},pbsMedia}(ContentTools.Tools.ElementButton),function(){var dragEnterHandler=function(){var root=ContentEdit.Root.get(),elem=root.focused();elem&&window.PBSEditor.getToolUI("pbs-media").apply(elem,null)};window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("start",function(){document.addEventListener("dragenter",dragEnterHandler)}),editor.bind("stop",function(){document.removeEventListener("dragenter",dragEnterHandler)})})}(),ContentTools.Tools.Underline=function(_super){function Underline(){return Underline.__super__.constructor.apply(this,arguments)}return __extends(Underline,_super),ContentTools.ToolShelf.stow(Underline,"underline"),Underline.label=pbsParams.labels.underline,Underline.icon="underline",Underline.tagName="span",Underline.shortcut="ctrl+u",Underline.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Underline.isApplied=function(element,selection){var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"underline"===element.content.substring(from,to).getStyle("text-decoration",element)):!1},Underline.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"line-through"!==style?"none":"underline";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Underline}(ContentTools.Tool),ContentTools.Tools.paragraphPicker=function(_super){function paragraphPicker(){return paragraphPicker.__super__.constructor.apply(this,arguments)}return __extends(paragraphPicker,_super),ContentTools.ToolShelf.stow(paragraphPicker,"paragraphPicker"),paragraphPicker.label=pbsParams.labels.text_style,paragraphPicker.icon="paragraph-picker",paragraphPicker.tagName="p",paragraphPicker.types={p:{className:"Paragraph",label:pbsParams.labels.paragraph},h1:{className:"Heading1",label:pbsParams.labels.heading_1},h2:{className:"Heading2",label:pbsParams.labels.heading_2},h3:{className:"Heading3",label:pbsParams.labels.heading_3},h4:{className:"Heading4",label:pbsParams.labels.heading_4},h5:{className:"Heading5",label:pbsParams.labels.heading_5},h6:{className:"Heading6",label:pbsParams.labels.heading_6},blockquote:{className:"Blockquote",label:'"'+pbsParams.labels.blockquote+'"'},pre:{className:"Preformatted",label:pbsParams.labels.preformatted}},paragraphPicker.canApply=function(element){if(this.types.hasOwnProperty(element.tagName())){for(var tag in this.types)this.types.hasOwnProperty(tag)&&element.tagName()!==tag&&this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+tag)&&this._ceElement._domElement.classList.remove("pbs-paragraph-picker-type-"+tag);this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+element.tagName())||(this._ceElement._domElement.classList.add("pbs-paragraph-picker-type-"+element.tagName()),this._ceElement._domElement.firstChild.textContent=this.types[element.tagName()].label)}return void 0!==element},paragraphPicker.isApplied=function(){return!this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-p")},paragraphPicker.apply=function(element,selection,callback){var app,forceAdd,paragraph,region;return app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Heading.canApply(element)&&!forceAdd?ContentTools.Tools[this._selectedClass].apply(element,selection,callback):("Region"!==element.parent().type()&&(element=element.closest(function(node){return"Region"===node.parent().type()})),region=element.parent(),paragraph=new ContentEdit.Text(this._selectedType),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0))},paragraphPicker._paragraphPickerMount=function(){var _this=this,d=document.createElement("DIV");for(var tag in this.types)if(this.types.hasOwnProperty(tag)){var label=document.createElement(tag);label.innerHTML=this.types[tag].label,label.setAttribute("data-tag",tag),label.setAttribute("data-class",this.types[tag].className),d.appendChild(label),label.addEventListener("mousedown",function(ev){ev.preventDefault(),this._selectedType=ev.target.getAttribute("data-tag"),this._selectedClass=ev.target.getAttribute("data-class"),this._ceElement._mouseDown=!0,this._ceElement._onMouseUp()}.bind(this))}this._ceElement._domElement.innerHTML=pbsParams.labels.paragraph,this._ceElement._domElement.appendChild(d),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){_this.hidePicker()}),wp.hooks.addAction("pbs.tool.popup.open",function(){this.hidePicker()}.bind(this))},paragraphPicker.hidePicker=function(){this._ceElement._domElement.querySelector("div").style.display="",this.rememberedSelection=null},paragraphPicker}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=ContentTools.EditorApp.get()._toolbox._toolUIs.paragraph;"undefined"!=typeof tool&&tool.tool.hidePicker()}),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._paragraphPickerMount&&this.tool._paragraphPickerMount(),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("paragraphPicker"!==this.tool.name)return proxied.call(this);var _this=this;this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){e.target.classList.contains("ct-tool")&&(""===_this._domElement.querySelector("div").style.display&&wp.hooks.doAction("pbs.tool.popup.open"),_this._domElement.querySelector("div").style.display=_this._domElement.querySelector("div").style.display?"":"block")})}}(),ContentTools.Tools.Strikethrough=function(_super){function Strikethrough(){return Strikethrough.__super__.constructor.apply(this,arguments)}return __extends(Strikethrough,_super),ContentTools.ToolShelf.stow(Strikethrough,"strikethrough"),Strikethrough.label=pbsParams.labels.strikethrough,Strikethrough.icon="strikethrough",Strikethrough.tagName="span",Strikethrough.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Strikethrough.isApplied=function(element,selection){var _ref,from=0,to=0;return void 0!==element.content&&element.content.length()?(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"line-through"===element.content.substring(from,to).getStyle("text-decoration",element)):!1},Strikethrough.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"underline"!==style?"none":"line-through";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Strikethrough}(ContentTools.Tool),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push('[data-ce-tag="embed"]'),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("embed"!==target.getAttribute("data-ce-tag"))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit_embed),o.addEventListener("click",function(){target._ceElement._onDoubleClick()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push(".ce-element--type-iframe"),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if(!target.classList.contains("ce-element--type-iframe"))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit_embed),o.addEventListener("click",function(){target._ceElement._onDoubleClick()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push('[data-ce-tag="html"]'),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("html"!==target.getAttribute("data-ce-tag"))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool-label"),o.innerHTML=pbsParams.labels.html,o.addEventListener("click",function(){}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit_html),o.addEventListener("click",function(){target._ceElement.openEditor()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.isFocused()&&(target._ceElement.blur(),target._ceElement.nextContent()?target._ceElement.nextContent().focus():target._ceElement.previousContent().focus()&&target._ceElement.previousContent().focus()),target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push(".ce-element--type-icon"),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if(!target.classList)return tools;
if(!target.classList.contains("ce-element--type-icon"))return tools;var o;return o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-left"),o.setAttribute("data-tooltip",pbsParams.labels.align_left),target.classList.contains("alignleft")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.addCSSClass("alignleft"),target._ceElement.taint()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-center"),o.setAttribute("data-tooltip",pbsParams.labels.align_center),target.classList.contains("aligncenter")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.addCSSClass("aligncenter"),target._ceElement.taint()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-right"),o.setAttribute("data-tooltip",pbsParams.labels.align_right),target.classList.contains("alignright")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.addCSSClass("alignright"),target._ceElement.taint()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit),o.addEventListener("click",function(){target._ceElement._onDoubleClick()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-clone"),o.setAttribute("data-tooltip",pbsParams.labels.clone),o.addEventListener("click",function(){target._ceElement.clone()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push('img.alignright,img.alignleft,img.alignnone,img.aligncenter,img[class*="wp-image-"]'),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("IMG"!==target.tagName&&"DL"!==target.tagName)return tools;if(!(target.classList.contains("alignleft")||target.classList.contains("alignright")||target.classList.contains("aligncenter")||target.classList.contains("alignnone"))){if(!target.getAttribute("class"))return tools;if(-1===target.getAttribute("class").indexOf("wp-image-"))return tools}var o;return o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-left"),o.setAttribute("data-tooltip",pbsParams.labels.align_left),target.classList.contains("alignleft")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return target._ceElement&&"Image"===target._ceElement.constructor.name?(target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.removeCSSClass("alignnone"),void target._ceElement.addCSSClass("alignleft")):(target.classList.remove("alignleft","alignright","alignnone","aligncenter"),target.classList.add("alignleft"),void _pbsImageTriggerParentChange(target))}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-center"),o.setAttribute("data-tooltip",pbsParams.labels.align_center),target.classList.contains("aligncenter")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return target._ceElement&&"Image"===target._ceElement.constructor.name?(target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.removeCSSClass("alignnone"),void target._ceElement.addCSSClass("aligncenter")):(target.classList.remove("alignleft","alignright","alignnone","aligncenter"),target.classList.add("aligncenter"),void _pbsImageTriggerParentChange(target))}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-right"),o.setAttribute("data-tooltip",pbsParams.labels.align_right),target.classList.contains("alignright")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return target._ceElement&&"Image"===target._ceElement.constructor.name?(target._ceElement.removeCSSClass("alignleft"),target._ceElement.removeCSSClass("alignright"),target._ceElement.removeCSSClass("aligncenter"),target._ceElement.removeCSSClass("alignnone"),void target._ceElement.addCSSClass("alignright")):(target.classList.remove("alignleft","alignright","alignnone","aligncenter"),target.classList.add("alignright"),void _pbsImageTriggerParentChange(target))}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit),o.addEventListener("click",function(){if(target._ceElement){if(target._ceElement.openMediaManager)return void target._ceElement.openMediaManager();target._ceElement._onDoubleClick()}}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){var parentNode=target.parentNode;return target._ceElement&&"Image"===target._ceElement.constructor.name?void target._ceElement.parent().detach(target._ceElement):("A"===parentNode.tagName?(parentNode=parentNode.parentNode,parentNode.removeChild(target.parentNode)):parentNode.removeChild(target),void _pbsImageTriggerParentChange(parentNode))}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push('[data-base="caption"]'),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("caption"!==target.getAttribute("data-base"))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-left"),o.setAttribute("data-tooltip",pbsParams.labels.align_left),"alignleft"===target._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.setSCAttr("align","alignleft")}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-center"),o.setAttribute("data-tooltip",pbsParams.labels.align_center),"aligncenter"===target._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.setSCAttr("align","aligncenter")}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-right"),o.setAttribute("data-tooltip",pbsParams.labels.align_right),"alignright"===target._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.setSCAttr("align","alignright")}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-none"),o.setAttribute("data-tooltip",pbsParams.labels.align_none),"alignnone"===target._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){target._ceElement.setSCAttr("align","alignnone")}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit),o.addEventListener("click",function(){target._ceElement._onDoubleClick()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools},999);var _pbsImageTriggerParentChange=function(domElement){for(var currElement=domElement;currElement;){if(currElement._ceElement){var ctElem=currElement._ceElement;if(ctElem.content){ctElem.content=new HTMLString.String(currElement.innerHTML,ctElem.content.preserveWhitespace()),ctElem.updateInnerHTML(),ctElem.taint();break}}currElement=currElement.parentNode}};wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push("a[href]:not(.pbs-button)"),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("A"!==target.tagName)return tools;if(target.classList.contains("pbs-button"))return tools;if(!target.getAttribute("href"))return tools;if(target.innerHTML.match(/<img/g))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool-label"),o.classList.add("pbs-tool-label-link"),o.innerHTML=target.getAttribute("href"),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-link-visit"),o.setAttribute("data-tooltip",pbsParams.labels.visit_link),o.addEventListener("click",function(){window.open(target.getAttribute("href"),"_linktool")}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit_link),o.addEventListener("click",function(){for(var domElement=target;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(target.innerHTML),selection=new ContentSelect.Range(index,index);selection.select(domElement),window.PBSEditor.getToolUI("link").apply(domElement._ceElement,selection,function(){})}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-link-unlink"),o.setAttribute("data-tooltip",pbsParams.labels.unlink),o.addEventListener("click",function(){for(var domElement=target;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(target.innerHTML),selected=ContentTools.Tools.Link.getSelectedLink(domElement._ceElement,index,index),from=selected.from,to=selected.to;domElement._ceElement.content=domElement._ceElement.content.unformat(from,to,"a"),domElement._ceElement.updateInnerHTML(),domElement._ceElement.taint()}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push("[data-shortcode]"),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if(!target.getAttribute("data-shortcode"))return tools;if("caption"===target.getAttribute("data-base"))return tools;if(!wp.hooks.applyFilters("pbs.toolbar.tools.allow",!0,target))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool-label"),o.innerHTML=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",target.getAttribute("data-base")),PBSShortcodes[target.getAttribute("data-base")]&&PBSShortcodes[target.getAttribute("data-base")].label&&(o.innerHTML=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",PBSShortcodes[target.getAttribute("data-base")].label)),o.addEventListener("click",function(){}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip",pbsParams.labels.edit_shortcode),o.addEventListener("click",function(){target._ceElement.convertToText()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-clone"),o.setAttribute("data-tooltip",pbsParams.labels.clone),o.addEventListener("click",function(){target._ceElement.clone()}),tools.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement?(target._ceElement.isFocused()&&target._ceElement.blur(),target._ceElement.parent().detach(target._ceElement)):target.parentNode._ceElement?(target.parentNode._ceElement.isFocused()&&target.parentNode._ceElement.blur(),target.parentNode._ceElement.parent().detach(target.parentNode._ceElement)):target.parentNode.removeChild(target)}),tools.push(o),tools}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(selector){return selector.push('[data-ce-tag="map"]'),selector}),wp.hooks.addFilter("pbs.toolbar_tools",function(tools,toolbar,target){if("map"!==target.getAttribute("data-ce-tag"))return tools;var o=document.createElement("DIV");return o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip",pbsParams.labels.remove),o.addEventListener("click",function(){target._ceElement.parent().detach(target._ceElement)}),tools.push(o),tools}),ContentTools.Tools.GetPremium=function(_super){function GetPremium(){return GetPremium.__super__.constructor.apply(this,arguments)}return __extends(GetPremium,_super),ContentTools.ToolShelf.stow(GetPremium,"get-premium"),GetPremium.type="get-premium",GetPremium}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return"get-premium"===this.tool.type&&(this._domElement.classList.remove("ct-tool"),this._domElement.classList.add("pbs-get-more-features"),this._domElement.classList.add("pbs-get-more-features-dark"),this._domElement.innerHTML='<a href="https://pagebuildersandwich.com/?utm_source=lite-plugin&utm_medium=inspector-top&utm_campaign=Page%20Builder%20Sandwich" target="_blank">'+pbsParams.labels.get_the_premium_plugin+"</a>"),ret}}(),document.addEventListener("DOMContentLoaded",function(){document.querySelector("#wp-admin-bar-pbs_go_premium").addEventListener("click",function(){var win=window.open("https://pagebuildersandwich.com/?utm_source=lite-plugin&utm_medium=adminbar&utm_campaign=Page%20Builder%20Sandwich","_blank");win.focus()})}),function(context,factory){"use strict";if("function"==typeof define&&define.amd)define([],factory);else if("object"==typeof exports)module.exports=factory();else{var namespace="hopscotch";if(context[namespace])return;context[namespace]=factory()}}(this,function(){var Hopscotch,HopscotchBubble,HopscotchCalloutManager,HopscotchI18N,customI18N,customRenderer,customEscape,utils,callbacks,helpers,winLoadHandler,defaultOpts,winHopscotch,templateToUse="bubble_default",Sizzle=window.Sizzle||null,undefinedStr="undefined",waitingToStart=!1,hasJquery=typeof jQuery!==undefinedStr,hasSessionStorage=!1,isStorageWritable=!1,document=window.document,validIdRegEx=/^[a-zA-Z]+[a-zA-Z0-9_-]*$/,rtlMatches={left:"right",right:"left"};try{typeof window.sessionStorage!==undefinedStr&&(hasSessionStorage=!0,sessionStorage.setItem("hopscotch.test.storage","ok"),sessionStorage.removeItem("hopscotch.test.storage"),isStorageWritable=!0)}catch(err){}return defaultOpts={smoothScroll:!0,scrollDuration:1e3,scrollTopMargin:200,showCloseButton:!0,showPrevButton:!1,showNextButton:!0,bubbleWidth:280,bubblePadding:15,arrowWidth:20,skipIfNoElement:!0,isRtl:!1,cookieName:"hopscotch.tour.state"},Array.isArray||(Array.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)}),winLoadHandler=function(){waitingToStart&&winHopscotch.startTour()},utils={addClass:function(domEl,classToAdd){var domClasses,classToAddArr,i,len;if(domEl.className){for(classToAddArr=classToAdd.split(/\s+/),domClasses=" "+domEl.className+" ",i=0,len=classToAddArr.length;len>i;++i)domClasses.indexOf(" "+classToAddArr[i]+" ")<0&&(domClasses+=classToAddArr[i]+" ");domEl.className=domClasses.replace(/^\s+|\s+$/g,"")}else domEl.className=classToAdd},removeClass:function(domEl,classToRemove){var domClasses,classToRemoveArr,i,len;for(classToRemoveArr=classToRemove.split(/\s+/),domClasses=" "+domEl.className+" ",i=0,len=classToRemoveArr.length;len>i;++i)domClasses=domClasses.replace(" "+classToRemoveArr[i]+" "," ");domEl.className=domClasses.replace(/^\s+|\s+$/g,"")},hasClass:function(domEl,classToCheck){var classes;return domEl.className?(classes=" "+domEl.className+" ",-1!==classes.indexOf(" "+classToCheck+" ")):!1},getPixelValue:function(val){var valType=typeof val;return"number"===valType?val:"string"===valType?parseInt(val,10):0},valOrDefault:function(val,valDefault){return typeof val!==undefinedStr?val:valDefault},invokeCallbackArrayHelper:function(arr){var fn;return Array.isArray(arr)&&(fn=helpers[arr[0]],"function"==typeof fn)?fn.apply(this,arr.slice(1)):void 0},invokeCallbackArray:function(arr){var i,len;if(Array.isArray(arr)){if("string"==typeof arr[0])return utils.invokeCallbackArrayHelper(arr);for(i=0,len=arr.length;len>i;++i)utils.invokeCallback(arr[i])}},invokeCallback:function(cb){return"function"==typeof cb?cb():"string"==typeof cb&&helpers[cb]?helpers[cb]():utils.invokeCallbackArray(cb)},invokeEventCallbacks:function(evtType,stepCb){var i,len,cbArr=callbacks[evtType];if(stepCb)return this.invokeCallback(stepCb);for(i=0,len=cbArr.length;len>i;++i)this.invokeCallback(cbArr[i].cb)},getScrollTop:function(){var scrollTop;return scrollTop=typeof window.pageYOffset!==undefinedStr?window.pageYOffset:document.documentElement.scrollTop},getScrollLeft:function(){var scrollLeft;return scrollLeft=typeof window.pageXOffset!==undefinedStr?window.pageXOffset:document.documentElement.scrollLeft},getWindowHeight:function(){return window.innerHeight||document.documentElement.clientHeight},addEvtListener:function(el,evtName,fn){return el?el.addEventListener?el.addEventListener(evtName,fn,!1):el.attachEvent("on"+evtName,fn):void 0},removeEvtListener:function(el,evtName,fn){return el?el.removeEventListener?el.removeEventListener(evtName,fn,!1):el.detachEvent("on"+evtName,fn):void 0},documentIsReady:function(){return"complete"===document.readyState},evtPreventDefault:function(evt){evt.preventDefault?evt.preventDefault():event&&(event.returnValue=!1)},extend:function(obj1,obj2){var prop;for(prop in obj2)obj2.hasOwnProperty(prop)&&(obj1[prop]=obj2[prop])},getStepTargetHelper:function(target){var result=document.getElementById(target);if(result)return result;if(hasJquery)return result=jQuery(target),result.length?result[0]:null;if(Sizzle)return result=new Sizzle(target),result.length?result[0]:null;if(document.querySelector)try{return document.querySelector(target)}catch(err){}return/^#[a-zA-Z][\w-_:.]*$/.test(target)?document.getElementById(target.substring(1)):null},getStepTarget:function(step){var queriedTarget;if(!step||!step.target)return null;if("string"==typeof step.target)return utils.getStepTargetHelper(step.target);if(Array.isArray(step.target)){var i,len;for(i=0,len=step.target.length;len>i;i++)if("string"==typeof step.target[i]&&(queriedTarget=utils.getStepTargetHelper(step.target[i])))return queriedTarget;return null}return step.target},getI18NString:function(key){return customI18N[key]||HopscotchI18N[key]},setState:function(name,value,days){var date,expires="";if(hasSessionStorage&&isStorageWritable)try{sessionStorage.setItem(name,value)}catch(err){isStorageWritable=!1,this.setState(name,value,days)}else hasSessionStorage&&sessionStorage.removeItem(name),days&&(date=new Date,date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()),document.cookie=name+"="+value+expires+"; path=/"},getState:function(name){var i,c,state,nameEQ=name+"=",ca=document.cookie.split(";");if(hasSessionStorage&&(state=sessionStorage.getItem(name)))return state;for(i=0;i<ca.length;i++){for(c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ)){state=c.substring(nameEQ.length,c.length);break}}return state},clearState:function(name){hasSessionStorage?sessionStorage.removeItem(name):this.setState(name,"",-1)},normalizePlacement:function(step){!step.placement&&step.orientation&&(step.placement=step.orientation)},flipPlacement:function(step){if(step.isRtl&&!step._isFlipped){var prop,i,props=["orientation","placement"];step.xOffset&&(step.xOffset=-1*this.getPixelValue(step.xOffset));for(i in props)prop=props[i],step.hasOwnProperty(prop)&&rtlMatches.hasOwnProperty(step[prop])&&(step[prop]=rtlMatches[step[prop]]);step._isFlipped=!0}}},utils.addEvtListener(window,"load",winLoadHandler),callbacks={next:[],prev:[],start:[],end:[],show:[],error:[],close:[]},helpers={},HopscotchI18N={stepNums:null,nextBtn:"Next",prevBtn:"Back",doneBtn:"Done",skipBtn:"Skip",closeTooltip:"Close"},customI18N={},HopscotchBubble=function(opt){this.init(opt)},HopscotchBubble.prototype={isShowing:!1,currStep:void 0,setPosition:function(step){var bubbleBoundingHeight,bubbleBoundingWidth,boundingRect,top,left,arrowOffset,verticalLeftPosition,targetEl=utils.getStepTarget(step),el=this.element,arrowEl=this.arrowEl,arrowPos=step.isRtl?"right":"left";if(utils.flipPlacement(step),utils.normalizePlacement(step),bubbleBoundingWidth=el.offsetWidth,bubbleBoundingHeight=el.offsetHeight,utils.removeClass(el,"fade-in-down fade-in-up fade-in-left fade-in-right"),boundingRect=targetEl.getBoundingClientRect(),verticalLeftPosition=step.isRtl?boundingRect.right-bubbleBoundingWidth:boundingRect.left,"top"===step.placement)top=boundingRect.top-bubbleBoundingHeight-this.opt.arrowWidth,left=verticalLeftPosition;else if("bottom"===step.placement)top=boundingRect.bottom+this.opt.arrowWidth,left=verticalLeftPosition;else if("left"===step.placement)top=boundingRect.top,left=boundingRect.left-bubbleBoundingWidth-this.opt.arrowWidth;else{if("right"!==step.placement)throw new Error("Bubble placement failed because step.placement is invalid or undefined!");top=boundingRect.top,left=boundingRect.right+this.opt.arrowWidth}arrowOffset="center"!==step.arrowOffset?utils.getPixelValue(step.arrowOffset):step.arrowOffset,arrowOffset?"top"===step.placement||"bottom"===step.placement?(arrowEl.style.top="","center"===arrowOffset?arrowEl.style[arrowPos]=Math.floor(bubbleBoundingWidth/2-arrowEl.offsetWidth/2)+"px":arrowEl.style[arrowPos]=arrowOffset+"px"):("left"===step.placement||"right"===step.placement)&&(arrowEl.style[arrowPos]="","center"===arrowOffset?arrowEl.style.top=Math.floor(bubbleBoundingHeight/2-arrowEl.offsetHeight/2)+"px":arrowEl.style.top=arrowOffset+"px"):(arrowEl.style.top="",arrowEl.style[arrowPos]=""),"center"===step.xOffset?left=boundingRect.left+targetEl.offsetWidth/2-bubbleBoundingWidth/2:left+=utils.getPixelValue(step.xOffset),"center"===step.yOffset?top=boundingRect.top+targetEl.offsetHeight/2-bubbleBoundingHeight/2:top+=utils.getPixelValue(step.yOffset),step.fixedElement||(top+=utils.getScrollTop(),left+=utils.getScrollLeft()),el.style.position=step.fixedElement?"fixed":"absolute",el.style.top=top+"px",el.style.left=left+"px"},render:function(step,idx,callback){var tourSpecificRenderer,customTourData,unsafe,currTour,totalSteps,totalStepsI18n,nextBtnText,isLast,opts,el=this.element;if(step?this.currStep=step:this.currStep&&(step=this.currStep),this.opt.isTourBubble?(currTour=winHopscotch.getCurrTour(),currTour&&(customTourData=currTour.customData,tourSpecificRenderer=currTour.customRenderer,step.isRtl=step.hasOwnProperty("isRtl")?step.isRtl:currTour.hasOwnProperty("isRtl")?currTour.isRtl:this.opt.isRtl,unsafe=currTour.unsafe,Array.isArray(currTour.steps)&&(totalSteps=currTour.steps.length,totalStepsI18n=this._getStepI18nNum(this._getStepNum(totalSteps-1)),isLast=this._getStepNum(idx)===this._getStepNum(totalSteps-1)))):(customTourData=step.customData,tourSpecificRenderer=step.customRenderer,unsafe=step.unsafe,step.isRtl=step.hasOwnProperty("isRtl")?step.isRtl:this.opt.isRtl),nextBtnText=isLast?utils.getI18NString("doneBtn"):step.showSkip?utils.getI18NString("skipBtn"):utils.getI18NString("nextBtn"),utils.flipPlacement(step),utils.normalizePlacement(step),this.placement=step.placement,opts={i18n:{prevBtn:utils.getI18NString("prevBtn"),nextBtn:nextBtnText,closeTooltip:utils.getI18NString("closeTooltip"),stepNum:this._getStepI18nNum(this._getStepNum(idx)),numSteps:totalStepsI18n},buttons:{showPrev:utils.valOrDefault(step.showPrevButton,this.opt.showPrevButton)&&this._getStepNum(idx)>0,showNext:utils.valOrDefault(step.showNextButton,this.opt.showNextButton),showCTA:utils.valOrDefault(step.showCTAButton&&step.ctaLabel,!1),ctaLabel:step.ctaLabel,showClose:utils.valOrDefault(this.opt.showCloseButton,!0)},step:{num:idx,isLast:utils.valOrDefault(isLast,!1),title:step.title||"",content:step.content||"",isRtl:step.isRtl,placement:step.placement,padding:utils.valOrDefault(step.padding,this.opt.bubblePadding),width:utils.getPixelValue(step.width)||this.opt.bubbleWidth,customData:step.customData||{}},tour:{isTour:this.opt.isTourBubble,numSteps:totalSteps,unsafe:utils.valOrDefault(unsafe,!1),customData:customTourData||{}}},"function"==typeof tourSpecificRenderer)el.innerHTML=tourSpecificRenderer(opts);else if("string"==typeof tourSpecificRenderer){if(!winHopscotch.templates||"function"!=typeof winHopscotch.templates[tourSpecificRenderer])throw new Error('Bubble rendering failed - template "'+tourSpecificRenderer+'" is not a function.');el.innerHTML=winHopscotch.templates[tourSpecificRenderer](opts)}else if(customRenderer)el.innerHTML=customRenderer(opts);else{if(!winHopscotch.templates||"function"!=typeof winHopscotch.templates[templateToUse])throw new Error('Bubble rendering failed - template "'+templateToUse+'" is not a function.');el.innerHTML=winHopscotch.templates[templateToUse](opts)}for(children=el.children,numChildren=children.length,i=0;i<numChildren;i++)node=children[i],utils.hasClass(node,"hopscotch-arrow")&&(this.arrowEl=node);return el.style.zIndex="number"==typeof step.zindex?step.zindex:"",this._setArrow(step.placement),this.hide(!1),this.setPosition(step),callback&&callback(!step.fixedElement),this},_getStepNum:function(idx){var stepIdx,i,skippedStepsCount=0,skippedSteps=winHopscotch.getSkippedStepsIndexes(),len=skippedSteps.length;for(i=0;len>i;i++)stepIdx=skippedSteps[i],idx>stepIdx&&skippedStepsCount++;return idx-skippedStepsCount},_getStepI18nNum:function(idx){var stepNumI18N=utils.getI18NString("stepNums");return stepNumI18N&&idx<stepNumI18N.length?idx=stepNumI18N[idx]:idx+=1,idx},_setArrow:function(placement){utils.removeClass(this.arrowEl,"down up right left"),"top"===placement?utils.addClass(this.arrowEl,"down"):"bottom"===placement?utils.addClass(this.arrowEl,"up"):"left"===placement?utils.addClass(this.arrowEl,"right"):"right"===placement&&utils.addClass(this.arrowEl,"left")},_getArrowDirection:function(){return"top"===this.placement?"down":"bottom"===this.placement?"up":"left"===this.placement?"right":"right"===this.placement?"left":void 0},show:function(){var self=this,fadeClass="fade-in-"+this._getArrowDirection(),fadeDur=1e3;return utils.removeClass(this.element,"hide"),utils.addClass(this.element,fadeClass),setTimeout(function(){utils.removeClass(self.element,"invisible")},50),setTimeout(function(){utils.removeClass(self.element,fadeClass)},fadeDur),this.isShowing=!0,this},hide:function(remove){var el=this.element;return remove=utils.valOrDefault(remove,!0),el.style.top="",el.style.left="",remove?(utils.addClass(el,"hide"),utils.removeClass(el,"invisible")):(utils.removeClass(el,"hide"),utils.addClass(el,"invisible")),utils.removeClass(el,"animate fade-in-up fade-in-down fade-in-right fade-in-left"),this.isShowing=!1,this},destroy:function(){var el=this.element;el&&el.parentNode.removeChild(el),utils.removeEvtListener(el,"click",this.clickCb)},_handleBubbleClick:function(evt){function findMatchRecur(el){return el===evt.currentTarget?null:utils.hasClass(el,"hopscotch-cta")?"cta":utils.hasClass(el,"hopscotch-next")?"next":utils.hasClass(el,"hopscotch-prev")?"prev":utils.hasClass(el,"hopscotch-close")?"close":findMatchRecur(el.parentElement)}var action;evt=evt||window.event;var targetElement=evt.target||evt.srcElement;if(action=findMatchRecur(targetElement),"cta"===action)this.opt.isTourBubble||winHopscotch.getCalloutManager().removeCallout(this.currStep.id),this.currStep.onCTA&&utils.invokeCallback(this.currStep.onCTA);else if("next"===action)winHopscotch.nextStep(!0);else if("prev"===action)winHopscotch.prevStep(!0);else if("close"===action){if(this.opt.isTourBubble){var currStepNum=winHopscotch.getCurrStepNum(),currTour=winHopscotch.getCurrTour(),doEndCallback=currStepNum===currTour.steps.length-1;utils.invokeEventCallbacks("close"),winHopscotch.endTour(!0,doEndCallback)}else this.opt.onClose&&utils.invokeCallback(this.opt.onClose),this.opt.id&&!this.opt.isTourBubble?winHopscotch.getCalloutManager().removeCallout(this.opt.id):this.destroy();utils.evtPreventDefault(evt)}},init:function(initOpt){var onWinResize,appendToBody,currTour,opt,el=document.createElement("div"),self=this,resizeCooldown=!1;this.element=el,opt={showPrevButton:defaultOpts.showPrevButton,showNextButton:defaultOpts.showNextButton,bubbleWidth:defaultOpts.bubbleWidth,bubblePadding:defaultOpts.bubblePadding,arrowWidth:defaultOpts.arrowWidth,isRtl:defaultOpts.isRtl,showNumber:!0,isTourBubble:!0},initOpt=typeof initOpt===undefinedStr?{}:initOpt,utils.extend(opt,initOpt),this.opt=opt,el.className="hopscotch-bubble animated",opt.isTourBubble?(currTour=winHopscotch.getCurrTour(),currTour&&utils.addClass(el,"tour-"+currTour.id)):utils.addClass(el,"hopscotch-callout no-number"),onWinResize=function(){!resizeCooldown&&self.isShowing&&(resizeCooldown=!0,setTimeout(function(){self.setPosition(self.currStep),resizeCooldown=!1},100))},utils.addEvtListener(window,"resize",onWinResize),this.clickCb=function(evt){self._handleBubbleClick(evt)},utils.addEvtListener(el,"click",this.clickCb),this.hide(),utils.documentIsReady()?document.body.appendChild(el):(document.addEventListener?(appendToBody=function(){document.removeEventListener("DOMContentLoaded",appendToBody),window.removeEventListener("load",appendToBody),document.body.appendChild(el)},document.addEventListener("DOMContentLoaded",appendToBody,!1)):(appendToBody=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",appendToBody),window.detachEvent("onload",appendToBody),document.body.appendChild(el))},document.attachEvent("onreadystatechange",appendToBody)),utils.addEvtListener(window,"load",appendToBody))}},HopscotchCalloutManager=function(){var callouts={},calloutOpts={};this.createCallout=function(opt){var callout;if(!opt.id)throw new Error("Must specify a callout id.");if(!validIdRegEx.test(opt.id))throw new Error("Callout ID is using an invalid format. Use alphanumeric, underscores, and/or hyphens only. First character must be a letter.");if(callouts[opt.id])throw new Error("Callout by that id already exists. Please choose a unique id.");if(!utils.getStepTarget(opt))throw new Error("Must specify existing target element via 'target' option.");return opt.showNextButton=opt.showPrevButton=!1,opt.isTourBubble=!1,callout=new HopscotchBubble(opt),callouts[opt.id]=callout,calloutOpts[opt.id]=opt,callout.render(opt,null,function(){callout.show(),opt.onShow&&utils.invokeCallback(opt.onShow)}),callout},this.getCallout=function(id){return callouts[id]},this.removeAllCallouts=function(){var calloutId;for(calloutId in callouts)callouts.hasOwnProperty(calloutId)&&this.removeCallout(calloutId)},this.removeCallout=function(id){var callout=callouts[id];callouts[id]=null,calloutOpts[id]=null,callout&&callout.destroy()},this.refreshCalloutPositions=function(){var calloutId,callout,opts;for(calloutId in callouts)callouts.hasOwnProperty(calloutId)&&calloutOpts.hasOwnProperty(calloutId)&&(callout=callouts[calloutId],opts=calloutOpts[calloutId],callout&&opts&&callout.setPosition(opts))}},Hopscotch=function(initOptions){var bubble,calloutMgr,opt,currTour,currStepNum,cookieTourId,cookieTourStep,_configure,self=this,skippedSteps={},cookieSkippedSteps=[],getBubble=function(setOptions){
return bubble&&bubble.element&&bubble.element.parentNode||(bubble=new HopscotchBubble(opt)),setOptions&&utils.extend(bubble.opt,{bubblePadding:getOption("bubblePadding"),bubbleWidth:getOption("bubbleWidth"),showNextButton:getOption("showNextButton"),showPrevButton:getOption("showPrevButton"),showCloseButton:getOption("showCloseButton"),arrowWidth:getOption("arrowWidth"),isRtl:getOption("isRtl")}),bubble},destroyBubble=function(){bubble&&(bubble.destroy(),bubble=null)},getOption=function(name){return"undefined"==typeof opt?defaultOpts[name]:utils.valOrDefault(opt[name],defaultOpts[name])},getCurrStep=function(){var step;return step=!currTour||0>currStepNum||currStepNum>=currTour.steps.length?null:currTour.steps[currStepNum]},targetClickNextFn=function(){self.nextStep()},adjustWindowScroll=function(cb){var scrollEl,yuiAnim,yuiEase,direction,scrollIncr,scrollTimeoutFn,bubble=getBubble(),bubbleEl=bubble.element,bubbleTop=utils.getPixelValue(bubbleEl.style.top),bubbleBottom=bubbleTop+utils.getPixelValue(bubbleEl.offsetHeight),targetEl=utils.getStepTarget(getCurrStep()),targetBounds=targetEl.getBoundingClientRect(),targetElTop=targetBounds.top+utils.getScrollTop(),targetElBottom=targetBounds.bottom+utils.getScrollTop(),targetTop=targetElTop>bubbleTop?bubbleTop:targetElTop,targetBottom=bubbleBottom>targetElBottom?bubbleBottom:targetElBottom,windowTop=utils.getScrollTop(),windowBottom=windowTop+utils.getWindowHeight(),scrollToVal=targetTop-getOption("scrollTopMargin");targetTop>=windowTop&&(targetTop<=windowTop+getOption("scrollTopMargin")||windowBottom>=targetBottom)?cb&&cb():getOption("smoothScroll")?typeof YAHOO!==undefinedStr&&typeof YAHOO.env!==undefinedStr&&typeof YAHOO.env.ua!==undefinedStr&&typeof YAHOO.util!==undefinedStr&&typeof YAHOO.util.Scroll!==undefinedStr?(scrollEl=YAHOO.env.ua.webkit?document.body:document.documentElement,yuiEase=YAHOO.util.Easing?YAHOO.util.Easing.easeOut:void 0,yuiAnim=new YAHOO.util.Scroll(scrollEl,{scroll:{to:[0,scrollToVal]}},getOption("scrollDuration")/1e3,yuiEase),yuiAnim.onComplete.subscribe(cb),yuiAnim.animate()):hasJquery?jQuery("body, html").animate({scrollTop:scrollToVal},getOption("scrollDuration"),cb):(0>scrollToVal&&(scrollToVal=0),direction=windowTop>targetTop?-1:1,scrollIncr=Math.abs(windowTop-scrollToVal)/(getOption("scrollDuration")/10),(scrollTimeoutFn=function(){var scrollTop=utils.getScrollTop(),scrollTarget=scrollTop+direction*scrollIncr;return direction>0&&scrollTarget>=scrollToVal||0>direction&&scrollToVal>=scrollTarget?(scrollTarget=scrollToVal,cb&&cb(),void window.scrollTo(0,scrollTarget)):(window.scrollTo(0,scrollTarget),utils.getScrollTop()===scrollTop?void(cb&&cb()):void setTimeout(scrollTimeoutFn,10))})()):(window.scrollTo(0,scrollToVal),cb&&cb())},goToStepWithTarget=function(direction,cb){var target,step,goToStepFn;currStepNum+direction>=0&&currStepNum+direction<currTour.steps.length?(currStepNum+=direction,step=getCurrStep(),goToStepFn=function(){target=utils.getStepTarget(step),target?(skippedSteps[currStepNum]&&delete skippedSteps[currStepNum],cb(currStepNum)):(skippedSteps[currStepNum]=!0,utils.invokeEventCallbacks("error"),goToStepWithTarget(direction,cb))},step.delay?setTimeout(goToStepFn,step.delay):goToStepFn()):cb(-1)},changeStep=function(doCallbacks,direction){var step,origStep,wasMultiPage,changeStepCb,bubble=getBubble(),self=this;if(bubble.hide(),doCallbacks=utils.valOrDefault(doCallbacks,!0),step=getCurrStep(),step.nextOnTargetClick&&utils.removeEvtListener(utils.getStepTarget(step),"click",targetClickNextFn),origStep=step,wasMultiPage=direction>0?origStep.multipage:currStepNum>0&&currTour.steps[currStepNum-1].multipage,changeStepCb=function(stepNum){var doShowFollowingStep;if(-1===stepNum)return this.endTour(!0);if(doCallbacks&&(doShowFollowingStep=direction>0?utils.invokeEventCallbacks("next",origStep.onNext):utils.invokeEventCallbacks("prev",origStep.onPrev)),stepNum===currStepNum){if(wasMultiPage)return void setStateHelper();doShowFollowingStep=utils.valOrDefault(doShowFollowingStep,!0),doShowFollowingStep?this.showStep(stepNum):this.endTour(!1)}},!wasMultiPage&&getOption("skipIfNoElement"))goToStepWithTarget(direction,function(stepNum){changeStepCb.call(self,stepNum)});else if(currStepNum+direction>=0&&currStepNum+direction<currTour.steps.length){if(currStepNum+=direction,step=getCurrStep(),!utils.getStepTarget(step)&&!wasMultiPage)return utils.invokeEventCallbacks("error"),this.endTour(!0,!1);changeStepCb.call(this,currStepNum)}else if(currStepNum+direction===currTour.steps.length)return this.endTour();return this},loadTour=function(tour){var prop,tourState,tourStateValues,tmpOpt={};for(prop in tour)tour.hasOwnProperty(prop)&&"id"!==prop&&"steps"!==prop&&(tmpOpt[prop]=tour[prop]);return _configure.call(this,tmpOpt,!0),tourState=utils.getState(getOption("cookieName")),tourState&&(tourStateValues=tourState.split(":"),cookieTourId=tourStateValues[0],cookieTourStep=tourStateValues[1],tourStateValues.length>2&&(cookieSkippedSteps=tourStateValues[2].split(",")),cookieTourStep=parseInt(cookieTourStep,10)),this},findStartingStep=function(startStepNum,savedSkippedSteps,cb){var step,target;if(currStepNum=startStepNum||0,skippedSteps=savedSkippedSteps||{},step=getCurrStep(),target=utils.getStepTarget(step))return void cb(currStepNum);if(!target){if(utils.invokeEventCallbacks("error"),skippedSteps[currStepNum]=!0,getOption("skipIfNoElement"))return void goToStepWithTarget(1,cb);currStepNum=-1,cb(currStepNum)}},showStepHelper=function(stepNum){function showBubble(){bubble.show(),utils.invokeEventCallbacks("show",step.onShow)}var step=currTour.steps[stepNum],bubble=getBubble(),targetEl=utils.getStepTarget(step);currStepNum!==stepNum&&getCurrStep().nextOnTargetClick&&utils.removeEvtListener(utils.getStepTarget(getCurrStep()),"click",targetClickNextFn),currStepNum=stepNum,bubble.hide(!1),bubble.render(step,stepNum,function(adjustScroll){adjustScroll?adjustWindowScroll(showBubble):showBubble(),step.nextOnTargetClick&&utils.addEvtListener(targetEl,"click",targetClickNextFn)}),setStateHelper()},setStateHelper=function(){var cookieVal=currTour.id+":"+currStepNum,skipedStepIndexes=winHopscotch.getSkippedStepsIndexes();skipedStepIndexes&&skipedStepIndexes.length>0&&(cookieVal+=":"+skipedStepIndexes.join(",")),utils.setState(getOption("cookieName"),cookieVal,1)},init=function(initOptions){initOptions&&this.configure(initOptions)};this.getCalloutManager=function(){return typeof calloutMgr===undefinedStr&&(calloutMgr=new HopscotchCalloutManager),calloutMgr},this.startTour=function(tour,stepNum){var bubble,currStepNum,skippedSteps={},self=this;if(!currTour){if(!tour)throw new Error("Tour data is required for startTour.");if(!tour.id||!validIdRegEx.test(tour.id))throw new Error("Tour ID is using an invalid format. Use alphanumeric, underscores, and/or hyphens only. First character must be a letter.");currTour=tour,loadTour.call(this,tour)}if(typeof stepNum!==undefinedStr){if(stepNum>=currTour.steps.length)throw new Error("Specified step number out of bounds.");currStepNum=stepNum}if(!utils.documentIsReady())return waitingToStart=!0,this;if("undefined"==typeof currStepNum&&currTour.id===cookieTourId&&typeof cookieTourStep!==undefinedStr){if(currStepNum=cookieTourStep,cookieSkippedSteps.length>0)for(var i=0,len=cookieSkippedSteps.length;len>i;i++)skippedSteps[cookieSkippedSteps[i]]=!0}else currStepNum||(currStepNum=0);return findStartingStep(currStepNum,skippedSteps,function(stepNum){var target=-1!==stepNum&&utils.getStepTarget(currTour.steps[stepNum]);return target?(utils.invokeEventCallbacks("start"),bubble=getBubble(),bubble.hide(!1),self.isActive=!0,void(utils.getStepTarget(getCurrStep())?self.showStep(stepNum):(utils.invokeEventCallbacks("error"),getOption("skipIfNoElement")&&self.nextStep(!1)))):void self.endTour(!1,!1)}),this},this.showStep=function(stepNum){var step=currTour.steps[stepNum];if(utils.getStepTarget(step))return step.delay?setTimeout(function(){showStepHelper(stepNum)},step.delay):showStepHelper(stepNum),this},this.prevStep=function(doCallbacks){return changeStep.call(this,doCallbacks,-1),this},this.nextStep=function(doCallbacks){return changeStep.call(this,doCallbacks,1),this},this.endTour=function(clearState,doCallbacks){var currentStep,bubble=getBubble();return clearState=utils.valOrDefault(clearState,!0),doCallbacks=utils.valOrDefault(doCallbacks,!0),currTour&&(currentStep=getCurrStep(),currentStep&&currentStep.nextOnTargetClick&&utils.removeEvtListener(utils.getStepTarget(currentStep),"click",targetClickNextFn)),currStepNum=0,cookieTourStep=void 0,bubble.hide(),clearState&&utils.clearState(getOption("cookieName")),this.isActive&&(this.isActive=!1,currTour&&doCallbacks&&utils.invokeEventCallbacks("end")),this.removeCallbacks(null,!0),this.resetDefaultOptions(),destroyBubble(),currTour=null,this},this.getCurrTour=function(){return currTour},this.getCurrTarget=function(){return utils.getStepTarget(getCurrStep())},this.getCurrStepNum=function(){return currStepNum},this.getSkippedStepsIndexes=function(){var stepIds,skippedStepsIdxArray=[];for(stepIds in skippedSteps)skippedStepsIdxArray.push(stepIds);return skippedStepsIdxArray},this.refreshBubblePosition=function(){var currStep=getCurrStep();return currStep&&getBubble().setPosition(currStep),this.getCalloutManager().refreshCalloutPositions(),this},this.listen=function(evtType,cb,isTourCb){return evtType&&callbacks[evtType].push({cb:cb,fromTour:isTourCb}),this},this.unlisten=function(evtType,cb){var i,len,evtCallbacks=callbacks[evtType];for(i=0,len=evtCallbacks.length;len>i;++i)evtCallbacks[i]===cb&&evtCallbacks.splice(i,1);return this},this.removeCallbacks=function(evtName,tourOnly){var cbArr,i,len,evt;for(evt in callbacks)if(!evtName||evtName===evt)if(tourOnly)for(cbArr=callbacks[evt],i=0,len=cbArr.length;len>i;++i)cbArr[i].fromTour&&(cbArr.splice(i--,1),--len);else callbacks[evt]=[];return this},this.registerHelper=function(id,fn){"string"==typeof id&&"function"==typeof fn&&(helpers[id]=fn)},this.unregisterHelper=function(id){helpers[id]=null},this.invokeHelper=function(id){var i,len,args=[];for(i=1,len=arguments.length;len>i;++i)args.push(arguments[i]);helpers[id]&&helpers[id].call(null,args)},this.setCookieName=function(name){return opt.cookieName=name,this},this.resetDefaultOptions=function(){return opt={},this},this.resetDefaultI18N=function(){return customI18N={},this},this.getState=function(){return utils.getState(getOption("cookieName"))},_configure=function(options,isTourOptions){var bubble,eventPropName,i,len,events=["next","prev","start","end","show","error","close"];for(opt||this.resetDefaultOptions(),utils.extend(opt,options),options&&utils.extend(customI18N,options.i18n),i=0,len=events.length;len>i;++i)eventPropName="on"+events[i].charAt(0).toUpperCase()+events[i].substring(1),options[eventPropName]&&this.listen(events[i],options[eventPropName],isTourOptions);return bubble=getBubble(!0),this},this.configure=function(options){return _configure.call(this,options,!1)},this.setRenderer=function(render){var typeOfRender=typeof render;return"string"===typeOfRender?(templateToUse=render,customRenderer=void 0):"function"===typeOfRender&&(customRenderer=render),this},this.setEscaper=function(esc){return"function"==typeof esc&&(customEscape=esc),this},init.call(this,initOptions)},winHopscotch=new Hopscotch,function(){var _={};_.escape=function(str){return customEscape?customEscape(str):null==str?"":(""+str).replace(new RegExp("[&<>\"']","g"),function(match){return"&"==match?"&amp;":"<"==match?"&lt;":">"==match?"&gt;":'"'==match?"&quot;":"'"==match?"&#x27;":void 0})},this.templates=this.templates||{},this.templates.bubble_default=function(obj){function optEscape(str,unsafe){return unsafe?_.escape(str):str}obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='\n<div class="hopscotch-bubble-container" style="width: '+(null==(__t=step.width)?"":__t)+"px; padding: "+(null==(__t=step.padding)?"":__t)+'px;">\n  ',tour.isTour&&(__p+='<span class="hopscotch-bubble-number">'+(null==(__t=i18n.stepNum)?"":__t)+"</span>"),__p+='\n  <div class="hopscotch-bubble-content">\n    ',""!==step.title&&(__p+='<h3 class="hopscotch-title">'+(null==(__t=optEscape(step.title,tour.unsafe))?"":__t)+"</h3>"),__p+="\n    ",""!==step.content&&(__p+='<div class="hopscotch-content">'+(null==(__t=optEscape(step.content,tour.unsafe))?"":__t)+"</div>"),__p+='\n  </div>\n  <div class="hopscotch-actions">\n    ',buttons.showPrev&&(__p+='<button class="hopscotch-nav-button prev hopscotch-prev">'+(null==(__t=i18n.prevBtn)?"":__t)+"</button>"),__p+="\n    ",buttons.showCTA&&(__p+='<button class="hopscotch-nav-button next hopscotch-cta">'+(null==(__t=buttons.ctaLabel)?"":__t)+"</button>"),__p+="\n    ",buttons.showNext&&(__p+='<button class="hopscotch-nav-button next hopscotch-next">'+(null==(__t=i18n.nextBtn)?"":__t)+"</button>"),__p+="\n  </div>\n  ",buttons.showClose&&(__p+='<button class="hopscotch-bubble-close hopscotch-close">'+(null==(__t=i18n.closeTooltip)?"":__t)+"</button>"),__p+='\n</div>\n<div class="hopscotch-bubble-arrow-container hopscotch-arrow">\n  <div class="hopscotch-bubble-arrow-border"></div>\n  <div class="hopscotch-bubble-arrow"></div>\n</div>';return __p}}.call(winHopscotch),winHopscotch}),window.pbsPlayTour=function(){var helloListener=function(){if(hopscotch.getCurrTour()&&"editor-tour"===hopscotch.getCurrTour().id&&0===hopscotch.getCurrStepNum()){var root=ContentEdit.Root.get();root.focused()&&root.focused().content&&root.focused().content.text().match(/sandwich/i)&&hopscotch.nextStep()}},nextStepHandler=function(){hopscotch.nextStep()},newRowHandler=function(row){row._addCSSClass("pbs_tour_new_row"),hopscotch.nextStep()};hopscotch.endTour();var mainRegion=ContentTools.EditorApp.get().regions()["main-content"],createEmptyParagraph=!0;if(mainRegion.children.length>0&&"Text"===mainRegion.children[0].constructor.name&&mainRegion.children[0].content.isWhitespace()&&(createEmptyParagraph=!1),createEmptyParagraph){var startingParagraph=new ContentEdit.Text("p");mainRegion.attach(startingParagraph,0),startingParagraph.focus()}var tour2={id:"editor-tour",i18n:{doneBtn:pbsParams.labels.next},steps:[]};tour2.steps.push({title:pbsParams.labels.tour_content_area_title,content:pbsParams.labels.tour_content_area_body,delay:500,target:".ce-element--type-text",placement:"bottom",onShow:function(){window.pbsOnlyOpenSection(),document.querySelector(".ce-element--type-text")._ceElement.focus(),document.addEventListener("keyup",helloListener)},onNext:function(){document.removeEventListener("keyup",helloListener)}}),tour2.steps.push({title:pbsParams.labels.tour_inspector_title,content:pbsParams.labels.tour_inspector_body,target:document.querySelector(".ct-toolbox"),placement:"right",fixedElement:!0,yOffset:30,onShow:function(){window.pbsOnlyOpenSection("pbs-text-formatting-group"),document.querySelector(".pbs-text-formatting-group").addEventListener("mouseover",nextStepHandler)},onNext:function(){document.querySelector(".pbs-text-formatting-group").removeEventListener("mouseover",nextStepHandler)},onEnd:function(){}}),pbsParams.is_lite?tour2.steps.push({title:"Let&apos;s Try It Out",content:"For starters, go ahead and click on this <strong>Bold</strong> button to make your text bold.<br><br><em>Try it out now.</em>",target:document.querySelector(".ct-tool--bold"),onShow:function(){document.querySelector(".ct-tool--bold").addEventListener("mousedown",nextStepHandler)},onNext:function(){document.querySelector(".ct-tool--bold").removeEventListener("mousedown",nextStepHandler)},placement:"right",fixedElement:!0,yOffset:-15}):tour2.steps.push({title:"Let&apos;s Try It Out",content:"For starters, go ahead and click on this <strong>Increase Font Size</strong> button to make your text larger.<br><br>You can also hold down the "+(-1!==navigator.appVersion.indexOf("Mac")?"Command":"CTRL")+" key while clicking to decrease instead.<br><br><em>Try it out now.</em>",target:document.querySelector(".ct-tool--font-up"),onShow:function(){document.querySelector(".ct-tool--font-up").addEventListener("mousedown",nextStepHandler),document.querySelector(".ct-tool--font-up").style.animation="pbs-tour-glow-red infinite 2s"},onNext:function(){document.querySelector(".ct-tool--font-up").removeEventListener("mousedown",nextStepHandler),document.querySelector(".ct-tool--font-up").style.animation=""},onEnd:function(){document.querySelector(".ct-tool--font-up").style.animation=""},placement:"right",fixedElement:!0,yOffset:-15}),pbsParams.is_lite?tour2.steps.push({title:"You&apos;ll Be Able to See Your Changes Live",content:"Clicking on the bold button again would remove the style.<br><br><em>Now try and click on the text color tool. It&apos;s the upper-left most button in the inspector.</em>",target:".ce-element--type-text",placement:"bottom",onShow:function(){document.querySelector(".ct-tool--color").addEventListener("click",nextStepHandler),document.querySelector(".ct-tool--color").style.animation="pbs-tour-glow-red infinite 2s"},onNext:function(){document.querySelector(".ct-tool--color").removeEventListener("click",nextStepHandler),document.querySelector(".ct-tool--color").style.animation=""},onEnd:function(){document.querySelector(".ct-tool--color").style.animation=""}}):tour2.steps.push({title:"Keep Clicking That Button",content:"You&apos;ll be able to see your changes live. Hold down your mouse button to continuously increase the font size.<br><br>You can also try decreasing the size by holding the "+(-1!==navigator.appVersion.indexOf("Mac")?"Command":"CTRL")+" key while clicking the button. Or hold SHIFT+"+(-1!==navigator.appVersion.indexOf("Mac")?"Command":"CTRL")+" keys to reset it to the original size.<br><br><em>Now try and click on the text color tool. It&apos;s the upper-left most button in the inspector.</em>",target:".ce-element--type-text",placement:"bottom",onShow:function(){document.querySelector(".ct-tool--color").addEventListener("click",nextStepHandler),document.querySelector(".ct-tool--color").style.animation="pbs-tour-glow-red infinite 2s"},onNext:function(){document.querySelector(".ct-tool--color").removeEventListener("click",nextStepHandler),document.querySelector(".ct-tool--color").style.animation=""},onEnd:function(){document.querySelector(".ct-tool--color").style.animation=""}}),tour2.steps.push({title:"Use This Color Picker to Change Colors",content:"Clicking on different tools do different things. Color tools bring up color pickers, and some buttons toggle between different values.<br><br><em>Now drag the circular handle to change the color of your heading to proceed. Pick any color you like</em>",target:document.querySelector(".ct-tool--color > *"),placement:"right",fixedElement:!0,yOffset:0,onShow:function(){wp.hooks.addAction("pbs.tool.color.applied",_.once(nextStepHandler))}}),tour2.steps.push({title:"How to Undo",content:"Hmmm, hold on. I&apos;m not sure I like that color. Let&apos;s go back to the previous one. You can use the undo shortcut "+(-1!==navigator.appVersion.indexOf("Mac")?"Command+Z":"CTRL+Z")+" to revert your changes.<br><br><em>Try undoing the color changes to proceed.</em>",target:".ce-element--type-text",placement:"bottom",delay:500,onShow:function(){wp.hooks.addAction("pbs.undo",_.once(nextStepHandler))},onNext:function(){window.pbsOnlyOpenSection("pbs-interactive-elements-group")}}),tour2.steps.push({title:"Rows & Columns",content:"You can also organize your content into different sections by adding rows & columns. You can place your content inside them and style the rows and columns to get a unique look.<br><br><em>Try adding a row with a single column now by clicking on the <strong>Add Row</strong> button.</em>",target:document.querySelector(".ct-tool--onecolumn"),placement:"right",delay:700,fixedElement:!0,yOffset:30,onShow:function(){wp.hooks.addAction("pbs.tool.row.applied",_.once(newRowHandler)),document.querySelector(".ct-tool--onecolumn").style.animation="pbs-tour-glow-red infinite 2s"},onNext:function(){document.querySelector(".ct-tool--onecolumn").style.animation=""},onEnd:function(){document.querySelector(".ct-tool--onecolumn").style.animation=""}}),tour2.steps.push({title:"Rows Are Outlined",content:"This is the row you just created. You can start typing right away to add content to it. But first let&apos;s try dragging the text above inside this row.<br><br><em>Click and hold your mouse on the &quot;Sandwich&quot; text we typed in earlier to start dragging it. (Tip: hold your mouse button for a long period)</em>",target:".pbs_tour_new_row",placement:"bottom",onShow:function(){document.querySelector(".ce-element--type-text").addEventListener("mousedown",nextStepHandler)},onNext:function(){document.querySelector(".pbs_tour_new_row").classList.remove("pbs_tour_new_row"),document.querySelector(".ce-element--type-text").removeEventListener("mousedown",nextStepHandler)}}),tour2.steps.push({title:"Now Drag This into the Row",content:"Drag it inside the row, the area you are dragging to will become highlighted with arrows. If the entire row is highlighted, this will drop your item before or after the row. If the items inside the row get highlighted, then it will be dropped <strong>inside</strong> the row.<br><br><em>Drop the text inside the row to continue.</em>",target:".ce-element--type-text",placement:"bottom",onShow:function(){document.addEventListener("mouseup",nextStepHandler)},onNext:function(){document.removeEventListener("mouseup",nextStepHandler),jQuery(".ct-toolbox").animate({scrollTop:document.querySelector(".pbs-row-group").offsetTop-40},600)}}),tour2.steps.push({title:"Properties Area",content:"Since our row is currently selected, additional properties are shown in the inspector. These new buttons will help you further style your row.<br><br>Additional buttons are also available when other elements are selected.<br><br><em>Try it out now, add a border on your row by clicking on the <strong>border style</strong> button. Do this to proceed.</em>",target:".pbs-row-group",delay:700,placement:"right",fixedElement:!0,yOffset:30,onShow:function(){var oneStepHandler=_.once(nextStepHandler);document.querySelector(".pbs-button-col-border-style").addEventListener("mouseup",oneStepHandler),document.querySelector(".pbs-button-col-border-width").addEventListener("mouseup",oneStepHandler),document.querySelector(".pbs-button-col-border-style").style.animation="pbs-tour-glow-white infinite 2s"},onNext:function(){jQuery(".ct-toolbox").animate({scrollTop:document.querySelector(".pbs-interactive-elements-group").offsetTop-40},600),document.querySelector(".pbs-button-col-border-style").style.animation=""},onEnd:function(){document.querySelector(".pbs-button-col-border-style").style.animation=""}}),tour2.steps.push({title:"More Elements",content:"Aside from text, rows and columns, there are other elements that you can add to your content like images, buttons and carousels.<br><br>"+(pbsParams.is_lite?"Some elements are only available in the premium version of the plugin.<br><br>":"")+"<em>"+(pbsParams.is_lite?"Click on next to proceed.":"Click on the carousel button to add a carousel to proceed.")+"</em>",target:".pbs-interactive-elements-group",delay:700,placement:"right",fixedElement:!0,yOffset:30,onShow:function(){document.querySelector(".ct-tool--carousel")&&(document.querySelector(".ct-tool--carousel").addEventListener("mouseup",nextStepHandler),document.querySelector(".ct-tool--carousel").style.animation="pbs-tour-glow-red infinite 2s")},onNext:function(){document.querySelector(".ct-tool--carousel")&&(document.querySelector(".ct-tool--carousel").removeEventListener("mouseup",nextStepHandler),document.querySelector(".ct-tool--carousel").style.animation="")},onEnd:function(){document.querySelector(".ct-tool--carousel").style.animation=""}}),tour2.steps.push({title:"Using Interactive Elements",content:"Some elements like this carousel are interactive. For carousels, in order to edit the other slides, you&apos;ll have to click on the bullets to navigate to them.<br><br><em>Click on the <strong>other bullets</strong> on this carousel to proceed.</em>",target:".ce-element--type-carousel",placement:"bottom",onShow:function(){var oneStepHandler=_.once(nextStepHandler);setTimeout(function(){document.querySelectorAll(".ce-element--type-carousel .glide__bullet")[1].addEventListener("mouseup",oneStepHandler),document.querySelectorAll(".ce-element--type-carousel .glide__bullet")[2].addEventListener("mouseup",oneStepHandler),document.querySelectorAll(".ce-element--type-carousel .glide__bullet")[2].style.animation="pbs-tour-glow-red infinite 2s"},100)},onNext:function(){document.querySelectorAll(".ce-element--type-carousel .glide__bullet")[2].style.animation=""},onEnd:function(){document.querySelectorAll(".ce-element--type-carousel .glide__bullet")[2].style.animation=""}}),tour2.steps.push({title:"Need Help?",content:"If you need additional help, click on this help button to bring up the online documentation.<br><br>You can also find tips on the button on the right.",target:"#wp-admin-bar-pbs_help_docs",nextOnTargetClick:!0,placement:"left",xOffset:-10,fixedElement:!0}),tour2.steps.push({title:pbsParams.labels.tour_done_title,content:pbsParams.labels.tour_done_body,target:"#wp-admin-bar-gambit_builder_save",nextOnTargetClick:!0,placement:"bottom",xOffset:50,fixedElement:!0,onShow:function(){window.pbsOpenAllSections(),jQuery(".ct-toolbox").animate({scrollTop:0},600)}}),hopscotch.startTour(tour2);var editor=ContentTools.EditorApp.get();editor.unbind("start",window.pbsPlayTour)},wp.hooks.addAction("pbs.ct.ready",function(){if("undefined"!=typeof hopscotch&&pbsParams.do_intro){if(localStorage){if(localStorage.getItem("pbs_did_intro"))return;localStorage.setItem("pbs_did_intro",1)}var tour={id:"start-editing",i18n:{doneBtn:pbsParams.labels.close},steps:[{title:pbsParams.labels.tour_intro_title,content:pbsParams.labels.tour_intro_body,target:document.querySelector("#wp-admin-bar-gambit_builder_edit"),placement:"bottom",fixedElement:!0}]};hopscotch.startTour(tour);var editor=ContentTools.EditorApp.get();editor.bind("start",window.pbsPlayTour)}}),window.addEventListener("DOMContentLoaded",function(){if("undefined"!=typeof hopscotch){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){hopscotch.endTour()})}}),window.addEventListener("DOMContentLoaded",function(){function handleVisibilityChange(){isHidden=!!document[hidden]}if(pbsParams.is_lite&&!pbsParams.lite_tracking_rated){var trackerInterval,editor=ContentTools.EditorApp.get();editor.bind("start",function(){pbsParams.lite_tracking_rated||(trackerInterval=setInterval(function(){isHidden||sendPing()},15e3))}),editor.bind("stop",function(){clearInterval(trackerInterval)});var hidden,visibilityChange,sendPing=function(){var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=function(){request.status>=200&&request.status<400&&"show"===request.responseText&&showRateBox()},request.send("action=pbs_lite_tracking_ping&nonce="+pbsParams.lite_tracking_nonce)},showRateBox=function(){document.querySelector("#wp-admin-bar-pbs_rate").classList.remove("pbs-hidden")},rated=function(){var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.send("action=pbs_lite_tracking_rated&nonce="+pbsParams.lite_tracking_nonce),pbsParams.lite_tracking_rated="1",clearInterval(trackerInterval),window.open("https://wordpress.org/plugins/page-builder-sandwich/","_blank")},isHidden=!1;"undefined"!=typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),"undefined"==typeof document.addEventListener||"undefined"==typeof document[hidden]||document.addEventListener(visibilityChange,handleVisibilityChange,!1),document.querySelector("#pbs-rate-no").addEventListener("click",function(){document.querySelector("#wp-admin-bar-pbs_rate").classList.add("pbs-hidden")}),document.querySelector("#pbs-rate-go").addEventListener("click",function(){document.querySelector("#wp-admin-bar-pbs_rate").classList.add("pbs-hidden"),rated()})}}),window.addEventListener("DOMContentLoaded",function(){var doOptin=function(yesno,callback){var payload=new FormData;payload.append("action","pbs_optin_answer"),payload.append("optin",yesno),payload.append("nonce",pbsParams.optin_nonce);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<400?"undefined"!=typeof callback&&callback():window.alert(pbsParams.labels.optin_error)},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)},editor=ContentTools.EditorApp.get();editor.bind("start",function(){if("undefined"!=typeof pbsParams.show_opt_in_stats_track&&pbsParams.show_opt_in_stats_track){var div=document.createElement("DIV");div.innerHTML=wp.template("pbs-stats-tracking-optin")(),div.classList.add("pbs-stats-tracking-optin-wrapper"),document.body.appendChild(div);var optin=document.querySelector(".pbs-stats-tracking-optin-wrapper");setTimeout(function(){optin.classList.add("pbs-show")},10),document.querySelector(".pbs-stats-tracking-optin-yes").addEventListener("click",function(ev){doOptin("yes",function(){optin.parentNode.removeChild(optin),delete pbsParams.show_opt_in_stats_track})}),document.querySelector(".pbs-stats-tracking-optin-no").addEventListener("click",function(ev){doOptin("no",function(){optin.parentNode.removeChild(optin),delete pbsParams.show_opt_in_stats_track})})}})}),function(){var proxied=jQuery.fn.is;jQuery.fn.is=function(selector){var ret=proxied.call(this,selector);if(ret){var elem=this[0];if('<div tabindex="0"></div>'===elem.outerHTML)return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)}return ret}}(),window.PBSEditor||(window.PBSEditor={}),window.PBSEditor.hexToRgb=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},window.PBSEditor.rgbToHsl=function(r,g,b){r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(b>g?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}},ContentTools.DEFAULT_TOOLS=[["paragraphPicker","color","clear-formatting","remove","bold","italic","underline","link","strikethrough","hr","align-left","align-center","align-right","align-justify","indent","unindent","unordered-list","ordered-list","code","undo","redo"],["pbs-media","widget","sidebar","icon","shortcode","html","map","tabs","onecolumn","twocolumn","threecolumn","fourcolumn"],["get-premium"]],window.PBSEditor.toolHeadings=[{label:pbsParams.labels.text_formatting,"class":"text-formatting"},{label:pbsParams.labels.insert_content,"class":"interactive-elements"}],window.PBSEditor.advancedTools=["h3","h4","h5","h6","table","preformatted","indent","unindent","code","align-justify","uppercase","strikethrough","pbs-advanced-formatting-group","pbs-shortcodes-group"],window.addEventListener("DOMContentLoaded",function(){new PBSEditor.MarginBottom,new PBSEditor.MarginTop,new PBSEditor.MarginBottomContainer,new PBSEditor.MarginTopContainer,new PBSEditor.OverlayColumnWidth,new PBSEditor.OverlayColumnWidthRight,new PBSEditor.OverlayColumnWidthLabels});