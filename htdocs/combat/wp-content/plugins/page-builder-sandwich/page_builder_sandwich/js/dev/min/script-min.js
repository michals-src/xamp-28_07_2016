ContentEdit.INDENT="";var PBS={};window.addEventListener("load",function(){var t;t=ContentTools.EditorApp.get(),window._contentToolsShim(t),t.init("*[data-editable]","data-name"),t.bind("save",function(e){function n(e){4===e.target.readyState&&(t.busy(!1),new ContentTools.FlashUI("200"===e.target.status?"ok":"no"))}var o,i,r;this.busy(!0),i=new FormData;for(o in e)if(e.hasOwnProperty(o)){var s=e[o];s=wp.hooks.applyFilters("pbs.save",s),i.append(o,s)}i.append("action","gambit_builder_save_content"),i.append("save_nonce",pbsParams.save_nonce),i.append("post_id",pbsParams.post_id),r=new XMLHttpRequest,r.addEventListener("readystatechange",n),r.open("POST",pbsParams.ajax_url),r.send(i)});var e=!1,n=_.debounce(function(){e&&document.querySelector("html").classList.add("pbs-show-outlines")},800),o=function(t){t.shiftKey&&(e=!0,n())},i=function(t){16===t.which&&(e=!1,document.querySelector("html").classList.remove("pbs-show-outlines"))};t.bind("start",function(){document.querySelector("html").classList.add("pbs-editing"),document.querySelector("html").classList.add("theme-"+pbsParams.theme_name);try{this.regions()["main-content"].children[0].focus()}catch(t){}this.domRegions()[0].classList.add("pbs-editing"),document.removeEventListener("keydown",this._handleHighlightOn),document.removeEventListener("keyup",this._handleHighlightOff),window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new Event("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16),document.addEventListener("keydown",o),document.addEventListener("keyup",i)}),t.bind("stop",function(){this.domRegions()[0].classList.remove("pbs-editing"),document.querySelector("html").classList.remove("pbs-editing"),document.querySelector("html").classList.remove("theme-"+pbsParams.theme_name),window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new Event("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16),document.removeEventListener("keydown",o),document.removeEventListener("keyup",i)}),document.body.addEventListener("mousedown",function(t){(t.target.classList.contains("ct-ignition__button--confirm")||t.target.parentNode&&t.target.parentNode.classList.contains("ct-ignition__button--confirm"))&&window.PBSEditor.updateModifiedContent()}),document.body.addEventListener("mousedown",function(t){for(var e=document.querySelector('[data-name="main-content"]'),n=e.contains(t.target),o=e===t.target,i=e;"body"!==i.parentNode.tagName.toLowerCase();)i=i.parentNode;var r=i.contains(t.target);if(e.classList.contains("pbs-editing")&&r&&!o&&!n){var s=e.getBoundingClientRect(),a=ContentTools.EditorApp.get().regions()["main-content"],l,d=!0;if(t.pageY>window.scrollY+s.top+s.height/2?(d=!1,l=a.children[a.children.length-1]):l=a.children[0],l.focus&&l.focus(),-1!==["DivRow","Div","Shortcode"].indexOf(l.constructor.name)){var c=new ContentEdit.Text("p",{},"");d?l.parent().attach(c,0):l.parent().attach(c,l.parent().children.indexOf(l)+1),l=c,l.focus()}var u=0;d||l.content&&(u=l.content.length()),t.preventDefault();var p=new ContentSelect.Range(u,u);return void p.select(l._domElement)}}),wp.hooks.doAction("pbs.init")}),ContentEdit.DRAG_HOLD_DURATION=400,ContentEdit.Root.get().bind("drag",function(){document.querySelector('[data-name="main-content"]').classList.add("dragging")}),ContentEdit.Root.get().bind("drop",function(){document.querySelector('[data-name="main-content"]').classList.remove("dragging"),window.dispatchEvent(new Event("pbs:fix-row-widths"))}),window.pbsSelectorMatches=function(t,e){var n=Element.prototype,o=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)};return o.call(t,e)},window.cssToStyleObject=function(t){for(var e=/([\w-]*)\s*:\s*([^;]*)/g,n,o={};n=e.exec(t);)o[n[1]]=n[2];return o},window.cssToStyleString=function(t){var e="";for(var n in t)e+=n+":"+t[n]+";";return e},ContentEdit.Element.prototype._onMouseMove=function(){};var __slice=[].slice,__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};window.PBSEditor={},window.PBSEditor.getToolUI=function(t){return ContentTools.EditorApp.get()._toolbox._toolUIs[t]},ContentEdit.Root.get().bind("mount",function(t){t.domElement()._ceElement=t}),window.PBSEditor.updateModifiedContent=function(){var t=ContentTools.EditorApp.get().regions();for(var e in t)window.PBSEditor.updateModifiedContentRecursive(t[e])},window.PBSEditor.updateModifiedContentRecursive=function(t){var e=t.children;for(var n in e){var o=e[n];"undefined"!=typeof o.content&&o.content.html()!==o._domElement.innerHTML&&window.PBSEditor.updateElementContent(o,o._domElement.innerHTML),window.PBSEditor.updateModifiedContentRecursive(o)}},window.PBSEditor.updateElementContent=function(t,e){"Shortcode"!==t.constructor.name&&(t.content=new HTMLString.String(e).trim(),t.updateInnerHTML(),t.taint())},ContentEdit.Element.prototype.style=function(t,e){var n;return"undefined"==typeof e?(n=this._domElement.style[t],n?n:(n=window.getComputedStyle(this._domElement),n[t])):(this._domElement.style[t]=e,n=this._domElement.getAttribute("style"),null===n?(this._attributes.style="",this.isMounted()&&this._domElement.removeAttribute("style"),this.taint()):this.attr("style",n))},ContentEdit.Element.prototype.defaultStyle=function(t){var e=this._domElement.style[t];e||(e=window.getComputedStyle(this._domElement),e=e[t]),this._domElement.style[t]="";var n=window.getComputedStyle(this._domElement);return n=n[t],this._domElement.style[t]=e,n},window._contentToolsShim=function(t){t.start=function(){ContentTools.EditorApp.getCls().prototype.start.call(this),t.trigger("start")},t.stop=function(){ContentTools.EditorApp.getCls().prototype.stop.call(this),t.trigger("stop")}},ContentTools.IgnitionUI.prototype.mount=function(){this._domElement=document.querySelector("#wpadminbar"),this._domEdit=document.querySelector("#wp-admin-bar-gambit_builder_edit"),this._domEdit.classList.add("ct-ignition__button--edit"),this._domConfirm=document.querySelector("#wp-admin-bar-gambit_builder_save"),this._domConfirm.classList.add("ct-ignition__button--confirm"),this._domCancel=document.querySelector("#wp-admin-bar-gambit_builder_cancel"),this._domCancel.classList.add("ct-ignition__button--cancel"),this._domBusy=document.querySelector("#wp-admin-bar-gambit_builder_busy"),this._domBusy.classList.add("ct-ignition__button--busy");var t=this._addDOMEventListeners();return this._domEdit.addEventListener("mousedown",function(){this.prevScrollY=window.scrollY}),this._domEdit.addEventListener("click",function(){window.scrollTo(0,this.prevScrollY)}),t},ContentEdit.Shortcode=function(t){function e(t,n,o){this.sc_hash=n["data-shortcode"],this.sc_base=n["data-base"],this.sc_raw=atob(this.sc_hash),this.sc_prev_raw=this.sc_raw,this.model=new Backbone.Model({}),this.parseShortcode(),this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,e.__super__.constructor.call(this,t,n),this._content=o}return __extends(e,t),e.sc_raw="",e.sc_hash="",e.sc_base="",e.sc_prev_raw="",e.createShortcode=function(t){var e=document.createElement("DIV");return e.setAttribute("data-ce-moveable",""),e.setAttribute("data-ce-tag","shortcode"),e.setAttribute("data-base",t.shortcode.tag),e.setAttribute("data-shortcode",btoa(t.content)),ContentEdit.Shortcode.fromDOMElement(e)},e.prototype.convertToText=function(){var t=document.createElement("P");t.innerHTML=this.sc_raw,t=ContentEdit.Text.fromDOMElement(t),this.blur();var e=this.parent().children.indexOf(this),n=this._domElement.getBoundingClientRect(),o=this._domElement.innerHTML,i=0;if(this._domElement.nextElementSibling){var r=this._domElement.nextElementSibling.getBoundingClientRect();i=r.top-n.bottom}this.parent().attach(t,e),this.parent().detach(this),t.isShortcodeEditing=!0,t._domElement.style.minHeight=n.height+"px",t._domElement.style.marginBottom=i+"px",t.origShortcode=this.sc_raw,t.origInnerHTML=o,t.focus(),function(t){setTimeout(function(){var e=new ContentSelect.Range(t.content.length(),t.content.length());t._domElement&&e.select(t._domElement)},1)}(t)},e.prototype.parseShortcode=function(){var t=wp.shortcode.next(this.sc_base,this.sc_raw,0);for(var e in t.shortcode.attrs.named)this.model.set(e,t.shortcode.attrs.named[e],{silent:!0});for(var n in t.shortcode.attrs.numeric)this.model.set(n,t.shortcode.attrs.numeric[n],{silent:!0});this.model.set("content",t.shortcode.content,{silent:!0})},e.prototype._onMouseUp=function(t){e.__super__._onMouseUp.call(this,t),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(t){return function(){t._doubleClickCount=0}}(this),500),this._doubleClickCount++},e.prototype._onMouseOut=function(t){e.__super__._onMouseOut.call(this,t),clearTimeout(this._dragTimeout)},e.prototype._onMouseDown=function(t){t.preventDefault(),t.stopPropagation(),e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this.domElement()===t.target&&(this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION/2),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(t){return function(){t._doubleClickCount=0}}(this),500),this._doubleClickCount++,3===this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,this._onDoubleClick(t)))},e.prototype._onDoubleClick=function(){this.convertToText()},e.prototype.blur=function(){var t=ContentEdit.Root.get();return this.isFocused()?(this._removeCSSClass("ce-element--focused"),t._focused=null,t.trigger("blur",this)):void 0},e.droppers={Shortcode:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Image:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert,DivRow:ContentEdit.Element._dropVert,Div:ContentEdit.Element._dropVert},e.prototype.focus=function(t){var e;return e=ContentEdit.Root.get(),this.isFocused()?void 0:(e.focused()&&e.focused().blur(),this._addCSSClass("ce-element--focused"),e._focused=this,this.isMounted()&&!t&&this.domElement().focus(),e.trigger("focus",this))},e.prototype.cssTypeName=function(){return"shortcode"},e.prototype.typeName=function(){return"Shortcode"},e.prototype.clone=function(){var t=ContentEdit.Root.get();t.focused()===this&&t.focused().blur();var n=document.createElement("div");n.innerHTML=this.html();var o=e.fromDOMElement(n.childNodes[0]),i=this.parent().children.indexOf(this);this.parent().attach(o,i+1),o.focus()},e.prototype.modelChanged=function(){this.updateSCRaw(),this.updateSCHash(),clearTimeout(this._scRefreshTrigger);var t=this;this._scRefreshTrigger=setTimeout(function(){t.ajaxUpdate()},500)},e.prototype.setSCAttr=function(t,e){this.model.set(t,e)},e.prototype.setSCContent=function(t){this.model.set("content",t)},e.prototype.updateSCRaw=function(){var t="";t+="["+this.sc_base;var e=this.model.keys();for(var n in e){var o=e[n];"content"!==o&&(t+=" "+o+'="'+this.model.get(o)+'"')}t+="]",this.model.get("content")&&(t+=this.model.get("content")),t+="[/"+this.sc_base+"]",this.sc_raw=t},e.prototype.updateSCHash=function(){this.sc_hash=btoa(this.sc_raw),this.attr("data-shortcode",this.sc_hash)},e.prototype.ajaxUpdate=function(t){if(this.sc_prev_raw!==this.sc_raw||t){var e=new FormData;e.append("action","pbs_shortcode_render"),e.append("shortcode",this.sc_hash),e.append("nonce",pbsParams.shortcode_nonce),this._domElement.classList.add("pbs--rendering");var n=this,o=new XMLHttpRequest;o.open("POST",window.location.href),o.onload=function(){if(o.status>=200&&o.status<400){var t=JSON.parse(o.responseText),e=t.scripts+t.styles,i=document.createElement("div");i.innerHTML=e.trim();var r=document.querySelector("html").innerHTML;if(e.trim().length)for(var s=i.childNodes.length-1;s>=0;s--)if(i.childNodes[s].getAttribute){var a=i.childNodes[s];-1===r.indexOf(a.outerHTML)&&document.body.appendChild(a)}if(n._domElement.innerHTML=t.output,n._content=t.output,n.style("float",""),1===n._domElement.children.length)try{var l=getComputedStyle(n._domElement.firstChild);("left"===l["float"]||"right"===l["float"])&&n.style("float",l["float"])}catch(d){}document.dispatchEvent(new CustomEvent("pbs:shortcode-render",{detail:document.querySelector(".pbs--rendering")}))}n._domElement.classList.remove("pbs--rendering"),n._domElement.style.minHeight="",n._domElement.style.marginBottom="",n.sc_prev_raw=n.sc_raw},o.onerror=function(){n._domElement.classList.remove("pbs--rendering"),n._domElement.style.minHeight="",n._domElement.style.marginBottom="",n.sc_prev_raw=n.sc_raw},o.send(e)}},e}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Shortcode,"shortcode"),ContentEdit.Text.prototype.convertShortcodes=function(){if(!this.content.isWhitespace()){var t=this.content.html(),e=[],n=[],o=/\[([^\/][\w-_]+)[^\]]*\]/g,i=o.exec(t);if(i){for(var r=0;i;)if(i.index<r)i=o.exec(t);else{var s=i[1],a=wp.shortcode.next(s,t,i.index);e.push(t.substr(r,i.index-r)),n.push(a),r=i.index+a.content.length,i=o.exec(t)}e.push(t.substr(r));var l,d=this.parent().children.indexOf(this),c=this.parent(),u=this._domElement,p,m;u&&u.style.minHeight&&(p=u.style.minHeight,m=u.style.bottomMargin);for(var h=0;h<e.length+n.length;h++){var g=h%2===1;if(l=null,0!==h){if(g?l=ContentEdit.Shortcode.createShortcode(n[Math.floor(h/2)]):e[h/2].trim()&&(l=document.createElement("P"),l.innerHTML=e[h/2],l=ContentEdit.Text.fromDOMElement(l)),l&&(d++,c.attach(l,d),1===h&&u&&p&&(l._domElement.style.minHeight=p,l._domElement.style.bottomMargin=m),"Shortcode"===l.constructor.name)){var f=!0;1===h&&l.sc_raw===this.origShortcode&&(l._domElement.innerHTML=this.origInnerHTML,l._content=this.origInnerHTML,f=!1),f&&l.ajaxUpdate(!0)}}else this.content=new HTMLString.String(e[h],!0),this.updateInnerHTML(),this.taint()}this.parent()&&this.content.isWhitespace()&&this.parent().detach(this)}}},ContentEdit.Text.prototype._shortcodeOverrideKeyReturn=ContentEdit.Text.prototype._keyReturn,ContentEdit.Text.prototype._keyReturn=function(t){if(this.isShortcodeEditing)return this.blur(),this.convertShortcodes();var e=this._shortcodeOverrideKeyReturn(t);return this.convertShortcodes(),e},window.addEventListener("load",function(){ContentEdit.Root.get().bind("blur",function(t){"Text"===t.constructor.name&&t.convertShortcodes()}),document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var t=ContentEdit.Root.get(),e=t.focused();e&&"Text"===e.constructor.name&&e.content&&e.content.html().match(/\[\w+[^\]]+\]/)&&e.blur()})}),ContentEdit.Text.prototype._shortcodeOverrideKeyLeft=ContentEdit.Text.prototype._keyLeft,ContentEdit.Text.prototype._keyLeft=function(t){var e=ContentSelect.Range.query(this._domElement);if(0===e.get()[0]){var n=this.previousContent();if(n&&"Shortcode"===n.constructor.name)return t.preventDefault(),t.stopPropagation(),void n.focus()}return this._shortcodeOverrideKeyLeft(t)},ContentEdit.Text.prototype._shortcodeOverrideKeyRight=ContentEdit.Text.prototype._keyRight,ContentEdit.Text.prototype._keyRight=function(t){var e=ContentSelect.Range.query(this._domElement);if(this._atEnd(e)){var n=this.nextContent();if(n&&"Shortcode"===n.constructor.name)return t.preventDefault(),t.stopPropagation(),void n.focus()}return this._shortcodeOverrideKeyRight(t)},window.addEventListener("load",function(){var t=ContentEdit.Root.get();document.addEventListener("keydown",function(e){if(t.focused()&&"Shortcode"===t.focused().constructor.name&&-1!==["body","html"].indexOf(e.target.tagName.toLowerCase())&&-1===[16,17,18,91,92].indexOf(e.which)){var n=t.focused(),o,i,r,s,a=n.parent().children.indexOf(n);if(-1!==[13,8,46].indexOf(e.which)&&e.preventDefault(),8===e.which?(n.blur(),n.parent().children[a-1]?(i=n.parent().children[a-1],i.focus(),i.content&&(s=new ContentSelect.Range(i.content.length(),i.content.length()),s.select(i._domElement))):n.parent().children[a+1]?(i=n.parent().children[a+1],i.focus(),i.content&&(s=new ContentSelect.Range(i.content.length(),i.content.length()),s.select(i._domElement))):(r=n.parent(),setTimeout(function(){r.children[0].focus()},1))):46===e.which&&(n.blur(),n.parent().children[a+1]?n.parent().children[a+1].focus():n.parent().children[a-1]?n.parent().children[a-1].focus():(r=n.parent(),setTimeout(function(){r.children[0].focus()},1))),8===e.which||46===e.which)return void n.parent().detach(n);if((40===e.which||39===e.which)&&n.nextContent()&&n.parent().children.indexOf(n)!==n.parent().children.length-1)return e.preventDefault(),void n.nextContent().focus();if((38===e.which||37===e.which)&&n.previousContent()&&0!==n.parent().children.indexOf(n))return e.preventDefault(),void n.previousContent().focus();38!==e.which&&37!==e.which&&a++,o=new ContentEdit.Text("p"),n.parent().attach(o,a),n.blur(),o.focus()}})}),ContentEdit.Node.prototype._overridePreviousContent=ContentEdit.Node.prototype.previousContent,ContentEdit.Node.prototype.previousContent=function(){var t=this.previousWithTest(function(t){return void 0!==t.content||"Shortcode"===t.constructor.name});return t},ContentEdit.Node.prototype._overrideNextContent=ContentEdit.Node.prototype.nextContent,ContentEdit.Node.prototype.nextContent=function(){return this.nextWithTest(function(t){return void 0!==t.content||"Shortcode"===t.constructor.name})},window.addEventListener("load",function(){var t=document.querySelectorAll('[data-name="main-content"] [data-shortcode]');Array.prototype.forEach.call(t,function(t){if(1===t.children.length)try{var e=getComputedStyle(t.firstChild);("left"===e["float"]||"right"===e["float"])&&(t.style["float"]=e["float"])}catch(n){}})}),ContentEdit.Embed=function(t){function e(t,n,o){this.url=n["data-embed"],this.model=new Backbone.Model({}),this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,e.__super__.constructor.call(this,t,n),this._content=o}return __extends(e,t),e.prototype.updateEmbedContent=function(){console.log("updateEmbedContent")},e}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Embed,"embed"),ContentEdit.Text.prototype._embedOverrideKeyReturn=ContentEdit.Text.prototype._keyReturn,ContentEdit.Text.prototype._keyReturn=function(t){if(this.isEmbedEditing)return this.blur(),this.updateEmbedContent();var e=this._embedOverrideKeyReturn(t);return this.updateEmbedContent(),e},window.addEventListener("load",function(){ContentEdit.Root.get().bind("blur",function(t){"Text"===t.constructor.name&&t.updateEmbedContent()})}),ContentEdit.Div=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}return __extends(e,t),e.prototype.cssTypeName=function(){return"div"},e.prototype.typeName=function(){return"Div"},e.prototype._onMouseUp=function(t){t.target===this._domElement&&(e.__super__._onMouseUp.call(this,t),clearTimeout(this._dragTimeout))},e.prototype._onMouseDown=function(t){return t.target===this._domElement&&(e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this.domElement()===t.target)?(t.preventDefault(),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},e.prototype._onMouseOver=function(t){t.target===this._domElement&&e.__super__._onMouseOver.call(this,t)},e.prototype.attach=function(t,n){2===this.children.length&&"undefined"!=typeof this.children[0].content&&this.children[0].content.isWhitespace()&&this.detach(this.children[0]),2===this.children.length&&"undefined"!=typeof this.children[1].content&&this.children[1].content.isWhitespace()&&this.detach(this.children[1]),e.__super__.attach.call(this,t,n)},e.prototype.detach=function(t){ContentEdit.NodeCollection.prototype.detach.call(this,t),0===this.children.length&&this.attach(new ContentEdit.Text("p"),0)},e._dropInside=function(t,e,n){var o=0;return"below"===n[0]&&(o=e.children.length),e.attach(t,o)},e.droppers={Image:ContentEdit.Element._dropBoth,Div:ContentEdit.Element._dropVert,Button:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropBoth},e.fromDOMElement=function(t){var e;if(null!==t.getAttribute("data-shortcode"))return ContentEdit.Shortcode.fromDOMElement(t);if(t.classList.contains("pbs-row"))return ContentEdit.DivRow.fromDOMElement(t);if(t.classList.contains("pbs-col"))return ContentEdit.DivCol.fromDOMElement(t);var n,o,i,r,s,a;r=new this(t.tagName,this.getDOMElementAttributes(t)),i=function(){var e,o,i,r;for(i=t.childNodes,r=[],e=0,o=i.length;o>e;e++)n=i[e],r.push(n);return r}();var l=ContentEdit.TagNames.get();for(s=0,a=i.length;a>s;s++)if(o=i[s],1===o.nodeType){e=l.match(o.getAttribute("data-ce-tag")?o.getAttribute("data-ce-tag"):o.tagName);var d=e.fromDOMElement(o);d&&r.attach(d)}return 0===r.children.length?null:r},e}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Div,"div"),ContentEdit.DivRow=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}return __extends(e,t),e.prototype.cssTypeName=function(){return"row"},e.prototype.typeName=function(){return"Row"},e.prototype.showOutline=function(){for(var t=this;t;)"DivRow"===t.constructor.name&&t._addCSSClass("pbs-new-column"),t=t.parent()},e.prototype._onMouseOver=function(t){var n=ContentEdit.Root.get(),o=n.dragging();if(this._removeCSSClass("pbs-new-column"),n._dropTarget){var i=document.querySelector(".ce-element--over");if(n._dropTarget.domElement().contains(o.domElement())&&(null===i||null!==i&&o.domElement().contains(i)))return n._dropTarget._removeCSSClass("ce-element--drop"),n._dropTarget._removeCSSClass("ce-element--drop-above"),n._dropTarget._removeCSSClass("ce-element--drop-below"),n._dropTarget._removeCSSClass("ce-element--drop-center"),n._dropTarget._removeCSSClass("ce-element--drop-left"),n._dropTarget._removeCSSClass("ce-element--drop-right"),void(n._dropTarget=null)}return null!==n._dropTarget&&o&&pbsSelectorMatches(n._dropTarget.domElement(),".ce-element--dragging *")?(n._dropTarget._removeCSSClass("ce-element--drop"),n._dropTarget._removeCSSClass("ce-element--drop-above"),n._dropTarget._removeCSSClass("ce-element--drop-below"),n._dropTarget._removeCSSClass("ce-element--drop-center"),n._dropTarget._removeCSSClass("ce-element--drop-left"),n._dropTarget._removeCSSClass("ce-element--drop-right"),void(n._dropTarget=null)):void((!o||t.target.classList.contains("pbs-row"))&&(e.__super__._onMouseOver.call(this,t),o&&this._removeCSSClass("ce-element--over"),this.domElement()!==t.target&&this._removeCSSClass("ce-element--over"),t.target.classList.contains("pbs-row")||this._removeCSSClass("ce-element--over")))},e.prototype._onMouseUp=function(t){e.__super__._onMouseUp.call(this,t),clearTimeout(this._dragTimeout)},e.prototype._onMouseMove=function(t){e.__super__._onMouseMove.call(this,t),clearTimeout(this._dragTimeout)},e.prototype._onMouseDown=function(t){return e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this.domElement()===t.target?(t.preventDefault(),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},e.droppers={DivRow:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,Button:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert},e.prototype.mount=function(){e.__super__.mount.call(this),this.addCSSClass("pbs-row")},e.fromDOMElement=function(t){var e;if(null!==t.getAttribute("data-shortcode"))return ContentEdit.Static.fromDOMElement(t);if(t.classList.contains("pbs-col"))return ContentEdit.DivCol.fromDOMElement(t);var n,o,i,r,s,a;r=new this(t.tagName,this.getDOMElementAttributes(t)),i=function(){var e,o,i,r;for(i=t.childNodes,r=[],e=0,o=i.length;o>e;e++)n=i[e],r.push(n);return r}();var l=ContentEdit.TagNames.get();for(s=0,a=i.length;a>s;s++)if(o=i[s],1===o.nodeType&&(e=l.match(o.getAttribute("data-ce-tag")?o.getAttribute("data-ce-tag"):o.tagName),"div"===o.tagName.toLowerCase()||o.classList.contains("pbs-col"))){var d=e.fromDOMElement(o);d&&r.attach(d)}return 0===r.children.length?null:r},e.prototype.focus=function(){var t=document.querySelector(".ce-element--over");null===t&&this.children[0].focus(),document.querySelector(".ce-element--over")===this._domElement&&this.children[this.children.length-1].focus()},e.prototype.addNewColumn=function(t){"undefined"==typeof t&&(t=this.children.length);var e=new ContentEdit.DivCol("div"),n=new ContentEdit.Text("p",{},"");return e.attach(n),this.attach(e,t),e.style("flex-grow","1"),e},e.prototype.adjustColumnNumber=function(t){if(this.children.length<t)for(;this.children.length<t;)this.addNewColumn();else if(this.children.length>t)for(;this.children.length>t;)this.children[t].blurIfFocused(),this.children[t-1].merge(this.children[t])},e.prototype.adjustColumns=function(t){var e=t.replace(/(\s*\+\s*|\s+)/g," ").split(" ");this.adjustColumnNumber(e.length);var n=1;for(var o in e)if(-1!==e[o].indexOf("/")){var i=parseInt(e[o].split("/")[1],10);i>n&&(n=i)}for(o in e){var r=1;if(-1!==e[o].indexOf("/")){var s=e[o].split("/");r=s[0]/s[1]*n}else r=parseInt(e[o],10);this.children[o].style("flex-grow",r)}},e.prototype.clone=function(){this.blurIfFocused();var t=document.createElement("div");t.innerHTML=this.html();var n=e.fromDOMElement(t.childNodes[0]),o=this.parent().children.indexOf(this);return this.parent().attach(n,o+1),n.focus(),n},e.prototype.getColumnEquation=function(){var t,e,n,o=0;for(n in this.children)t=this.children[n],e=window.getComputedStyle(t._domElement),o+=parseFloat(e["flex-grow"]);var i="";for(n in this.children)t=this.children[n],e=window.getComputedStyle(t._domElement),i+=i?" + ":"",i+=parseFloat(e["flex-grow"])+"/"+o;return i},e.prototype.blurIfFocused=function(){var t=ContentEdit.Root.get();if(t.focused())for(var e=t.focused();e;){if(e===this)return void t.focused().blur();e=e.parent()}},e}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.DivRow,"div"),ContentEdit.DivCol=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}function n(t,e){var n=new ContentSelect.Range(e,e);n.select(t)}return __extends(e,t),e.prototype.cssTypeName=function(){return"col"},e.prototype.typeName=function(){return"Column"},e.prototype._onMouseUp=function(t){e.__super__._onMouseUp.call(this,t),clearTimeout(this._dragTimeout)},e.prototype._onMouseMove=function(t){e.__super__._onMouseMove.call(this,t),clearTimeout(this._dragTimeout)},e.prototype._onMouseDown=function(t){return e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this.domElement()===t.target?(t.preventDefault(),this._domElement.classList.contains("pbs-drag-row")?this.parent().drag(t.pageX,t.pageY):this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)):void 0},e.prototype._onMouseOut=function(t){e.__super__._onMouseOut.call(this,t),this._domElement.classList.remove("pbs-drag-row-handle"),this._domElement.classList.remove("pbs-drag-row")},e.prototype._onMouseMove=function(t){e.__super__._onMouseOver.call(this,t);var n=ContentEdit.Root.get(),o=n.dragging(),i;if(this._domElement.classList.remove("pbs-drag-row-handle"),o&&!pbsSelectorMatches(this._domElement,".ce-element--dragging, .ce-element--dragging *"))i=this._domElement.getBoundingClientRect(),this._domElement.classList.remove("pbs-drop-outside-row"),(i.bottom-t.clientY<=15||t.clientY-i.top<=15)&&(this._domElement.classList.remove("ce-element--over"),this._domElement.classList.add("pbs-drop-outside-row"));else if(o){var r=document.querySelector(".ce-element--over");if(r&&(r._ceElement._removeCSSClass("ce-element--over"),o._addCSSClass("ce-element--over")),n._dropTarget)return n._dropTarget._removeCSSClass("ce-element--over"),n._dropTarget._removeCSSClass("ce-element--drop"),n._dropTarget._removeCSSClass("ce-element--drop-above"),n._dropTarget._removeCSSClass("ce-element--drop-below"),n._dropTarget._removeCSSClass("ce-element--drop-center"),n._dropTarget._removeCSSClass("ce-element--drop-left"),n._dropTarget._removeCSSClass("ce-element--drop-right"),void(n._dropTarget=null)}else 0===this.parent().children.indexOf(this)&&(this._domElement.classList.add("pbs-drag-row-handle"),this._domElement.classList.remove("pbs-drag-row"),i=this._domElement.getBoundingClientRect(),t.clientX-i.left<=15&&this._domElement.classList.add("pbs-drag-row"))},e.prototype._onMouseOver=function(t){e.__super__._onMouseOver.call(this,t);var n=ContentEdit.Root.get(),o=n.dragging();return!o||t.target.classList.contains("pbs-col")?o&&pbsSelectorMatches(t.target,".ce-element--dragging *")?void this._removeCSSClass("ce-element--over"):void(o&&t.target.classList.contains("pbs-col")||(t.target.classList.contains("pbs-col")&&!o&&this.domElement()===t.target?this._addCSSClass("ce-element--over"):this._removeCSSClass("ce-element--over"))):void 0},e.placements=["left","right","above","below"],e._dropColumn=function(t,e,n){var o;if(e._domElement.classList.contains("pbs-drop-outside-row")){if(1===t.parent().children.length){var i=t.parent();return i.parent().detach(i),o=e.parent().parent().children.indexOf(e.parent()),"below"===n[0]&&o++,e.parent().parent().attach(i,o)}t.parent().detach(t),o=e.parent().parent().children.indexOf(e.parent()),"below"===n[0]&&o++;var r;return r=new ContentEdit.DivRow("div"),r.attach(t),e.parent().parent().attach(r,o)}return t.parent().detach(t),o=e.parent().children.indexOf(e),("right"===n[1]||"center"===n[1])&&o++,e.parent().attach(t,o)},e._dropInsideOrOutside=function(t,e,n){var o,i;if(e._domElement.classList.contains("pbs-drop-outside-row"))return o=e.parent(),t.parent().detach(t),i=o.parent().children.indexOf(o),"below"===n[0]&&i++,o.parent().attach(t,i);if("DivCol"===t.constructor.name&&"DivCol"!==e.constructor.name){if(1===t.parent().children.length)return o=t.parent(),o.parent().detach(o),i=e.parent().children.indexOf(e),"below"===n[0]&&i++,e.parent().attach(o,i);t.parent().detach(t),i=e.parent().children.indexOf(e),"below"===n[0]&&i++;var r;return r=new ContentEdit.DivRow("div"),r.attach(t),e.parent().attach(r,i)}return ContentEdit.Div._dropInside(t,e,n)},e.droppers={DivCol:e._dropColumn,Shortcode:e._dropInsideOrOutside,Div:e._dropInsideOrOutside,DivRow:e._dropInsideOrOutside,Image:e._dropInsideOrOutside,List:e._dropInsideOrOutside,PreText:e._dropInsideOrOutside,Static:e._dropInsideOrOutside,Table:e._dropInsideOrOutside,Text:e._dropInsideOrOutside,Video:e._dropInsideOrOutside},e.prototype.mount=function(){e.__super__.mount.call(this),this.addCSSClass("pbs-col");for(var t=this.children.length-1;t>=0;t--)"undefined"!=typeof this.children[t].content&&this.children[t].content.isWhitespace()&&this.detach(this.children[t])},e.mergers={DivCol:function(t,e){for(var n=t.children.length,o=0;n>o;o++)e.attach(t.children[0]);for(o=n-1;o>=0;o--)e.children[o].content&&e.children[o].content.isWhitespace()&&e.detach(e.children[o]);return t.parent().detach(t),e.taint()}},e.fromDOMElement=function(t){if(null!==t.getAttribute("data-shortcode"))return ContentEdit.Static.fromDOMElement(t);if(t.classList.contains("pbs-row"))return ContentEdit.DivRow.fromDOMElement(t);

var e,n,o,i,r,s;i=new this(t.tagName,this.getDOMElementAttributes(t)),o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}();var a=ContentEdit.TagNames.get();for(r=0,s=o.length;s>r;r++)if(n=o[r],1===n.nodeType){var l;l=a.match(n.getAttribute("data-ce-tag")?n.getAttribute("data-ce-tag"):n.tagName);var d=l.fromDOMElement(n);d&&i.attach(d)}return 0===i.children.length&&i.attach(new ContentEdit.Text("p"),0),i},e.prototype.focus=function(){var t=ContentEdit.Root.get();t.focused()&&t.focused().blur();for(var e=this.children.length-1;e>=0;e--)if(this.children[e].constructor&&"DivRow"!==this.children[e].constructor.name){this.children[e].focus();var o=0;this.children[e].content&&(o=this.children[e].content.length());var i=this.children[e]._domElement;return void setTimeout(n,1,i,o)}for(e=this.children.length-1;e>=0;e--)if(this.children[e].constructor&&"DivRow"===this.children[e].constructor.name)return void this.children[e].children[0].focus();this.children[0].focus()},e.prototype.clone=function(){this.blurIfFocused();var t=document.createElement("div");t.innerHTML=this.html();var n=e.fromDOMElement(t.childNodes[0]),o=this.parent().children.indexOf(this);return this.parent().attach(n,o+1),n.focus(),n},e.prototype.blurIfFocused=function(){var t=ContentEdit.Root.get();if(t.focused())for(var e=t.focused();e;){if(e===this)return void t.focused().blur();e=e.parent()}},e}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.DivCol,"div"),ContentEdit.Root.get().__getDropPlacement=ContentEdit.Root.get()._getDropPlacement,ContentEdit.Root.get()._getDropPlacement=function(t,e){var n=ContentEdit.Root.get().__getDropPlacement(t,e);if(null===this._dropTarget)return n;if(null===this._dropTarget.constructor)return n;if("DivCol"===this.dragging().constructor.name&&"DivCol"!==this._dropTarget.constructor.name&&(n[1]="center"),"DivCol"===this._dropTarget.constructor.name)if(this._dropTarget._domElement.classList.contains("pbs-drop-outside-row"))n[1]="center";else if(this.dragging().parent()===this._dropTarget.parent()&&!this._dropTarget._domElement.classList.contains("pbs-drop-outside-row")&&-1===this._dropTarget.constructor.placements.indexOf("center")){var o=this._dropTarget.domElement().getBoundingClientRect();t-o.left<o.width/2?n[1]="left":n[1]="right"}return n},ContentEdit.Root.get().bind("drop",function(t,e){if(null!==e&&null!==e.parent()&&("DivCol"===e.parent().constructor.name||"Div"===e.parent().constructor.name)){var n=e.parent();for(var o in n.children)null!==n.children[o].content&&"undefined"!=typeof n.children[o].content&&n.children.length>1&&n.children[o].content.isWhitespace()&&n.children[o]!==t&&n.detach(n.children[o])}}),ContentEdit.Root.get().bind("drop",function(t,e){null!==e&&null!==e.parent()&&"DivRow"===t.constructor.name&&("Div"===t.parent().constructor.name||"DivCol"===t.parent().constructor.name)&&t.attr("data-width")&&(t.style("margin-right",""),t.style("margin-left",""),"full-width-retain-content"===t.attr("data-width")&&(t.style("padding-right",""),t.style("padding-left","")),t.removeAttr("data-width"))}),ContentEdit.Text.prototype.__keyReturn=ContentEdit.Text.prototype._keyReturn,ContentEdit.Text.prototype._keyReturn=function(t){if(t.preventDefault(),("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&this.content.isWhitespace()&&this.parent().children.indexOf(this)===this.parent().children.length-1){var e=this.parent().parent();this.parent().detach(this);var n=e.parent().children.indexOf(e)+1,o=new ContentEdit.Text("p",{},"");return e.parent().attach(o,n),void o.focus()}return this.__keyReturn(t)},ContentEdit.Text.prototype.__keyUp=ContentEdit.Text.prototype._keyUp,ContentEdit.Text.prototype._keyUp=function(t){var e=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&0===this.parent().children.indexOf(this)&&0===e.get()[0]){var n=this.parent().parent(),o=n.parent().children.indexOf(n),i=new ContentEdit.Text("p",{},"");return n.parent().attach(i,o),void i.focus()}return this.__keyUp(t)},ContentEdit.Text.prototype.__keyDown=ContentEdit.Text.prototype._keyDown,ContentEdit.Text.prototype._keyDown=function(t){var e=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(e)){var n=this.parent().parent(),o=n.parent().children.indexOf(n),i=new ContentEdit.Text("p",{},"");return n.parent().attach(i,o+1),void i.focus()}return this.__keyDown(t)},ContentEdit.Element.prototype._onColOverrideMouseOver=ContentEdit.Element.prototype._onMouseOver,ContentEdit.Element.prototype._onMouseOver=function(t){var e=this._onColOverrideMouseOver(t),n=ContentEdit.Root.get(),o=n.dragging();if(o&&"DivCol"===o.constructor.name&&pbsSelectorMatches(t.target,".ce-element--dragging *")){var i=document.querySelector(".ce-element--over");i&&(i._ceElement._removeCSSClass("ce-element--over"),o._addCSSClass("ce-element--over"))}return e},wp.hooks.addFilter("pbs.save",function(t){return t=t.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(max-width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),t=t.replace(/(<[^>]+pbs-row[^>]+style\=[^>]*[^-])(width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),t=t.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(left:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),t=t.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width-retain-content["'][^>]+>/g,function(t){return t=t.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),t=t.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),t=t.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),t=t.replace(/(padding:\s?)([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),t=t.replace(/\s?padding-left:\s?[\d\w.]+;?\s?/g,""),t=t.replace(/\s?padding-right:\s?[\d\w.]+;?\s?/g,""),t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),t=t.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),t=t.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),t=t.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),t=t.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")}),t=t.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width["'][^>]+>/g,function(t){return t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),t=t.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),t=t.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),t=t.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),t=t.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),t=t.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")})});var root=ContentEdit.Root.get();root._overrideImageOnStopResizing=root._onStopResizing,root._onStopResizing=function(t){if("Image"===this._resizing.constructor.name){var e=this._resizing._attributes["class"].match(/size-\w+/);e&&this._resizing.removeCSSClass(e[0])}return this._overrideImageOnStopResizing(t)}.bind(root),ContentEdit.Image.prototype._onDblclick=function(){this.openMediaManager()},ContentEdit.Image.prototype.openMediaManager=function(){var t=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(this._domElement)});t.state("image-details").on("update",function(t){_pbsUpdateNonCaptionedImageCTElement(this,t)}.bind(this)),t.on("close",function(){wp.media.editor.remove("edit"),t.detach()})},ContentEdit.Image.prototype._removeDOMEventListeners=function(){this._domElement.removeEventListener("dblclick",this._onDblClickBound),window.removeEventListener("keydown",this._onKeyDownBound)},ContentEdit.Image.prototype.mount=function(){this._domElement=document.createElement("img");for(var t in this._attributes)this._attributes[t]&&this._domElement.setAttribute(t,this._attributes[t]);return this._onDblClickBound=this._onDblclick.bind(this),this._domElement.addEventListener("dblclick",this._onDblClickBound),this._onKeyDownBound=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDownBound),ContentEdit.Image.__super__.mount.call(this)},ContentEdit.Image.prototype._onKeyDown=function(t){-1===["input","select","textarea","button"].indexOf(t.target.tagName.toLowerCase())&&this.isFocused()&&ContentTools.Tools.Paragraph.apply(this,null,function(){})},ContentEdit.Image._dropBoth=function(t,e,n){var o;return t.parent().detach(t),o=e.parent().children.indexOf(e),"below"===n[0]&&"center"===n[1]&&(o+=1),t.removeCSSClass("alignleft"),t.removeCSSClass("alignright"),t.removeCSSClass("aligncenter"),t.removeCSSClass("alignnone"),-1!==["left","right","center"].indexOf(n[1])&&t.addCSSClass("align"+n[1]),e.parent().attach(t,o)},ContentEdit.Image.droppers={Image:ContentEdit.Image._dropBoth,PreText:ContentEdit.Image._dropBoth,Static:ContentEdit.Image._dropBoth,Text:ContentEdit.Image._dropBoth},window.addEventListener("load",function(){for(var t=document.querySelector('[data-name="main-content"]'),e="a:not([data-ce-tag]) > img.alignright, a:not([data-ce-tag]) > img.alignleft, a:not([data-ce-tag]) > img.aligncenter, a:not([data-ce-tag]) > img.alignnone, p > img.alignright, p > img.alignleft, p > img.aligncenter, p > img.alignnone";t.querySelector(e);){var n=t.querySelector(e),o=n;if("A"===n.parentNode.tagName&&(o=n.parentNode,o.setAttribute("data-ce-tag","img")),"P"===o.parentNode.tagName){var i=o.parentNode,r=i.innerHTML.indexOf(o.outerHTML),s=r+o.outerHTML.length,a=i.innerHTML.substr(0,r).trim(),l=i.innerHTML.substr(s).trim(),d="",c;""!==a&&(c=i.cloneNode(),c.innerHTML=a,d+=c.outerHTML),d+=o.outerHTML,""!==l&&(c=i.cloneNode(),c.innerHTML=l,d+=c.outerHTML),i.outerHTML=d}}for(;t.querySelector('img ~ br, [data-ce-tag="img"] ~ br');)t.querySelector('img ~ br, [data-ce-tag="img"] ~ br').remove()}),wp.hooks.addFilter("pbs.save",function(t){return t=t.replace(/\sdata-ce-tag=["']img["']/g,""),t=t.replace(/(<a[^>]*)\sclass((\s|>)[^>]*>)/g,"$1$2"),t=t.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<p[^>]*>)/g,"$4$1"),t=t.replace(/(<[^pa][^>]*>\s*)(<img[^>]*>)/g,"$1<p>$2</p>"),t=t.replace(/(<[^p][^>]*>\s*)(<a[^>]+>\s*<img[^>]*>\s*<\/a>)/g,"$1<p>$2</p>"),t=t.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<br[^>]*>)*/g,"$1")}),ContentEdit.Text.prototype._lineBreakOrigKeyReturn=ContentEdit.Text.prototype._keyReturn,ContentEdit.Text.prototype._keyReturn=function(t){if(t.preventDefault(),!this.content.isWhitespace()){if(t.shiftKey||t.metaKey||t.ctrlKey){ContentSelect.Range.query(this._domElement);var e=ContentSelect.Range.query(this._domElement),n=this.content.substring(0,e.get()[0]),o=this.content.substring(e.get()[1]),i=e.get()[0]+1,r=new HTMLString.String("<br><br>",!0);return 0!==o.length()&&(r=new HTMLString.String("<br>",!0)),this.content=n.concat(r,o),this.updateInnerHTML(),e.set(i,i),this.selection(e),this.taint()}return this._lineBreakOrigKeyReturn(t)}},HTMLString.String.prototype.removeStyles=function(){var t,e,n,o,i,r,s,a;for(e=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],0>i&&(i=this.length()+i+1),0>e&&(e=this.length()+e),o=this.copy(),n=r=e;i>=e?i>r:r>i;n=i>=e?++r:--r)if(t=o.characters[n],t._tags.length)for(var l=t._tags.length-1;l>=0;l--)"a"!==t.tags()[l].name()&&o.characters[n].removeTags(t.tags()[l]);return o.optimize(),o},HTMLString.String.prototype.hasStyle=function(){var t,e,n,o,i,r=null;for(e=arguments[0],o=arguments[1],arguments.length>=3&&(r=arguments[2]),0>o&&(o=this.length()+o+1),0>e&&(e=this.length()+e),n=i=e;o>=e?o>i:i>o;n=o>=e?++i:--i)if(t=this.characters[n],t._tags.length)if(r){var s=window.cssToStyleObject(t.tags()[0].attr("style"));if("undefined"!=typeof s[r])return s[r]}else{if(-1!==["b","strong","i","em"].indexOf(t.tags()[0].name()))return!0;if(t.tags()[0].attr("style"))return!0}return!1},HTMLString.String.prototype.style=function(){var t,e,n,o,i,r,s,a,l;e=arguments[0],r=arguments[1],l=arguments[2],a=arguments[3],i=new HTMLString.Tag("span"),0>r&&(r=this.length()+r+1),0>e&&(e=this.length()+e);var d=document.createElement(l);for(d.style.display="none",document.body.appendChild(d),o=this.copy(),n=s=e;r>=e?r>s:s>r;n=r>=e?++s:--s){t=o.characters[n],t._tags.length||t.addTags(i);var c=!1;for(var u in t._tags)if("br"===t._tags[u].name()){c=!0;break}if(!c){var p=window.cssToStyleObject(t.tags()[0].attr("style"));for(var m in a){if(a[m]){"string"==typeof a[m]?a[m]=["",a[m]]:""!==a[m][0]&&a[m].unshift("");var h=a[m][a[m].length-1],g;for(var f in a[m]){g=a[m][f];var _="";g&&(_='style="'+m+": "+g+'"'),d.innerHTML="<span "+_+">"+t.c()+"</span>";var v=window.getComputedStyle(d.firstChild);if(v[m]===h)break}p[m]=g}else delete p[m];""===p[m]&&delete p[m]}o.characters[n]._tags[0].attr("style",window.cssToStyleString(p)),"span"===o.characters[n]._tags[0].name()&&""===o.characters[n]._tags[0].attr("style").trim()&&o.characters[n].removeTags()}}return document.body.removeChild(d),o.optimize(),o},HTMLString.String.prototype.getStyle=function(t,e){var n=t;t=t.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()});var o=e._domElement,i=this.html(),r=!1;if(0===i.indexOf("<"))for(var s in e._domElement.children)if(e._domElement.children[s].outerHTML===i){o=e._domElement.children[s],r=!0;break}if(!r&&0===i.indexOf("<")){var a=new RegExp("(<\\w+[^>]+style=[^>]*[^-]"+n+":\\s*)([\\w.]+)"),l=i.match(a);if(l)return l[2]}return getComputedStyle(o)[t]},ContentTools.DEFAULT_TOOLS=[["color","bold","italic","link","pbs-media","clear-formatting","underline","align-left","align-center","align-right"],["paragraph","h2","h3","h4","h5","h6","blockquote","preformatted","unordered-list","ordered-list","indent","unindent","table"],["margin-bottom-up","margin-bottom-down","margin-top-up","margin-top-down","margin-reset","font-up","font-down","line-height"],["add-element","add-element-list"],["row","column2","column3","column4","column233","column424"],["undo","redo","remove"],["toggle-advanced"]],window.PBSEditor.toolHeadings=[{index:0,label:"Text Formatting","class":"text-formatting"},{index:1,label:"Change Type","class":"change-type"},{index:2,label:"Adv Text & Image Formatting","class":"advanced-formatting"},{index:3,label:"Shortcodes","class":"shortcodes"},{index:4,label:"Rows & Columns","class":"rows-columns"},{index:5,label:"Actions","class":"actions"}],window.PBSEditor.advancedTools=["h4","h5","h6","table","preformatted","indent","unindent","pbs-advanced-formatting-group","pbs-rows-columns-group"],window.addEventListener("load",function(){var t=ContentTools.EditorApp.get();t.bind("stop",function(){document.querySelector("html").classList.remove("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")}),null===window.localStorage.getItem("ct-toolbox-position")&&window.localStorage.setItem("ct-toolbox-position","0,32");var e=ContentTools.EditorApp.get()._toolbox;e.__contain=e._contain,e._contain=function(){var t=e.__contain();return window.innerWidth-this._domElement.offsetWidth===parseInt(this._domElement.style.left,10)&&32===parseInt(this._domElement.style.top,10)?(document.querySelector("html").classList.add("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")):0===parseInt(this._domElement.style.left,10)&&32===parseInt(this._domElement.style.top,10)?(document.querySelector("html").classList.add("pbs-inspector-docked-left"),document.querySelector("html").classList.remove("pbs-inspector-docked-right")):(document.querySelector("html").classList.remove("pbs-inspector-docked-right"),document.querySelector("html").classList.remove("pbs-inspector-docked-left")),t};var n=function(t){var $=jQuery,e=$(this),n=this.scrollTop,o=this.scrollHeight,i=e.height(),r="DOMMouseScroll"===t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,s=r>0,a=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!s&&-r>o-i-n?(e.scrollTop(o),a()):s&&r>n?(e.scrollTop(0),a()):void 0};t.bind("start",function(){jQuery(".ct-toolbox").on("DOMMouseScroll mousewheel",n)}),t.bind("stop",function(){jQuery(".ct-toolbox").off("DOMMouseScroll mousewheel",n)})}),window.addEventListener("load",function(){ContentEdit.Root.get().bind("focus",function(t){var e=ContentTools.EditorApp.get();e._toolbox.addSection(t),window._inspectorOrigScrollTop&&(document.querySelector(".ct-toolbox").scrollTop=window._inspectorOrigScrollTop)}),ContentEdit.Root.get().bind("blur",function(){window._inspectorOrigScrollTop=document.querySelector(".ct-toolbox").scrollTop;var t=ContentTools.EditorApp.get();t._toolbox.clearSections()})}),ContentTools.ToolboxUI.prototype._pbsAddDesignMount=ContentTools.ToolboxUI.prototype.mount,ContentTools.ToolboxUI.prototype.mount=function(){for(var t=this._pbsAddDesignMount(),e=0;e<window.PBSEditor.toolHeadings.length;e++){var n=window.PBSEditor.toolHeadings[e],o=n.index,i=n.label,r="pbs-"+n["class"];if(document.querySelectorAll(".ct-toolbox .ct-tool-group")[o]){var s=document.querySelectorAll(".ct-toolbox .ct-tool-group")[o];s.classList.add(r+"-group");var a=document.createElement("div");a.innerHTML=i,a.classList.add("pbs-group-title"),a.classList.add(r+"-title"),s.insertBefore(a,s.firstChild)}}return t};var _pbsCreatedViews=[];ContentTools.ToolboxUI.prototype.addSectionOptions=function(t,e,n,o){"undefined"==typeof o&&(o=n.model);for(var i in PBSOption)if(e.type.toLowerCase()===i.toLowerCase()){var r=n.constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-"+e.id,s=document.createElement("DIV");s.classList.add("ct-tool"),"button"!==e.type.toLowerCase()&&s.classList.add("pbs-tool-option"),e["class"]&&s.setAttribute("class",s.getAttribute("class")+" "+e["class"]),s.classList.add("pbs-"+i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),s.setAttribute("id",r),t.appendChild(s);var a=new PBSOption[i]({optionSettings:e,model:o,el:s});return void _pbsCreatedViews.push(a.render())}},ContentTools.ToolboxUI.prototype.addGenericShortcodeOptions=function(t,e){var n,o,i,r;o=e.model.keys();for(i in o)r=o[i],"content"!==r&&(n=new PBSOption.GenericOption({attribute:r,model:e.model}),_pbsCreatedViews.push(n.render()),t.appendChild(n.el));e.model.get("content")&&(n=new PBSOption.GenericOption({attribute:"content",model:e.model}),_pbsCreatedViews.push(n.render()),t.appendChild(n.el))},ContentTools.ToolboxUI.prototype.addSection=function(t){var e,n,o=[];"undefined"==typeof this._domInspectorGroups&&(this._domInspectorGroups=[]),e=t;for(var i=[];e&&"Region"!==e.constructor.name;)"DivRow"===e.constructor.name?i.splice(i.length-1,0,e):i.push(e),e=e.parent();var r=[];for(n in i){e=i[n];var s=e.constructor.name,a,l;if(-1===r.indexOf(s)){if(r.push(s),"Shortcode"===s)l=e._domElement.getAttribute("data-base"),"undefined"!=typeof PBSShortcodes[e.sc_base]&&"undefined"!=typeof PBSShortcodes[e.sc_base].name&&(l=PBSShortcodes[e.sc_base].name);else{if("undefined"==typeof PBSShortcodes[s]||-1!==o.indexOf(s))continue;l=e.typeName(),"undefined"!=typeof PBSShortcodes[s].label&&(l=PBSShortcodes[s].label)}var d=this.constructor.createDiv(["ct-tool-group","pbs-inspector-group","pbs-"+e.cssTypeName()+"-group"]);this._domElement.appendChild(d),this._domInspectorGroups.push(d);var c=document.createElement("DIV");if(c.classList.add("pbs-group-title"),c.classList.add("pbs-"+e.cssTypeName()+"-title"),c.innerHTML=l+" Properties",d.insertBefore(c,d.firstChild),"Shortcode"===s){var u=e.sc_base,p=PBSShortcodes[u];if("undefined"!=typeof p&&"undefined"!=typeof p.hidden&&p.hidden)continue;if("undefined"!=typeof p&&"undefined"!=typeof p.options)for(n=0;n<p.options.length;n++)this.addSectionOptions(d,p.options[n],e);else this.addGenericShortcodeOptions(d,e)}else{if("undefined"==typeof PBSShortcodes[s]||-1!==o.indexOf(s))continue;for(a=new Backbone.Model({element:e}),n=0;n<PBSShortcodes[s].options.length;n++)this.addSectionOptions(d,PBSShortcodes[s].options[n],e,a)}}}},ContentTools.ToolboxUI.prototype.clearSections=function(){for(;_pbsCreatedViews.length>0;){var t=_pbsCreatedViews.pop();t.remove()}for(;this._domInspectorGroups.length;){var e=this._domInspectorGroups.shift();e.parentNode.removeChild(e)}};var PBSShortcodes={DivRow:{label:"Row",options:[{name:"Background Color",type:"colorButton",value:function(t){return t._domElement.style.backgroundColor},change:function(t,e){t.style("background-color",e)}},{name:"Row Width",id:"width",type:"button","class":"pbs-button-row-width",initialize:function(t,e){e.listenTo(e.model,"change",e.render)},render:function(t,e){for(var n=t,o=t._domElement;o&&o._ceElement;)o.classList.contains("pbs-row")&&(n=o._ceElement),o=o.parentNode;var i=n._domElement.getAttribute("data-width");i||(i=""),e.el.classList.remove("full"),e.el.classList.remove("full-retain"),"full-width"===i?e.el.classList.add("full"):"full-width-retain-content"===i&&e.el.classList.add("full-retain"),e.model.set(e.optionSettings.id,i)},click:function(t,e){for(var n=t,o=t._domElement;o&&o._ceElement;)o.classList.contains("pbs-row")&&(n=o._ceElement),o=o.parentNode;var i=n._domElement.getAttribute("data-width");i||(i=""),n.style("margin-left",""),n.style("margin-right",""),n.style("padding-left",""),n.style("padding-right",""),e.el.classList.remove("full"),e.el.classList.remove("full-retain"),"full-width"===i?i="":"full-width-retain-content"===i?(i="full-width",e.el.classList.add("full")):(i="full-width-retain-content",e.el.classList.add("full-retain")),n.attr("data-width",i),window._pbsFixRowWidth(n._domElement),n.taint(),e.model.set(e.optionSettings.id,i)},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Clone Row",type:"button","class":"pbs-button-clone",click:function(t){var e=t.clone();window._pbsFixRowWidth(e._domElement)},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Delete Row",type:"button","class":"ct-tool--remove",click:function(t){t.blurIfFocused(),t.parent().detach(t)},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Columns",type:"text",id:"columns","class":"pbs-option-inline pbs-option-large",initialize:function(t,e){delete e.events["keyup input"]},value:function(t){return t.getColumnEquation()},change:function(t,e){t.adjustColumns(e)}},{name:"Margins & Paddings",type:"marginsAndPaddings"},{name:"Border",type:"border"},{name:"Custom Class",type:"customClass",ignoredClasses:"pbs-[\\w-]+"},{name:"Custom ID",type:"customID"}]},DivCol:{label:"Column",options:[{name:"Background Color",type:"colorButton",value:function(t){return t._domElement.style.backgroundColor},change:function(t,e){t.style("background-color",e)}},{name:"Vertical Column Alignment",type:"button","class":"pbs-button-vertical-alignment",render:function(t,e){var n=t._domElement.style["align-self"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-start","flex-end","center"),n?(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")):n="auto (stretch)",e.el.setAttribute("data-tooltip",this.name+": "+n)},click:function(t,e){var n=t._domElement.style["align-self"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-start","flex-end","center"),"auto"!==n&&n?"flex-start"===n?n="center":"center"===n?n="flex-end":"flex-end"===n&&(n=""):n="flex-start",t.style("align-self",n),t.style("-ms-align-self",n),t.style("-webkit-align-self",n),n?(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")):n="auto (stretch)",e.el.setAttribute("data-tooltip",this.name+": "+n)},mouseenter:function(t,e){var n=t._domElement.style["align-self"];n||(n="auto (stretch)"),e.el.setAttribute("data-tooltip",this.name+": "+n),t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Vertical Content Alignment",type:"button","class":"pbs-button-vertical-content-alignment",render:function(t,e){var n=t._domElement.style["justify-content"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-start","flex-end","space-between","space-around","end","center"),n&&(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")),n||(n="flex-start"),e.el.setAttribute("data-tooltip",this.name+": "+n)},click:function(t,e){var n=t._domElement.style["justify-content"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-start","flex-end","space-between","space-around","end","center"),n="flex-start"!==n&&n?"center"===n?"flex-end":"flex-end"===n?"space-between":"space-between"===n?"space-around":"":"center",n&&(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")),t.style("justify-content",n),t.style("-ms-justify-content",n),t.style("-webkit-justify-content",n),n||(n="flex-start"),e.el.setAttribute("data-tooltip",this.name+": "+n)},mouseenter:function(t,e){var n=t._domElement.style["justify-content"];n||(n="flex-start"),e.el.setAttribute("data-tooltip",this.name+": "+n),t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Horizontal Content Alignment",type:"button","class":"pbs-button-horizontal-content-alignment",render:function(t,e){var n=t._domElement.style["align-items"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-end","flex-start"),n&&(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")),n||(n="stretch"),e.el.setAttribute("data-tooltip",this.name+": "+n)},click:function(t,e){var n=t._domElement.style["align-items"];e.el.classList.remove("ct-tool--applied"),e.el.classList.remove("flex-end","flex-start"),n="stretch"!==n&&n?"flex-start"===n?"flex-end":"":"flex-start",n&&(e.el.classList.add(n),e.el.classList.add("ct-tool--applied")),t.style("align-items",n),t.style("-ms-align-items",n),t.style("-webkit-align-items",n),n||(n="stretch"),e.el.setAttribute("data-tooltip",this.name+": "+n)},mouseenter:function(t,e){var n=t._domElement.style["align-items"];n||(n="stretch"),e.el.setAttribute("data-tooltip",this.name+": "+n),t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Add Column",type:"button","class":"pbs-button-add-column",click:function(t){t.parent().addNewColumn(t.parent().children.indexOf(t)+1)},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Clone Column",type:"button","class":"pbs-button-clone",click:function(t){t.clone().focus()},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Delete Column",type:"button","class":"ct-tool--remove",click:function(t){t.blurIfFocused(),t.parent().detach(t)},mouseenter:function(t){t._domElement.classList.add("ce-element--over")},mouseleave:function(t){t._domElement.classList.remove("ce-element--over")}},{name:"Margins & Paddings",type:"marginsAndPaddings"},{name:"Border",type:"border"},{name:"Custom Class",type:"customClass",ignoredClasses:"pbs-[\\w-]+"},{name:"Custom ID",type:"customID"}]},Text:{label:"Text",options:[{name:"Custom Class",type:"customClass"},{name:"Custom ID",type:"customID"}]},PreText:{label:"Text",options:[{name:"Custom Class",type:"customClass"},{name:"Custom ID",type:"customID"}]},List:{label:"List",options:[{name:"Custom Class",type:"customClass"},{name:"Custom ID",type:"customID"}]},Table:{label:"Table",options:[{name:"Custom Class",type:"customClass"},{name:"Custom ID",type:"customID"}]},Image:{label:"Image",options:[{name:"Custom Class",type:"customClass",ignoredClasses:"(align\\w+|wp-image-\\d+|size-\\w+)"},{name:"Custom ID",type:"customID"}]}};if(pbsParams.additional_shortcodes)for(var i in pbsParams.additional_shortcodes)PBSShortcodes[i]=pbsParams.additional_shortcodes[i];var PBSOption={};PBSOption.Button=Backbone.View.extend({events:{click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings","attribute")),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this)},render:function(){return this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name),this.optionSettings.render&&this.optionSettings.render(this.model.get("element"),this),this},click:function(){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),this)},mouseenter:function(){this.optionSettings.mouseenter&&this.optionSettings.mouseenter(this.model.get("element"),this)},mouseleave:function(){this.optionSettings.mouseleave&&this.optionSettings.mouseleave(this.model.get("element"),this)}}),PBSOption.ShowAdvanced=Backbone.View.extend({events:{"click button":"toggleAdvanced"},clicked:!1,initialize:function(t){_.extend(this,_.pick(t,"optionSettings","attribute","toggle"))},render:function(){var t={};return _.extend(t,this.model.attributes),_.extend(t,this.optionSettings),t.value=this.model.get(this.attribute),t.attr=this.attribute,this.$el.html("<button>Show advanced...</button>"),this},toggleAdvanced:function(){this.el.querySelector("button").innerHTML=this.clicked?"Show advanced...":"Hide advanced...",this.clicked=!this.clicked;var t=this.el.parentNode.querySelectorAll("."+this.optionSettings.toggle);Array.prototype.forEach.call(t,function(t){t.classList.toggle(this.optionSettings.toggle+"-show")}.bind(this))}}),PBSOption.GenericOption=Backbone.View.extend({template:wp.template("pbs-shortcode-generic-option"),className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings","attribute")),"content"===this.attribute&&(this.template=wp.template("pbs-shortcode-generic-content"))},render:function(){var t={};return _.extend(t,this.model.attributes),_.extend(t,this.optionSettings),t.value=this.model.get(this.attribute),t.attr=this.attribute,this.$el.html(this.template(t)),this},attributeChanged:function(t){this.model.set(this.attribute,t.target.value)}}),PBSOption.Border=Backbone.View.extend({template:wp.template("pbs-option-border"),events:{"change select":"styleChanged","change .width":"widthChanged","keyup .width":"widthChanged","change .radius":"radiusChanged","keyup .radius":"radiusChanged","click .pbs-color-preview":"togglePicker","change .pbs-color-popup input":"colorChanged","keyup .pbs-color-popup input":"colorChanged"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var t=this.model.attributes;_.extend(t,this.optionSettings),t.id=this.randomID;var e=window.getComputedStyle(this.model.get("element")._domElement),n=["border-color","border-style","border-width","border-radius"];for(var o in n)this.model.set(n[o],e[n[o]],{silent:!0});this.$el.html(this.template(t));var i=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){i.colorChanged()},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this},remove:function(){
jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.apply(this,arguments)},colorChanged:function(){var t=this.el.querySelector(".pbs-color-popup input").value,e=jQuery(this.el.querySelector("#"+this.randomID)).iris("color");("transparent"===t||""===t)&&(e=t),this.model.get("element").style("border-color",e),"transparent"===e&&(e=""),this.el.querySelector(".pbs-color-preview").style.background=e},styleChanged:function(t){this.model.get("element").style("border-style",t.target.value);var e="0px";"none"!==t.target.value&&(e="1px");var n=!0;parseInt(this.model.get("border-top-width"),10)&&(n=!1),parseInt(this.model.get("border-right-width"),10)&&(n=!1),parseInt(this.model.get("border-bottom-width"),10)&&(n=!1),parseInt(this.model.get("border-left-width"),10)&&(n=!1),(n&&"none"!==t.target.value||"none"===t.target.value)&&(this.model.set("border-top-width",e),this.model.set("border-right-width",e),this.model.set("border-bottom-width",e),this.model.set("border-left-width",e),this.model.get("element").style("border-width",e),this.model.trigger("change",this.model))},widthChanged:function(t){var e=t.target.value;isNaN(e)||""===e.trim()||(e+="px"),this.model.get("element").style("border-width",e)},radiusChanged:function(t){var e=t.target.value;isNaN(e)||""===e.trim()||(e+="px"),this.model.get("element").style("border-radius",e)},togglePicker:function(){"block"===this.el.querySelector(".pbs-color-popup").style.display?this.el.querySelector(".pbs-color-popup").style.display="":this.el.querySelector(".pbs-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""}}),PBSOption.Color=Backbone.View.extend({template:wp.template("pbs-option-color"),events:{"change input":"selectChanged","keyup input":"selectChanged","click .pbs-color-preview":"togglePicker"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var t=this.model.attributes;_.extend(t,this.optionSettings),t.id=this.randomID,t.value=this.optionSettings.value(this.model.get("element")),this.$el.html(this.template(t));var e=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){e.selectChanged()},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.apply(this,arguments)},selectChanged:function(){var t=this.el.querySelector("input"),e=jQuery(t).iris("color");(""===t.value||"transparent"===t.value)&&(e=t.value),this.optionSettings.change(this.model.get("element"),e),this.model.set(this.optionSettings.id,e),"transparent"===e&&(e=""),this.el.querySelector(".pbs-color-preview").style.background=e},togglePicker:function(){"block"===this.el.querySelector(".pbs-color-popup").style.display?this.el.querySelector(".pbs-color-popup").style.display="":this.el.querySelector(".pbs-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""}}),PBSOption.ColorButton=PBSOption.Color.extend({}),PBSOption.Select=Backbone.View.extend({template:wp.template("pbs-option-select"),events:{"change select":"selectChanged"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var t=this.model.attributes;return _.extend(t,this.optionSettings),t.value=this.optionSettings.value(this.model.get("element")),this.$el.html(this.template(t)),this},selectChanged:function(t){this.optionSettings.change(this.model.get("element"),t.target.value),this.model.set(this.optionSettings.id,t.target.value)}}),PBSOption.Text=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var t=this.model.attributes;return _.extend(t,this.optionSettings),t.value="",this.optionSettings.value&&(t.value=this.optionSettings.value(this.model.get("element"))),this.$el.html(this.template(t)),this},selectChanged:function(t){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),t.target.value),this.model.set(this.optionSettings.id,t.target.value)}}),PBSOption.Number=PBSOption.Text.extend({}),PBSOption.MarginsAndPaddings=Backbone.View.extend({template:wp.template("pbs-option-margins-and-paddings"),events:{"keyup input":"inputChanged","change input":"inputChanged","blur input":"fixBlankValue","keydown input":"incrementDecrementValue"},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.listenTo(this.model,"change",this.render)},render:function(){var t=this.model.get("element")._domElement,e=window.getComputedStyle(t),n=["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left"];for(var o in n)t.style[n[o]]?this.model.set(n[o],t.style[n[o]],{silent:!0}):this.model.set(n[o],e[n[o]],{silent:!0});"full-width-retain-content"===t.getAttribute("data-width")||"full-width"===t.getAttribute("data-width")?("full-width-retain-content"===this.model.get("width")?this.model.set("disableHorizontalPaddings",!0):this.model.unset("disableHorizontalPaddings"),"full-width-retain-content"===this.model.get("width")||"full-width"===this.model.get("width")?this.model.set("disableHorizontalMargins",!0):this.model.unset("disableHorizontalMargins")):(this.model.unset("disableHorizontalPaddings"),this.model.unset("disableHorizontalMargins"));var i=this.model.attributes;return _.extend(i,this.optionSettings),this.$el.html(this.template(i)),this},inputChanged:function(t){var e=t.target.value,n=t.target.getAttribute("data-style");isNaN(e)||""===e.trim()||(e+="px"),this.model.get("element").style(n,e),this.model.set(n,e,{silent:!0})},incrementDecrementValue:function(t){var e=/^(\-?\d+)([^\d]*)$/,n=e.exec(t.target.value);!n||38!==t.which&&40!==t.which||(38===t.which?(n[1]++,(t.ctrlKey||t.metaKey||t.shiftKey)&&(n[1]++,n[1]++,n[1]++,n[1]++)):(n[1]--,(t.ctrlKey||t.metaKey||t.shiftKey)&&(n[1]--,n[1]--,n[1]--,n[1]--)),t.target.value=n[1]+n[2],t.target.dispatchEvent(new Event("change")))},fixBlankValue:function(t){var e=t.target.getAttribute("data-style"),n=e.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()}),o=this.model.get("element")._domElement.style[n];if(!o){var i=window.getComputedStyle(this.model.get("element")._domElement);o=i[e]}t.target.value=o,this.model.set(e,o,{silent:!0})}}),PBSOption.CustomClass=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getClasses:function(){var t=this.model.get("element");if("undefined"==typeof t.attr("class"))return"";var e=t.attr("class");if(this.optionSettings.ignoredClasses){var n=e.trim().split(" ");e="",this.staticClasses=[];var o=new RegExp(this.optionSettings.ignoredClasses,"i");for(var i in n)o.test(n[i])?this.staticClasses.push(n[i]):(e+=0===e.length?"":" ",e+=n[i])}return e},change:function(t,e){var n;if(e=e.toLowerCase(),"undefined"!=typeof t.attr("class")){var o=t.attr("class").split(" ");for(n in o)t.removeCSSClass(o[n])}if(""!==e.trim()){var i=e.trim().split(" ");for(n in i)t.addCSSClass(i[n])}if(this.staticClasses.length)for(n in this.staticClasses)t.addCSSClass(this.staticClasses[n]);t.taint()},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getClasses(this.model.get("element")))},render:function(){var t=this.model.attributes;return _.extend(t,this.optionSettings),t.value=this.getClasses(this.model.get("element")),this.$el.html(this.template(t)),this},selectChanged:function(t){this.change(this.model.get("element"),t.target.value),this.model.set(this.optionSettings.id,t.target.value)}}),PBSOption.CustomID=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getID:function(){var t=this.model.get("element");return"undefined"==typeof t.attr("id")?"":t.attr("id")},change:function(t,e){t.attr("id",e),t.taint()},initialize:function(t){_.extend(this,_.pick(t,"optionSettings")),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getID(this.model.get("element")))},render:function(){var t=this.model.attributes;return _.extend(t,this.optionSettings),t.value=this.getID(this.model.get("element")),this.$el.html(this.template(t)),this},selectChanged:function(t){this.change(this.model.get("element"),t.target.value),this.model.set(this.optionSettings.id,t.target.value)}}),ContentTools.Tools.AddElement=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"add-element"),e.label="Add Element",e.icon="add-element",e.canApply=function(){return!0},e.isApplied=function(){return"block"===document.querySelector(".ct-tool--add-element-list").style.display},e.apply=function(t,e,n){return n(!0)},e}(ContentTools.Tool),ContentTools.ToolUI.prototype._addElementAddDOMEventListeners=ContentTools.ToolUI.prototype._addDOMEventListeners,ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("AddElement"===this.tool.name)this._domElement.addEventListener("mousedown",function(t){t.target.classList.contains("ct-tool")&&t.preventDefault()}),this._domElement.addEventListener("click",function(t){if(t.target.classList.contains("ct-tool")){var e=ContentTools.EditorApp.get()._toolbox._toolUIs["add-element-list"];"undefined"!=typeof e&&e.tool.toggleList()}});else{if("AddElementList"!==this.tool.name)return this._addElementAddDOMEventListeners();this._domElement.addEventListener("mousedown",function(t){t.target.classList.contains("ct-tool")&&t.preventDefault()})}},ContentTools.Tools.AddElementList=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"add-element-list"),e.label="Add Element",e.type="add-element-list",e.icon="add-element-list",e.label="",e.canApply=function(){return!0},e.isApplied=function(){return!1},e._addElementListMount=function(){},e.createInsertedShortcode=function(t){var e={tag:t,type:"closed",content:"",attrs:{}};if(PBSShortcodes[t]&&PBSShortcodes[t].options)for(var n in PBSShortcodes[t].options){var o=PBSShortcodes[t].options[n];o.id&&o["default"]&&(e.attrs[o.id]=o["default"])}return new wp.shortcode(e).string()},e.toggleList=function(){this._ceElement._domElement.children.length?this.hideList():this.showList()},e._onClick=function(t){var e=ContentEdit.Root.get();if(e.focused()){for(var n=t.target;!n.getAttribute("data-shortcode")&&n.parentNode;)n=n.parentNode;var o=n.getAttribute("data-shortcode"),i=this.createInsertedShortcode(o),r=wp.shortcode.next(o,i,0),s=ContentEdit.Shortcode.createShortcode(r),a=e.focused().parent().children.indexOf(e.focused());e.focused().parent().attach(s,a+1),s.ajaxUpdate(!0),e.focused()._dontCloseAddElementList=!0,s.focus()}},e.showList=function(){for(var t in pbsParams.shortcodes){var e=pbsParams.shortcodes[t],n=document.createElement("DIV");if(n.classList.add("pbs-add-element-sc"),n.setAttribute("data-shortcode",e),!PBSShortcodes[e]||"undefined"==typeof PBSShortcodes[e].hidden||!PBSShortcodes[e].hidden){if(PBSShortcodes[e]&&PBSShortcodes[e].icon){var o=document.createElement("div");o.setAttribute("style","background-image: url("+PBSShortcodes[e].icon+")"),o.classList.add("pbs-shortcode-icon"),n.appendChild(o)}var i=document.createElement("h4");if(i.innerHTML=e,PBSShortcodes[e]&&PBSShortcodes[e].name&&(i.innerHTML=PBSShortcodes[e].name),n.appendChild(i),PBSShortcodes[e]&&PBSShortcodes[e].desc){var r=document.createElement("p");r.classList.add("pbs-shortcode-desc"),r.innerHTML=PBSShortcodes[e].desc,n.appendChild(r)}n.addEventListener("click",this._onClick.bind(this)),this._ceElement._domElement.appendChild(n)}}this._ceElement._domElement.style.display="block"},e.hideList=function(){for(this._ceElement._domElement.style.display="";this._ceElement._domElement.firstChild;)this._ceElement._domElement.removeChild(this._ceElement._domElement.firstChild)},e}(ContentTools.Tool),ContentTools.ToolUI.prototype._addElementMountOverride=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(t,e){var n=this._addElementMountOverride(t,e);return this.tool._ceElement=this,"undefined"!=typeof this.tool._addElementListMount&&this.tool._addElementListMount(),n},ContentTools.ToolUI.prototype._addElementUnmountOverride=ContentTools.ToolUI.prototype.unmount,ContentTools.ToolUI.prototype.unmount=function(t,e){var n=this._addElementUnmountOverride(t,e);return this.tool._ceElement=this,"undefined"!=typeof this.tool._addElementListUnmount&&this.tool._addElementListUnmount(),n},ContentEdit.Root.get().bind("blur",function(t){var e=ContentTools.EditorApp.get()._toolbox._toolUIs["add-element-list"];if("undefined"!=typeof e){if(t._dontCloseAddElementList)return void(t._dontCloseAddElementList=void 0);e.tool.hideList()}}),window.addEventListener("load",function(){var t=new PBS.Toolbar;t.init(),ContentTools.EditorApp.get().bind("start",function(){t.start()}),ContentTools.EditorApp.get().bind("stop",function(){t.stop()})}),PBS.Toolbar=function(){function t(){this._domElement=null,this.tools=[]}return t.prototype.init=function(){this._domElement=document.createElement("DIV"),this._domElement.classList.add("pbs-toolbar"),this._offsetAdminBar=document.querySelector("#wpadminbar").offsetHeight,document.body.appendChild(this._domElement),this._addEventListeners(),this._onMouseOverBound=this._onMouseOver.bind(this),this._onMouseMoveBound=this._onMouseMove.bind(this),this._onMouseOutBound=this._onMouseOut.bind(this),this._updatePositionBound=this._updatePosition.bind(this)},t.prototype._addEventListeners=function(){this._domElement.addEventListener("mouseout",function(t){this._parent!==t.relatedTarget&&this._onMouseOut(t)}.bind(this)),this._domElement.addEventListener("mouseout",function(t){t.relatedTarget&&t.relatedTarget.dispatchEvent(new Event("mouseover"))}),ContentEdit.Root.get().bind("drag",function(){this.hide()}.bind(this)),ContentEdit.Root.get().bind("blur",function(){this.hide()}.bind(this))},t.prototype._onMouseOver=function(t){var e=document.querySelector("[data-editable]");if(e.contains(t.target)&&!(t.relatedTarget&&(t.relatedTarget.classList.contains("pbs-toolbar")||t.relatedTarget.classList.contains("pbs-tool"))||ContentEdit.Root.get().dragging())){var n=wp.hooks.applyFilters("pbs.has_toolbar_selectors",[]);this._clearTools();for(var o in n){var i=n[o].split(",").join(" *,").concat(" *,"+n[o]);if(pbsSelectorMatches(t.target,i))return this._parent=t.target,void(this._addTools(t.target)&&(this._domElement.classList.add("pbs-show"),this._domElement.style.opacity=1,this._updatePosition()))}}},t.prototype._onMouseMove=function(t){this._parent&&(this._domElement.classList.contains("pbs-show")||this._onMouseOver(t),this._updatePosition())},t.prototype._onMouseOut=function(t){t.relatedTarget&&(t.relatedTarget.classList.contains("pbs-toolbar")||t.relatedTarget.classList.contains("pbs-tool"))||this.hide()},t.prototype._addTools=function(t){var e=wp.hooks.applyFilters("pbs.toolbar_tools",[],this._domElement,t);if(e.length){for(;this._domElement.firstChild;)this._domElement.removeChild(this._domElement.firstChild);for(var n in e)this._domElement.appendChild(e[n]),this.tools.push(e[n]),this.tools[this.tools.length-1].addEventListener("click",this._updatePositionBound);return e.length}},t.prototype._updatePosition=function(){var t=this._parent.getBoundingClientRect(),e=getComputedStyle(document.querySelector("html"));this._domElement.style.left=t.right-t.width/2-this._domElement.offsetWidth/2-parseInt(e["margin-left"],10)+"px",this._domElement.style.top=t.top+window.pageYOffset-this._offsetAdminBar-this._domElement.offsetHeight+1+"px"},t.prototype.start=function(){document.addEventListener("mouseover",this._onMouseOverBound),document.addEventListener("mousemove",this._onMouseMoveBound),document.addEventListener("mouseout",this._onMouseOutBound)},t.prototype.stop=function(){document.removeEventListener("mouseover",this._onMouseOverBound),document.removeEventListener("mousemove",this._onMouseMoveBound),document.removeEventListener("mouseout",this._onMouseOutBound)},t.prototype._clearTools=function(){for(var t in this.tools)this.tools[t].removeEventListener("click",this._updatePositionBound);for(;this._domElement.firstChild;)this._domElement.removeChild(this._domElement.firstChild);this.tools=[]},t.prototype.hide=function(){this._domElement.classList.remove("pbs-show"),this._clearTools()},t}(),ContentTools.Tools.Heading1=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h1"),e.label="H1",e.icon="h1",e.tagName="h1",e.canApply=function(t,e){return"ListItemText"===t.constructor.name?!1:"TableCellText"===t.constructor.name?!1:ContentTools.Tools.Paragraph.canApply(t,e)},e.apply=function(t,n,o){return this.isApplied(t)?(t.tagName("p"),void t.taint()):e.__super__.constructor.apply.call(this,t,n,o)},e.isApplied=function(t){return t.tagName()===this.tagName},e}(ContentTools.Tools.Heading),ContentTools.Tools.Heading2=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h2"),e.label="H2",e.icon="h2",e.tagName="h2",e}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading3=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h3"),e.label="H3",e.icon="h3",e.tagName="h3",e}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading4=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h4"),e.label="H4",e.icon="h4",e.tagName="h4",e}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading5=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h5"),e.label="H5",e.icon="h5",e.tagName="h5",e}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading6=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"h6"),e.label="H6",e.icon="h6",e.tagName="h6",e}(ContentTools.Tools.Heading1),ContentTools.Tools.Blockquote=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"blockquote"),e.label="Blockquote",e.icon="blockquote",e.tagName="blockquote",e}(ContentTools.Tools.Heading1),ContentTools.Tools.ClearFormatting=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"clear-formatting"),e.label="Clear Formatting",e.icon="clear-formatting",e.tagName="span",e.canApply=function(t,e){if(!ContentTools.Tools.Bold.canApply(t,e))return!1;var n=0,o=0,i;return void 0!==t.content&&t.content.length()?(e&&(i=e.get(),n=i[0],o=i[1]),n===o&&(n=0,o=t.content.length()),t.content.hasStyle(n,o)):!1},e.apply=function(t,e,n){var o,i,r;return t.storeState(),r=e.get(),o=r[0],i=r[1],o===i&&(o=0,i=t.content.length()),t.content=t.content.removeStyles(o,i),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Color=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"color"),e.label="Color",e.icon="color",e.tagName="span",e.canApply=function(t,e){if(!t.content)return!1;var n,o,i=e&&!e.isCollapsed(),r="";if(i){var s=e.get();n=s[0],o=s[1],n===o&&(o+=1)}else n=0,o=t.content.length();var a=t.content.slice(n,o).html(),l=a.match(/^<span[^>]style[^>]+['"\s;]color:\s?([#().,\w]+)/);if(l&&(r=l[1]),!r){if("undefined"==typeof this._defaultBodyTextColor){var d=getComputedStyle(document.body);this._defaultBodyTextColor=d.color}r=this._defaultBodyTextColor}return this._ceElement._domElement.style.backgroundColor!==r&&(this._ceElement._domElement.style.backgroundColor=r),r?window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+r):window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label),!0},e.isApplied=function(){return!1},e.apply=function(t,e,n){var o,i,r;t.storeState(),this.rememberedSelection&&(e=this.rememberedSelection),r=e.get(),o=r[0],i=r[1],o===i&&(o=0,i=t.content.length());var s=jQuery(this._ceElement._domElement.querySelector("input")).iris("color");return""===this._ceElement._domElement.querySelector("input").value&&(s=""),t.content=t.content.style(o,i,t._tagName,{color:s}),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e._colorPickerMount=function(){var t=this,e=document.createElement("DIV"),n=document.createElement("INPUT");n.addEventListener("mousedown",function(){var e=ContentEdit.Root.get().focused(),n=null;e.selection&&(n=e.selection());var o=n.get(),i=o[0],r=o[1];(0!==i||0!==r)&&(t.rememberedSelection=n)}),n.addEventListener("keyup",function(e){""===e.target.value&&(t.selectedColor=e.target.value,t._ceElement._mouseDown=!0,t._ceElement._onMouseUp(),jQuery(t._ceElement._domElement.querySelector("input")).iris("color",t.selectedColor))}),n.addEventListener("blur",function(){t._ceElement._domElement.querySelector("input").focus()}),n.classList.add("color-picker"),n.setAttribute("data-alpha","true"),e.appendChild(n),this._ceElement._domElement.appendChild(e),jQuery(n).iris({defaultColor:this._ceElement._domElement.style.backgroundColor,change:function(e){t._ceElement._justShowedPicker||(t.selectedColor=e.target.value,t._ceElement._mouseDown=!0,t._ceElement._onMouseUp(e)),t._ceElement._justShowedPicker=void 0},clear:function(){},hide:!1,palettes:["#000","#fff","#CF000F","#F89406","#F9BF3B","#2ECC71","#19B5FE","#8E44AD"]}),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){t.hidePicker()})},e.hidePicker=function(){this._ceElement._domElement.firstChild.style.display="",this.rememberedSelection=null},e}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var t=ContentTools.EditorApp.get()._toolbox._toolUIs.color;"undefined"!=typeof t&&t.tool.hidePicker()}),ContentTools.ToolUI.prototype._colorPickerMountOverride=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(t,e){var n=this._colorPickerMountOverride(t,e);return this.tool._ceElement=this,"undefined"!=typeof this.tool._colorPickerMount&&this.tool._colorPickerMount(),n},ContentTools.ToolUI.prototype._toolColorAddDOMEventListeners=ContentTools.ToolUI.prototype._addDOMEventListeners,ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if("Color"!==this.tool.name)return this._toolColorAddDOMEventListeners();var t=this;this._domElement.addEventListener("mousedown",function(t){t.target.classList.contains("ct-tool")&&t.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){t._domElement.querySelector("input").value=t._domElement.style.backgroundColor,t._justShowedPicker=!0,jQuery(t._domElement.querySelector("input")).iris("color",t._domElement.style.backgroundColor),t._domElement.firstChild.style.display=t._domElement.firstChild.style.display?"":"block";var n=t._domElement.querySelectorAll(".iris-palette");Array.prototype.forEach.call(n,function(t){"undefined"==typeof t._pbsInitDone&&(t._pbsInitDone=!0,t.addEventListener("mousedown",function(t){t.preventDefault()}))})}})},ContentTools.Tools.Row=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"row"),e.label="Add Row",e.icon="row",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column2=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column2"),e.label="Add a 2-Column Row",e.icon="column-2",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column3=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column3"),e.label="Add a 3-Column Row",e.icon="column-3",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column4=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column4"),e.label="Add a 4-Column Row",e.icon="column-4",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column233=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column233"),e.label="Add a 2/3 1/3 Column Row",e.icon="column-23-3",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),i.style("flex-grow","2"),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column323=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column323"),e.label="Add a 1/3 2/3 Column Row",e.icon="column-3-23",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),i.style("flex-grow","2"),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Column424=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column424"),e.label="Add a 1/4 1/2 1/4 Column Row",e.icon="column-4-2-4",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),i.style("flex-grow","2"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),t.blur(),r.focus(),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.ColumnCustom=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"column-custom"),e.label="Add an N-Column Row",e.icon="column-custom",e.tagName="div",e.canApply=function(){return!0},e.apply=function(t,e,n){var o=new ContentEdit.DivRow("div"),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),s=t.parent().children.indexOf(t);return t.parent().attach(o,s+1),o.attach(i),i.attach(r),t.blur(),r.focus(),i=new ContentEdit.DivCol("div"),r=new ContentEdit.Text("p",{},""),o.attach(i),i.attach(r),o.showOutline(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.FontUp=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"font-up"),e.label="Increase font size",e.icon="font-up",e.tagName="span",e.canApply=function(t,e){return ContentTools.Tools.Bold.canApply(t,e)},e.isApplied=function(t,e){var n=0,o=0,i;if(void 0===t.content||!t.content.length())return!1;e&&(i=e.get(),n=i[0],o=i[1]),n===o&&(n=0,o=t.content.length());var r=parseInt(t.content.substring(n,o).getStyle("font-size",t),10);return window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+r+"px"),t.content.hasStyle(n,o,"font-size")},e.doHold=function(t,e){return this.apply(t,e,function(){})},e.apply=function(t,e,n){var o,i,r;t.storeState(),r=e.get(),o=r[0],i=r[1],o===i&&(o=0,i=t.content.length());var s=parseInt(t.content.substring(o,i).getStyle("font-size",t),10)+1,a={"font-size":s+"px"};return t.content=t.content.style(o,i,t._tagName,a),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.FontDown=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"font-down"),e.label="Decrease font size",e.icon="font-down",e.tagName="span",e.canApply=function(t,e){return ContentTools.Tools.Bold.canApply(t,e)},e.apply=function(t,e,n){var o,i,r;t.storeState(),r=e.get(),o=r[0],i=r[1],o===i&&(o=0,i=t.content.length());var s=parseInt(t.content.substring(o,i).getStyle("font-size",t),10)-1;1>s&&(s=1);var a={"font-size":s+"px"};return t.content=t.content.style(o,i,t._tagName,a),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e}(ContentTools.Tools.FontUp),ContentTools.Tools.Link._pbsToolLinkOverrideCanApply=ContentTools.Tools.Link.canApply,
ContentTools.Tools.Link.canApply=function(t,e){var n=this._pbsToolLinkOverrideCanApply(t,e);if(!n&&t.content&&e){var o=e.get(),i=o[0],r=o[1];if(i===r)return!0}return n},ContentTools.Tools.Link.getSelectedLink=function(t,e,n){if(e<t.content.characters.length&&e>=0&&t.content.characters[e].hasTags("a"))for(;e>0;)if(e--,!t.content.characters[e].hasTags("a")){e++;break}if(n<t.content.characters.length&&n>=0&&t.content.characters[n].hasTags("a"))for(;n<t.content.characters.length&&t.content.characters[n].hasTags("a");)n++;return{from:e,to:n}},ContentTools.Tools.Link.apply=function(t,e,n){if("Image"===t.constructor.name)return void t.openMediaManager();var o=e.get(),i=o[0],r=o[1],s=this.getSelectedLink(t,i,r);i=s.from,r=s.to,e=new ContentSelect.Range(i,r);var a=this.getTag(t,e),l="",d="",c="";return a&&(a.attr("href")&&(l=a.attr("href")),a.attr("target")&&(d=a.attr("target"))),c=t.content.unformat(i,r,"a"),c=c.slice(i,r),wpLink.open("dummy-wplink-textarea"),c.html()===c.text()?(document.querySelector("#wp-link-wrap").classList.add("has-text-field"),c=c.text()):(document.querySelector("#wp-link-wrap").classList.remove("has-text-field"),c=""),document.querySelector("#wp-link-url").value=l,document.querySelector("#wp-link-text").value=c,document.querySelector("#wp-link-target").checked=""!==d,window._pbsCurrentLink={element:t,selection:e},n(!0)},window.addEventListener("load",function(){document.addEventListener("click",function(t){if("wp-link-submit"===t.target.getAttribute("id")){var e=window._pbsCurrentLink.element,n=window._pbsCurrentLink.selection,o=n.get(),i=o[0],r=o[1];e.content=e.content.unformat(i,r,"a");var s=document.querySelector("#wp-link-url").value,a=document.querySelector("#wp-link-text").value,l=document.querySelector("#wp-link-target").checked;if(s){var d={href:s};if(l&&(d.target="_blank"),document.querySelector("#wp-link-wrap").classList.contains("has-text-field")&&""===a.trim()&&(a=s),a){var c=new HTMLString.String(a,"PreText"===e.constructor.name);c=c.format(0,c.characters.length,new HTMLString.Tag("a",d));var u=e.content.substring(0,n.get()[0]),p=e.content.substring(n.get()[1]);e.content=u.concat(c),e.content=e.content.concat(p,!1)}else e.content=e.content.format(i,r,new HTMLString.Tag("a",d));e.updateInnerHTML(),e.taint()}else e.content=e.content.unformat(i,r,"a"),e.updateInnerHTML(),e.taint();delete window._pbsCurrentLink,wpLink.close()}})}),ContentTools.Tools.Link.getTag=function(t,e){var n,o,i,r,s,a,l,d,c,u,p,m;if("Image"===t.constructor.name){if(t.a)return t.a}else for(u=e.get(),o=u[0],s=u[1],i=t.content.slice(o,s),p=i.characters,a=0,d=p.length;d>a;a++)if(n=p[a],n.hasTags("a"))for(m=n.tags(),l=0,c=m.length;c>l;l++)if(r=m[l],"a"===r.name())return r;return null},ContentTools.Tools.LineHeight=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"line-height"),e.label="Line Height",e.icon="line-height",e.tagName="span",e.canApply=function(t,e){return ContentTools.Tools.Bold.canApply(t,e)},e.isApplied=function(t){if(void 0===t.content||!t.content.length())return!1;var e=this.getCurrentLineHeight(t);return window.PBSEditor.getToolUI("line-height")._domElement.setAttribute("data-tooltip",this.label+": "+e+"em"),this.getDefaultLineHeight(t)!==e},e.getDefaultLineHeight=function(t){var e=t.defaultStyle("line-height");if(e){var n=window.getComputedStyle(t._domElement);e=-1!==e.indexOf("px")?parseInt(e,10)/parseInt(n["font-size"],10):parseFloat(e),e=Math.round(10*e)/10}return e},e.getCurrentLineHeight=function(t){var e=t.style("line-height");if(-1!==e.indexOf("em"))e=parseFloat(e);else{var n=window.getComputedStyle(t._domElement);e=parseInt(e,10)/parseInt(n["font-size"],10)}return Math.round(10*e)/10},e.apply=function(t,e,n){t.storeState();var o=2.5,i=1,r=this.getCurrentLineHeight(t);return r+=.1,r>o&&(r=i),r=Math.round(10*r)/10,this.getDefaultLineHeight(t)===r?r="":r+="em",t.style("line-height",r),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.MarginBase=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.label="Increase Bottom Margin",e.icon="margin-bottom-up",e.style="margin-bottom",e.increment="up",e.tagName="span",e.canApply=function(t,e){return"Image"===t.constructor.name?!0:ContentTools.Tools.Bold.canApply(t,e)},e.isApplied=function(t){var e=t.style(this.style);window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+e);var n=parseInt(t.defaultStyle(this.style),10),o=parseInt(e,10);return"up"===this.increment?o>n:n>o},e.doHold=function(t,e){return this.apply(t,e,function(){})},e.apply=function(t,e,n){var o=parseInt(t.defaultStyle(this.style),10),i=parseInt(t.style(this.style),10);return"up"===this.increment?i++:i--,i!==o?t.style(this.style,i+"px"):t.style(this.style,""),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.MarginBottomUp=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"margin-bottom-up"),e.label="Increase Bottom Margin",e.icon="margin-bottom-up",e.tagName="span",e.style="margin-bottom",e.increment="up",e}(ContentTools.Tools.MarginBase),ContentTools.Tools.MarginBottomDown=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"margin-bottom-down"),e.label="Decrease Bottom Margin",e.icon="margin-bottom-down",e.style="margin-bottom",e.increment="down",e}(ContentTools.Tools.MarginBase),ContentTools.Tools.MarginTopUp=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"margin-top-up"),e.label="Increase Top Margin",e.icon="margin-top-up",e.style="margin-top",e.increment="up",e}(ContentTools.Tools.MarginBase),ContentTools.Tools.MarginTopDown=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"margin-top-down"),e.label="Decrease Top Margin",e.icon="margin-top-down",e.style="margin-top",e.increment="down",e}(ContentTools.Tools.MarginBase),ContentTools.Tools.MarginReset=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"margin-reset"),e.label="Reset Margins",e.icon="margin-reset",e.tagName="span",e.canApply=function(t,e){var n=!1;if("Image"===t.constructor.name&&(n=!0),n||(n=ContentTools.Tools.Bold.canApply(t,e)),!n)return!1;var o=t.style("margin-bottom"),i=parseInt(t.defaultStyle("margin-bottom"),10),r=parseInt(o,10);return i!==r?!0:(o=t.style("margin-top"),i=parseInt(t.defaultStyle("margin-top"),10),r=parseInt(o,10),i!==r?!0:!1)},e.isApplied=function(){return!1},e.apply=function(t,e,n){return t.style("margin-top",""),t.style("margin-bottom",""),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.pbsMedia=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"pbs-media"),e.label="Media",e.icon="image",e.canApply=function(t,e){return ContentTools.Tools.Heading.canApply(t,e)},e.apply=function(t,e){var n=ContentEdit.Root.get(),o=n.focused();ContentSelect.Range.query(o._domElement),e=ContentSelect.Range.query(o._domElement),window._tempSelection=e,window._pbsAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.pbsAddMediaOverrideInsert,wp.media.editor.open()},e.pbsAddMediaOverrideInsert=function(t){var e=ContentEdit.Root.get();if(e.focused()){var n=e.focused(),o=!1;if(!t.match(/^\[/)){var i=document.createElement("p");i.innerHTML=t;var r=ContentEdit.Image.fromDOMElement(i.firstChild);if(r){var s=n.parent().children.indexOf(n);n.parent().attach(r,s+1),o=!0}}if(!o){var a=n.content.substring(0,window._tempSelection.get()[0]),l=n.content.substring(window._tempSelection.get()[1]);n.content=a.concat(new HTMLString.String(t,!0)),n.content=n.content.concat(l,!1),n.updateInnerHTML(),n.taint(),"undefined"!=typeof n.convertShortcodes&&t.match(/\[\w+[^\]]*\]/)&&n.convertShortcodes()}}wp.media.editor.insert=window._pbsAddMediaOrigInsert},e}(ContentTools.Tool),ContentTools.Tools.ToggleAdvanced=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"toggle-advanced"),e.type="toggle-advanced",e}(ContentTools.Tool),ContentTools.ToolUI.prototype._columnOverrideMount=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(t,e){var n=this._columnOverrideMount(t,e);return"toggle-advanced"===this.tool.type&&(this._domElement.classList.add("pbs-toggle-advanced"),this._domElement.innerHTML="More Tools","1"===window.localStorage.getItem("pbs-show-advanced")&&(this._domElement.innerHTML="Less Tools",document.querySelector(".ct-toolbox").classList.toggle("pbs-show-advanced")),this._domElement.addEventListener("click",function(){document.querySelector(".ct-toolbox").classList.toggle("pbs-show-advanced"),document.querySelector(".ct-toolbox").classList.contains("pbs-show-advanced")?(this._domElement.innerHTML="Less Tools",window.localStorage.setItem("pbs-show-advanced","1")):(this._domElement.innerHTML="More Tools",window.localStorage.removeItem("pbs-show-advanced"))}.bind(this))),n},ContentTools.ToolboxUI.prototype._pbsToggleAdvOverrideMount=ContentTools.ToolboxUI.prototype.mount,ContentTools.ToolboxUI.prototype.mount=function(){var t=this._pbsToggleAdvOverrideMount();for(var e in window.PBSEditor.advancedTools){var n=window.PBSEditor.advancedTools[e],o=window.PBSEditor.getToolUI(n);o?o._domElement.classList.add("pbs-advanced-tool"):document.querySelector("."+n).classList.add("pbs-advanced-tool")}return t},ContentTools.Tools.AlignCenter.className="",ContentTools.Tools.AlignCenter.apply=function(t,e,n){var o;return("ListItemText"===(o=t.constructor.name)||"TableCellText"===o)&&(t=t.parent()),t.style("textAlign","center"),n(!0)},ContentTools.Tools.AlignLeft.className="",ContentTools.Tools.AlignLeft.apply=function(t,e,n){var o;return("ListItemText"===(o=t.constructor.name)||"TableCellText"===o)&&(t=t.parent()),t.style("textAlign","left"),n(!0)},ContentTools.Tools.AlignRight.className="",ContentTools.Tools.AlignRight.apply=function(t,e,n){var o;return("ListItemText"===(o=t.constructor.name)||"TableCellText"===o)&&(t=t.parent()),t.style("textAlign","right"),n(!0)},ContentTools.Tools.Heading._canApply=ContentTools.Tools.Heading.canApply,ContentTools.Tools.Heading.canApply=function(t,e){var n=ContentTools.Tools.Heading._canApply(t,e);return"ListItemText"===t.constructor.name?!1:void 0!==t.content&&t.parent().tagName?n||"div"===t.parent().tagName():n},ContentTools.Tools.Paragraph.isApplied=function(t){return t.tagName()===this.tagName},ContentTools.Tools.UnorderedList.canApply=function(t,e){var n=ContentTools.Tools.Heading1.canApply(t,e);return t.parent()&&t.parent().tagName&&"li"===t.parent().tagName()?!0:n},ContentTools.Tools.OrderedList.canApply=ContentTools.Tools.UnorderedList.canApply,ContentTools.Tools.UnorderedList.isApplied=function(t){return t.parent().parent()&&t.parent().parent().tagName&&t.parent().parent().tagName()===this.listTag?!0:!1},ContentTools.Tools.OrderedList.isApplied=ContentTools.Tools.UnorderedList.isApplied,ContentTools.Tools.UnorderedList._pbsOverrideApply=ContentTools.Tools.UnorderedList.apply,ContentTools.Tools.UnorderedList.apply=function(t,e,n){return this.isApplied(t)?void t.parent().unindent():this._pbsOverrideApply(t,e,n)},ContentTools.Tools.OrderedList._pbsOverrideApply=ContentTools.Tools.OrderedList.apply,ContentTools.Tools.OrderedList.apply=function(t,e,n){return this.isApplied(t)?void t.parent().unindent():this._pbsOverrideApply(t,e,n)},ContentTools.Tools.Preformatted.canApply=function(t,e){return ContentTools.Tools.Heading1.canApply(t,e)},ContentTools.Tools.Preformatted._pbsOverrideApply=ContentTools.Tools.Preformatted.apply,ContentTools.Tools.Preformatted.apply=function(t,e,n){return this.isApplied(t)?(t.tagName("p"),void t.taint()):this._pbsOverrideApply(t,e,n)},ContentTools.Tools.Preformatted.isApplied=function(t){return t.tagName()===this.tagName},ContentTools.Tools.Bold.canApply=function(t,e){return t.content?e:!1},ContentTools.Tools.Bold.isApplied=function(t,e){var n=0,o=0,i;if(void 0===t.content||!t.content.length())return!1;e&&(i=e.get(),n=i[0],o=i[1]),n===o&&(n=0,o=t.content.length());var r=t.content.substring(n,o),s=r.getStyle("font-weight",t);return r.hasTags("strong",!0)||r.hasTags("b",!0)?!0:"bold"===s},ContentTools.Tools.Bold.apply=function(t,e,n){this.tagName="span";var o=0,i=0,r;t.storeState(),e&&(r=e.get(),o=r[0],i=r[1]),o===i&&(o=0,i=t.content.length());var s=t.content.substring(o,i);if(s.hasTags("strong",!0))t.content=t.content.unformat(o,i,new HTMLString.Tag("strong"));else if(s.hasTags("b",!0))t.content=t.content.unformat(o,i,new HTMLString.Tag("b"));else{var a=s.getStyle("font-weight",t);a=a&&"normal"!==a?"normal":"bold";var l={"font-weight":a};t.content=t.content.style(o,i,t._tagName,l)}return t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},ContentTools.Tools.Italic.canApply=function(t,e){return ContentTools.Tools.Bold.canApply(t,e)},ContentTools.Tools.Italic.isApplied=function(t,e){var n=0,o=0,i;if(void 0===t.content||!t.content.length())return!1;e&&(i=e.get(),n=i[0],o=i[1]),n===o&&(n=0,o=t.content.length());var r=t.content.substring(n,o),s=r.getStyle("font-style",t);return r.hasTags("em",!0)||r.hasTags("i",!0)?!0:"italic"===s},ContentTools.Tools.Italic.apply=function(t,e,n){this.tagName="span";var o=0,i=0,r;t.storeState(),e&&(r=e.get(),o=r[0],i=r[1]),o===i&&(o=0,i=t.content.length());var s=t.content.substring(o,i);if(s.hasTags("em",!0))t.content=t.content.unformat(o,i,new HTMLString.Tag("em"));else if(s.hasTags("i",!0))t.content=t.content.unformat(o,i,new HTMLString.Tag("i"));else{var a=s.getStyle("font-style",t);a=a&&"normal"!==a?"normal":"italic";var l={"font-style":a};t.content=t.content.style(o,i,t._tagName,l)}return t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},ContentTools.Tools.Link.isApplied=function(t,e){if("Image"===t.constructor.name)return t.a;if(e){var n,o,i;return void 0!==t.content&&t.content.length()?(i=e.get(),n=i[0],o=i[1],n===o&&(o+=1),t.content.slice(n,o).hasTags(this.tagName,!0)):!1}},ContentTools.Tools.Paragraph._overrideApply=ContentTools.Tools.Paragraph.apply,ContentTools.Tools.Paragraph.apply=function(t,e,n){var o,i,r,s;if(o=ContentTools.EditorApp.get(),i=o.ctrlDown(),ContentTools.Tools.Heading.canApply(t)&&!i);else if("DivCol"===t.parent().constructor.name||"Div"===t.parent().constructor.name)return s=t.parent(),r=new ContentEdit.Text("p"),s.attach(r,s.children.indexOf(t)+1),r.focus(),n(!0);return this._overrideApply(t,e,n)},ContentTools.ToolUI.prototype._overrideHoldOnMouseDown=ContentTools.ToolUI.prototype._onMouseDown,ContentTools.ToolUI.prototype._onMouseDown=function(t){var e=this._overrideHoldOnMouseDown(t);if(!this.tool.doHold)return e;clearTimeout(this._holdTimeout),clearInterval(this._holdInterval);var n,o;if(this._mouseDown){if(n=ContentEdit.Root.get().focused(),!n||!n.isMounted())return;o=null,n.selection&&(o=n.selection()),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.tool.doHold(n,o)}.bind(this),30)}.bind(this),500)}return e},ContentTools.ToolUI.prototype._overrideHoldOnMouseUp=ContentTools.ToolUI.prototype._onMouseUp,ContentTools.ToolUI.prototype._onMouseUp=function(t){return clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),this._overrideHoldOnMouseUp(t)},ContentTools.Tools.Underline=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),ContentTools.ToolShelf.stow(e,"underline"),e.label="Underline",e.icon="underline",e.tagName="span",e.canApply=function(t,e){return ContentTools.Tools.Bold.canApply(t,e)},e.isApplied=function(t,e){var n=0,o=0,i;return void 0!==t.content&&t.content.length()?(e&&(i=e.get(),n=i[0],o=i[1]),n===o&&(n=0,o=t.content.length()),t.content.hasStyle(n,o,"text-decoration")):!1},e.apply=function(t,e,n){var o,i,r;t.storeState(),r=e.get(),o=r[0],i=r[1],o===i&&(o=0,i=t.content.length());var s=t.content.substring(o,i).getStyle("text-decoration",t);s=s&&"none"!==s?"none":"underline";var a={"text-decoration":s};return t.content=t.content.style(o,i,t._tagName,a),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e}(ContentTools.Tool),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(t){return t.push('img.alignright,img.alignleft,img.alignnone,img.aligncenter,img[class*="wp-image-"]'),t}),wp.hooks.addFilter("pbs.toolbar_tools",function(t,e,n){if("IMG"!==n.tagName&&"DL"!==n.tagName)return t;if(!(n.classList.contains("alignleft")||n.classList.contains("alignright")||n.classList.contains("aligncenter")||n.classList.contains("alignnone"))&&-1===n.getAttribute("class").indexOf("wp-image-"))return t;var o;return o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-left"),o.setAttribute("data-tooltip","Align left"),n.classList.contains("alignleft")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return n._ceElement&&"Image"===n._ceElement.constructor.name?(n._ceElement.removeCSSClass("alignleft"),n._ceElement.removeCSSClass("alignright"),n._ceElement.removeCSSClass("aligncenter"),n._ceElement.removeCSSClass("alignnone"),void n._ceElement.addCSSClass("alignleft")):(n.classList.remove("alignleft","alignright","alignnone","aligncenter"),n.classList.add("alignleft"),void _pbsImageTriggerParentChange(n))}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-center"),o.setAttribute("data-tooltip","Align center"),n.classList.contains("aligncenter")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return n._ceElement&&"Image"===n._ceElement.constructor.name?(n._ceElement.removeCSSClass("alignleft"),n._ceElement.removeCSSClass("alignright"),n._ceElement.removeCSSClass("aligncenter"),n._ceElement.removeCSSClass("alignnone"),void n._ceElement.addCSSClass("aligncenter")):(n.classList.remove("alignleft","alignright","alignnone","aligncenter"),n.classList.add("aligncenter"),void _pbsImageTriggerParentChange(n))}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-right"),o.setAttribute("data-tooltip","Align right"),n.classList.contains("alignright")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return n._ceElement&&"Image"===n._ceElement.constructor.name?(n._ceElement.removeCSSClass("alignleft"),n._ceElement.removeCSSClass("alignright"),n._ceElement.removeCSSClass("aligncenter"),n._ceElement.removeCSSClass("alignnone"),void n._ceElement.addCSSClass("alignright")):(n.classList.remove("alignleft","alignright","alignnone","aligncenter"),n.classList.add("alignright"),void _pbsImageTriggerParentChange(n))}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-none"),o.setAttribute("data-tooltip","Align none"),n.classList.contains("alignnone")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){return n._ceElement&&"Image"===n._ceElement.constructor.name?(n._ceElement.removeCSSClass("alignleft"),n._ceElement.removeCSSClass("alignright"),n._ceElement.removeCSSClass("aligncenter"),n._ceElement.removeCSSClass("alignnone"),void n._ceElement.addCSSClass("alignnone")):(n.classList.remove("alignleft","alignright","alignnone","aligncenter"),n.classList.add("alignnone"),void _pbsImageTriggerParentChange(n))}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip","Edit"),o.addEventListener("click",function(){if(n._ceElement&&n._ceElement.openMediaManager)return void n._ceElement.openMediaManager();var t=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(n)});t.state("image-details").on("update",function(t){_pbsUpdateNonCaptionedImage(n,t)}),t.on("close",function(){wp.media.editor.remove("edit"),t.detach()})}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip","Remove"),o.addEventListener("click",function(){var t=n.parentNode;return n._ceElement&&"Image"===n._ceElement.constructor.name?void n._ceElement.parent().detach(n._ceElement):("A"===t.tagName?(t=t.parentNode,t.removeChild(n.parentNode)):t.removeChild(n),void _pbsImageTriggerParentChange(t))}),t.push(o),t});var _pbsImageGetMetaData=function(t){var e=t.getAttribute("class").match(/wp-image-(\d+)/),n=t.getAttribute("class").match(/align(\w+)/),o=t.getAttribute("class").match(/size-(\w+)/),i,r=t.getAttribute("class").split(" "),s=[],a=/wp-image-\d+|align\w+|size-\w+|ce-element[-\w]*/;if(t._ceElement&&t._ceElement.a&&t._ceElement.a["class"]){var l=t._ceElement.a["class"].split(" ");for(i in l)l[i].match(a)||s.push(l[i])}for(i in r)r[i].match(a)||s.push(r[i]);var d={attachment_id:e?e[1]:!1,size:o?o[1]:"custom",caption:"",align:n?n[1]:"none",extraClasses:s.join(" "),link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""};d.url=t.getAttribute("src"),d.alt=t.getAttribute("alt"),d.title=t.getAttribute("title");var c=t.getAttribute("width"),u=t.getAttribute("height");d.customWidth=d.width=c,d.customHeight=d.height=u;for(var p=[],m=t.parentNode;null!==m&&"undefined"!=typeof m.classList&&!m.classList.contains("wp-caption");)m=m.parentNode;if(m&&m.classList){var h=m.classList;for(i=0;i<h.length;i++){var g=h.item(i);/^align/.test(g)?d.align=g.replace("align",""):g&&"wp-caption"!==g&&p.push(g)}d.captionClassName=p.join(" ");var f=m.querySelector(".wp-caption-text");f&&(d.caption=f.innerHTML.replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}if(t.parentNode&&"A"===t.parentNode.nodeName){var _=t.parentNode;d.linkUrl=_.getAttribute("href"),d.linkTargetBlank="_blank"===_.getAttribute("target")?!0:!1,d.linkRel=_.getAttribute("rel"),d.linkClassName=_.className}return t._ceElement&&t._ceElement.a&&(d.linkUrl=t._ceElement.a.href,d.linkTargetBlank="_blank"===t._ceElement.a.target?!0:!1,d.linkRel=t._ceElement.a.rel,d.linkClassName=t._ceElement.a["class"]),d},_pbsToolbarImageHasTextContent=function(t){return t&&!(!t.textContent&&!t.innerText)},_pbsToolbarImageGetParent=function(t,e){for(;t&&t.parentNode;){if(t.className&&-1!==(" "+t.className+" ").indexOf(" "+e+" "))return t;t=t.parentNode}return!1},_pbsUpdateNonCaptionedImage=function(t,e){var n,o,i,r,s,a,l,d,c;n=e.extraClasses.split(" "),n||(n=[]),e.caption||n.push("align"+e.align),e.attachment_id&&(n.push("wp-image-"+e.attachment_id),e.size&&"custom"!==e.size&&n.push("size-"+e.size)),l=e.width,d=e.height,"custom"===e.size&&(l=e.customWidth,d=e.customHeight),s={src:e.url,width:l||null,height:d||null,alt:e.alt,title:e.title||null,"class":n.join(" ")||null};for(var u in s)t.setAttribute(u,s[u]);if(a={href:e.linkUrl,rel:e.linkRel||null,target:e.linkTargetBlank?"_blank":null,"class":e.linkClassName||null},t.parentNode&&"A"===t.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(t.parentNode))if(e.linkUrl)for(u in a)null!==a[u]&&t.parentNode.setAttribute(u,a[u]);else{var p=t.parentNode;p.parentNode.insertBefore(t,p),p.parentNode.removeChild(p)}else if(e.linkUrl){var m=_pbsToolbarImageGetParent(t,"a");m&&t.parentNode.insertBefore(m,t.nextSibling),m=document.createElement("a");for(var h in a)null!==a[h]&&m.setAttribute(h,a[h]);t.parentNode.insertBefore(m,t),m.appendChild(t)}i=_pbsToolbarImageGetParent(t,".mceTemp"),o=t.parentNode&&"A"===t.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(t.parentNode)?t.parentNode:t;for(var g=null,f=o;f;){if(f._ceElement){g=f._ceElement;break}f=f.parentNode}if(e.caption){r=e.attachment_id?"attachment_"+e.attachment_id:null,c="align"+(e.align||"none");var _={tag:"caption",type:"closed",content:o.outerHTML+" "+e.caption,attrs:{id:r,align:c,width:l}},v=new wp.shortcode(_).string();return o.outerHTML=v,g.content&&(g.content=new HTMLString.String(g._domElement.innerHTML,!1)),g.updateInnerHTML(),void("undefined"!=typeof g.convertShortcodes&&g.convertShortcodes())}g.content=new HTMLString.String(g._domElement.innerHTML,!1),g.updateInnerHTML(),g.taint()},_pbsToolbarImageGetParent=function(t,e){for(;t&&t.parentNode;){if(t.className&&-1!==(" "+t.className+" ").indexOf(" "+e+" "))return t;t=t.parentNode}return!1},_pbsUpdateNonCaptionedImageCTElement=function(t,e){var n,o,i,r,s,a,l;n=e.extraClasses.split(" "),n||(n=[]),e.caption||n.push("align"+e.align),e.attachment_id&&(n.push("wp-image-"+e.attachment_id),e.size&&"custom"!==e.size&&n.push("size-"+e.size)),s=e.width,a=e.height,"custom"===e.size&&(s=e.customWidth,a=e.customHeight),i={src:e.url,width:s||null,height:a||null,alt:e.alt,title:e.title||null,"class":n.join(" ")||null},t._aspectRatio=a/s,t.size([s,a]),t.removeCSSClass("alignleft"),t.removeCSSClass("alignright"),t.removeCSSClass("aligncenter"),t.removeCSSClass("alignnone");for(var d in n)n[d]&&t.addCSSClass(n[d]);for(var c in i)"class"!==c&&(null!==i[c]?t.attr(c,i[c]):t.removeAttr(c));if(r={href:e.linkUrl,rel:e.linkRel||null,target:e.linkTargetBlank?"_blank":null,"class":e.linkClassName||null},t.a)if(e.linkUrl)for(c in r)null!==r[c]?t.a[c]=r[c]:delete t.a[c];else t.a=null;else if(e.linkUrl){t.a={};for(c in r)null!==r[c]&&(t.a[c]=r[c])}if(e.caption){o=e.attachment_id?"attachment_"+e.attachment_id:null,l="align"+(e.align||"none");var u={tag:"caption",type:"closed",content:t.html()+" "+e.caption,attrs:{id:o,align:l,width:s}},p=new wp.shortcode(u),m=ContentEdit.Shortcode.createShortcode(wp.shortcode.next("caption",p.string(),0)),h=t.parent().children.indexOf(t);return t.parent().attach(m,h),t.parent().detach(t),void m.ajaxUpdate(!0)}};wp.hooks.addFilter("pbs.has_toolbar_selectors",function(t){return t.push('[data-base="caption"]'),t}),wp.hooks.addFilter("pbs.toolbar_tools",function(t,e,n){if("caption"!==n.getAttribute("data-base"))return t;var o=document.createElement("DIV");return o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-left"),o.setAttribute("data-tooltip","Align left"),"alignleft"===n._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){n._ceElement.setSCAttr("align","alignleft")}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-center"),o.setAttribute("data-tooltip","Align center"),"aligncenter"===n._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){n._ceElement.setSCAttr("align","aligncenter")}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-right"),o.setAttribute("data-tooltip","Align right"),"alignright"===n._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){n._ceElement.setSCAttr("align","alignright")}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-align-none"),o.setAttribute("data-tooltip","Align none"),"alignnone"===n._ceElement.model.get("align")&&o.classList.add("pbs-toolbar-highlight"),o.addEventListener("click",function(){n._ceElement.setSCAttr("align","alignnone")}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip","Edit"),o.addEventListener("click",function(){var t=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(n.querySelector("img"))});t.state("image-details").on("update",function(t){_pbsUpdateCaptionedImage(n,t)}),t.on("close",function(){wp.media.editor.remove("edit"),t.detach()})}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip","Remove"),o.addEventListener("click",function(){n._ceElement.parent().detach(n._ceElement)}),t.push(o),t},999);var _pbsUpdateCaptionedImage=function(t,e){var n=t;t=t.querySelector("img");var o,i,r,s,a,l,d,c,u,p,m;o=e.extraClasses.split(" "),o||(o=[]),e.caption||o.push("align"+e.align),e.attachment_id&&(o.push("wp-image-"+e.attachment_id),e.size&&"custom"!==e.size&&o.push("size-"+e.size)),u=e.width,p=e.height,"custom"===e.size&&(u=e.customWidth,p=e.customHeight),d={src:e.url,width:u||null,height:p||null,alt:e.alt,title:e.title||null,"class":o.join(" ")||null};for(s in d)t.setAttribute(s,d[s]);if(c={href:e.linkUrl,rel:e.linkRel||null,target:e.linkTargetBlank?"_blank":null,"class":e.linkClassName||null},t.parentNode&&"A"===t.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(t.parentNode))if(e.linkUrl)for(s in c)null!==c[s]&&t.parentNode.setAttribute(s,c[s]);else{var h=t.parentNode;h.parentNode.insertBefore(t,h),h.parentNode.removeChild(h)}else if(e.linkUrl){(r=_pbsToolbarImageGetParent(t,"a"))&&t.parentNode.insertBefore(r,t.nextSibling),r=document.createElement("a");for(var g in c)null!==c[g]&&r.setAttribute(g,c[g]);t.parentNode.insertBefore(r,t),r.appendChild(t)}a=_pbsToolbarImageGetParent(t,".mceTemp"),i=t.parentNode&&"A"===t.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(t.parentNode)?t.parentNode:t;var f=n._ceElement;if(e.caption)l=e.attachment_id?"attachment_"+e.attachment_id:null,m="align"+(e.align||"none"),f.setSCAttr("id",m),f.setSCAttr("align",m),f.setSCAttr("width",u),f.setSCContent(i.outerHTML+" "+e.caption);else{f.isFocused()&&f.blur();var _=document.createElement("p");_.innerHTML=i.outerHTML;var v=ContentEdit.Image.fromDOMElement(_.firstChild);f.parent().attach(v,f.parent().children.indexOf(f)+1),f.parent().detach(f)}},_pbsImageTriggerParentChange=function(t){for(var e=t;e;){if(e._ceElement){var n=e._ceElement;if(n.content){n.content=new HTMLString.String(e.innerHTML,n.content.preserveWhitespace()),n.updateInnerHTML(),n.taint();break}}e=e.parentNode}};wp.hooks.addFilter("pbs.has_toolbar_selectors",function(t){return t.push("a[href]"),t}),wp.hooks.addFilter("pbs.toolbar_tools",function(t,e,n){if("A"!==n.tagName)return t;if(!n.getAttribute("href"))return t;if(n.innerHTML.match(/<img/g))return t;var o=document.createElement("DIV");return o.classList.add("pbs-tool-label"),o.classList.add("pbs-tool-label-link"),o.innerHTML=n.getAttribute("href"),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-link-visit"),o.setAttribute("data-tooltip","Visit Link"),o.addEventListener("click",function(){window.open(n.getAttribute("href"),"_linktool")}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip","Edit Link"),o.addEventListener("click",function(){for(var t=n;!t._ceElement;)t=t.parentNode;var e=t._ceElement.content.indexOf(n.innerHTML),o=new ContentSelect.Range(e,e);o.select(t),window.PBSEditor.getToolUI("link").apply(t._ceElement,o,function(){})}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-link-unlink"),o.setAttribute("data-tooltip","Unlink"),o.addEventListener("click",function(){for(var t=n;!t._ceElement;)t=t.parentNode;var e=t._ceElement.content.indexOf(n.innerHTML),o=ContentTools.Tools.Link.getSelectedLink(t._ceElement,e,e),i=o.from,r=o.to;t._ceElement.content=t._ceElement.content.unformat(i,r,"a"),t._ceElement.updateInnerHTML(),t._ceElement.taint()}),t.push(o),t}),wp.hooks.addFilter("pbs.has_toolbar_selectors",function(t){return t.push("[data-shortcode]"),t}),wp.hooks.addFilter("pbs.toolbar_tools",function(t,e,n){if(!n.getAttribute("data-shortcode"))return t;if("caption"===n.getAttribute("data-base"))return t;var o=document.createElement("DIV");return o.classList.add("pbs-tool-label"),o.innerHTML=n.getAttribute("data-base"),o.addEventListener("click",function(){}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-edit"),o.setAttribute("data-tooltip","Edit Shortcode"),o.addEventListener("click",function(){
n._ceElement.convertToText()}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-clone"),o.setAttribute("data-tooltip","Clone"),o.addEventListener("click",function(){n._ceElement.clone()}),t.push(o),o=document.createElement("DIV"),o.classList.add("pbs-tool"),o.classList.add("pbs-image-remove"),o.setAttribute("data-tooltip","Remove"),o.addEventListener("click",function(){n._ceElement?(n._ceElement.isFocused()&&n._ceElement.blur(),n._ceElement.parent().detach(n._ceElement)):n.parentNode._ceElement?(n.parentNode._ceElement.isFocused()&&n.parentNode._ceElement.blur(),n.parentNode._ceElement.parent().detach(n.parentNode._ceElement)):n.parentNode.removeChild(n)}),t.push(o),t});